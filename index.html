<html lang="es"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ModaStyle - Tienda de Ropa, Accesorios y Hogar</title>
    
    <!-- Estilos CSS -->
    <style>body { margin: 0; }</style><style>body { margin: 0; }</style><style>body { margin: 0; }</style><style>body { margin: 0; }</style><style>body { margin: 0; }</style><style>body { margin: 0; }</style><style>
        :root {
            --primary: #1a1a1a;
            --secondary: #333333;
            --accent: #D4AF37;
            --light: #f8f8f8;
            --medium: #e0e0e0;
            --dark: #0a0a0a;
            --text: #333333;
            --text-light: #666666;
            --success: #2e8b57;
            --warning: #ffa500;
            --error: #cc3333;
            --admin: #8B5CF6;
            
            --color-todo: #D4AF37;
            --color-hombre: #2563EB;
            --color-mujer: #DB2777;
            --color-kids: #059669;
            --color-accesorios: #7C3AED;
            
            --cupon-envio: #10b981;
            --cupon-descuento: #059669;
            --cupon-2x1: #3b82f6;
            --cupon-3x2: #8b5cf6;
            --cupon-flash: #f59e0b;
            
            --border-radius: 8px;
            --border-radius-sm: 4px;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            --shadow-hover: 0 4px 12px rgba(0, 0, 0, 0.08);
            --transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.1);
            --container-width: 1200px;
            --header-height: 60px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
            font-size: 14px;
        }

        body {
            font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--light);
            color: var(--text);
            line-height: 1.4;
            overflow-x: hidden;
        }

        .container {
            max-width: var(--container-width);
            margin: 0 auto;
            padding: 0 15px;
        }

        /* Header */
        .main-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            height: var(--header-height);
            z-index: 1000;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.05);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 100%;
            gap: 15px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            color: var(--primary);
            flex-shrink: 0;
        }

        .logo-icon {
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.8rem;
            box-shadow: 0 1px 4px rgba(212, 175, 55, 0.3);
        }

        .logo-text {
            font-size: 1.1rem;
            font-weight: 700;
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .search-container {
            flex: 1;
            max-width: 400px;
            position: relative;
            margin: 0 15px;
        }

        .search-input {
            width: 100%;
            padding: 10px 15px 10px 40px;
            border: 1px solid var(--medium);
            border-radius: var(--border-radius);
            background: var(--light);
            font-size: 0.85rem;
            transition: var(--transition);
            outline: none;
            color: var(--text);
        }

        .search-input:focus {
            border-color: var(--accent);
            background: white;
            box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.1);
        }

        .search-input::placeholder {
            color: var(--text-light);
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-hover);
            margin-top: 5px;
            z-index: 1001;
            max-height: 400px;
            overflow-y: auto;
            display: none;
            border: 1px solid var(--medium);
        }

        .search-results.active {
            display: block;
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .search-result-item {
            padding: 12px 15px;
            border-bottom: 1px solid var(--light);
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: var(--transition);
        }

        .search-result-item:hover {
            background: var(--light);
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-image {
            width: 45px;
            height: 45px;
            object-fit: cover;
            border-radius: var(--border-radius-sm);
            flex-shrink: 0;
        }

        .search-result-info {
            flex: 1;
            min-width: 0;
        }

        .search-result-name {
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 3px;
            color: var(--primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .search-result-category {
            font-size: 0.7rem;
            color: var(--text-light);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .search-result-price {
            font-weight: 700;
            color: var(--accent);
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .search-no-results {
            padding: 20px;
            text-align: center;
            color: var(--text-light);
        }

        .search-no-results i {
            font-size: 1.5rem;
            margin-bottom: 8px;
            color: var(--medium);
        }

        .search-no-results p {
            margin: 0;
            font-size: 0.85rem;
        }

        .clear-search {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            padding: 5px;
            display: none;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }

        .clear-search:hover {
            background: var(--medium);
            color: var(--primary);
        }

        .clear-search.active {
            display: flex;
        }

        .admin-btn {
            background: linear-gradient(135deg, var(--admin), #7C3AED);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            padding: 8px 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 1px 4px rgba(139, 92, 246, 0.3);
            margin-left: auto;
            margin-right: 10px;
        }

        .admin-btn:hover {
            background: linear-gradient(135deg, #7C3AED, var(--admin));
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(139, 92, 246, 0.4);
        }

        .nav-links {
            display: flex;
            gap: 20px;
            list-style: none;
        }

        .nav-link {
            text-decoration: none;
            color: var(--text);
            font-weight: 500;
            padding: 4px 0;
            position: relative;
            transition: var(--transition);
            font-size: 0.85rem;
            letter-spacing: 0.3px;
        }

        .nav-link:hover {
            color: var(--accent);
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 1px;
            background: linear-gradient(90deg, var(--accent), var(--primary));
            transition: var(--transition);
        }

        .nav-link:hover::after {
            width: 100%;
        }

        .hero-section {
            padding: 80px 0 30px;
            background: linear-gradient(135deg, #f5f5f5 0%, #ffffff 100%);
            position: relative;
            overflow: hidden;
        }

        .hero-content {
            text-align: center;
            max-width: 700px;
            margin: 0 auto;
            position: relative;
            z-index: 2;
        }

        .hero-title {
            font-size: 2rem;
            font-weight: 800;
            line-height: 1.1;
            margin-bottom: 15px;
            color: var(--primary);
            letter-spacing: -0.5px;
        }

        .hero-highlight {
            color: var(--accent);
            font-weight: 700;
        }

        .hero-badges {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 25px;
        }

        .badge {
            padding: 6px 12px;
            background: white;
            border-radius: var(--border-radius-sm);
            font-size: 0.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(212, 175, 55, 0.2);
            transition: var(--transition);
        }

        .badge:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-hover);
            border-color: var(--accent);
        }

        .badge i {
            color: var(--accent);
            font-size: 0.85rem;
        }

        .categories-section {
            padding: 40px 0;
            background: var(--light);
        }

        .section-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.6rem;
            font-weight: 800;
            margin-bottom: 10px;
            color: var(--primary);
            position: relative;
            display: inline-block;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 2px;
            background: linear-gradient(90deg, var(--accent), var(--primary));
            border-radius: 1px;
        }

        .section-subtitle {
            color: var(--text-light);
            font-size: 0.9rem;
            max-width: 500px;
            margin: 0 auto;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .category-card {
            position: relative;
            border-radius: var(--border-radius);
            overflow: hidden;
            height: 250px;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .category-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
        }

        .category-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
        }

        .category-card:hover .category-image {
            transform: scale(1.05);
        }

        .category-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            color: white;
            padding: 20px 15px 15px;
        }

        .category-name {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .category-description {
            font-size: 0.85rem;
            opacity: 0.9;
            margin-bottom: 10px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            min-height: 28px;
        }

        .category-badge {
            display: inline-block;
            padding: 4px 10px;
            background: var(--accent);
            color: var(--dark);
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            font-size: 0.75rem;
        }

        .products-section {
            padding: 50px 0;
            background: linear-gradient(135deg, #ffffff 0%, #fafafa 100%);
        }

        .category-filters {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .category-filter {
            padding: 6px 12px;
            background: white;
            border: 1px solid var(--medium);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            color: var(--text);
            font-size: 0.8rem;
        }

        .category-filter:hover {
            border-color: var(--accent);
            transform: translateY(-1px);
        }

        .category-filter.active {
            color: white;
            border-color: transparent;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.2);
        }

        .category-filter[data-color="todo"].active {
            background: var(--color-todo);
        }
        .category-filter[data-color="hombre"].active {
            background: var(--color-hombre);
        }
        .category-filter[data-color="mujer"].active {
            background: var(--color-mujer);
        }
        .category-filter[data-color="kids"].active {
            background: var(--color-kids);
        }
        .category-filter[data-color="accesorios"].active {
            background: var(--color-accesorios);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .product-card {
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid rgba(0, 0, 0, 0.05);
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
        }

        .product-image-container {
            position: relative;
            overflow: hidden;
            height: 180px;
        }

        .product-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
            cursor: pointer;
        }

        .product-card:hover .product-image {
            transform: scale(1.05);
        }

        .product-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 3px 8px;
            font-size: 0.65rem;
            font-weight: 700;
            border-radius: var(--border-radius-sm);
            text-transform: uppercase;
            letter-spacing: 0.3px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.2);
            z-index: 2;
        }

        .product-badge.oferta {
            background: #FFD700;
            color: #333;
        }
        .product-badge.nuevo {
            background: #32CD32;
            color: white;
        }
        .product-badge.agotado {
            background: #ff4757;
            color: white;
        }

        .product-info {
            padding: 8px;
        }

        .product-category {
            color: var(--accent);
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .product-title {
            font-size: 0.85rem;
            font-weight: 700;
            margin-bottom: 4px;
            color: #000000;
            line-height: 1.2;
            min-height: 28px;
        }

        .product-price-container {
            margin-bottom: 6px;
        }

        .sale-price-container {
            display: flex;
            align-items: center;
            gap: 4px;
            margin-bottom: 6px;
        }

        .original-price {
            font-size: 0.85rem;
            color: var(--text-light);
            text-decoration: line-through;
            font-weight: 500;
        }

        .sale-price {
            font-size: 1rem;
            font-weight: 800;
            color: var(--accent);
        }

        .discount-badge {
            padding: 1px 4px;
            background: #FFD700;
            color: #333;
            border-radius: var(--border-radius-sm);
            font-size: 0.6rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .product-description {
            color: var(--text-light);
            margin-bottom: 6px;
            line-height: 1.3;
            font-size: 0.75rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            min-height: 28px;
        }

        .product-features {
            display: flex;
            flex-direction: column;
            gap: 3px;
            margin-bottom: 6px;
        }

        .feature {
            display: flex;
            align-items: center;
            gap: 4px;
            color: var(--text);
            font-size: 0.7rem;
        }

        .feature i {
            color: var(--accent);
            width: 12px;
            font-size: 0.65rem;
        }

        .variant-selector {
            margin-bottom: 6px;
        }

        .variant-label {
            display: block;
            margin-bottom: 3px;
            font-weight: 600;
            color: var(--primary);
            font-size: 0.75rem;
        }

        .variant-options {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
        }

        .variant-btn {
            padding: 3px 6px;
            border: 1px solid var(--medium);
            background: white;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            font-size: 0.7rem;
            min-width: 32px;
        }

        .variant-btn:hover:not(.disabled) {
            border-color: var(--accent);
            transform: translateY(-1px);
        }

        .variant-btn.selected {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .variant-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .product-actions {
            display: flex;
            gap: 4px;
            margin-top: 8px;
        }

        .add-to-cart-btn {
            flex: 1;
            padding: 6px 8px;
            background: linear-gradient(135deg, var(--accent), #c19b2e);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            font-size: 0.75rem;
        }

        .add-to-cart-btn:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(212, 175, 55, 0.4);
            background: linear-gradient(135deg, #c19b2e, var(--accent));
        }

        .add-to-cart-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .image-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.92);
            backdrop-filter: blur(10px);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .image-modal-overlay.active {
            display: flex;
        }

        .image-modal {
            max-width: 90%;
            max-height: 90vh;
            position: relative;
        }

        .image-modal img {
            width: 100%;
            height: auto;
            max-height: 85vh;
            object-fit: contain;
            border-radius: var(--border-radius);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .close-image-modal {
            position: absolute;
            top: -30px;
            right: -5px;
            width: 35px;
            height: 35px;
            background: rgba(255, 255, 255, 0.15);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            backdrop-filter: blur(5px);
        }

        .close-image-modal:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: rotate(90deg);
        }

        .cart-icon {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 65px;
            height: 65px;
            background: linear-gradient(135deg, #D4AF37, #B8962E, #9C7D26);
            color: white;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
            transition: var(--transition);
            border: 3px solid white;
            font-weight: 600;
        }

        .cart-icon:hover {
            transform: scale(1.08) translateY(-3px);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
            background: linear-gradient(135deg, #B8962E, #D4AF37, #9C7D26);
        }

        .cart-icon:active {
            transform: scale(0.98);
        }

        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(135deg, #ff6b6b, #ff5252);
            color: white;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(255, 107, 107, 0.4);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .cart-panel {
            position: fixed;
            top: 0;
            right: -350px;
            width: 320px;
            height: 100vh;
            background: linear-gradient(180deg, #ffffff 0%, #fafafa 100%);
            box-shadow: -3px 0 15px rgba(0, 0, 0, 0.1);
            z-index: 1001;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
        }

        .cart-panel.open {
            right: 0;
        }

        .cart-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .cart-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .cart-header {
            padding: 15px;
            background: linear-gradient(135deg, var(--primary), #2a2a2a);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-title {
            font-size: 1.1rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .close-cart {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .close-cart:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
            border-color: var(--accent);
        }

        .cart-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            background: linear-gradient(180deg, #fafafa 0%, #f5f5f5 100%);
        }

        .coupon-section {
            background: white;
            border-radius: var(--border-radius-sm);
            padding: 12px;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .coupon-title {
            font-size: 0.9rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .coupon-title i {
            color: #10b981;
        }

        .coupon-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
            max-height: 250px;
            overflow-y: auto;
            padding-right: 2px;
        }

        .coupon-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 10px;
            border-radius: var(--border-radius-sm);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05));
            border: 1px solid rgba(16, 185, 129, 0.2);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            flex-wrap: wrap;
        }

        .coupon-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.15);
            border-color: #10b981;
        }

        .coupon-item.applied {
            background: linear-gradient(135deg, #10b981, #059669);
            border-color: #059669;
            color: white;
            cursor: default;
        }

        .coupon-item.applied .coupon-code,
        .coupon-item.applied .coupon-description,
        .coupon-item.applied .coupon-icon {
            color: white;
        }

        .coupon-item.expired {
            opacity: 0.6;
            background: linear-gradient(135deg, rgba(100, 116, 139, 0.1), rgba(100, 116, 139, 0.05));
            border-color: rgba(100, 116, 139, 0.3);
            cursor: not-allowed;
            pointer-events: none;
        }

        .coupon-item.expired .coupon-code,
        .coupon-item.expired .coupon-description,
        .coupon-item.expired .coupon-icon {
            color: #64748b;
        }

        .coupon-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            flex-shrink: 0;
        }

        .coupon-info {
            flex: 1;
            min-width: 0;
        }

        .coupon-code {
            font-weight: 700;
            font-size: 0.8rem;
            margin-bottom: 2px;
            color: #059669;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .coupon-description {
            font-size: 0.7rem;
            color: var(--text-light);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 4px;
        }

        .coupon-timer {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.65rem;
            color: var(--text-light);
            background: rgba(0, 0, 0, 0.05);
            padding: 3px 6px;
            border-radius: 12px;
            margin-top: 4px;
            width: fit-content;
        }

        .coupon-item.expired .coupon-timer {
            background: rgba(100, 116, 139, 0.15);
            color: #64748b;
        }

        .coupon-item.applied .coupon-timer {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .coupon-timer i {
            font-size: 0.6rem;
        }

        .timer-numbers {
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .applied-badge {
            background: white;
            color: #10b981;
            padding: 2px 6px;
            border-radius: var(--border-radius-sm);
            font-size: 0.6rem;
            font-weight: 700;
            margin-left: 6px;
        }

        .expired-badge {
            background: #64748b;
            color: white;
            padding: 2px 6px;
            border-radius: var(--border-radius-sm);
            font-size: 0.6rem;
            font-weight: 700;
            margin-left: 6px;
        }

        .no-coupons {
            padding: 10px;
            text-align: center;
            color: var(--text-light);
            font-size: 0.75rem;
            background: rgba(0, 0, 0, 0.02);
            border-radius: var(--border-radius-sm);
        }

        .cart-items {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .cart-item {
            background: white;
            border-radius: var(--border-radius-sm);
            padding: 12px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            gap: 10px;
            transition: var(--transition);
        }

        .cart-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
            border-color: var(--accent);
        }

        .cart-item-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
        }

        .cart-item-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .cart-item-title {
            font-weight: 700;
            font-size: 0.85rem;
            margin-bottom: 3px;
            color: #000000;
            line-height: 1.2;
        }

        .cart-item-variant {
            color: var(--text-light);
            font-size: 0.7rem;
            margin-bottom: 2px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .cart-item-price {
            font-weight: 700;
            color: var(--accent);
            font-size: 0.9rem;
            margin-top: 3px;
        }

        .cart-item-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 6px;
        }

        .quantity-control {
            display: flex;
            align-items: center;
            gap: 6px;
            background: var(--light);
            padding: 3px 6px;
            border-radius: var(--border-radius-sm);
            border: 1px solid var(--medium);
        }

        .quantity-btn {
            width: 20px;
            height: 20px;
            border: none;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.8rem;
            transition: var(--transition);
            color: var(--primary);
        }

        .quantity-btn:hover:not(:disabled) {
            background: var(--accent);
            color: white;
            transform: scale(1.05);
        }

        .remove-item {
            padding: 4px 8px;
            background: linear-gradient(135deg, #ff6b6b, #ff5252);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .remove-item:hover {
            background: linear-gradient(135deg, #ff5252, #ff3b3b);
            transform: translateY(-1px);
        }

        .empty-cart {
            text-align: center;
            padding: 30px 15px;
            color: var(--text-light);
            display: none;
        }

        .empty-cart i {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--medium);
            opacity: 0.5;
        }

        .empty-cart h3 {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-light);
        }

        .continue-shopping {
            display: inline-block;
            padding: 6px 12px;
            background: var(--light);
            color: var(--text);
            text-decoration: none;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            transition: var(--transition);
            border: 1px solid var(--medium);
            font-size: 0.8rem;
        }

        .continue-shopping:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
            transform: translateY(-1px);
        }

        .cart-summary {
            background: white;
            border-radius: var(--border-radius-sm);
            padding: 12px;
            margin-top: 15px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 0, 0, 0.05);
            display: none;
        }

        .cart-summary.show {
            display: block;
        }

        .summary-title {
            font-size: 0.9rem;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.8rem;
            color: var(--text);
        }

        .summary-coupon-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.8rem;
            color: #10b981;
            background: rgba(16, 185, 129, 0.1);
            padding: 4px 8px;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
        }

        .summary-total {
            display: flex;
            justify-content: space-between;
            font-weight: 700;
            font-size: 1rem;
            padding-top: 12px;
            border-top: 2px solid var(--medium);
            margin-top: 12px;
            color: var(--primary);
        }

        .total-amount {
            color: var(--accent);
            font-size: 1.1rem;
        }

        .free-shipping-promo {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.1), rgba(212, 175, 55, 0.05));
            border: 1px dashed var(--accent);
            border-radius: var(--border-radius-sm);
            padding: 8px;
            margin: 12px 0;
            text-align: center;
            display: none;
        }

        .free-shipping-promo.show {
            display: block;
        }

        .promo-text {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 2px;
            font-size: 0.8rem;
        }

        .promo-subtext {
            font-size: 0.75rem;
            color: var(--text-light);
        }

        .progress-bar {
            height: 3px;
            background: var(--medium);
            border-radius: 1px;
            margin: 8px 0 6px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #c19b2e);
            border-radius: 1px;
            transition: width 0.4s ease;
        }

        .cart-actions {
            padding: 12px 15px;
            background: white;
            border-top: 1px solid var(--medium);
            display: flex;
            flex-direction: column;
            gap: 8px;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);
        }

        .checkout-btn {
            padding: 10px;
            background: linear-gradient(135deg, var(--accent), var(--primary));
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .checkout-btn:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(212, 175, 55, 0.4);
        }

        .clear-cart-btn {
            padding: 8px;
            background: var(--light);
            color: var(--text);
            border: 1px solid var(--medium);
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .clear-cart-btn:hover:not(:disabled) {
            background: #f0f0f0;
            border-color: var(--text-light);
            transform: translateY(-1px);
        }

        .checkout-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(3px);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 12px;
        }

        .checkout-modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            padding: 15px;
            max-width: 400px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-hover);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .modal-header h3 {
            margin: 0;
            color: var(--primary);
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 0.9rem;
            cursor: pointer;
            color: var(--text-light);
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .close-modal:hover {
            background: var(--light);
            color: var(--primary);
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.85rem;
        }

        .form-input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid var(--medium);
            border-radius: var(--border-radius-sm);
            font-family: inherit;
            font-size: 0.85rem;
            transition: var(--transition);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.1);
        }

        .delivery-options {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .delivery-option {
            padding: 10px;
            border: 1px solid var(--medium);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }

        .delivery-option:hover {
            border-color: var(--accent);
            background: rgba(212, 175, 55, 0.05);
        }

        .delivery-option.selected {
            border-color: var(--accent);
            background: rgba(212, 175, 55, 0.1);
        }

        .delivery-info {
            flex: 1;
        }

        .delivery-name {
            font-weight: 600;
            margin-bottom: 2px;
            color: var(--primary);
            font-size: 0.85rem;
        }

        .delivery-address {
            color: var(--text-light);
            font-size: 0.75rem;
        }

        .map-link {
            font-size: 0.75rem;
            color: var(--accent);
            text-decoration: none;
            margin-top: 3px;
            display: inline-flex;
            align-items: center;
            gap: 3px;
            transition: var(--transition);
            opacity: 0.8;
        }

        .map-link:hover {
            opacity: 1;
            color: var(--accent);
            text-decoration: underline;
        }

        .payment-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
        }

        .payment-option {
            padding: 10px;
            border: 1px solid var(--medium);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            font-weight: 600;
            font-size: 0.8rem;
        }

        .payment-option:hover {
            border-color: var(--accent);
            background: rgba(212, 175, 55, 0.05);
        }

        .payment-option.selected {
            border-color: var(--accent);
            background: rgba(212, 175, 55, 0.1);
        }

        .transfer-info {
            margin-top: 12px;
            padding: 10px;
            background: var(--light);
            border-radius: var(--border-radius-sm);
            display: none;
        }

        .transfer-info.show {
            display: block;
        }

        .transfer-details {
            margin-top: 6px;
        }

        .transfer-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            font-size: 0.75rem;
        }

        .transfer-label {
            color: var(--text-light);
        }

        .transfer-value {
            font-weight: 600;
            color: var(--primary);
        }

        .modal-actions {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }

        .btn-secondary {
            flex: 1;
            padding: 8px;
            background: var(--medium);
            color: var(--text);
            border: none;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.85rem;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .btn-primary {
            flex: 1;
            padding: 8px;
            background: linear-gradient(135deg, var(--accent), var(--primary));
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(212, 175, 55, 0.3);
        }

        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(3px);
            z-index: 3000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 12px;
        }

        .auth-modal.active {
            display: flex;
        }

        .auth-content {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            max-width: 400px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-hover);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .auth-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--admin), #7C3AED);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            color: white;
            font-size: 1.2rem;
        }

        .auth-title {
            font-size: 1.3rem;
            font-weight: 800;
            margin-bottom: 8px;
            color: var(--primary);
        }

        .auth-subtitle {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .admin-panel {
            position: fixed;
            top: 0;
            right: -450px;
            width: 420px;
            height: 100vh;
            background: linear-gradient(180deg, #ffffff 0%, #fafafa 100%);
            box-shadow: -3px 0 15px rgba(0, 0, 0, 0.1);
            z-index: 3001;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
        }

        .admin-panel.open {
            right: 0;
        }

        .admin-header {
            padding: 15px;
            background: linear-gradient(135deg, var(--admin), #7C3AED);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-title {
            font-size: 1.1rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .close-admin {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .close-admin:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
            border-color: white;
        }

        .admin-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: linear-gradient(180deg, #fafafa 0%, #f5f5f5 100%);
        }

        .admin-tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--medium);
            padding-bottom: 10px;
            flex-wrap: wrap;
        }

        .admin-tab {
            flex: 1;
            padding: 8px 10px;
            background: white;
            border: 1px solid var(--medium);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            text-align: center;
            font-size: 0.75rem;
            min-width: 70px;
        }

        .admin-tab:hover {
            border-color: var(--admin);
            transform: translateY(-1px);
        }

        .admin-tab.active {
            background: var(--admin);
            color: white;
            border-color: var(--admin);
        }

        .admin-section {
            display: none;
        }

        .admin-section.active {
            display: block;
        }

        .section-title-admin {
            font-size: 0.9rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .admin-form {
            background: white;
            border-radius: var(--border-radius-sm);
            padding: 12px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 0, 0, 0.05);
            margin-bottom: 15px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 10px;
        }

        .form-group-admin {
            margin-bottom: 10px;
        }

        .form-label-admin {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.8rem;
        }

        .form-input-admin {
            width: 100%;
            padding: 7px 9px;
            border: 1px solid var(--medium);
            border-radius: var(--border-radius-sm);
            font-family: inherit;
            font-size: 0.8rem;
            transition: var(--transition);
        }

        .form-input-admin:focus {
            outline: none;
            border-color: var(--admin);
            box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.1);
        }

        .form-textarea {
            width: 100%;
            padding: 7px 9px;
            border: 1px solid var(--medium);
            border-radius: var(--border-radius-sm);
            font-family: inherit;
            font-size: 0.8rem;
            transition: var(--transition);
            resize: vertical;
            min-height: 70px;
        }

        .form-select {
            width: 100%;
            padding: 7px 9px;
            border: 1px solid var(--medium);
            border-radius: var(--border-radius-sm);
            font-family: inherit;
            font-size: 0.8rem;
            transition: var(--transition);
            background: white;
        }

        .multi-input-container {
            display: flex;
            gap: 6px;
            margin-bottom: 6px;
        }

        .multi-input {
            flex: 1;
            padding: 7px 9px;
            border: 1px solid var(--medium);
            border-radius: var(--border-radius-sm);
            font-family: inherit;
            font-size: 0.8rem;
        }

        .add-btn {
            padding: 7px 10px;
            background: var(--admin);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .add-btn:hover {
            background: #7C3AED;
            transform: translateY(-1px);
        }

        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
            max-height: 100px;
            overflow-y: auto;
            padding: 5px;
            background: rgba(139, 92, 246, 0.05);
            border-radius: var(--border-radius-sm);
        }

        .tag {
            background: rgba(139, 92, 246, 0.1);
            color: var(--admin);
            padding: 3px 7px;
            border-radius: var(--border-radius-sm);
            font-size: 0.7rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .tag-remove {
            cursor: pointer;
            font-size: 0.65rem;
            opacity: 0.7;
        }

        .tag-remove:hover {
            opacity: 1;
        }

        .form-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .btn-save {
            flex: 1;
            padding: 8px;
            background: linear-gradient(135deg, var(--success), #2e8b57);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .btn-save:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(46, 139, 87, 0.3);
        }

        .btn-cancel {
            flex: 1;
            padding: 8px;
            background: var(--medium);
            color: var(--text);
            border: none;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .btn-cancel:hover {
            background: #d0d0d0;
            transform: translateY(-1px);
        }

        .variant-system-container {
            margin-bottom: 12px;
        }

        .variant-field {
            background: rgba(139, 92, 246, 0.05);
            border-radius: var(--border-radius-sm);
            padding: 8px;
            margin-bottom: 8px;
            border: 1px solid rgba(139, 92, 246, 0.1);
        }

        .variant-field-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .variant-field-title {
            font-weight: 600;
            color: var(--admin);
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .remove-variant-btn {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.65rem;
            transition: var(--transition);
        }

        .remove-variant-btn:hover {
            transform: scale(1.1);
        }

        .variant-options-container {
            margin-top: 8px;
        }

        .variant-option-item {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 4px;
        }

        .stock-system-container {
            margin-top: 12px;
        }

        .stock-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .stock-table-container {
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid var(--medium);
            border-radius: var(--border-radius-sm);
            font-size: 0.7rem;
        }

        .stock-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.7rem;
        }

        .stock-table th {
            background: var(--light);
            padding: 5px;
            text-align: left;
            font-weight: 600;
            color: var(--primary);
            border-bottom: 1px solid var(--medium);
            position: sticky;
            top: 0;
        }

        .stock-table td {
            padding: 5px;
            border-bottom: 1px solid var(--light);
        }

        .stock-input {
            width: 50px;
            padding: 3px;
            border: 1px solid var(--medium);
            border-radius: var(--border-radius-sm);
            text-align: center;
            font-size: 0.7rem;
        }

        .coupon-admin-container {
            background: white;
            border-radius: var(--border-radius-sm);
            padding: 12px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 0, 0, 0.05);
            margin-bottom: 15px;
        }

        .coupon-item-admin {
            background: rgba(16, 185, 129, 0.05);
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: var(--border-radius-sm);
            padding: 10px;
            margin-bottom: 8px;
            transition: var(--transition);
        }

        .coupon-item-admin:hover {
            background: rgba(16, 185, 129, 0.1);
            border-color: #10b981;
        }

        .coupon-header-admin {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .coupon-code-admin {
            font-weight: 700;
            color: #10b981;
            background: rgba(16, 185, 129, 0.1);
            padding: 3px 8px;
            border-radius: var(--border-radius-sm);
            font-size: 0.8rem;
        }

        .coupon-actions-admin {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .coupon-expiry-badge {
            font-size: 0.65rem;
            padding: 2px 6px;
            border-radius: 12px;
            background: rgba(245, 158, 11, 0.1);
            color: #f59e0b;
            display: inline-flex;
            align-items: center;
            gap: 3px;
        }

        .coupon-details-admin {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(16, 185, 129, 0.1);
        }

        .coupon-detail-item {
            display: flex;
            flex-direction: column;
        }

        .coupon-detail-label {
            font-size: 0.7rem;
            color: var(--text-light);
        }

        .coupon-detail-value {
            font-weight: 600;
            color: var(--primary);
            font-size: 0.8rem;
        }

        .coupon-detail-value i {
            color: #10b981;
            margin-right: 4px;
        }

        .coupon-type-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .coupon-type-option {
            flex: 1;
            padding: 8px;
            border: 1px solid var(--medium);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            text-align: center;
            transition: var(--transition);
            font-size: 0.8rem;
            min-width: 100px;
        }

        .coupon-type-option:hover {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.05);
        }

        .coupon-type-option.selected {
            background: #10b981;
            color: white;
            border-color: #10b981;
        }

        .coupon-type-option.selected i {
            color: white;
        }

        .coupon-field-group {
            margin-bottom: 10px;
        }

        .coupon-field-label {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
            color: var(--primary);
            font-size: 0.75rem;
        }

        .coupon-input {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid var(--medium);
            border-radius: var(--border-radius-sm);
            font-size: 0.8rem;
        }

        .coupon-input:focus {
            border-color: #10b981;
            outline: none;
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.1);
        }

        .coupon-expiry-row {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .coupon-expiry-field {
            flex: 1;
            min-width: 80px;
        }

        .coupons-list-admin {
            max-height: 350px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .products-list-admin {
            max-height: 350px;
            overflow-y: auto;
            border: 1px solid var(--medium);
            border-radius: var(--border-radius-sm);
            background: white;
        }

        .product-item-admin {
            padding: 8px;
            border-bottom: 1px solid var(--light);
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: move;
            transition: var(--transition);
        }

        .product-item-admin:hover {
            background: rgba(139, 92, 246, 0.05);
        }

        .product-item-admin.dragging {
            opacity: 0.5;
            background: rgba(139, 92, 246, 0.1);
        }

        .product-image-admin {
            width: 45px;
            height: 45px;
            object-fit: cover;
            border-radius: var(--border-radius-sm);
        }

        .product-info-admin {
            flex: 1;
            min-width: 0;
        }

        .product-name-admin {
            font-weight: 700;
            font-size: 0.8rem;
            margin-bottom: 2px;
            color: var(--primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .product-category-admin {
            font-size: 0.7rem;
            color: var(--text-light);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .product-price-admin {
            font-weight: 700;
            color: var(--accent);
            font-size: 0.75rem;
        }

        .product-actions-admin {
            display: flex;
            gap: 4px;
            flex-shrink: 0;
        }

        .product-action-btn {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.65rem;
        }

        .edit-btn-admin {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }

        .delete-btn-admin {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
        }

        .product-action-btn:hover {
            transform: scale(1.1);
        }

        .categories-list-admin {
            max-height: 350px;
            overflow-y: auto;
        }

        .category-item-admin {
            padding: 10px;
            border-bottom: 1px solid var(--light);
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: move;
            transition: var(--transition);
            background: white;
            border-radius: var(--border-radius-sm);
            margin-bottom: 6px;
            box-shadow: var(--shadow);
        }

        .category-item-admin:hover {
            background: rgba(139, 92, 246, 0.05);
            transform: translateY(-1px);
        }

        .category-item-admin.dragging {
            opacity: 0.5;
            background: rgba(139, 92, 246, 0.1);
        }

        .category-info-admin {
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 0;
        }

        .category-icon-admin {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .category-details-admin {
            flex: 1;
            min-width: 0;
        }

        .category-name-admin {
            font-weight: 700;
            font-size: 0.85rem;
            margin-bottom: 3px;
            color: var(--primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .category-stats-admin {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.75rem;
        }

        .category-product-count {
            color: var(--text-light);
        }

        .category-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 1px solid var(--medium);
            flex-shrink: 0;
        }

        .category-actions-admin {
            display: flex;
            gap: 4px;
            flex-shrink: 0;
        }

        .category-action-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.75rem;
        }

        .edit-category-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }

        .delete-category-btn {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
        }

        .category-action-btn:hover:not(:disabled) {
            transform: scale(1.1);
        }

        .delete-category-btn:disabled {
            background: var(--medium);
            cursor: not-allowed;
            opacity: 0.5;
        }

        .format-guide {
            margin-top: 8px;
            padding: 8px;
            background: rgba(139, 92, 246, 0.05);
            border-radius: var(--border-radius-sm);
            border: 1px solid rgba(139, 92, 246, 0.1);
        }

        .format-example {
            font-size: 0.7rem;
            padding: 3px 6px;
            background: rgba(139, 92, 246, 0.1);
            border-radius: var(--border-radius-sm);
            margin-bottom: 3px;
            color: var(--admin);
            font-family: 'Consolas', monospace;
            display: none;
        }

        .format-example.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .stat-card {
            background: white;
            border-radius: var(--border-radius-sm);
            padding: 10px;
            text-align: center;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .stat-icon {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 6px;
            font-size: 0.9rem;
            color: white;
        }

        .stat-value {
            font-size: 1.1rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 2px;
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--text-light);
        }

        .export-options {
            background: white;
            border-radius: var(--border-radius-sm);
            padding: 12px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 0, 0, 0.05);
            margin-bottom: 12px;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 8px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            color: var(--text);
        }

        .status-message {
            padding: 8px;
            border-radius: var(--border-radius-sm);
            margin-bottom: 10px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 6px;
            display: none;
        }

        .status-success {
            background: rgba(46, 139, 87, 0.1);
            border: 1px solid rgba(46, 139, 87, 0.2);
            color: var(--success);
        }

        .status-error {
            background: rgba(204, 51, 51, 0.1);
            border: 1px solid rgba(204, 51, 51, 0.2);
            color: var(--error);
        }

        .status-info {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.2);
            color: var(--admin);
        }

        .editor-container {
            background: white;
            border-radius: var(--border-radius-sm);
            padding: 12px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 0, 0, 0.05);
            margin-bottom: 12px;
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .editor-actions {
            display: flex;
            gap: 6px;
        }

        .btn-preview {
            padding: 7px 10px;
            background: var(--admin);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .btn-preview:hover {
            background: #7C3AED;
            transform: translateY(-1px);
        }

        .editor-categories-list {
            margin-top: 15px;
        }

        .editor-category-item {
            padding: 10px;
            border: 1px solid var(--medium);
            border-radius: var(--border-radius-sm);
            margin-bottom: 8px;
            background: white;
            transition: var(--transition);
        }

        .editor-category-item:hover {
            border-color: var(--admin);
            box-shadow: var(--shadow-hover);
        }

        .editor-category-item.dragging {
            opacity: 0.5;
            background: rgba(139, 92, 246, 0.05);
        }

        .editor-category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .editor-category-title {
            font-weight: 700;
            font-size: 0.85rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .editor-category-actions {
            display: flex;
            gap: 4px;
        }

        .editor-category-content {
            display: grid;
            grid-template-columns: 80px 1fr;
            gap: 10px;
        }

        .editor-category-preview {
            width: 80px;
            height: 80px;
            border-radius: var(--border-radius-sm);
            overflow: hidden;
            border: 1px solid var(--medium);
        }

        .editor-category-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .editor-category-fields {
            flex: 1;
        }

        .color-preview {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 1px solid var(--medium);
            display: inline-block;
            vertical-align: middle;
            margin-left: 4px;
        }

        .section-preview {
            background: var(--light);
            border-radius: var(--border-radius-sm);
            padding: 15px;
            margin-top: 12px;
            border: 2px dashed var(--medium);
        }

        .preview-title {
            text-align: center;
            margin-bottom: 12px;
        }

        .main-footer {
            background: linear-gradient(135deg, var(--primary), #0a0a0a);
            color: white;
            padding: 30px 0 15px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .footer-section h3 {
            font-size: 1rem;
            margin-bottom: 12px;
            color: white;
            position: relative;
            padding-bottom: 6px;
        }

        .footer-section h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 35px;
            height: 2px;
            background: var(--accent);
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 6px;
        }

        .footer-links a {
            color: #cccccc;
            text-decoration: none;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.8rem;
        }

        .footer-links a:hover {
            color: var(--accent);
            transform: translateX(2px);
        }

        .copyright {
            text-align: center;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #999999;
            font-size: 0.75rem;
        }

        @media (max-width: 992px) {
            .products-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .search-container {
                max-width: 300px;
            }
        }

        @media (max-width: 768px) {
            .products-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .form-row {
                grid-template-columns: 1fr;
            }
            .admin-panel {
                width: 100%;
                right: -100%;
            }
            .stock-table-container {
                max-height: 150px;
            }
            .editor-category-content {
                grid-template-columns: 1fr;
            }
            .editor-category-preview {
                width: 100%;
                height: 150px;
            }
            .search-container {
                max-width: 200px;
            }
            .nav-links {
                display: none;
            }
            .coupon-type-selector {
                flex-direction: column;
            }
            .coupon-expiry-row {
                flex-direction: column;
            }
        }

        @media (max-width: 576px) {
            .products-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            .product-image-container {
                height: 150px;
            }
            .product-info {
                padding: 6px;
            }
            .admin-panel {
                width: 100%;
                right: -100%;
            }
            .admin-tab {
                padding: 6px 8px;
                font-size: 0.7rem;
                min-width: 60px;
            }
            .form-input-admin, 
            .form-select, 
            .form-textarea {
                font-size: 0.75rem;
                padding: 6px 8px;
            }
            .cart-icon {
                width: 55px;
                height: 55px;
                bottom: 15px;
                right: 15px;
            }
            .cart-count {
                width: 20px;
                height: 20px;
                font-size: 0.65rem;
            }
            .search-container {
                max-width: 150px;
                margin: 0 8px;
            }
            .search-input {
                padding: 8px 12px 8px 35px;
                font-size: 0.8rem;
            }
            .search-icon {
                left: 10px;
                font-size: 0.8rem;
            }
            .clear-search {
                right: 10px;
            }
            .coupon-details-admin {
                grid-template-columns: 1fr;
            }
            .coupon-expiry-row {
                flex-wrap: wrap;
            }
        }

        @media (max-width: 400px) {
            .search-container {
                max-width: 120px;
            }
            .search-input::placeholder {
                font-size: 0.75rem;
            }
        }
    </style>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&amp;display=swap" rel="stylesheet">
</head>
<body style="overflow: hidden;">
    <div class="image-modal-overlay" id="imageModal">
        <div class="image-modal">
            <button class="close-image-modal" id="closeImageModal">
                <i class="fas fa-times"></i>
            </button>
            <img id="modalImage" src="" alt="Imagen ampliada">
        </div>
    </div>

    <div class="auth-modal" id="authModal">
        <div class="auth-content">
            <div class="auth-header">
                <div class="auth-icon">
                    <i class="fas fa-lock"></i>
                </div>
                <h2 class="auth-title">Panel de Administracin</h2>
                <p class="auth-subtitle">Ingresa el PIN de acceso</p>
            </div>
            
            <form id="authForm">
                <div class="form-group-admin">
                    <label class="form-label-admin">
                        <i class="fas fa-key"></i> PIN de Acceso:
                    </label>
                    <input type="password" id="pinInput" class="form-input-admin" maxlength="6" placeholder="Ingresa el PIN de 6 dgitos" required="">
                </div>
                
                <div class="status-message status-success" id="authMessage" style="display: none;"><i class="fas fa-check-circle"></i><span>PIN correcto. Accediendo al panel...</span></div>
                
                <div class="form-actions">
                    <button type="button" class="btn-cancel" id="cancelAuth">
                        <i class="fas fa-times"></i>
                        Cancelar
                    </button>
                    <button type="submit" class="btn-save" id="submitAuth">
                        <i class="fas fa-sign-in-alt"></i>
                        Acceder
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="admin-panel open" id="adminPanel">
        <div class="admin-header">
            <h2 class="admin-title">
                <i class="fas fa-cogs"></i>
                Panel de Administracin
            </h2>
            <button class="close-admin" id="closeAdmin">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="admin-content">
            <div class="admin-tabs">
                <button class="admin-tab" data-tab="products">
                    <i class="fas fa-box"></i> Productos
                </button>
                <button class="admin-tab" data-tab="add">
                    <i class="fas fa-plus"></i> Agregar
                </button>
                <button class="admin-tab" data-tab="categories">
                    <i class="fas fa-tags"></i> Categoras
                </button>
                <button class="admin-tab" data-tab="section-editor">
                    <i class="fas fa-edit"></i> Editor de Seccin
                </button>
                <button class="admin-tab" data-tab="coupons">
                    <i class="fas fa-ticket-alt"></i> Cupones
                </button>
                <button class="admin-tab" data-tab="stats">
                    <i class="fas fa-chart-bar"></i> Estadsticas
                </button>
                <button class="admin-tab active" data-tab="export">
                    <i class="fas fa-download"></i> Exportar
                </button>
            </div>
            
            <div class="admin-section" id="productsSection">
                <h3 class="section-title-admin">
                    <i class="fas fa-list"></i>
                    Lista de Productos
                </h3>
                <div class="status-message status-info" id="reorderMessage">
                    <i class="fas fa-info-circle"></i>
                    <span>Arrastra y suelta para reordenar los productos</span>
                </div>
                <div class="products-list-admin" id="productsListAdmin">
                        <div class="product-item-admin" data-product-id="1" draggable="true">
                            <img src="https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=1200&amp;q=80" alt="SUDADERA BSICA" class="product-image-admin">
                            <div class="product-info-admin">
                                <div class="product-name-admin">SUDADERA BSICA</div>
                                <div class="product-category-admin">
                                    <i class="fas fa-tag"></i>
                                    SUDADERA | Hombre
                                </div>
                                <div class="product-price-admin">$200</div>
                            </div>
                            <div class="product-actions-admin">
                                <button class="product-action-btn edit-btn-admin" onclick="admin.editarProducto(1)">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="product-action-btn delete-btn-admin" onclick="admin.eliminarProducto(1)">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
            </div>

            <div class="admin-section" id="addSection">
                <h3 class="section-title-admin">
                    <i class="fas fa-plus-circle"></i>
                    Agregar Nuevo Producto
                </h3>
                <div class="status-message status-success" id="formMessage" style="display: none;"><i class="fas fa-check-circle"></i><span>Producto actualizado correctamente</span></div>
                <form class="admin-form" id="productForm">
                    <div class="form-row">
                        <div class="form-group-admin">
                            <label class="form-label-admin">
                                <i class="fas fa-tag"></i> Nombre:
                            </label>
                            <input type="text" id="productName" class="form-input-admin" placeholder="Nombre del producto" required="">
                        </div>
                        
                        <div class="form-group-admin">
                            <label class="form-label-admin">
                                <i class="fas fa-box"></i> Categora:
                            </label>
                            <select id="productCategory" class="form-select" required=""><option value="">Selecciona categora</option><option value="hombre">Hombre</option><option value="accesorios">Accesorios</option><option value="mujer">Mujer</option><option value="kids">Kids</option></select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group-admin">
                            <label class="form-label-admin">
                                <i class="fas fa-list"></i> Subcategora:
                            </label>
                            <input type="text" id="productSubcategory" class="form-input-admin" placeholder="Ej: Sudaderas, Mochilas, Peluches, Camas" required="">
                        </div>
                        
                        <div class="form-group-admin">
                            <label class="form-label-admin">
                                <i class="fas fa-dollar-sign"></i> Precio Regular:
                            </label>
                            <input type="text" id="productPrice" class="form-input-admin" placeholder="Ej: $250" required="">
                        </div>
                    </div>
                    
                    <div class="form-group-admin">
                        <label class="form-label-admin">
                            <i class="fas fa-percentage"></i> Precio de Descuento (opcional):
                        </label>
                        <input type="text" id="productDiscountPrice" class="form-input-admin" placeholder="Ej: $200 (dejar vaco si no hay descuento)">
                    </div>
                    
                    <div class="form-group-admin">
                        <label class="form-label-admin">
                            <i class="fas fa-image"></i> URL de Imagen Principal:
                        </label>
                        <input type="url" id="productImage" class="form-input-admin" placeholder="https://ejemplo.com/imagen.jpg" required="">
                    </div>
                    
                    <div class="form-group-admin">
                        <label class="form-label-admin">
                            <i class="fas fa-images"></i> URLs de Imgenes por Color/Variante (una por lnea):
                        </label>
                        <textarea id="productImages" class="form-textarea" placeholder="Formato: Variante|URL
Ej: Negro|https://ejemplo.com/negro.jpg
Azul|https://ejemplo.com/azul.jpg
Dejar vaco si no hay imgenes por variante"></textarea>
                    </div>
                    
                    <div class="form-group-admin">
                        <label class="form-label-admin">
                            <i class="fas fa-align-left"></i> Descripcin:
                        </label>
                        <textarea id="productDescription" class="form-textarea" placeholder="Describe el producto..." required=""></textarea>
                    </div>
                    
                    <div class="form-group-admin">
                        <label class="form-label-admin">
                            <i class="fas fa-shapes"></i> Sistema de Variantes Personalizado:
                        </label>
                        <div id="variantSystemContainer"></div>
                        <button type="button" class="add-btn" id="addVariantBtn">
                            <i class="fas fa-plus"></i>
                            Agregar Campo de Variante
                        </button>
                    </div>
                    
                    <div class="form-group-admin">
                        <label class="form-label-admin">
                            <i class="fas fa-check-circle"></i> Especificaciones:
                        </label>
                        <div class="multi-input-container">
                            <input type="text" id="specInput" class="multi-input" placeholder="Agrega una especificacin">
                            <button type="button" class="add-btn" id="addSpecBtn">
                                <i class="fas fa-plus"></i>
                                Agregar
                            </button>
                        </div>
                        <div class="tags-container" id="specsContainer"></div>
                    </div>
                    
                    <div class="form-group-admin">
                        <label class="form-label-admin">
                            <i class="fas fa-star"></i> Estado:
                        </label>
                        <select id="productEstado" class="form-select" required="">
                            <option value="nuevo">Nuevo</option>
                            <option value="oferta">Oferta</option>
                            <option value="normal">Normal</option>
                            <option value="agotado">Agotado</option>
                        </select>
                    </div>
                    
                    <div class="form-group-admin">
                        <div class="stock-system-container" id="stockSystemContainer"></div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn-cancel" id="resetFormBtn">
                            <i class="fas fa-redo"></i>
                            Limpiar
                        </button>
                        <button type="submit" class="btn-save" id="saveProductBtn"><i class="fas fa-save"></i> Guardar Producto</button>
                    </div>
                </form>
            </div>

            <div class="admin-section" id="categoriesSection">
                <h3 class="section-title-admin">
                    <i class="fas fa-tags"></i>
                    Gestin de Categoras
                </h3>
                <div class="status-message status-info" id="categoriesReorderMessage">
                    <i class="fas fa-info-circle"></i>
                    <span>Arrastra y suelta para reordenar las categoras</span>
                </div>
                <div class="status-message" id="categoriesMessage" style="display: none;"></div>
                
                <div class="admin-form">
                    <div class="form-group-admin">
                        <label class="form-label-admin">
                            <i class="fas fa-plus-circle"></i> Agregar Nueva Categora:
                        </label>
                        <div class="form-row">
                            <div class="form-group-admin">
                                <label class="form-label-admin">
                                    <i class="fas fa-tag"></i> Nombre de Categora:
                                </label>
                                <input type="text" id="newCategoryName" class="form-input-admin" placeholder="Ej: Hombre, Mujer, Kids, Accesorios" required="">
                            </div>
                            
                            <div class="form-group-admin">
                                <label class="form-label-admin">
                                    <i class="fas fa-palette"></i> Color:
                                </label>
                                <input type="color" id="newCategoryColor" class="form-input-admin" style="height: 38px; padding: 4px;" value="#D4AF37">
                            </div>
                        </div>
                        
                        <div class="form-group-admin">
                            <label class="form-label-admin">
                                <i class="fas fa-icons"></i> cono FontAwesome (opcional):
                            </label>
                            <input type="text" id="newCategoryIcon" class="form-input-admin" placeholder="fa-tshirt, fa-user, fa-child">
                        </div>
                        
                        <button type="button" class="btn-save" id="addCategoryBtn"><i class="fas fa-plus"></i> Agregar Nueva Categora</button>
                    </div>
                </div>
                
                <h4 class="section-title-admin" style="margin-top: 20px;">
                    <i class="fas fa-list"></i>
                    Categoras Existentes
                </h4>
                <div class="categories-list-admin" id="categoriesListAdmin">
                        <div class="category-item-admin" data-category-id="hombre" draggable="true">
                            <div class="category-info-admin">
                                <div class="category-icon-admin" style="background: #2563EB;">
                                    <i class="fas fa-user-tie"></i>
                                </div>
                                <div class="category-details-admin">
                                    <div class="category-name-admin">Hombre</div>
                                    <div class="category-stats-admin">
                                        <span class="category-product-count">1 productos</span>
                                        <span class="category-color" style="background: #2563EB;"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="category-actions-admin">
                                <button class="category-action-btn edit-category-btn" onclick="admin.editarCategoria('hombre')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="category-action-btn delete-category-btn" onclick="admin.eliminarCategoria('hombre')" disabled="">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    
                        <div class="category-item-admin" data-category-id="accesorios" draggable="true">
                            <div class="category-info-admin">
                                <div class="category-icon-admin" style="background: #7C3AED;">
                                    <i class="fas fa-briefcase"></i>
                                </div>
                                <div class="category-details-admin">
                                    <div class="category-name-admin">Accesorios</div>
                                    <div class="category-stats-admin">
                                        <span class="category-product-count">0 productos</span>
                                        <span class="category-color" style="background: #7C3AED;"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="category-actions-admin">
                                <button class="category-action-btn edit-category-btn" onclick="admin.editarCategoria('accesorios')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="category-action-btn delete-category-btn" onclick="admin.eliminarCategoria('accesorios')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    
                        <div class="category-item-admin" data-category-id="mujer" draggable="true">
                            <div class="category-info-admin">
                                <div class="category-icon-admin" style="background: #DB2777;">
                                    <i class="fas fa-female"></i>
                                </div>
                                <div class="category-details-admin">
                                    <div class="category-name-admin">Mujer</div>
                                    <div class="category-stats-admin">
                                        <span class="category-product-count">0 productos</span>
                                        <span class="category-color" style="background: #DB2777;"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="category-actions-admin">
                                <button class="category-action-btn edit-category-btn" onclick="admin.editarCategoria('mujer')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="category-action-btn delete-category-btn" onclick="admin.eliminarCategoria('mujer')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    
                        <div class="category-item-admin" data-category-id="kids" draggable="true">
                            <div class="category-info-admin">
                                <div class="category-icon-admin" style="background: #059669;">
                                    <i class="fas fa-child"></i>
                                </div>
                                <div class="category-details-admin">
                                    <div class="category-name-admin">Kids</div>
                                    <div class="category-stats-admin">
                                        <span class="category-product-count">0 productos</span>
                                        <span class="category-color" style="background: #059669;"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="category-actions-admin">
                                <button class="category-action-btn edit-category-btn" onclick="admin.editarCategoria('kids')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="category-action-btn delete-category-btn" onclick="admin.eliminarCategoria('kids')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
            </div>

            <div class="admin-section" id="section-editorSection">
                <h3 class="section-title-admin">
                    <i class="fas fa-edit"></i>
                    Editor de Seccin "Nuestras Categoras"
                </h3>
                
                <div class="status-message status-info" id="editorInfoMessage">
                    <i class="fas fa-info-circle"></i>
                    <span>Desde aqu puedes modificar el ttulo, subttulo y las categoras que aparecen en la pgina principal.</span>
                </div>
                
                <div class="status-message status-success" id="editorMessage" style="display: none;"><i class="fas fa-check-circle"></i><span>Categora eliminada</span></div>
                
                <div class="editor-container">
                    <div class="editor-header">
                        <h4 class="section-title-admin" style="margin: 0;">
                            <i class="fas fa-cog"></i>
                            Configuracin de la Seccin
                        </h4>
                        <div class="editor-actions">
                            <button type="button" class="btn-preview" id="previewSectionBtn"><i class="fas fa-eye-slash"></i> Ocultar Vista Previa</button>
                            <button type="button" class="btn-save" id="saveSectionBtn">
                                <i class="fas fa-save"></i>
                                Guardar Cambios
                            </button>
                        </div>
                    </div>
                    
                    <div class="admin-form">
                        <div class="form-group-admin">
                            <label class="form-label-admin">
                                <i class="fas fa-heading"></i> Ttulo de la Seccin:
                            </label>
                            <input type="text" id="sectionTitle" class="form-input-admin" placeholder="Ej: Nuestras Categoras" value="Nuestras Categoras">
                        </div>
                        
                        <div class="form-group-admin">
                            <label class="form-label-admin">
                                <i class="fas fa-align-left"></i> Subttulo/Descripcin:
                            </label>
                            <textarea id="sectionSubtitle" class="form-textarea" placeholder="Ej: Explora nuestra variedad de productos organizados por categoras">Explora nuestra variedad de productos organizados por categoras</textarea>
                        </div>
                    </div>
                </div>
                
                <div class="editor-container">
                    <div class="editor-header">
                        <h4 class="section-title-admin" style="margin: 0;">
                            <i class="fas fa-tags"></i>
                            Gestin de Categoras de la Seccin
                        </h4>
                        <button type="button" class="btn-save" id="addSectionCategoryBtn">
                            <i class="fas fa-plus"></i>
                            Agregar Categora
                        </button>
                    </div>
                    
                    <div class="status-message status-info">
                        <i class="fas fa-info-circle"></i>
                        <span>Arrastra y suelta para reordenar las categoras. Cada categora incluye: Nombre, Descripcin, Imagen, Color del botn y Enlace.</span>
                    </div>
                    
                    <div class="editor-categories-list" id="sectionCategoriesList">
                    <div class="editor-category-item" data-category-id="1" draggable="true">
                        <div class="editor-category-header">
                            <div class="editor-category-title">
                                <i class="fas fa-tag"></i> Hombre
                                <span class="color-preview" style="background: #2563EB;"></span>
                            </div>
                            <div class="editor-category-actions">
                                <button class="category-action-btn edit-category-btn" onclick="admin.editarSectionCategory(1)">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="category-action-btn delete-category-btn" onclick="admin.eliminarSectionCategory(1)">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="editor-category-content">
                            <div class="editor-category-preview">
                                <img src="https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=500&amp;q=80" alt="Hombre">
                            </div>
                            <div class="editor-category-fields">
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-font"></i> Nombre:
                                    </label>
                                    <input type="text" class="form-input-admin" value="Hombre" readonly="">
                                </div>
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-align-left"></i> Descripcin:
                                    </label>
                                    <input type="text" class="form-input-admin" value="Ropa y accesorios para hombres modernos" readonly="">
                                </div>
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-link"></i> Accin:
                                    </label>
                                    <input type="text" class="form-input-admin" value="carrito.filterProducts('hombre')" readonly="">
                                </div>
                            </div>
                        </div>
                    </div>
                
                    <div class="editor-category-item" data-category-id="2" draggable="true">
                        <div class="editor-category-header">
                            <div class="editor-category-title">
                                <i class="fas fa-tag"></i> Mujer
                                <span class="color-preview" style="background: #DB2777;"></span>
                            </div>
                            <div class="editor-category-actions">
                                <button class="category-action-btn edit-category-btn" onclick="admin.editarSectionCategory(2)">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="category-action-btn delete-category-btn" onclick="admin.eliminarSectionCategory(2)">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="editor-category-content">
                            <div class="editor-category-preview">
                                <img src="https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=500&amp;q=80" alt="Mujer">
                            </div>
                            <div class="editor-category-fields">
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-font"></i> Nombre:
                                    </label>
                                    <input type="text" class="form-input-admin" value="Mujer" readonly="">
                                </div>
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-align-left"></i> Descripcin:
                                    </label>
                                    <input type="text" class="form-input-admin" value="Moda femenina para todos los estilos" readonly="">
                                </div>
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-link"></i> Accin:
                                    </label>
                                    <input type="text" class="form-input-admin" value="carrito.filterProducts('mujer')" readonly="">
                                </div>
                            </div>
                        </div>
                    </div>
                
                    <div class="editor-category-item" data-category-id="3" draggable="true">
                        <div class="editor-category-header">
                            <div class="editor-category-title">
                                <i class="fas fa-tag"></i> Kids
                                <span class="color-preview" style="background: #059669;"></span>
                            </div>
                            <div class="editor-category-actions">
                                <button class="category-action-btn edit-category-btn" onclick="admin.editarSectionCategory(3)">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="category-action-btn delete-category-btn" onclick="admin.eliminarSectionCategory(3)">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="editor-category-content">
                            <div class="editor-category-preview">
                                <img src="https://images.unsplash.com/photo-1584917865442-de89df76afd3?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=500&amp;q=80" alt="Kids">
                            </div>
                            <div class="editor-category-fields">
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-font"></i> Nombre:
                                    </label>
                                    <input type="text" class="form-input-admin" value="Kids" readonly="">
                                </div>
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-align-left"></i> Descripcin:
                                    </label>
                                    <input type="text" class="form-input-admin" value="Ropa divertida para los ms pequeos" readonly="">
                                </div>
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-link"></i> Accin:
                                    </label>
                                    <input type="text" class="form-input-admin" value="carrito.filterProducts('kids')" readonly="">
                                </div>
                            </div>
                        </div>
                    </div>
                
                    <div class="editor-category-item" data-category-id="4" draggable="true">
                        <div class="editor-category-header">
                            <div class="editor-category-title">
                                <i class="fas fa-tag"></i> Accesorios
                                <span class="color-preview" style="background: #7C3AED;"></span>
                            </div>
                            <div class="editor-category-actions">
                                <button class="category-action-btn edit-category-btn" onclick="admin.editarSectionCategory(4)">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="category-action-btn delete-category-btn" onclick="admin.eliminarSectionCategory(4)">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="editor-category-content">
                            <div class="editor-category-preview">
                                <img src="https://images.unsplash.com/photo-1595777457583-95e059d581b8?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=500&amp;q=80" alt="Accesorios">
                            </div>
                            <div class="editor-category-fields">
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-font"></i> Nombre:
                                    </label>
                                    <input type="text" class="form-input-admin" value="Accesorios" readonly="">
                                </div>
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-align-left"></i> Descripcin:
                                    </label>
                                    <input type="text" class="form-input-admin" value="Complementos para completar tu look" readonly="">
                                </div>
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-link"></i> Accin:
                                    </label>
                                    <input type="text" class="form-input-admin" value="carrito.filterProducts('accesorios')" readonly="">
                                </div>
                            </div>
                        </div>
                    </div>
                
                    <div class="editor-category-item" data-category-id="5" draggable="true">
                        <div class="editor-category-header">
                            <div class="editor-category-title">
                                <i class="fas fa-tag"></i> Nueva Categora 5
                                <span class="color-preview" style="background: #D4AF37;"></span>
                            </div>
                            <div class="editor-category-actions">
                                <button class="category-action-btn edit-category-btn" onclick="admin.editarSectionCategory(5)">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="category-action-btn delete-category-btn" onclick="admin.eliminarSectionCategory(5)">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="editor-category-content">
                            <div class="editor-category-preview">
                                <img src="https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=500&amp;q=80" alt="Nueva Categora 5">
                            </div>
                            <div class="editor-category-fields">
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-font"></i> Nombre:
                                    </label>
                                    <input type="text" class="form-input-admin" value="Nueva Categora 5" readonly="">
                                </div>
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-align-left"></i> Descripcin:
                                    </label>
                                    <input type="text" class="form-input-admin" value="Descripcin de la categora" readonly="">
                                </div>
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-link"></i> Accin:
                                    </label>
                                    <input type="text" class="form-input-admin" value="carrito.filterProducts('todo')" readonly="">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                </div>
                
                <div class="section-preview" id="sectionPreview" style="display: block;">
                    <h4 class="section-title-admin">
                        <i class="fas fa-eye"></i>
                        Vista Previa de la Seccin
                    </h4>
                    <div class="preview-title">
                        <h2 id="previewSectionTitle" style="font-size: 1.6rem; font-weight: 800; margin-bottom: 10px; color: var(--primary);">Nuestras Categoras</h2>
                        <p id="previewSectionSubtitle" style="color: var(--text-light); font-size: 0.9rem;">Explora nuestra variedad de productos organizados por categoras</p>
                    </div>
                    <div class="categories-grid" id="previewCategoriesGrid">
                    <div class="category-card">
                        <img src="https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=500&amp;q=80" alt="Hombre" class="category-image">
                        <div class="category-overlay">
                            <h3 class="category-name">Hombre</h3>
                            <p class="category-description">Ropa y accesorios para hombres modernos</p>
                            <span class="category-badge" style="background: #2563EB">Ver productos</span>
                        </div>
                    </div>
                
                    <div class="category-card">
                        <img src="https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=500&amp;q=80" alt="Mujer" class="category-image">
                        <div class="category-overlay">
                            <h3 class="category-name">Mujer</h3>
                            <p class="category-description">Moda femenina para todos los estilos</p>
                            <span class="category-badge" style="background: #DB2777">Ver productos</span>
                        </div>
                    </div>
                
                    <div class="category-card">
                        <img src="https://images.unsplash.com/photo-1584917865442-de89df76afd3?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=500&amp;q=80" alt="Kids" class="category-image">
                        <div class="category-overlay">
                            <h3 class="category-name">Kids</h3>
                            <p class="category-description">Ropa divertida para los ms pequeos</p>
                            <span class="category-badge" style="background: #059669">Ver productos</span>
                        </div>
                    </div>
                
                    <div class="category-card">
                        <img src="https://images.unsplash.com/photo-1595777457583-95e059d581b8?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=500&amp;q=80" alt="Accesorios" class="category-image">
                        <div class="category-overlay">
                            <h3 class="category-name">Accesorios</h3>
                            <p class="category-description">Complementos para completar tu look</p>
                            <span class="category-badge" style="background: #7C3AED">Ver productos</span>
                        </div>
                    </div>
                
                    <div class="category-card">
                        <img src="https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=500&amp;q=80" alt="Nueva Categora 5" class="category-image">
                        <div class="category-overlay">
                            <h3 class="category-name">Nueva Categora 5</h3>
                            <p class="category-description">Descripcin de la categora</p>
                            <span class="category-badge" style="background: #D4AF37">Ver productos</span>
                        </div>
                    </div>
                </div>
                </div>
            </div>
            
            <div class="admin-section" id="couponsSection">
                <h3 class="section-title-admin">
                    <i class="fas fa-ticket-alt"></i>
                    Gestin de Cupones con Cronmetro
                </h3>
                
                <div class="status-message status-info" id="couponInfoMessage">
                    <i class="fas fa-info-circle"></i>
                    <span>Los cupones aparecern en el carrito con un cronmetro en das, horas y minutos. Se desactivan automticamente al expirar.</span>
                </div>
                
                <div class="status-message status-success" id="couponMessage" style="display: none;"><i class="fas fa-check-circle"></i><span>Cupn guardado correctamente con cronmetro</span></div>
                
                <div class="coupon-admin-container">
                    <h4 class="section-title-admin" style="margin-top: 0; margin-bottom: 15px;">
                        <i class="fas fa-plus-circle"></i>
                        Agregar Nuevo Cupn con Fecha de Expiracin
                    </h4>
                    
                    <div class="coupon-type-selector" id="couponTypeSelector">
                        <div class="coupon-type-option selected" data-type="envio" onclick="admin.seleccionarTipoCupon('envio')">
                            <i class="fas fa-truck"></i> Envo Gratis
                        </div>
                        <div class="coupon-type-option" data-type="porcentaje" onclick="admin.seleccionarTipoCupon('porcentaje')">
                            <i class="fas fa-percent"></i> % Descuento
                        </div>
                        <div class="coupon-type-option" data-type="fijo" onclick="admin.seleccionarTipoCupon('fijo')">
                            <i class="fas fa-dollar-sign"></i> Descuento Fijo
                        </div>
                        <div class="coupon-type-option" data-type="2x1" onclick="admin.seleccionarTipoCupon('2x1')">
                            <i class="fas fa-gift"></i> 2x1 / 3x2
                        </div>
                    </div>
                    
                    <div id="couponFormFields">
                        <div id="envioFields" style="display: block;">
                            <div class="form-row">
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-tag"></i> Cdigo del Cupn:
                                    </label>
                                    <input type="text" id="couponCode" class="coupon-input" placeholder="Ej: ENVIOGRATIS" value=" ENVO GRATIS" maxlength="20">
                                </div>
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-info-circle"></i> Descripcin:
                                    </label>
                                    <input type="text" id="couponDescription" class="coupon-input" placeholder="Ej: Compras +$399" value="Compras +$399">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-coins"></i> Monto mnimo:
                                    </label>
                                    <input type="number" id="couponMinAmount" class="coupon-input" placeholder="Monto mnimo" value="399">
                                </div>
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-tint"></i> Color del cupn:
                                    </label>
                                    <input type="color" id="couponColor" class="coupon-input" style="height: 38px; padding: 4px;" value="#10b981">
                                </div>
                            </div>
                        </div>
                        
                        <div id="porcentajeFields" style="display: none;">
                            <div class="form-row">
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-tag"></i> Cdigo del Cupn:
                                    </label>
                                    <input type="text" id="couponCodePorcentaje" class="coupon-input" placeholder="Ej: 20OFF" value=" 20% OFF">
                                </div>
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-percent"></i> Porcentaje:
                                    </label>
                                    <input type="number" id="couponPercent" class="coupon-input" placeholder="Ej: 20" value="20" min="1" max="100">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-coins"></i> Monto mnimo:
                                    </label>
                                    <input type="number" id="couponMinAmountPorcentaje" class="coupon-input" placeholder="Monto mnimo" value="0">
                                </div>
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-palette"></i> Color:
                                    </label>
                                    <input type="color" id="couponColorPorcentaje" class="coupon-input" style="height: 38px; padding: 4px;" value="#059669">
                                </div>
                            </div>
                            <div class="form-group-admin">
                                <label class="form-label-admin">
                                    <i class="fas fa-info-circle"></i> Descripcin:
                                </label>
                                <input type="text" id="couponDescriptionPorcentaje" class="coupon-input" placeholder="Ej: Toda la tienda" value="Toda la tienda">
                            </div>
                        </div>
                        
                        <div id="fijoFields" style="display: none;">
                            <div class="form-row">
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-tag"></i> Cdigo del Cupn:
                                    </label>
                                    <input type="text" id="couponCodeFijo" class="coupon-input" placeholder="Ej: DESCUENTO50" value="$50 OFF">
                                </div>
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-dollar-sign"></i> Descuento fijo:
                                    </label>
                                    <input type="number" id="couponFixed" class="coupon-input" placeholder="Ej: 50" value="50">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-coins"></i> Monto mnimo:
                                    </label>
                                    <input type="number" id="couponMinAmountFijo" class="coupon-input" placeholder="Monto mnimo" value="0">
                                </div>
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-palette"></i> Color:
                                    </label>
                                    <input type="color" id="couponColorFijo" class="coupon-input" style="height: 38px; padding: 4px;" value="#8b5cf6">
                                </div>
                            </div>
                            <div class="form-group-admin">
                                <label class="form-label-admin">
                                    <i class="fas fa-info-circle"></i> Descripcin:
                                </label>
                                <input type="text" id="couponDescriptionFijo" class="coupon-input" placeholder="Ej: Descuento en toda la tienda" value="Descuento en toda la tienda">
                            </div>
                        </div>
                        
                        <div id="2x1Fields" style="display: none;">
                            <div class="form-row">
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-tag"></i> Cdigo del Cupn:
                                    </label>
                                    <input type="text" id="couponCodePromo" class="coupon-input" placeholder="Ej: 2X1CAMISETAS" value="2X1CAMISETAS">
                                </div>
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-gift"></i> Tipo promocin:
                                    </label>
                                    <select id="couponPromoType" class="coupon-input">
                                        <option value="2x1">2x1</option>
                                        <option value="3x2">3x2</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-tag"></i> Categora aplicable:
                                    </label>
                                    <select id="couponPromoCategory" class="coupon-input">
                                        <option value="">Todas las categoras</option>
                                        <option value="hombre">Hombre</option>
                                        <option value="mujer">Mujer</option>
                                        <option value="kids">Kids</option>
                                        <option value="accesorios">Accesorios</option>
                                    </select>
                                </div>
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-palette"></i> Color:
                                    </label>
                                    <input type="color" id="couponColorPromo" class="coupon-input" style="height: 38px; padding: 4px;" value="#3b82f6">
                                </div>
                            </div>
                            <div class="form-group-admin">
                                <label class="form-label-admin">
                                    <i class="fas fa-info-circle"></i> Descripcin:
                                </label>
                                <input type="text" id="couponDescriptionPromo" class="coupon-input" placeholder="Ej: Camisetas bsicas" value="Camisetas bsicas">
                            </div>
                        </div>
                    </div>
                    
                    <!-- SECCIN DE CRONMETRO: FECHA DE EXPIRACIN -->
                    <div class="form-group-admin" style="margin-top: 15px; border-top: 1px dashed var(--medium); padding-top: 15px;">
                        <label class="form-label-admin" style="color: var(--warning);">
                            <i class="fas fa-clock"></i> Fecha de Expiracin (Cronmetro):
                        </label>
                        
                        <div class="coupon-expiry-row">
                            <div class="coupon-expiry-field">
                                <label class="coupon-field-label">
                                    <i class="fas fa-calendar"></i> Fecha:
                                </label>
                                <input type="date" id="couponExpiryDate" class="coupon-input" value="">
                            </div>
                            
                            <div class="coupon-expiry-field">
                                <label class="coupon-field-label">
                                    <i class="fas fa-hourglass-start"></i> Hora:
                                </label>
                                <input type="time" id="couponExpiryTime" class="coupon-input" value="23:59">
                            </div>
                            
                            <div class="coupon-expiry-field">
                                <label class="coupon-field-label">
                                    <i class="fas fa-infinity"></i> Opciones:
                                </label>
                                <select id="couponExpiryPreset" class="coupon-input" onchange="admin.aplicarPresetExpiracion(this.value)">
                                    <option value="">Seleccionar preset</option>
                                    <option value="1d">1 da</option>
                                    <option value="3d">3 das</option>
                                    <option value="7d">7 das</option>
                                    <option value="15d">15 das</option>
                                    <option value="30d">30 das</option>
                                    <option value="never">Sin expiracin</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="font-size: 0.7rem; color: var(--text-light); margin-top: 5px; display: flex; align-items: center; gap: 5px;">
                            <i class="fas fa-info-circle"></i> 
                            El cupn se desactivar automticamente al llegar a la fecha/hora seleccionada.
                        </div>
                    </div>
                    
                    <div class="form-actions" style="margin-top: 15px;">
                        <button type="button" class="btn-cancel" onclick="admin.resetCouponForm()">
                            <i class="fas fa-redo"></i>
                            Limpiar
                        </button>
                        <button type="button" class="btn-save" onclick="admin.guardarCupon()">
                            <i class="fas fa-save"></i>
                            Guardar Cupn con Cronmetro
                        </button>
                    </div>
                </div>
                
                <h4 class="section-title-admin" style="margin-top: 20px;">
                    <i class="fas fa-list"></i>
                    Cupones Disponibles (con Cronmetro)
                </h4>
                
                <div class="coupons-list-admin" id="couponsListAdmin">
                        <div class="coupon-item-admin" style="">
                            <div class="coupon-header-admin">
                                <span class="coupon-code-admin" style="background: #05966920; color: #059669;">
                                    <i class="fas fa-percent"></i>  20% OFF
                                </span>
                                <div class="coupon-actions-admin">
                                    <span class="status-message status-success" style="display: inline-flex; margin: 0; padding: 2px 8px; font-size: 0.7rem;"><i class="fas fa-check-circle"></i> Disponible</span>
                                    <span class="coupon-expiry-badge"><i class="fas fa-hourglass-half"></i> 1d</span>
                                    <button class="product-action-btn delete-btn-admin" onclick="admin.eliminarCupon('cupon1770926203643')" style="width: 26px; height: 26px; margin-left: 5px;">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="coupon-details-admin">
                                <div class="coupon-detail-item">
                                    <span class="coupon-detail-label">Descripcin:</span>
                                    <span class="coupon-detail-value">Toda la tienda</span>
                                </div>
                                <div class="coupon-detail-item">
                                    <span class="coupon-detail-label">Tipo:</span>
                                    <span class="coupon-detail-value">20% OFF</span>
                                </div>
                                <div class="coupon-detail-item">
                                    <span class="coupon-detail-label">Condicin:</span>
                                    <span class="coupon-detail-value">Sin mnimo</span>
                                </div>
                                
                            <div class="coupon-detail-item">
                                <span class="coupon-detail-label"><i class="fas fa-clock"></i> Expira:</span>
                                <span class="coupon-detail-value">14/2/2026 12:00 a.m.</span>
                            </div>
                        
                            </div>
                        </div>
                    
                        <div class="coupon-item-admin" style="">
                            <div class="coupon-header-admin">
                                <span class="coupon-code-admin" style="background: #3b82f620; color: #3b82f6;">
                                    <i class="fas fa-gift"></i> 3X2CAMISETAS
                                </span>
                                <div class="coupon-actions-admin">
                                    <span class="status-message status-success" style="display: inline-flex; margin: 0; padding: 2px 8px; font-size: 0.7rem;"><i class="fas fa-check-circle"></i> Disponible</span>
                                    <span class="coupon-expiry-badge"><i class="fas fa-hourglass-half"></i> 1d</span>
                                    <button class="product-action-btn delete-btn-admin" onclick="admin.eliminarCupon('cupon1770926255572')" style="width: 26px; height: 26px; margin-left: 5px;">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="coupon-details-admin">
                                <div class="coupon-detail-item">
                                    <span class="coupon-detail-label">Descripcin:</span>
                                    <span class="coupon-detail-value">Camisetas bsicas</span>
                                </div>
                                <div class="coupon-detail-item">
                                    <span class="coupon-detail-label">Tipo:</span>
                                    <span class="coupon-detail-value">2X1</span>
                                </div>
                                <div class="coupon-detail-item">
                                    <span class="coupon-detail-label">Condicin:</span>
                                    <span class="coupon-detail-value">Todos los productos</span>
                                </div>
                                
                            <div class="coupon-detail-item">
                                <span class="coupon-detail-label"><i class="fas fa-clock"></i> Expira:</span>
                                <span class="coupon-detail-value">13/2/2026 11:59 p.m.</span>
                            </div>
                        
                            </div>
                        </div>
                    </div>
            </div>

            <div class="admin-section" id="statsSection">
                <h3 class="section-title-admin">
                    <i class="fas fa-chart-pie"></i>
                    Estadsticas de la Tienda
                </h3>
                <div class="stats-grid" id="statsGrid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--admin);">
                            <i class="fas fa-boxes"></i>
                        </div>
                        <div class="stat-value">1</div>
                        <div class="stat-label">Productos Totales</div>
                    </div>
                    
                    
                        <div class="stat-card">
                            <div class="stat-icon" style="background: #2563EB;">
                                <i class="fas fa-user-tie"></i>
                            </div>
                            <div class="stat-value">1</div>
                            <div class="stat-label">Hombre</div>
                        </div>
                    
                        <div class="stat-card">
                            <div class="stat-icon" style="background: #7C3AED;">
                                <i class="fas fa-briefcase"></i>
                            </div>
                            <div class="stat-value">0</div>
                            <div class="stat-label">Accesorios</div>
                        </div>
                    
                        <div class="stat-card">
                            <div class="stat-icon" style="background: #DB2777;">
                                <i class="fas fa-female"></i>
                            </div>
                            <div class="stat-value">0</div>
                            <div class="stat-label">Mujer</div>
                        </div>
                    
                        <div class="stat-card">
                            <div class="stat-icon" style="background: #059669;">
                                <i class="fas fa-child"></i>
                            </div>
                            <div class="stat-value">0</div>
                            <div class="stat-label">Kids</div>
                        </div>
                    
                </div>
                
                <div class="stats-grid" style="margin-top: 15px;" id="couponStats">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #10b981;">
                            <i class="fas fa-ticket-alt"></i>
                        </div>
                        <div class="stat-value" id="totalCouponsStat">2</div>
                        <div class="stat-label">Cupones Activos</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #f59e0b;">
                            <i class="fas fa-hourglass-half"></i>
                        </div>
                        <div class="stat-value" id="expiringSoonCouponsStat">2</div>
                        <div class="stat-label">Expiran pronto</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #64748b;">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-value" id="expiredCouponsStat">0</div>
                        <div class="stat-label">Expirados</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #f59e0b;">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-value" id="usedCouponsStat">0</div>
                        <div class="stat-label">Usados</div>
                    </div>
                </div>
            </div>

            <div class="admin-section active" id="exportSection">
                <h3 class="section-title-admin">
                    <i class="fas fa-download"></i>
                    Exportar HTML Actualizado
                </h3>
                <div class="status-message status-info">
                    <i class="fas fa-info-circle"></i>
                    <span>Exporta la tienda completa con todos los productos modificados, nuevos cupones con cronmetro incluidos.</span>
                </div>
                
                <div class="export-options">
                    <div class="form-group-admin">
                        <label class="form-label-admin">
                            <i class="fas fa-file-code"></i> Opciones de exportacin:
                        </label>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="exportClean" checked="">
                                <span>Limpiar HTML (remover panel de administracin)</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="exportIncludeData" checked="">
                                <span>Incluir datos de productos, cupones y fechas de expiracin</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn-save" id="exportHtmlBtn">
                            <i class="fas fa-download"></i>
                            Descargar HTML Completo
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <header class="main-header">
        <div class="container header-content">
            <a href="#" class="logo">
                <div class="logo-icon">
                    <i class="fas fa-crown"></i>
                </div>
                <div class="logo-text">ModaStyle</div>
            </a>
            
            <div class="search-container">
                <input type="text" class="search-input" id="searchInput" placeholder="Buscar productos...">
                <i class="fas fa-search search-icon"></i>
                <button class="clear-search" id="clearSearch">
                    <i class="fas fa-times"></i>
                </button>
                <div class="search-results" id="searchResults">
                            <div class="search-result-item" onclick="buscador.selectSearchResult(1)">
                                <img src="https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=1200&amp;q=80" alt="SUDADERA BSICA" class="search-result-image">
                                <div class="search-result-info">
                                    <div class="search-result-name">SUDADERA BSICA</div>
                                    <div class="search-result-category">
                                        <i class="fas fa-tag"></i>
                                        Hombre
                                    </div>
                                </div>
                                <div class="search-result-price">$200</div>
                            </div>
                        </div>
            </div>
            
            <button class="admin-btn" id="adminBtn">
                <i class="fas fa-cogs"></i>
                Administracin
            </button>
            
            <nav>
                <ul class="nav-links" id="navLinks">
                    <li><a href="#inicio" class="nav-link">Inicio</a></li>
                    <li><a href="#categorias" class="nav-link">Categoras</a></li>
                    <li><a href="#productos" class="nav-link">Productos</a></li>
                    <li><a href="#contacto" class="nav-link">Contacto</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="hero-section" id="inicio">
        <div class="container">
            <div class="hero-content">
                <h1 class="hero-title">
                    Estilo que <span class="hero-highlight">Trasciende</span>
                </h1>
                
                <div class="hero-badges">
                    <div class="badge">
                        <i class="fas fa-shipping-fast"></i>
                        Envo gratis +$300
                    </div>
                    <div class="badge">
                        <i class="fas fa-shield-alt"></i>
                        Garanta 30 das
                    </div>
                    <div class="badge">
                        <i class="fas fa-gem"></i>
                        Productos premium
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="categories-section" id="categorias">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Nuestras Categoras</h2>
                <p class="section-subtitle">Explora nuestra variedad de productos organizados por categoras</p>
            </div>
            
            <div class="categories-grid" id="categoriesGrid">
                        <div class="category-card" onclick="carrito.filterProducts('hombre')">
                            <img src="https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=500&amp;q=80" alt="Hombre" class="category-image">
                            <div class="category-overlay">
                                <h3 class="category-name">Hombre</h3>
                                <p class="category-description">Ropa y accesorios para hombres modernos</p>
                                <span class="category-badge" style="background: #2563EB">Ver productos</span>
                            </div>
                        </div>
                    
                        <div class="category-card" onclick="carrito.filterProducts('mujer')">
                            <img src="https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=500&amp;q=80" alt="Mujer" class="category-image">
                            <div class="category-overlay">
                                <h3 class="category-name">Mujer</h3>
                                <p class="category-description">Moda femenina para todos los estilos</p>
                                <span class="category-badge" style="background: #DB2777">Ver productos</span>
                            </div>
                        </div>
                    
                        <div class="category-card" onclick="carrito.filterProducts('kids')">
                            <img src="https://images.unsplash.com/photo-1584917865442-de89df76afd3?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=500&amp;q=80" alt="Kids" class="category-image">
                            <div class="category-overlay">
                                <h3 class="category-name">Kids</h3>
                                <p class="category-description">Ropa divertida para los ms pequeos</p>
                                <span class="category-badge" style="background: #059669">Ver productos</span>
                            </div>
                        </div>
                    
                        <div class="category-card" onclick="carrito.filterProducts('accesorios')">
                            <img src="https://images.unsplash.com/photo-1595777457583-95e059d581b8?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=500&amp;q=80" alt="Accesorios" class="category-image">
                            <div class="category-overlay">
                                <h3 class="category-name">Accesorios</h3>
                                <p class="category-description">Complementos para completar tu look</p>
                                <span class="category-badge" style="background: #7C3AED">Ver productos</span>
                            </div>
                        </div>
                    
                        <div class="category-card" onclick="carrito.filterProducts('todo')">
                            <img src="https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=500&amp;q=80" alt="Nueva Categora 5" class="category-image">
                            <div class="category-overlay">
                                <h3 class="category-name">Nueva Categora 5</h3>
                                <p class="category-description">Descripcin de la categora</p>
                                <span class="category-badge" style="background: #D4AF37">Ver productos</span>
                            </div>
                        </div>
                    </div>
        </div>
    </section>

    <section class="products-section" id="productos">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Todos los Productos</h2>
                <p class="section-subtitle">Explora nuestra coleccin completa de productos</p>
            </div>
            
            <div class="category-filters" id="categoryFilters">
                        <button class="category-filter active" onclick="carrito.filterProducts('todo')" data-color="#D4AF37" style="background: rgb(212, 175, 55); color: white; border-color: rgb(212, 175, 55);">
                            TODO
                        </button>
                    
                        <button class="category-filter " onclick="carrito.filterProducts('hombre')" data-color="#2563EB">
                            Hombre
                        </button>
                    
                        <button class="category-filter " onclick="carrito.filterProducts('accesorios')" data-color="#7C3AED">
                            Accesorios
                        </button>
                    
                        <button class="category-filter " onclick="carrito.filterProducts('mujer')" data-color="#DB2777">
                            Mujer
                        </button>
                    
                        <button class="category-filter " onclick="carrito.filterProducts('kids')" data-color="#059669">
                            Kids
                        </button>
                    </div>
            
            <div class="products-grid" id="productsGrid">
                        <div class="product-card" data-product-id="1" style="animation-delay: 0s">
                            <div class="product-image-container">
                                <img src="https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=1200&amp;q=80" alt="SUDADERA BSICA" class="product-image" onclick="carrito.openImageModal('https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=1200&amp;q=80', 'SUDADERA BSICA')" data-original-image="https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=1200&amp;q=80" data-has-variant-images="true">
                                <div class="product-badge oferta">OFERTA</div>
                            </div>
                            
                            <div class="product-info">
                                <div class="product-category" style="color: #2563EB">
                                    <i class="fas fa-tag"></i>
                                    SUDADERA
                                </div>
                                
                                <h3 class="product-title">SUDADERA BSICA</h3>
                                
                                <div class="product-price-container">
                                    
                                        <div class="sale-price-container">
                                            <div class="original-price">$250</div>
                                            <div class="sale-price" style="color: #2563EB">$200</div>
                                            <div class="discount-badge">OFERTA</div>
                                        </div>
                                    
                                </div>
                                
                                <p class="product-description">
                                    La Sudadera esencial perfecta para cualquier ocasin. Fabricada con algodn egipcio de la ms alta calidad.
                                </p>
                                
                                
                                    <div class="product-features">
                                        
                                            <div class="feature">
                                                <i class="fas fa-check" style="color: #2563EB"></i>
                                                <span>100% algodn egipcio</span>
                                            </div>
                                        
                                            <div class="feature">
                                                <i class="fas fa-check" style="color: #2563EB"></i>
                                                <span>Corte regular</span>
                                            </div>
                                        
                                            <div class="feature">
                                                <i class="fas fa-check" style="color: #2563EB"></i>
                                                <span>Cuello redondo reforzado</span>
                                            </div>
                                        
                                    </div>
                                
                                
                                
                    <div class="variant-selector" data-variant-name="Talla">
                        <div class="variant-label">Talla:</div>
                        <div class="variant-options">
                            
                                <button class="variant-btn" data-value="32" style="border-color: #2563EB" onclick="carrito.selectVariant(this, 'Talla', true)">
                                    32
                                </button>
                            
                                <button class="variant-btn" data-value="30" style="border-color: #2563EB" onclick="carrito.selectVariant(this, 'Talla', true)">
                                    30
                                </button>
                            
                                <button class="variant-btn" data-value="34" style="border-color: #2563EB" onclick="carrito.selectVariant(this, 'Talla', true)">
                                    34
                                </button>
                            
                        </div>
                    </div>
                
                    <div class="variant-selector" data-variant-name="Color">
                        <div class="variant-label">Color:</div>
                        <div class="variant-options">
                            
                                <button class="variant-btn" data-value="Negro" style="border-color: #2563EB" onclick="carrito.selectVariant(this, 'Color', true)">
                                    Negro
                                </button>
                            
                                <button class="variant-btn" data-value="Azul" style="border-color: #2563EB" onclick="carrito.selectVariant(this, 'Color', true)">
                                    Azul
                                </button>
                            
                                <button class="variant-btn" data-value="Rosa" style="border-color: #2563EB" onclick="carrito.selectVariant(this, 'Color', true)">
                                    Rosa
                                </button>
                            
                        </div>
                    </div>
                
                                
                                <div class="product-actions">
                                    <button class="add-to-cart-btn" data-product-id="1" style="background: linear-gradient(135deg, #2563EB, #1d4fbc);" onclick="carrito.handleAddToCart(1)">
                                        <i class="fas fa-shopping-cart"></i>
                                        AGREGAR AL CARRITO
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
        </div>
    </section>

    <div class="checkout-modal" id="checkoutModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <i class="fas fa-truck"></i>
                    Informacin de Entrega y Pago
                </h3>
                <button class="close-modal" id="closeModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="checkoutForm">
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-user"></i> Nombre completo:
                    </label>
                    <input type="text" id="customerName" class="form-input" required="" placeholder="Ingresa tu nombre completo">
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-phone"></i> Telfono:
                    </label>
                    <input type="tel" id="customerPhone" class="form-input" required="" placeholder="Ingresa tu nmero de telfono">
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-clock"></i> Horario de entrega:
                    </label>
                    <select id="deliveryTime" class="form-select" required="">
                        <option value="">Selecciona un horario</option>
                        <option value="12:00">12:00 PM</option>
                        <option value="19:00">7:00 PM</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-map-marker-alt"></i> Punto de entrega:
                    </label>
                    <div class="delivery-options">
                        <label class="delivery-option" id="deliveryOption1">
                            <input type="radio" name="delivery" value="xhala" style="display: none;">
                            <div class="delivery-info">
                                <div class="delivery-name">San Sebastin Xhala</div>
                                <div class="delivery-address">San Sebastin, enfrente de la universidad</div>
                                <a href="https://maps.app.goo.gl/nKi4gyiDY1KikZPQ6" target="_blank" class="map-link">
                                    <i class="fas fa-map-marker-alt"></i> Ver en Google Maps
                                </a>
                            </div>
                        </label>
                        
                        <label class="delivery-option selected" id="deliveryOption2">
                            <input type="radio" name="delivery" value="socorro" style="display: none;">
                            <div class="delivery-info">
                                <div class="delivery-name">El Socorro</div>
                                <div class="delivery-address">Colonia El Socorro, en los Arcos en frente del oxxo</div>
                                <a href="https://maps.app.goo.gl/BYYZWmaa9TbtjWvD8" target="_blank" class="map-link">
                                    <i class="fas fa-map-marker-alt"></i> Ver en Google Maps
                                </a>
                            </div>
                        </label>
                        
                        <label class="delivery-option" id="deliveryOption3">
                            <input type="radio" name="delivery" value="mateo" style="display: none;">
                            <div class="delivery-info">
                                <div class="delivery-name">San Mateo</div>
                                <div class="delivery-address">San Mateo, en frente de la iglesia</div>
                                <a href="https://maps.app.goo.gl/q1KoquLtgrTEnuCo6" target="_blank" class="map-link">
                                    <i class="fas fa-map-marker-alt"></i> Ver en Google Maps
                                </a>
                            </div>
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-credit-card"></i> Mtodo de pago:
                    </label>
                    <div class="payment-options">
                        <label class="payment-option selected" id="paymentOption1">
                            <input type="radio" name="payment" value="efectivo" style="display: none;">
                            <i class="fas fa-money-bill-wave"></i> Efectivo
                        </label>
                        
                        <label class="payment-option" id="paymentOption2">
                            <input type="radio" name="payment" value="transferencia" style="display: none;">
                            <i class="fas fa-university"></i> Transferencia
                        </label>
                    </div>
                    
                    <div class="transfer-info" id="transferInfo">
                        <div style="font-weight: 600; color: var(--primary); margin-bottom: 6px; font-size: 0.85rem;">
                            <i class="fas fa-info-circle"></i> Datos para transferencia:
                        </div>
                        <div class="transfer-details">
                            <div class="transfer-row">
                                <span class="transfer-label">Nombre:</span>
                                <span class="transfer-value">Saul Flores</span>
                            </div>
                            <div class="transfer-row">
                                <span class="transfer-label">Banco:</span>
                                <span class="transfer-value">STP</span>
                            </div>
                            <div class="transfer-row">
                                <span class="transfer-label">CLABE:</span>
                                <span class="transfer-value">721180100001101243</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" id="cancelCheckout">
                        Cancelar
                    </button>
                    <button type="submit" class="btn-primary" id="confirmCheckout">
                        <i class="fab fa-whatsapp"></i>
                        Enviar pedido por WhatsApp
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="cart-icon" id="cartIcon">
        <i class="fas fa-shopping-bag"></i>
        <div class="cart-count" id="cartCount">1</div>
    </div>

    <div class="cart-overlay" id="cartOverlay"></div>
    
    <div class="cart-panel" id="cartPanel">
        <div class="cart-header">
            <h2 class="cart-title">
                <i class="fas fa-shopping-bag"></i>
                Tu Carrito
            </h2>
            <button class="close-cart" id="closeCart">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="cart-content">
            <div class="coupon-section" id="couponSection" style="display: block;">
                <div class="coupon-title">
                    <i class="fas fa-ticket-alt"></i>
                    Cupones disponibles
                </div>
                <div class="coupon-grid" id="couponGrid">
                        <div class="coupon-item" data-coupon-id="cupon1770926203643" onclick="carrito.aplicarCupon('cupon1770926203643')" style="border-color: #059669; background: linear-gradient(135deg, #05966915, #05966905);">
                            <div class="coupon-icon" style="background: #059669; color: white;">
                                <i class="fas fa-percent"></i>
                            </div>
                            <div class="coupon-info">
                                <div class="coupon-code" style="color: #059669;">
                                     20% OFF
                                </div>
                                <div class="coupon-description">
                                    Toda la tienda
                                </div>
                                <div class="coupon-timer"><i class="fas fa-hourglass-half"></i> <span class="timer-numbers">1d 10h 2m</span></div>
                            </div>
                        </div>
                    
                        <div class="coupon-item" data-coupon-id="cupon1770926255572" onclick="carrito.aplicarCupon('cupon1770926255572')" style="border-color: #3b82f6; background: linear-gradient(135deg, #3b82f615, #3b82f605);">
                            <div class="coupon-icon" style="background: #3b82f6; color: white;">
                                <i class="fas fa-gift"></i>
                            </div>
                            <div class="coupon-info">
                                <div class="coupon-code" style="color: #3b82f6;">
                                    3X2CAMISETAS
                                </div>
                                <div class="coupon-description">
                                    Camisetas bsicas
                                </div>
                                <div class="coupon-timer"><i class="fas fa-hourglass-half"></i> <span class="timer-numbers">1d 10h 1m</span></div>
                            </div>
                        </div>
                    </div>
            </div>
            
            <div class="free-shipping-promo show" id="freeShippingPromo" style="display: block;">
                <i class="fas fa-shipping-fast"></i>
                <div class="promo-text">Falta poco para envo gratis!</div>
                <div class="promo-subtext">Agrega <span id="remainingAmount">$100.00</span> ms a tu carrito</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="shippingProgress" style="width: 66.6667%;"></div>
                </div>
            </div>
            
            <div class="cart-items" id="cartItems">
                        <div class="cart-item">
                            <img src="https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=1200&amp;q=80" alt="SUDADERA BSICA" class="cart-item-image" onclick="carrito.openImageModal('https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=1200&amp;q=80', 'SUDADERA BSICA')">
                            <div class="cart-item-details">
                                <div class="cart-item-info">
                                    <div class="cart-item-title">SUDADERA BSICA</div>
                                    <div class="cart-item-variant">
                                        <i class="fas fa-tag"></i>
                                        Talla: 32 | Color: Negro
                                    </div>
                                    <div class="cart-item-price">$200</div>
                                </div>
                                
                                <div class="cart-item-actions">
                                    <div class="quantity-control">
                                        <button class="quantity-btn" onclick="carrito.updateQuantity(0, -1)">
                                            <i class="fas fa-minus"></i>
                                        </button>
                                        <span class="quantity-value">5</span>
                                        <button class="quantity-btn" onclick="carrito.updateQuantity(0, 1)">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                    <button class="remove-item" onclick="carrito.removeItem(0)">
                                        <i class="fas fa-trash"></i>
                                        Eliminar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
            
            <div class="empty-cart" id="emptyCart" style="display: none;">
                <i class="fas fa-shopping-bag"></i>
                <h3>Tu carrito est vaco</h3>
                <p>Agrega algunos productos para comenzar</p>
                <a href="#productos" class="continue-shopping" onclick="carrito.closeCart()">
                    <i class="fas fa-store"></i>
                    Continuar comprando
                </a>
            </div>
            
            <div class="cart-summary show" id="cartSummary" style="display: block;">
                <div class="summary-title">
                    <i class="fas fa-receipt"></i>
                    Resumen del Pedido
                </div>
                <div class="summary-row">
                    <span class="summary-label">
                        <i class="fas fa-box"></i>
                        Subtotal
                    </span>
                    <span class="summary-value" id="subtotal">$200.00</span>
                </div>
                
                <div id="appliedCouponRow" style="display: none;" class="summary-coupon-row">
                    <span class="summary-label">
                        <i class="fas fa-ticket-alt"></i>
                        Cupn <span id="appliedCouponCode"></span>
                    </span>
                    <span class="summary-value" id="appliedCouponDiscount">-$0.00</span>
                </div>
                
                <div class="summary-row">
                    <span class="summary-label">
                        <i class="fas fa-truck"></i>
                        Envo
                    </span>
                    <span class="summary-value" id="shipping">$50.00</span>
                </div>
                <div class="summary-total">
                    <span class="total-label">
                        <i class="fas fa-calculator"></i>
                        Total
                    </span>
                    <span class="total-amount" id="total">$250.00</span>
                </div>
            </div>
        </div>
        
        <div class="cart-actions" id="cartActions">
            <button class="checkout-btn" id="checkoutBtn">
                <i class="fab fa-whatsapp"></i>
                Finalizar Compra
            </button>
            <button class="clear-cart-btn" id="clearCartBtn">
                <i class="fas fa-trash"></i>
                Vaciar Carrito
            </button>
        </div>
    </div>

    <footer class="main-footer" id="contacto">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>ModaStyle</h3>
                    <p style="font-size: 0.8rem; line-height: 1.4;">Tienda de ropa, accesorios y artculos para el hogar con las ltimas tendencias en moda, estilo y decoracin. Calidad en cada producto.</p>
                </div>
                
                <div class="footer-section">
                    <h3>Enlaces rpidos</h3>
                    <ul class="footer-links">
                        <li><a href="#inicio"><i class="fas fa-chevron-right"></i> Inicio</a></li>
                        <li><a href="#categorias"><i class="fas fa-chevron-right"></i> Categoras</a></li>
                        <li><a href="#productos"><i class="fas fa-chevron-right"></i> Productos</a></li>
                        <li><a href="#contacto"><i class="fas fa-chevron-right"></i> Contacto</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>Contacto</h3>
                    <ul class="footer-links">
                        <li><a href="#"><i class="fas fa-phone"></i> (55) 1234-5678</a></li>
                        <li><a href="#"><i class="fas fa-envelope"></i> info@modastyle.com</a></li>
                        <li><a href="#"><i class="fas fa-map-marker-alt"></i> Ciudad de Mxico</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="copyright">
                 2024 ModaStyle - Tienda de Ropa, Accesorios y Hogar. Todos los derechos reservados.
            </div>
        </div>
    </footer>

    <script>
        // ==================== DATOS INICIALES ====================
        const CURRENT_VERSION = '3.0.0'; // Versin actualizada con cronmetro en cupones

        let productos = [{"id":1,"nombre":"SUDADERA BSICA","precioRegular":"$250","precioDescuento":"$200","imagen":"https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80","categoria":"hombre","subcategoria":"SUDADERA","descripcion":"La Sudadera esencial perfecta para cualquier ocasin. Fabricada con algodn egipcio de la ms alta calidad.","estado":"oferta","especificaciones":["100% algodn egipcio","Corte regular","Cuello redondo reforzado"],"variantes":[{"nombre":"Talla","tipo":"select","opciones":["32","30","34"],"required":true},{"nombre":"Color","tipo":"select","opciones":["Negro","Azul","Rosa"],"required":true}],"stock":{"32|Negro":5,"32|Azul":3,"32|Rosa":2,"30|Negro":4,"30|Azul":3,"30|Rosa":1,"34|Negro":6,"34|Azul":4,"34|Rosa":3},"imagenesPorVariante":{"Negro":"https://ejemplo.com/imagen-negra.jpg","Rojo":"https://ejemplo.com/imagen-roja.jpg","Azul":"https://ejemplo.com/imagen-azul.jpg"}}];

        let categorias = [{"id":"todo","nombre":"TODO","color":"#D4AF37","icono":"fa-tags","orden":1},{"id":"hombre","nombre":"Hombre","color":"#2563EB","icono":"fa-user-tie","orden":1},{"id":"accesorios","nombre":"Accesorios","color":"#7C3AED","icono":"fa-briefcase","orden":2},{"id":"mujer","nombre":"Mujer","color":"#DB2777","icono":"fa-female","orden":3},{"id":"kids","nombre":"Kids","color":"#059669","icono":"fa-child","orden":4}];

        let sectionCategories = [{"id":1,"name":"Hombre","description":"Ropa y accesorios para hombres modernos","image":"https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80","buttonColor":"#2563EB","action":"carrito.filterProducts('hombre')","order":1},{"id":2,"name":"Mujer","description":"Moda femenina para todos los estilos","image":"https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80","buttonColor":"#DB2777","action":"carrito.filterProducts('mujer')","order":2},{"id":3,"name":"Kids","description":"Ropa divertida para los ms pequeos","image":"https://images.unsplash.com/photo-1584917865442-de89df76afd3?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80","buttonColor":"#059669","action":"carrito.filterProducts('kids')","order":3},{"id":4,"name":"Accesorios","description":"Complementos para completar tu look","image":"https://images.unsplash.com/photo-1595777457583-95e059d581b8?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80","buttonColor":"#7C3AED","action":"carrito.filterProducts('accesorios')","order":4},{"id":5,"name":"Nueva Categora 5","description":"Descripcin de la categora","image":"https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80","buttonColor":"#D4AF37","action":"carrito.filterProducts('todo')","order":5}];

        let sectionConfig = {"title":"Nuestras Categoras","subtitle":"Explora nuestra variedad de productos organizados por categoras"};
        
        // ==================== DATOS DE CUPONES ====================
        let cuponesDisponibles = [{"id":"cupon1770926203643","codigo":" 20% OFF","descripcion":"Toda la tienda","tipo":"porcentaje","valor":20,"minimo":0,"color":"#059669","usado":false,"expirado":false,"fechaExpiracion":"2026-02-14T00:00:00","icono":"fa-percent"},{"id":"cupon1770926255572","codigo":"3X2CAMISETAS","descripcion":"Camisetas bsicas","tipo":"2x1","valor":"2x1","minimo":0,"color":"#3b82f6","usado":false,"expirado":false,"fechaExpiracion":"2026-02-13T23:59:00","icono":"fa-gift"}];

        let cuponesUsados = [];

        let cuponesExpirados = [];

        // ==================== GESTOR DE VERSIONES ====================
        class VersionManager {
            constructor() {
                this.checkVersion();
                this.initCouponTimers();
            }
            
            checkVersion() {
                const savedVersion = localStorage.getItem('modastyle_version');
                
                if (!savedVersion || savedVersion !== CURRENT_VERSION) {
                    localStorage.setItem('modastyle_productos', JSON.stringify(productos));
                    localStorage.setItem('modastyle_categorias', JSON.stringify(categorias));
                    localStorage.setItem('modastyle_section_categories', JSON.stringify(sectionCategories));
                    localStorage.setItem('modastyle_section_config', JSON.stringify(sectionConfig));
                    localStorage.setItem('modastyle_version', CURRENT_VERSION);
                    console.log('Datos actualizados a versin', CURRENT_VERSION);
                } else {
                    const productosGuardados = localStorage.getItem('modastyle_productos');
                    const categoriasGuardadas = localStorage.getItem('modastyle_categorias');
                    const sectionCategoriesGuardadas = localStorage.getItem('modastyle_section_categories');
                    const sectionConfigGuardada = localStorage.getItem('modastyle_section_config');
                    const cuponesGuardados = localStorage.getItem('modastyle_cupones');
                    const cuponesUsadosGuardados = localStorage.getItem('modastyle_cupones_usados');
                    const cuponesExpiradosGuardados = localStorage.getItem('modastyle_cupones_expirados');
                    
                    if (productosGuardados) {
                        try {
                            productos = JSON.parse(productosGuardados);
                        } catch (e) {}
                    }
                    
                    if (categoriasGuardadas) {
                        try {
                            categorias = JSON.parse(categoriasGuardadas);
                        } catch (e) {}
                    }
                    
                    if (sectionCategoriesGuardadas) {
                        try {
                            sectionCategories = JSON.parse(sectionCategoriesGuardadas);
                        } catch (e) {}
                    }
                    
                    if (sectionConfigGuardada) {
                        try {
                            sectionConfig = JSON.parse(sectionConfigGuardada);
                        } catch (e) {}
                    }
                    
                    if (cuponesGuardados) {
                        try {
                            cuponesDisponibles = JSON.parse(cuponesGuardados);
                        } catch (e) {}
                    }
                    
                    if (cuponesUsadosGuardados) {
                        try {
                            cuponesUsados = JSON.parse(cuponesUsadosGuardados);
                        } catch (e) {}
                    }
                    
                    if (cuponesExpiradosGuardados) {
                        try {
                            cuponesExpirados = JSON.parse(cuponesExpiradosGuardados);
                        } catch (e) {}
                    }
                }
            }
            
            initCouponTimers() {
                // Iniciar el intervalo de actualizacin de cronmetros (cada segundo)
                setInterval(() => {
                    if (window.carrito) {
                        window.carrito.updateCouponTimers();
                    }
                }, 1000);
            }
        }

        // ==================== SISTEMA DE BSQUEDA ====================
        class Buscador {
            constructor() {
                this.searchTimeout = null;
                this.currentSearch = '';
                this.isSearching = false;
                this.init();
            }
            
            init() {
                this.setupEventListeners();
            }
            
            setupEventListeners() {
                const searchInput = document.getElementById('searchInput');
                const clearSearch = document.getElementById('clearSearch');
                const searchResults = document.getElementById('searchResults');
                
                if (searchInput) {
                    searchInput.addEventListener('input', (e) => {
                        this.handleSearchInput(e.target.value, 'header');
                    });
                    
                    searchInput.addEventListener('focus', () => {
                        if (searchInput.value.trim()) {
                            this.showSearchResults(searchInput.value, 'header');
                        }
                    });
                }
                
                if (clearSearch) {
                    clearSearch.addEventListener('click', () => {
                        this.clearSearch('header');
                    });
                }
                
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.search-container')) {
                        searchResults.classList.remove('active');
                    }
                });
                
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        searchResults.classList.remove('active');
                        searchInput.blur();
                    }
                });
            }
            
            handleSearchInput(query, type) {
                clearTimeout(this.searchTimeout);
                query = query.trim();
                
                if (type === 'header') {
                    const clearBtn = document.getElementById('clearSearch');
                    if (clearBtn) clearBtn.classList.toggle('active', query.length > 0);
                }
                
                if (query.length < 2) {
                    if (type === 'header') {
                        document.getElementById('searchResults').classList.remove('active');
                    } else if (type === 'products' && window.carrito) {
                        window.carrito.renderProducts();
                    }
                    return;
                }
                
                this.searchTimeout = setTimeout(() => {
                    if (type === 'header') {
                        this.showSearchResults(query, type);
                    } else if (type === 'products') {
                        this.filterProductsBySearch(query);
                    }
                }, 300);
            }
            
            showSearchResults(query, type) {
                const searchResults = document.getElementById('searchResults');
                const results = this.searchProducts(query, 10);
                
                if (results.length === 0) {
                    searchResults.innerHTML = `
                        <div class="search-no-results">
                            <i class="fas fa-search"></i>
                            <p>No se encontraron productos</p>
                            <p style="font-size: 0.7rem; margin-top: 5px;">Intenta con otros trminos</p>
                        </div>
                    `;
                } else {
                    searchResults.innerHTML = results.map(product => {
                        const precio = product.precioDescuento || product.precioRegular;
                        const categoria = categorias.find(c => c.id === product.categoria);
                        
                        return `
                            <div class="search-result-item" onclick="buscador.selectSearchResult(${product.id})">
                                <img src="${product.imagen}" alt="${product.nombre}" class="search-result-image">
                                <div class="search-result-info">
                                    <div class="search-result-name">${product.nombre}</div>
                                    <div class="search-result-category">
                                        <i class="fas fa-tag"></i>
                                        ${categoria ? categoria.nombre : product.categoria}
                                    </div>
                                </div>
                                <div class="search-result-price">${precio}</div>
                            </div>
                        `;
                    }).join('');
                }
                
                searchResults.classList.add('active');
                
                if (window.carrito && window.carrito.currentFilter !== 'todo') {
                    window.carrito.filterProducts('todo');
                }
                document.getElementById('productos').scrollIntoView({ behavior: 'smooth' });
            }
            
            searchProducts(query, limit = null) {
                query = query.toLowerCase().trim();
                if (!query) return [];
                
                const results = productos.filter(product => {
                    if (product.nombre.toLowerCase().includes(query)) return true;
                    if (product.descripcion.toLowerCase().includes(query)) return true;
                    if (product.subcategoria.toLowerCase().includes(query)) return true;
                    if (product.especificaciones && product.especificaciones.some(spec => spec.toLowerCase().includes(query))) return true;
                    
                    const categoria = categorias.find(c => c.id === product.categoria);
                    if (categoria && categoria.nombre.toLowerCase().includes(query)) return true;
                    
                    return false;
                });
                
                results.sort((a, b) => {
                    const aInName = a.nombre.toLowerCase().includes(query);
                    const bInName = b.nombre.toLowerCase().includes(query);
                    if (aInName && !bInName) return -1;
                    if (!aInName && bInName) return 1;
                    return a.nombre.localeCompare(b.nombre);
                });
                
                return limit ? results.slice(0, limit) : results;
            }
            
            filterProductsBySearch(query) {
                this.currentSearch = query;
                this.isSearching = true;
                
                if (!window.carrito) return;
                
                const results = this.searchProducts(query);
                const filteredProducts = query ? results : productos;
                
                this.renderFilteredProducts(filteredProducts);
                this.updateSearchResultsMessage(query, results.length);
            }
            
            renderFilteredProducts(filteredProducts) {
                const productsGrid = document.getElementById('productsGrid');
                
                if (filteredProducts.length === 0) {
                    productsGrid.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--text-light);">
                            <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.3;"></i>
                            <h3>No se encontraron productos</h3>
                            <p>Prueba con otros trminos de bsqueda</p>
                            <button onclick="buscador.clearSearch('header')" style="margin-top: 15px; padding: 8px 16px; background: var(--accent); color: white; border: none; border-radius: var(--border-radius-sm); cursor: pointer;">
                                <i class="fas fa-times"></i> Limpiar bsqueda
                            </button>
                        </div>
                    `;
                    return;
                }
                
                productsGrid.innerHTML = filteredProducts.map((product, index) => {
                    const precio = product.precioDescuento || product.precioRegular;
                    const categoria = categorias.find(c => c.id === product.categoria);
                    const colorCategoria = categoria ? categoria.color : 'var(--accent)';
                    
                    return `
                        <div class="product-card" data-product-id="${product.id}" style="animation-delay: ${index * 0.05}s">
                            <div class="product-image-container">
                                <img src="${product.imagen}" alt="${product.nombre}" class="product-image" 
                                     onclick="carrito.openImageModal('${product.imagen}', '${product.nombre}')"
                                     data-original-image="${product.imagen}"
                                     ${product.imagenesPorVariante ? 'data-has-variant-images="true"' : ''}>
                                <div class="product-badge ${product.estado}">${product.estado.toUpperCase()}</div>
                            </div>
                            
                            <div class="product-info">
                                <div class="product-category" style="color: ${colorCategoria}">
                                    <i class="fas fa-tag"></i>
                                    ${product.subcategoria}
                                </div>
                                
                                <h3 class="product-title">${product.nombre}</h3>
                                
                                <div class="product-price-container">
                                    ${product.precioDescuento ? `
                                        <div class="sale-price-container">
                                            <div class="original-price">${product.precioRegular}</div>
                                            <div class="sale-price" style="color: ${colorCategoria}">${product.precioDescuento}</div>
                                            <div class="discount-badge">OFERTA</div>
                                        </div>
                                    ` : `
                                        <div class="regular-price">${product.precioRegular}</div>
                                    `}
                                </div>
                                
                                <p class="product-description">
                                    ${product.descripcion}
                                </p>
                                
                                ${product.especificaciones && product.especificaciones.length > 0 ? `
                                    <div class="product-features">
                                        ${product.especificaciones.map(spec => `
                                            <div class="feature">
                                                <i class="fas fa-check" style="color: ${colorCategoria}"></i>
                                                <span>${spec}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : ''}
                                
                                ${window.carrito ? window.carrito.renderProductVariants(product, colorCategoria) : ''}
                                
                                <div class="product-actions">
                                    <button class="add-to-cart-btn" 
                                            data-product-id="${product.id}"
                                            style="background: linear-gradient(135deg, ${colorCategoria}, ${this.darkenColor(colorCategoria)});"
                                            onclick="carrito.handleAddToCart(${product.id})">
                                        <i class="fas fa-shopping-cart"></i>
                                        AGREGAR AL CARRITO
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                if (window.carrito) {
                    setTimeout(() => {
                        document.querySelectorAll('.product-card').forEach(card => {
                            window.carrito.updateAddToCartButton(card);
                        });
                    }, 100);
                }
            }
            
            updateSearchResultsMessage(query, count) {
                const sectionSubtitle = document.querySelector('#productos .section-subtitle');
                if (sectionSubtitle) {
                    if (query) {
                        sectionSubtitle.textContent = `Encontramos ${count} producto${count !== 1 ? 's' : ''} para "${query}"`;
                        sectionSubtitle.style.color = 'var(--accent)';
                        sectionSubtitle.style.fontWeight = '600';
                    } else {
                        sectionSubtitle.textContent = 'Explora nuestra coleccin completa de productos';
                        sectionSubtitle.style.color = '';
                        sectionSubtitle.style.fontWeight = '';
                    }
                }
            }
            
            selectSearchResult(productId) {
                document.getElementById('searchResults').classList.remove('active');
                this.clearSearch('header');
                
                const product = productos.find(p => p.id === productId);
                if (product && window.carrito) {
                    window.carrito.filterProducts('todo');
                    this.renderFilteredProducts([product]);
                    
                    setTimeout(() => {
                        const productCard = document.querySelector(`.product-card[data-product-id="${productId}"]`);
                        if (productCard) {
                            productCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            productCard.style.animation = 'none';
                            setTimeout(() => {
                                productCard.style.animation = '';
                                productCard.style.boxShadow = '0 0 0 3px var(--accent)';
                                setTimeout(() => {
                                    productCard.style.boxShadow = '';
                                }, 1000);
                            }, 50);
                        }
                    }, 300);
                }
            }
            
            clearSearch(type) {
                if (type === 'header') {
                    const searchInput = document.getElementById('searchInput');
                    const clearBtn = document.getElementById('clearSearch');
                    const searchResults = document.getElementById('searchResults');
                    
                    if (searchInput) searchInput.value = '';
                    if (clearBtn) clearBtn.classList.remove('active');
                    if (searchResults) searchResults.classList.remove('active');
                    
                    this.currentSearch = '';
                    this.isSearching = false;
                    
                    if (window.carrito) {
                        window.carrito.renderProducts();
                        this.updateSearchResultsMessage('', productos.length);
                    }
                }
            }
            
            darkenColor(color) {
                let r = parseInt(color.slice(1, 3), 16);
                let g = parseInt(color.slice(3, 5), 16);
                let b = parseInt(color.slice(5, 7), 16);
                
                r = Math.floor(r * 0.8);
                g = Math.floor(g * 0.8);
                b = Math.floor(b * 0.8);
                
                return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
            }
            
            isActive() {
                return this.isSearching;
            }
            
            getCurrentSearch() {
                return this.currentSearch;
            }
        }

        // ==================== SISTEMA DE CARRITO ====================
        class Carrito {
            constructor() {
                this.items = JSON.parse(localStorage.getItem('cartModaStyle')) || [];
                this.currentFilter = 'todo';
                this.FREE_SHIPPING_MINIMUM = 300;
                this.cuponAplicado = null;
                this.couponTimers = [];
                
                document.body.style.overflow = 'auto';
                
                this.init();
            }
            
            init() {
                this.renderCartCount();
                this.setupEventListeners();
                this.renderProducts();
                this.renderCategories();
                this.renderCategoryFilters();
                this.updateCartButtons();
                
                new VersionManager();
                window.buscador = new Buscador();
                
                this.updateSectionCategories();
                this.cargarCupones();
            }
            
            // ========== MTODOS DE CUPONES CON CRONMETRO ==========
            cargarCupones() {
                const usados = localStorage.getItem('modastyle_cupones_usados');
                if (usados) {
                    try {
                        cuponesUsados = JSON.parse(usados);
                    } catch (e) {}
                }
                
                const expirados = localStorage.getItem('modastyle_cupones_expirados');
                if (expirados) {
                    try {
                        cuponesExpirados = JSON.parse(expirados);
                    } catch (e) {}
                }
                
                // Verificar expiracin de todos los cupones
                this.verificarExpiracionCupones();
                
                // Renderizar cupones en el carrito
                this.renderCouponsInCart();
                
                // Iniciar timers
                this.startCouponTimers();
            }
            
            verificarExpiracionCupones() {
                const ahora = new Date().getTime();
                let cambios = false;
                
                cuponesDisponibles.forEach(cupon => {
                    if (cupon.fechaExpiracion && !cupon.usado && !cupon.expirado) {
                        const fechaExpiracion = new Date(cupon.fechaExpiracion).getTime();
                        
                        if (ahora >= fechaExpiracion) {
                            cupon.expirado = true;
                            
                            // Agregar a lista de expirados
                            if (!cuponesExpirados.includes(cupon.id)) {
                                cuponesExpirados.push(cupon.id);
                                localStorage.setItem('modastyle_cupones_expirados', JSON.stringify(cuponesExpirados));
                            }
                            
                            // Si este cupn estaba aplicado, removerlo
                            if (this.cuponAplicado && this.cuponAplicado.id === cupon.id) {
                                this.cuponAplicado = null;
                            }
                            
                            cambios = true;
                        }
                    }
                });
                
                if (cambios) {
                    this.guardarCuponesEnStorage();
                }
            }
            
            startCouponTimers() {
                // Limpiar timers existentes
                this.couponTimers.forEach(timer => clearInterval(timer));
                this.couponTimers = [];
                
                // Cada cupn tendr su propio timer
                cuponesDisponibles.forEach(cupon => {
                    if (cupon.fechaExpiracion && !cupon.usado && !cupon.expirado) {
                        const timer = setInterval(() => {
                            this.actualizarTimerCupon(cupon.id);
                        }, 1000);
                        
                        this.couponTimers.push(timer);
                    }
                });
            }
            
            actualizarTimerCupon(cuponId) {
                const cupon = cuponesDisponibles.find(c => c.id === cuponId);
                if (!cupon || cupon.usado || cupon.expirado || !cupon.fechaExpiracion) return;
                
                const ahora = new Date().getTime();
                const fechaExpiracion = new Date(cupon.fechaExpiracion).getTime();
                const diferencia = fechaExpiracion - ahora;
                
                if (diferencia <= 0) {
                    // Cupn expirado
                    cupon.expirado = true;
                    if (!cuponesExpirados.includes(cupon.id)) {
                        cuponesExpirados.push(cupon.id);
                        localStorage.setItem('modastyle_cupones_expirados', JSON.stringify(cuponesExpirados));
                    }
                    
                    // Si estaba aplicado, removerlo
                    if (this.cuponAplicado && this.cuponAplicado.id === cupon.id) {
                        this.cuponAplicado = null;
                    }
                    
                    this.guardarCuponesEnStorage();
                    this.renderCouponsInCart();
                    this.updateCartSummary();
                    return;
                }
                
                // Actualizar el HTML del cronmetro para este cupn
                this.updateCouponTimerHTML(cupon, diferencia);
            }
            
            updateCouponTimers() {
                cuponesDisponibles.forEach(cupon => {
                    if (cupon.fechaExpiracion && !cupon.usado && !cupon.expirado) {
                        const ahora = new Date().getTime();
                        const fechaExpiracion = new Date(cupon.fechaExpiracion).getTime();
                        const diferencia = fechaExpiracion - ahora;
                        
                        if (diferencia <= 0) {
                            cupon.expirado = true;
                            if (!cuponesExpirados.includes(cupon.id)) {
                                cuponesExpirados.push(cupon.id);
                                localStorage.setItem('modastyle_cupones_expirados', JSON.stringify(cuponesExpirados));
                            }
                            
                            if (this.cuponAplicado && this.cuponAplicado.id === cupon.id) {
                                this.cuponAplicado = null;
                            }
                        } else {
                            this.updateCouponTimerHTML(cupon, diferencia);
                        }
                    }
                });
                
                this.guardarCuponesEnStorage();
                this.renderCouponsInCart();
                this.updateCartSummary();
            }
            
            updateCouponTimerHTML(cupon, diferenciaMs) {
                const cuponElement = document.querySelector(`.coupon-item[data-coupon-id="${cupon.id}"]`);
                if (!cuponElement) return;
                
                const timerElement = cuponElement.querySelector('.coupon-timer');
                if (!timerElement) return;
                
                const dias = Math.floor(diferenciaMs / (1000 * 60 * 60 * 24));
                const horas = Math.floor((diferenciaMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutos = Math.floor((diferenciaMs % (1000 * 60 * 60)) / (1000 * 60));
                const segundos = Math.floor((diferenciaMs % (1000 * 60)) / 1000);
                
                if (dias > 0) {
                    timerElement.innerHTML = `<i class="fas fa-hourglass-half"></i> <span class="timer-numbers">${dias}d ${horas}h ${minutos}m</span>`;
                } else if (horas > 0) {
                    timerElement.innerHTML = `<i class="fas fa-hourglass-half"></i> <span class="timer-numbers">${horas}h ${minutos}m ${segundos}s</span>`;
                } else {
                    timerElement.innerHTML = `<i class="fas fa-hourglass-end"></i> <span class="timer-numbers">${minutos}m ${segundos}s</span>`;
                }
            }
            
            obtenerTiempoRestante(fechaExpiracion) {
                const ahora = new Date().getTime();
                const expiracion = new Date(fechaExpiracion).getTime();
                const diferencia = expiracion - ahora;
                
                if (diferencia <= 0) {
                    return null;
                }
                
                const dias = Math.floor(diferencia / (1000 * 60 * 60 * 24));
                const horas = Math.floor((diferencia % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutos = Math.floor((diferencia % (1000 * 60 * 60)) / (1000 * 60));
                const segundos = Math.floor((diferencia % (1000 * 60)) / 1000);
                
                return { dias, horas, minutos, segundos };
            }
            
            renderCouponsInCart() {
                const couponSection = document.getElementById('couponSection');
                const couponGrid = document.getElementById('couponGrid');
                
                // Verificar expiracin antes de renderizar
                this.verificarExpiracionCupones();
                
                const cuponesActivos = cuponesDisponibles.filter(c => !c.usado && !c.expirado);
                
                if (cuponesActivos.length === 0) {
                    couponSection.style.display = 'none';
                    return;
                }
                
                couponSection.style.display = 'block';
                
                couponGrid.innerHTML = cuponesActivos.map(cupon => {
                    let bgColor = cupon.color || '#10b981';
                    let icono = cupon.icono || 'fa-ticket-alt';
                    
                    // Generar HTML del cronmetro
                    let timerHTML = '';
                    if (cupon.fechaExpiracion) {
                        const tiempo = this.obtenerTiempoRestante(cupon.fechaExpiracion);
                        if (tiempo) {
                            if (tiempo.dias > 0) {
                                timerHTML = `<div class="coupon-timer"><i class="fas fa-hourglass-half"></i> <span class="timer-numbers">${tiempo.dias}d ${tiempo.horas}h ${tiempo.minutos}m</span></div>`;
                            } else if (tiempo.horas > 0) {
                                timerHTML = `<div class="coupon-timer"><i class="fas fa-hourglass-half"></i> <span class="timer-numbers">${tiempo.horas}h ${tiempo.minutos}m ${tiempo.segundos}s</span></div>`;
                            } else {
                                timerHTML = `<div class="coupon-timer"><i class="fas fa-hourglass-end"></i> <span class="timer-numbers">${tiempo.minutos}m ${tiempo.segundos}s</span></div>`;
                            }
                        } else {
                            // Cupn expirado
                            cupon.expirado = true;
                            if (!cuponesExpirados.includes(cupon.id)) {
                                cuponesExpirados.push(cupon.id);
                                localStorage.setItem('modastyle_cupones_expirados', JSON.stringify(cuponesExpirados));
                            }
                            return ''; // No mostrar este cupn
                        }
                    }
                    
                    return `
                        <div class="coupon-item" data-coupon-id="${cupon.id}" onclick="carrito.aplicarCupon('${cupon.id}')" style="border-color: ${bgColor}; background: linear-gradient(135deg, ${bgColor}15, ${bgColor}05);">
                            <div class="coupon-icon" style="background: ${bgColor}; color: white;">
                                <i class="fas ${icono}"></i>
                            </div>
                            <div class="coupon-info">
                                <div class="coupon-code" style="color: ${bgColor};">
                                    ${cupon.codigo}
                                </div>
                                <div class="coupon-description">
                                    ${cupon.descripcion}
                                </div>
                                ${timerHTML}
                            </div>
                        </div>
                    `;
                }).join('');
                
                this.guardarCuponesEnStorage();
            }
            
            aplicarCupon(cuponId) {
                const cupon = cuponesDisponibles.find(c => c.id === cuponId);
                
                if (!cupon) {
                    alert('Este cupn no existe');
                    return;
                }
                
                if (cupon.usado) {
                    alert('Este cupn ya ha sido usado');
                    return;
                }
                
                if (cupon.expirado) {
                    alert('Este cupn ha expirado');
                    return;
                }
                
                // Verificar expiracin
                if (cupon.fechaExpiracion) {
                    const ahora = new Date().getTime();
                    const fechaExpiracion = new Date(cupon.fechaExpiracion).getTime();
                    
                    if (ahora >= fechaExpiracion) {
                        cupon.expirado = true;
                        if (!cuponesExpirados.includes(cupon.id)) {
                            cuponesExpirados.push(cupon.id);
                            localStorage.setItem('modastyle_cupones_expirados', JSON.stringify(cuponesExpirados));
                        }
                        this.guardarCuponesEnStorage();
                        this.renderCouponsInCart();
                        alert('Este cupn ha expirado');
                        return;
                    }
                }
                
                if (this.items.length === 0) {
                    alert('Agrega productos al carrito primero');
                    return;
                }
                
                const subtotal = this.calcularSubtotal();
                
                if (cupon.minimo && subtotal < cupon.minimo) {
                    alert(`Este cupn requiere un mnimo de compra de $${cupon.minimo}`);
                    return;
                }
                
                if (cupon.tipo === '2x1' || cupon.tipo === '3x2') {
                    const productosElegibles = this.items.filter(item => {
                        const producto = productos.find(p => p.id === item.productId);
                        if (!cupon.categoria) return true;
                        return producto && producto.categoria === cupon.categoria;
                    });
                    
                    if (productosElegibles.length < (cupon.tipo === '2x1' ? 2 : 3)) {
                        alert(`Necesitas al menos ${cupon.tipo === '2x1' ? '2' : '3'} productos elegibles para este cupn`);
                        return;
                    }
                }
                
                // Eliminar cupn anterior si existe
                if (this.cuponAplicado) {
                    this.cuponAplicado = null;
                }
                
                // Aplicar nuevo cupn sin marcarlo como usado
                this.cuponAplicado = cupon;
                
                this.renderCouponsInCart();
                this.renderCartItems();
                this.updateCartSummary();
                
                this.showNotification(`Cupn "${cupon.codigo}" aplicado correctamente`);
            }
            
            guardarCuponesEnStorage() {
                localStorage.setItem('modastyle_cupones', JSON.stringify(cuponesDisponibles));
            }
            
            // ========== MTODOS DEL CARRITO ==========
            renderCartCount() {
                const totalItems = this.items.reduce((sum, item) => sum + item.cantidad, 0);
                document.getElementById('cartCount').textContent = totalItems;
            }
            
            openCart() {
                document.getElementById('cartPanel').classList.add('open');
                document.getElementById('cartOverlay').classList.add('show');
                document.body.style.overflow = 'hidden';
                this.renderCartItems();
            }
            
            closeCart() {
                document.getElementById('cartPanel').classList.remove('open');
                document.getElementById('cartOverlay').classList.remove('show');
                document.body.style.overflow = 'auto';
            }
            
            setupEventListeners() {
                document.getElementById('cartIcon').addEventListener('click', () => this.openCart());
                document.getElementById('closeCart').addEventListener('click', () => this.closeCart());
                document.getElementById('cartOverlay').addEventListener('click', () => this.closeCart());
                document.getElementById('checkoutBtn').addEventListener('click', () => this.showCheckoutModal());
                document.getElementById('clearCartBtn').addEventListener('click', () => this.clearCart());
                
                document.getElementById('closeImageModal').addEventListener('click', () => this.closeImageModal());
                document.getElementById('imageModal').addEventListener('click', (e) => {
                    if (e.target === document.getElementById('imageModal')) {
                        this.closeImageModal();
                    }
                });
                
                document.getElementById('closeModal').addEventListener('click', () => this.closeCheckoutModal());
                document.getElementById('cancelCheckout').addEventListener('click', () => this.closeCheckoutModal());
                document.getElementById('checkoutForm').addEventListener('submit', (e) => this.submitOrder(e));
                
                document.querySelectorAll('.delivery-option').forEach(option => {
                    option.addEventListener('click', (e) => {
                        document.querySelectorAll('.delivery-option').forEach(o => o.classList.remove('selected'));
                        e.currentTarget.classList.add('selected');
                    });
                });
                
                document.querySelectorAll('.payment-option').forEach(option => {
                    option.addEventListener('click', (e) => {
                        document.querySelectorAll('.payment-option').forEach(o => o.classList.remove('selected'));
                        e.currentTarget.classList.add('selected');
                        
                        const transferInfo = document.getElementById('transferInfo');
                        transferInfo.classList.toggle('show', e.currentTarget.querySelector('input').value === 'transferencia');
                    });
                });
                
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        if (document.getElementById('cartPanel').classList.contains('open')) this.closeCart();
                        if (document.getElementById('checkoutModal').classList.contains('active')) this.closeCheckoutModal();
                        if (document.getElementById('imageModal').classList.contains('active')) this.closeImageModal();
                    }
                });
            }
            
            renderCartItems() {
                const cartItems = document.getElementById('cartItems');
                const emptyCart = document.getElementById('emptyCart');
                const cartSummary = document.getElementById('cartSummary');
                const cartActions = document.getElementById('cartActions');
                const freeShippingPromo = document.getElementById('freeShippingPromo');
                
                if (this.items.length === 0) {
                    cartItems.innerHTML = '';
                    emptyCart.style.display = 'block';
                    cartSummary.style.display = 'none';
                    cartSummary.classList.remove('show');
                    cartActions.classList.add('disabled');
                    freeShippingPromo.style.display = 'none';
                    return;
                }
                
                emptyCart.style.display = 'none';
                cartSummary.style.display = 'block';
                cartSummary.classList.add('show');
                cartActions.classList.remove('disabled');
                
                cartItems.innerHTML = this.items.map((item, index) => {
                    const product = productos.find(p => p.id === item.productId);
                    if (!product) return '';
                    
                    const subtotal = parseFloat(item.precio.replace('$', '')) * item.cantidad;
                    const variantesText = item.variantes.map(v => `${v.nombre}: ${v.valor}`).join(' | ');
                    
                    return `
                        <div class="cart-item">
                            <img src="${product.imagen}" alt="${product.nombre}" class="cart-item-image" onclick="carrito.openImageModal('${product.imagen}', '${product.nombre}')">
                            <div class="cart-item-details">
                                <div class="cart-item-info">
                                    <div class="cart-item-title">${product.nombre}</div>
                                    <div class="cart-item-variant">
                                        <i class="fas fa-tag"></i>
                                        ${variantesText}
                                    </div>
                                    <div class="cart-item-price">${item.precio}</div>
                                </div>
                                
                                <div class="cart-item-actions">
                                    <div class="quantity-control">
                                        <button class="quantity-btn" onclick="carrito.updateQuantity(${index}, -1)" ${item.cantidad <= 1 ? 'disabled' : ''}>
                                            <i class="fas fa-minus"></i>
                                        </button>
                                        <span class="quantity-value">${item.cantidad}</span>
                                        <button class="quantity-btn" onclick="carrito.updateQuantity(${index}, 1)">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                    <button class="remove-item" onclick="carrito.removeItem(${index})">
                                        <i class="fas fa-trash"></i>
                                        Eliminar
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                this.updateCartSummary();
                this.renderCouponsInCart();
            }
            
            calcularSubtotal() {
                return this.items.reduce((sum, item) => {
                    return sum + (parseFloat(item.precio.replace('$', '')) * item.cantidad);
                }, 0);
            }
            
            updateQuantity(index, change) {
                const item = this.items[index];
                const newQuantity = item.cantidad + change;
                
                if (newQuantity < 1) {
                    this.removeItem(index);
                    return;
                }
                
                const product = productos.find(p => p.id === item.productId);
                if (product) {
                    const variantKey = item.variantes.map(v => v.valor).join('|');
                    const stock = product.stock[variantKey] || 0;
                    
                    if (newQuantity > stock) {
                        alert(`Solo hay ${stock} unidades disponibles`);
                        return;
                    }
                }
                
                item.cantidad = newQuantity;
                this.saveCart();
                this.renderCartItems();
                this.renderCartCount();
                this.updateCartButtons();
            }
            
            removeItem(index) {
                this.items.splice(index, 1);
                this.saveCart();
                this.renderCartItems();
                this.renderCartCount();
                this.updateCartButtons();
                
                if (this.items.length === 0 && this.cuponAplicado) {
                    this.cuponAplicado = null;
                    this.renderCouponsInCart();
                }
            }
            
            updateCartSummary() {
                const subtotal = this.calcularSubtotal();
                
                let descuento = 0;
                if (this.cuponAplicado) {
                    descuento = this.calcularDescuento(subtotal);
                }
                
                const subtotalConDescuento = subtotal - descuento;
                
                let shipping = 50;
                
                if (this.cuponAplicado && this.cuponAplicado.tipo === 'envio') {
                    shipping = 0;
                } else {
                    shipping = subtotalConDescuento >= this.FREE_SHIPPING_MINIMUM ? 0 : 50;
                }
                
                const total = subtotalConDescuento + shipping;
                
                document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
                document.getElementById('shipping').textContent = shipping === 0 ? 'Gratis' : `$${shipping.toFixed(2)}`;
                document.getElementById('total').textContent = `$${total.toFixed(2)}`;
                
                const appliedCouponRow = document.getElementById('appliedCouponRow');
                if (this.cuponAplicado && descuento > 0) {
                    appliedCouponRow.style.display = 'flex';
                    document.getElementById('appliedCouponCode').textContent = this.cuponAplicado.codigo;
                    document.getElementById('appliedCouponDiscount').textContent = `-$${descuento.toFixed(2)}`;
                } else if (this.cuponAplicado && this.cuponAplicado.tipo === 'envio') {
                    appliedCouponRow.style.display = 'flex';
                    document.getElementById('appliedCouponCode').textContent = this.cuponAplicado.codigo;
                    document.getElementById('appliedCouponDiscount').textContent = 'Envo gratis';
                } else {
                    appliedCouponRow.style.display = 'none';
                }
                
                const freeShippingPromo = document.getElementById('freeShippingPromo');
                if (this.items.length > 0 && subtotal < this.FREE_SHIPPING_MINIMUM) {
                    const remaining = this.FREE_SHIPPING_MINIMUM - subtotal;
                    const progress = (subtotal / this.FREE_SHIPPING_MINIMUM) * 100;
                    
                    document.getElementById('remainingAmount').textContent = `$${remaining.toFixed(2)}`;
                    document.getElementById('shippingProgress').style.width = `${progress}%`;
                    freeShippingPromo.classList.add('show');
                    freeShippingPromo.style.display = 'block';
                } else {
                    freeShippingPromo.classList.remove('show');
                    freeShippingPromo.style.display = 'none';
                }
            }
            
            calcularDescuento(subtotal) {
                if (!this.cuponAplicado) return 0;
                
                const cupon = this.cuponAplicado;
                
                switch (cupon.tipo) {
                    case 'envio':
                        return 0;
                    case 'porcentaje':
                        return subtotal * (cupon.valor / 100);
                    case 'fijo':
                        return Math.min(cupon.valor, subtotal);
                    case '2x1':
                    case '3x2':
                        return this.calcularDescuentoPromocion(cupon);
                    default:
                        return 0;
                }
            }
            
            calcularDescuentoPromocion(cupon) {
                let elegibles = this.items.filter(item => {
                    const producto = productos.find(p => p.id === item.productId);
                    if (!cupon.categoria) return true;
                    return producto && producto.categoria === cupon.categoria;
                });
                
                if (elegibles.length === 0) return 0;
                
                elegibles.sort((a, b) => {
                    const precioA = parseFloat(a.precio.replace('$', ''));
                    const precioB = parseFloat(b.precio.replace('$', ''));
                    return precioA - precioB;
                });
                
                let descuento = 0;
                
                if (cupon.tipo === '2x1') {
                    const pares = Math.floor(elegibles.length / 2);
                    for (let i = 0; i < pares; i++) {
                        descuento += parseFloat(elegibles[i].precio.replace('$', ''));
                    }
                } else if (cupon.tipo === '3x2') {
                    const grupos = Math.floor(elegibles.length / 3);
                    for (let i = 0; i < grupos; i++) {
                        descuento += parseFloat(elegibles[i].precio.replace('$', ''));
                    }
                }
                
                return descuento;
            }
            
            addToCart(productId, variantes, precio) {
                const variantKey = variantes.map(v => v.valor).join('|');
                
                const existingItem = this.items.find(item => 
                    item.productId === productId && 
                    JSON.stringify(item.variantes) === JSON.stringify(variantes)
                );
                
                if (existingItem) {
                    this.updateQuantity(this.items.indexOf(existingItem), 1);
                } else {
                    this.items.push({
                        productId: productId,
                        variantes: variantes,
                        precio: precio,
                        cantidad: 1
                    });
                    this.saveCart();
                    this.renderCartCount();
                    this.renderCartItems();
                    this.updateCartButtons();
                    
                    this.showNotification('Producto agregado al carrito');
                }
            }
            
            clearCart() {
                if (confirm('Ests seguro de que quieres vaciar el carrito?')) {
                    this.items = [];
                    
                    if (this.cuponAplicado) {
                        this.cuponAplicado = null;
                    }
                    
                    this.saveCart();
                    this.renderCartCount();
                    this.renderCartItems();
                    this.updateCartButtons();
                    this.renderCouponsInCart();
                }
            }
            
            saveCart() {
                localStorage.setItem('cartModaStyle', JSON.stringify(this.items));
            }
            
            updateCartButtons() {
                const hasItems = this.items.length > 0;
                document.getElementById('checkoutBtn').disabled = !hasItems;
                document.getElementById('clearCartBtn').disabled = !hasItems;
            }
            
            showNotification(message) {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    bottom: 80px;
                    right: 20px;
                    background: linear-gradient(135deg, var(--accent), var(--primary));
                    color: white;
                    padding: 12px 16px;
                    border-radius: var(--border-radius);
                    z-index: 9999;
                    box-shadow: var(--shadow-hover);
                    animation: slideInRight 0.3s ease;
                `;
                notification.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-check-circle"></i>
                        <span>${message}</span>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.animation = 'slideInRight 0.3s ease reverse forwards';
                    setTimeout(() => notification.remove(), 300);
                }, 2000);
            }
            
            openImageModal(imageSrc, title) {
                document.getElementById('modalImage').src = imageSrc;
                document.getElementById('modalImage').alt = title;
                document.getElementById('imageModal').classList.add('active');
                document.body.style.overflow = 'hidden';
            }
            
            closeImageModal() {
                document.getElementById('imageModal').classList.remove('active');
                document.body.style.overflow = 'auto';
            }
            
            showCheckoutModal() {
                if (this.items.length === 0) return;
                document.getElementById('checkoutModal').classList.add('active');
                document.body.style.overflow = 'hidden';
            }
            
            closeCheckoutModal() {
                document.getElementById('checkoutModal').classList.remove('active');
                document.body.style.overflow = 'auto';
            }
            
            // ========== NUEVO: MTODO PARA MARCAR CUPONES COMO USADOS SOLO AL CONFIRMAR ==========
            marcarCuponComoUsado() {
                if (this.cuponAplicado) {
                    const cupon = this.cuponAplicado;
                    
                    // Marcar como usado
                    cupon.usado = true;
                    
                    // Agregar a la lista de cupones usados
                    if (!cuponesUsados.includes(cupon.id)) {
                        cuponesUsados.push(cupon.id);
                        localStorage.setItem('modastyle_cupones_usados', JSON.stringify(cuponesUsados));
                    }
                    
                    // Remover del carrito
                    this.cuponAplicado = null;
                    
                    // Actualizar vista
                    this.renderCouponsInCart();
                    this.guardarCuponesEnStorage();
                }
            }
            
            submitOrder(e) {
                e.preventDefault();
                
                const name = document.getElementById('customerName').value;
                const phone = document.getElementById('customerPhone').value;
                const deliveryTime = document.getElementById('deliveryTime').value;
                const deliveryOption = document.querySelector('.delivery-option.selected input')?.value;
                const paymentMethod = document.querySelector('.payment-option.selected input')?.value;
                
                if (!name || !phone || !deliveryTime || !deliveryOption || !paymentMethod) {
                    alert('Por favor completa todos los campos');
                    return;
                }
                
                let message = `*Hola ModaStyle! Quiero realizar un pedido*\n\n`;
                message += `*Informacin del cliente:*\n`;
                message += ` Nombre: ${name}\n`;
                message += ` Telfono: ${phone}\n`;
                message += ` Punto de entrega: ${this.getDeliveryName(deliveryOption)}\n`;
                message += ` Enlace: ${this.getDeliveryMap(deliveryOption)}\n`;
                message += ` Horario: ${deliveryTime}\n`;
                message += ` Pago: ${paymentMethod === 'efectivo' ? 'Efectivo' : 'Transferencia'}\n\n`;
                
                message += `*Detalles del pedido:*\n\n`;
                
                let total = 0;
                this.items.forEach((item, index) => {
                    const product = productos.find(p => p.id === item.productId);
                    const price = parseFloat(item.precio.replace('$', ''));
                    const itemTotal = price * item.cantidad;
                    total += itemTotal;
                    
                    message += `*${index + 1}. ${product.nombre}*\n`;
                    message += ` Variantes: ${item.variantes.map(v => `${v.nombre}: ${v.valor}`).join(', ')}\n`;
                    message += ` Cantidad: ${item.cantidad}\n`;
                    message += ` Precio: ${item.precio}\n`;
                    message += ` Subtotal: $${itemTotal.toFixed(2)}\n\n`;
                });
                
                const descuento = this.calcularDescuento(total);
                const totalConDescuento = total - descuento;
                let shipping = 50;
                
                if (this.cuponAplicado && this.cuponAplicado.tipo === 'envio') {
                    shipping = 0;
                } else {
                    shipping = totalConDescuento >= this.FREE_SHIPPING_MINIMUM ? 0 : 50;
                }
                
                const finalTotal = totalConDescuento + shipping;
                
                message += `*Resumen:*\n`;
                message += ` Subtotal: $${total.toFixed(2)}\n`;
                
                if (descuento > 0) {
                    message += ` Cupn (${this.cuponAplicado.codigo}): -$${descuento.toFixed(2)}\n`;
                }
                
                if (this.cuponAplicado && this.cuponAplicado.tipo === 'envio') {
                    message += ` Cupn (${this.cuponAplicado.codigo}): Envo gratis\n`;
                }
                
                message += ` Envo: ${shipping === 0 ? 'Gratis' : '$' + shipping.toFixed(2)}\n`;
                message += `* Total: $${finalTotal.toFixed(2)}*\n\n`;
                
                if (paymentMethod === 'transferencia') {
                    message += `*Datos de transferencia:*\n`;
                    message += ` Banco: STP\n`;
                    message += ` CLABE: 721180100001101243\n`;
                    message += ` Nombre: Saul Flores\n\n`;
                }
                
                message += `Gracias! `;
                
                const encodedMessage = encodeURIComponent(message);
                const whatsappUrl = `https://wa.me/5567416073?text=${encodedMessage}`;
                
                window.open(whatsappUrl, '_blank');
                
                //  DESACTIVAR CUPN SOLO AQU - EN EL MOMENTO DE CONFIRMAR PEDIDO
                this.marcarCuponComoUsado();
                
                this.clearCart();
                this.closeCheckoutModal();
                this.closeCart();
            }
            
            getDeliveryName(option) {
                const names = {
                    'xhala': 'San Sebastin Xhala',
                    'socorro': 'El Socorro',
                    'mateo': 'San Mateo'
                };
                return names[option] || option;
            }
            
            getDeliveryMap(option) {
                const maps = {
                    'xhala': 'https://maps.app.goo.gl/nKi4gyiDY1KikZPQ6',
                    'socorro': 'https://maps.app.goo.gl/BYYZWmaa9TbtjWvD8',
                    'mateo': 'https://maps.app.goo.gl/q1KoquLtgrTEnuCo6'
                };
                return maps[option] || '#';
            }
            
            renderProducts() {
                if (window.buscador && window.buscador.isActive()) return;
                
                const productsGrid = document.getElementById('productsGrid');
                const filteredProducts = this.currentFilter === 'todo' 
                    ? productos 
                    : productos.filter(p => p.categoria === this.currentFilter);
                
                if (filteredProducts.length === 0) {
                    productsGrid.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--text-light);">
                            <i class="fas fa-box-open" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.3;"></i>
                            <h3>No hay productos en esta categora</h3>
                            <p>Prueba con otra categora o vuelve ms tarde</p>
                        </div>
                    `;
                    return;
                }
                
                productsGrid.innerHTML = filteredProducts.map((product, index) => {
                    const precio = product.precioDescuento || product.precioRegular;
                    const categoria = categorias.find(c => c.id === product.categoria);
                    const colorCategoria = categoria ? categoria.color : 'var(--accent)';
                    
                    return `
                        <div class="product-card" data-product-id="${product.id}" style="animation-delay: ${index * 0.05}s">
                            <div class="product-image-container">
                                <img src="${product.imagen}" alt="${product.nombre}" class="product-image" 
                                     onclick="carrito.openImageModal('${product.imagen}', '${product.nombre}')"
                                     data-original-image="${product.imagen}"
                                     ${product.imagenesPorVariante ? 'data-has-variant-images="true"' : ''}>
                                <div class="product-badge ${product.estado}">${product.estado.toUpperCase()}</div>
                            </div>
                            
                            <div class="product-info">
                                <div class="product-category" style="color: ${colorCategoria}">
                                    <i class="fas fa-tag"></i>
                                    ${product.subcategoria}
                                </div>
                                
                                <h3 class="product-title">${product.nombre}</h3>
                                
                                <div class="product-price-container">
                                    ${product.precioDescuento ? `
                                        <div class="sale-price-container">
                                            <div class="original-price">${product.precioRegular}</div>
                                            <div class="sale-price" style="color: ${colorCategoria}">${product.precioDescuento}</div>
                                            <div class="discount-badge">OFERTA</div>
                                        </div>
                                    ` : `
                                        <div class="regular-price">${product.precioRegular}</div>
                                    `}
                                </div>
                                
                                <p class="product-description">
                                    ${product.descripcion}
                                </p>
                                
                                ${product.especificaciones && product.especificaciones.length > 0 ? `
                                    <div class="product-features">
                                        ${product.especificaciones.map(spec => `
                                            <div class="feature">
                                                <i class="fas fa-check" style="color: ${colorCategoria}"></i>
                                                <span>${spec}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : ''}
                                
                                ${this.renderProductVariants(product, colorCategoria)}
                                
                                <div class="product-actions">
                                    <button class="add-to-cart-btn" 
                                            data-product-id="${product.id}"
                                            style="background: linear-gradient(135deg, ${colorCategoria}, ${this.darkenColor(colorCategoria)});"
                                            onclick="carrito.handleAddToCart(${product.id})">
                                        <i class="fas fa-shopping-cart"></i>
                                        AGREGAR AL CARRITO
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                setTimeout(() => {
                    document.querySelectorAll('.variant-btn.selected').forEach(btn => {
                        btn.classList.remove('selected');
                    });
                }, 50);
            }
            
            renderProductVariants(product, colorCategoria) {
                if (!product.variantes || product.variantes.length === 0) return '';
                
                return product.variantes.map(variant => `
                    <div class="variant-selector" data-variant-name="${variant.nombre}">
                        <div class="variant-label">${variant.nombre}:</div>
                        <div class="variant-options">
                            ${variant.opciones.map(opcion => `
                                <button class="variant-btn" data-value="${opcion}" 
                                        style="border-color: ${colorCategoria}"
                                        onclick="carrito.selectVariant(this, '${variant.nombre}', ${variant.required})">
                                    ${opcion}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                `).join('');
            }
            
            selectVariant(button, variantName, required) {
                const productCard = button.closest('.product-card');
                const variantContainer = button.closest('.variant-selector');
                const productId = parseInt(productCard.dataset.productId);
                const product = productos.find(p => p.id === productId);
                
                const isAlreadySelected = button.classList.contains('selected');
                
                if (isAlreadySelected && !required) {
                    button.classList.remove('selected');
                    if (variantName.toLowerCase() === 'color') {
                        this.restoreOriginalImage(productCard);
                    }
                } else {
                    variantContainer.querySelectorAll('.variant-btn').forEach(btn => {
                        btn.classList.remove('selected');
                    });
                    
                    button.classList.add('selected');
                    
                    if (variantName.toLowerCase() === 'color' && product && product.imagenesPorVariante) {
                        this.updateProductImageByColor(productCard, button.dataset.value, product);
                    }
                }
                
                this.updateAddToCartButton(productCard);
            }
            
            updateProductImageByColor(productCard, color, product) {
                if (!product) {
                    const productId = parseInt(productCard.dataset.productId);
                    product = productos.find(p => p.id === productId);
                }
                
                if (!product || !product.imagenesPorVariante) return;
                
                const colorLower = color.toLowerCase();
                let imageForColor = null;
                
                for (const [variantValue, imageUrl] of Object.entries(product.imagenesPorVariante)) {
                    if (variantValue.toLowerCase().includes(colorLower)) {
                        imageForColor = imageUrl;
                        break;
                    }
                }
                
                if (imageForColor) {
                    const imgElement = productCard.querySelector('.product-image');
                    imgElement.src = imageForColor;
                    imgElement.alt = `${product.nombre} - ${color}`;
                    imgElement.setAttribute('onclick', `carrito.openImageModal('${imageForColor}', '${product.nombre} - ${color}')`);
                    imgElement.dataset.currentImage = color;
                }
            }
            
            restoreOriginalImage(productCard) {
                const productId = parseInt(productCard.dataset.productId);
                const product = productos.find(p => p.id === productId);
                
                if (!product) return;
                
                const imgElement = productCard.querySelector('.product-image');
                const originalImage = imgElement.dataset.originalImage || product.imagen;
                
                imgElement.src = originalImage;
                imgElement.alt = product.nombre;
                imgElement.setAttribute('onclick', `carrito.openImageModal('${originalImage}', '${product.nombre}')`);
                
                delete imgElement.dataset.currentImage;
            }
            
            getSelectedVariants(productCard) {
                const productId = parseInt(productCard.dataset.productId);
                const product = productos.find(p => p.id === productId);
                if (!product) return [];
                
                return product.variantes
                    .filter(variant => {
                        const variantContainer = productCard.querySelector(`.variant-selector[data-variant-name="${variant.nombre}"]`);
                        if (!variantContainer) return false;
                        return variantContainer.querySelector('.variant-btn.selected') !== null;
                    })
                    .map(variant => {
                        const variantContainer = productCard.querySelector(`.variant-selector[data-variant-name="${variant.nombre}"]`);
                        const selectedBtn = variantContainer.querySelector('.variant-btn.selected');
                        
                        return {
                            nombre: variant.nombre,
                            valor: selectedBtn.dataset.value,
                            required: variant.required
                        };
                    });
            }
            
            handleAddToCart(productId) {
                const productCard = document.querySelector(`.product-card[data-product-id="${productId}"]`);
                if (!productCard) return;
                
                const product = productos.find(p => p.id === productId);
                if (!product) return;
                
                const selectedVariants = this.getSelectedVariants(productCard);
                
                const missingRequired = product.variantes.filter(v => 
                    v.required && !selectedVariants.some(sv => sv.nombre === v.nombre)
                );
                
                if (missingRequired.length > 0) {
                    alert(`Por favor selecciona: ${missingRequired.map(v => v.nombre).join(', ')}`);
                    return;
                }
                
                const variantKey = selectedVariants.map(v => v.valor).join('|');
                const stock = product.stock[variantKey] || 0;
                
                if (stock <= 0) {
                    alert('Este producto est agotado');
                    return;
                }
                
                const cartItem = this.items.find(item => 
                    item.productId === productId && 
                    JSON.stringify(item.variantes) === JSON.stringify(selectedVariants)
                );
                
                if (cartItem && cartItem.cantidad >= stock) {
                    alert(`Solo hay ${stock} unidades disponibles`);
                    return;
                }
                
                const precio = product.precioDescuento || product.precioRegular;
                this.addToCart(productId, selectedVariants, precio);
            }
            
            updateAddToCartButton(productCard) {
                const productId = parseInt(productCard.dataset.productId);
                const product = productos.find(p => p.id === productId);
                if (!product) return;
                
                const addToCartBtn = productCard.querySelector('.add-to-cart-btn');
                
                const allRequiredSelected = product.variantes.every(variant => {
                    if (!variant.required) return true;
                    const variantContainer = productCard.querySelector(`.variant-selector[data-variant-name="${variant.nombre}"]`);
                    if (!variantContainer) return false;
                    return variantContainer.querySelector('.variant-btn.selected') !== null;
                });
                
                if (allRequiredSelected) {
                    addToCartBtn.disabled = false;
                    
                    const selectedVariants = this.getSelectedVariants(productCard);
                    const variantKey = selectedVariants.map(v => v.valor).join('|');
                    const stock = product.stock[variantKey] || 0;
                    
                    if (stock <= 0) {
                        addToCartBtn.disabled = true;
                        addToCartBtn.innerHTML = '<i class="fas fa-times"></i> AGOTADO';
                    } else {
                        addToCartBtn.innerHTML = '<i class="fas fa-shopping-cart"></i> AGREGAR AL CARRITO';
                    }
                } else {
                    addToCartBtn.disabled = true;
                    addToCartBtn.innerHTML = '<i class="fas fa-shopping-cart"></i> AGREGAR AL CARRITO';
                }
            }
            
            darkenColor(color) {
                let r = parseInt(color.slice(1, 3), 16);
                let g = parseInt(color.slice(3, 5), 16);
                let b = parseInt(color.slice(5, 7), 16);
                
                r = Math.floor(r * 0.8);
                g = Math.floor(g * 0.8);
                b = Math.floor(b * 0.8);
                
                return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
            }
            
            renderCategories() {
                this.updateSectionCategories();
            }
            
            updateSectionCategories() {
                const categoriesGrid = document.getElementById('categoriesGrid');
                document.querySelector('#categorias .section-title').textContent = sectionConfig.title;
                document.querySelector('#categorias .section-subtitle').textContent = sectionConfig.subtitle;
                
                const sortedCategories = [...sectionCategories].sort((a, b) => a.order - b.order);
                
                categoriesGrid.innerHTML = sortedCategories.map(categoria => {
                    return `
                        <div class="category-card" onclick="${categoria.action}">
                            <img src="${categoria.image}" alt="${categoria.name}" class="category-image">
                            <div class="category-overlay">
                                <h3 class="category-name">${categoria.name}</h3>
                                <p class="category-description">${categoria.description}</p>
                                <span class="category-badge" style="background: ${categoria.buttonColor}">Ver productos</span>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            renderCategoryFilters() {
                const filtersContainer = document.getElementById('categoryFilters');
                filtersContainer.innerHTML = categorias.map(categoria => {
                    const isActive = categoria.id === this.currentFilter;
                    return `
                        <button class="category-filter ${isActive ? 'active' : ''}" 
                                onclick="carrito.filterProducts('${categoria.id}')"
                                data-color="${categoria.color}">
                            ${categoria.nombre}
                        </button>
                    `;
                }).join('');
                
                this.updateFilterColors();
            }
            
            filterProducts(categoriaId) {
                if (window.buscador) window.buscador.clearSearch('header');
                
                this.currentFilter = categoriaId;
                
                document.querySelectorAll('.category-filter').forEach(filter => {
                    filter.classList.remove('active');
                });
                
                const activeFilter = document.querySelector(`.category-filter[onclick*="${categoriaId}"]`);
                if (activeFilter) activeFilter.classList.add('active');
                
                this.updateFilterColors();
                this.renderProducts();
                document.getElementById('productos').scrollIntoView({ behavior: 'smooth' });
            }
            
            updateFilterColors() {
                document.querySelectorAll('.category-filter.active').forEach(filter => {
                    const color = filter.getAttribute('data-color');
                    filter.style.background = color;
                    filter.style.color = 'white';
                    filter.style.borderColor = color;
                });
                
                document.querySelectorAll('.category-filter:not(.active)').forEach(filter => {
                    filter.style.background = '';
                    filter.style.color = '';
                    filter.style.borderColor = '';
                });
            }
        }

        // ==================== SISTEMA DE ADMINISTRACIN ====================
        class Administracion {
            constructor() {
                this.pinCorrecto = "199494";
                this.isAdmin = false;
                this.productosEditando = null;
                this.especificaciones = [];
                this.variantes = [];
                this.categoriaEditando = null;
                this.sectionCategoryEditando = null;
                this.tipoCuponSeleccionado = 'envio';
                
                document.getElementById('adminPanel').classList.remove('open');
                
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.renderProductosAdmin();
                this.renderCategoriasSelect();
                this.renderCategoriasAdmin();
                this.renderStats();
                this.loadSectionConfig();
                this.renderSectionCategories();
                this.renderCuponesAdmin();
                
                // Configurar fecha por defecto (7 das desde hoy)
                this.setDefaultExpiryDate();
            }
            
            setDefaultExpiryDate() {
                const dateInput = document.getElementById('couponExpiryDate');
                if (dateInput) {
                    const today = new Date();
                    const futureDate = new Date(today);
                    futureDate.setDate(today.getDate() + 7);
                    
                    const year = futureDate.getFullYear();
                    const month = String(futureDate.getMonth() + 1).padStart(2, '0');
                    const day = String(futureDate.getDate()).padStart(2, '0');
                    
                    dateInput.value = `${year}-${month}-${day}`;
                }
            }
            
            aplicarPresetExpiracion(valor) {
                const dateInput = document.getElementById('couponExpiryDate');
                const timeInput = document.getElementById('couponExpiryTime');
                
                if (valor === 'never') {
                    dateInput.value = '';
                    timeInput.value = '';
                    return;
                }
                
                if (valor === '1d') {
                    const date = new Date();
                    date.setDate(date.getDate() + 1);
                    dateInput.value = date.toISOString().split('T')[0];
                    timeInput.value = '23:59';
                } else if (valor === '3d') {
                    const date = new Date();
                    date.setDate(date.getDate() + 3);
                    dateInput.value = date.toISOString().split('T')[0];
                    timeInput.value = '23:59';
                } else if (valor === '7d') {
                    const date = new Date();
                    date.setDate(date.getDate() + 7);
                    dateInput.value = date.toISOString().split('T')[0];
                    timeInput.value = '23:59';
                } else if (valor === '15d') {
                    const date = new Date();
                    date.setDate(date.getDate() + 15);
                    dateInput.value = date.toISOString().split('T')[0];
                    timeInput.value = '23:59';
                } else if (valor === '30d') {
                    const date = new Date();
                    date.setDate(date.getDate() + 30);
                    dateInput.value = date.toISOString().split('T')[0];
                    timeInput.value = '23:59';
                }
            }
            
            setupEventListeners() {
                document.getElementById('adminBtn').addEventListener('click', () => this.showAuthModal());
                
                document.getElementById('authForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.verificarPin();
                });
                
                document.getElementById('cancelAuth').addEventListener('click', () => this.closeAuthModal());
                document.getElementById('closeAdmin').addEventListener('click', () => this.closeAdminPanel());
                
                document.querySelectorAll('.admin-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const tabId = e.currentTarget.dataset.tab;
                        this.switchTab(tabId);
                    });
                });
                
                document.getElementById('addSpecBtn').addEventListener('click', () => this.agregarEspecificacion());
                document.getElementById('addVariantBtn').addEventListener('click', () => this.agregarVariantField());
                document.getElementById('resetFormBtn').addEventListener('click', () => this.resetForm());
                document.getElementById('productForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.guardarProducto();
                });
                
                document.getElementById('addCategoryBtn').addEventListener('click', () => this.agregarCategoria());
                
                document.getElementById('previewSectionBtn').addEventListener('click', () => this.togglePreviewSection());
                document.getElementById('saveSectionBtn').addEventListener('click', () => this.saveSectionConfig());
                document.getElementById('addSectionCategoryBtn').addEventListener('click', () => this.addSectionCategory());
                
                document.getElementById('exportHtmlBtn').addEventListener('click', () => this.exportHtml());
            }
            
            // ========== MTODOS DE CUPONES CON CRONMETRO ==========
            seleccionarTipoCupon(tipo) {
                this.tipoCuponSeleccionado = tipo;
                
                document.querySelectorAll('.coupon-type-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                document.querySelector(`.coupon-type-option[data-type="${tipo}"]`).classList.add('selected');
                
                document.getElementById('envioFields').style.display = tipo === 'envio' ? 'block' : 'none';
                document.getElementById('porcentajeFields').style.display = tipo === 'porcentaje' ? 'block' : 'none';
                document.getElementById('fijoFields').style.display = tipo === 'fijo' ? 'block' : 'none';
                document.getElementById('2x1Fields').style.display = (tipo === '2x1' || tipo === '3x2') ? 'block' : 'none';
            }
            
            guardarCupon() {
                const tipo = this.tipoCuponSeleccionado;
                let codigo, descripcion, color, minimo, valor, categoria, icono;
                
                if (tipo === 'envio') {
                    codigo = document.getElementById('couponCode').value.trim();
                    descripcion = document.getElementById('couponDescription').value.trim();
                    minimo = parseFloat(document.getElementById('couponMinAmount').value) || 0;
                    color = document.getElementById('couponColor').value;
                    valor = 0;
                    icono = 'fa-truck';
                } else if (tipo === 'porcentaje') {
                    codigo = document.getElementById('couponCodePorcentaje').value.trim();
                    descripcion = document.getElementById('couponDescriptionPorcentaje').value.trim();
                    minimo = parseFloat(document.getElementById('couponMinAmountPorcentaje').value) || 0;
                    color = document.getElementById('couponColorPorcentaje').value;
                    valor = parseInt(document.getElementById('couponPercent').value) || 0;
                    icono = 'fa-percent';
                } else if (tipo === 'fijo') {
                    codigo = document.getElementById('couponCodeFijo').value.trim();
                    descripcion = document.getElementById('couponDescriptionFijo').value.trim();
                    minimo = parseFloat(document.getElementById('couponMinAmountFijo').value) || 0;
                    color = document.getElementById('couponColorFijo').value;
                    valor = parseFloat(document.getElementById('couponFixed').value) || 0;
                    icono = 'fa-dollar-sign';
                } else if (tipo === '2x1' || tipo === '3x2') {
                    codigo = document.getElementById('couponCodePromo').value.trim();
                    descripcion = document.getElementById('couponDescriptionPromo').value.trim();
                    color = document.getElementById('couponColorPromo').value;
                    valor = tipo;
                    categoria = document.getElementById('couponPromoCategory').value;
                    minimo = 0;
                    icono = tipo === '2x1' ? 'fa-gift' : 'fa-child';
                }
                
                if (!codigo) {
                    this.mostrarMensajeCupon('Ingresa un cdigo para el cupn', 'error');
                    return;
                }
                
                if (tipo === 'porcentaje' && (valor <= 0 || valor > 100)) {
                    this.mostrarMensajeCupon('El porcentaje debe ser entre 1 y 100', 'error');
                    return;
                }
                
                if (tipo === 'fijo' && valor <= 0) {
                    this.mostrarMensajeCupon('El descuento debe ser mayor a 0', 'error');
                    return;
                }
                
                // Obtener fecha de expiracin
                const expiryDate = document.getElementById('couponExpiryDate').value;
                const expiryTime = document.getElementById('couponExpiryTime').value || '23:59';
                let fechaExpiracion = null;
                
                if (expiryDate) {
                    fechaExpiracion = `${expiryDate}T${expiryTime}:00`;
                }
                
                const nuevoCupon = {
                    id: 'cupon' + Date.now(),
                    codigo: codigo,
                    descripcion: descripcion || 'Cupn de descuento',
                    tipo: tipo,
                    valor: valor,
                    minimo: minimo || 0,
                    color: color || '#10b981',
                    usado: false,
                    expirado: false,
                    fechaExpiracion: fechaExpiracion,
                    icono: icono
                };
                
                if (categoria) nuevoCupon.categoria = categoria;
                
                cuponesDisponibles.push(nuevoCupon);
                
                this.guardarCuponesEnStorage();
                this.renderCuponesAdmin();
                if (window.carrito) {
                    window.carrito.cargarCupones();
                    window.carrito.startCouponTimers();
                }
                
                this.mostrarMensajeCupon('Cupn guardado correctamente con cronmetro', 'success');
                this.resetCouponForm();
                this.renderStats();
            }
            
            guardarCuponesEnStorage() {
                localStorage.setItem('modastyle_cupones', JSON.stringify(cuponesDisponibles));
            }
            
            eliminarCupon(cuponId) {
                if (confirm('Eliminar este cupn?')) {
                    const index = cuponesDisponibles.findIndex(c => c.id === cuponId);
                    if (index !== -1) {
                        cuponesDisponibles.splice(index, 1);
                        
                        const usadoIndex = cuponesUsados.indexOf(cuponId);
                        if (usadoIndex !== -1) {
                            cuponesUsados.splice(usadoIndex, 1);
                            localStorage.setItem('modastyle_cupones_usados', JSON.stringify(cuponesUsados));
                        }
                        
                        const expiradoIndex = cuponesExpirados.indexOf(cuponId);
                        if (expiradoIndex !== -1) {
                            cuponesExpirados.splice(expiradoIndex, 1);
                            localStorage.setItem('modastyle_cupones_expirados', JSON.stringify(cuponesExpirados));
                        }
                        
                        this.guardarCuponesEnStorage();
                        this.renderCuponesAdmin();
                        if (window.carrito) {
                            window.carrito.cargarCupones();
                        }
                        this.mostrarMensajeCupon('Cupn eliminado', 'success');
                        this.renderStats();
                    }
                }
            }
            
            renderCuponesAdmin() {
                const container = document.getElementById('couponsListAdmin');
                
                if (!cuponesDisponibles || cuponesDisponibles.length === 0) {
                    container.innerHTML = `
                        <div class="status-message status-info">
                            <i class="fas fa-info-circle"></i>
                            <span>No hay cupones creados. Agrega cupones con cronmetro desde el formulario.</span>
                        </div>
                    `;
                    return;
                }
                
                const cuponesOrdenados = [...cuponesDisponibles].sort((a, b) => {
                    if (a.expirado && !b.expirado) return 1;
                    if (!a.expirado && b.expirado) return -1;
                    if (a.usado && !b.usado) return 1;
                    if (!a.usado && b.usado) return -1;
                    return 0;
                });
                
                container.innerHTML = cuponesOrdenados.map(cupon => {
                    let tipoTexto = '';
                    let valorTexto = '';
                    
                    if (cupon.tipo === 'envio') {
                        tipoTexto = ' Envo gratis';
                        valorTexto = cupon.minimo > 0 ? `Mnimo $${cupon.minimo}` : 'Sin mnimo';
                    } else if (cupon.tipo === 'porcentaje') {
                        tipoTexto = `${cupon.valor}% OFF`;
                        valorTexto = cupon.minimo > 0 ? `Mnimo $${cupon.minimo}` : 'Sin mnimo';
                    } else if (cupon.tipo === 'fijo') {
                        tipoTexto = `$${cupon.valor} OFF`;
                        valorTexto = cupon.minimo > 0 ? `Mnimo $${cupon.minimo}` : 'Sin mnimo';
                    } else {
                        tipoTexto = cupon.tipo.toUpperCase();
                        valorTexto = cupon.categoria ? `Solo ${cupon.categoria}` : 'Todos los productos';
                    }
                    
                    let estadoHTML = '';
                    if (cupon.expirado) {
                        estadoHTML = `<span class="status-message status-error" style="display: inline-flex; margin: 0; padding: 2px 8px; font-size: 0.7rem;"><i class="fas fa-clock"></i> Expirado</span>`;
                    } else if (cupon.usado) {
                        estadoHTML = `<span class="status-message status-error" style="display: inline-flex; margin: 0; padding: 2px 8px; font-size: 0.7rem;"><i class="fas fa-check-circle"></i> Usado</span>`;
                    } else {
                        estadoHTML = `<span class="status-message status-success" style="display: inline-flex; margin: 0; padding: 2px 8px; font-size: 0.7rem;"><i class="fas fa-check-circle"></i> Disponible</span>`;
                    }
                    
                    let fechaHTML = '';
                    if (cupon.fechaExpiracion) {
                        const fecha = new Date(cupon.fechaExpiracion);
                        fechaHTML = `
                            <div class="coupon-detail-item">
                                <span class="coupon-detail-label"><i class="fas fa-clock"></i> Expira:</span>
                                <span class="coupon-detail-value">${fecha.toLocaleDateString()} ${fecha.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                            </div>
                        `;
                    }
                    
                    return `
                        <div class="coupon-item-admin" style="${cupon.expirado ? 'opacity: 0.7;' : ''}">
                            <div class="coupon-header-admin">
                                <span class="coupon-code-admin" style="background: ${cupon.color}20; color: ${cupon.color};">
                                    <i class="fas ${cupon.icono || 'fa-ticket-alt'}"></i> ${cupon.codigo}
                                </span>
                                <div class="coupon-actions-admin">
                                    ${estadoHTML}
                                    ${cupon.fechaExpiracion && !cupon.expirado && !cupon.usado ? 
                                        `<span class="coupon-expiry-badge"><i class="fas fa-hourglass-half"></i> ${this.obtenerDiasRestantes(cupon.fechaExpiracion)}d</span>` : ''}
                                    <button class="product-action-btn delete-btn-admin" onclick="admin.eliminarCupon('${cupon.id}')" style="width: 26px; height: 26px; margin-left: 5px;">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="coupon-details-admin">
                                <div class="coupon-detail-item">
                                    <span class="coupon-detail-label">Descripcin:</span>
                                    <span class="coupon-detail-value">${cupon.descripcion}</span>
                                </div>
                                <div class="coupon-detail-item">
                                    <span class="coupon-detail-label">Tipo:</span>
                                    <span class="coupon-detail-value">${tipoTexto}</span>
                                </div>
                                <div class="coupon-detail-item">
                                    <span class="coupon-detail-label">Condicin:</span>
                                    <span class="coupon-detail-value">${valorTexto}</span>
                                </div>
                                ${fechaHTML}
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            obtenerDiasRestantes(fechaExpiracion) {
                const ahora = new Date().getTime();
                const expiracion = new Date(fechaExpiracion).getTime();
                const diferencia = expiracion - ahora;
                const dias = Math.floor(diferencia / (1000 * 60 * 60 * 24));
                return dias > 0 ? dias : 0;
            }
            
            mostrarMensajeCupon(texto, tipo) {
                const mensaje = document.getElementById('couponMessage');
                mensaje.className = `status-message status-${tipo}`;
                mensaje.innerHTML = `<i class="fas fa-${tipo === 'success' ? 'check' : 'exclamation'}-circle"></i><span>${texto}</span>`;
                mensaje.style.display = 'flex';
                
                setTimeout(() => {
                    mensaje.style.display = 'none';
                }, 3000);
            }
            
            resetCouponForm() {
                document.getElementById('couponCode').value = ' ENVO GRATIS';
                document.getElementById('couponDescription').value = 'Compras +$399';
                document.getElementById('couponMinAmount').value = '399';
                document.getElementById('couponColor').value = '#10b981';
                
                document.getElementById('couponCodePorcentaje').value = ' 20% OFF';
                document.getElementById('couponDescriptionPorcentaje').value = 'Toda la tienda';
                document.getElementById('couponMinAmountPorcentaje').value = '0';
                document.getElementById('couponColorPorcentaje').value = '#059669';
                document.getElementById('couponPercent').value = '20';
                
                document.getElementById('couponCodeFijo').value = '$50 OFF';
                document.getElementById('couponDescriptionFijo').value = 'Descuento en toda la tienda';
                document.getElementById('couponMinAmountFijo').value = '0';
                document.getElementById('couponColorFijo').value = '#8b5cf6';
                document.getElementById('couponFixed').value = '50';
                
                document.getElementById('couponCodePromo').value = '2X1CAMISETAS';
                document.getElementById('couponDescriptionPromo').value = 'Camisetas bsicas';
                document.getElementById('couponColorPromo').value = '#3b82f6';
                document.getElementById('couponPromoType').value = '2x1';
                document.getElementById('couponPromoCategory').value = '';
                
                this.setDefaultExpiryDate();
                document.getElementById('couponExpiryTime').value = '23:59';
                document.getElementById('couponExpiryPreset').value = '';
                
                this.seleccionarTipoCupon('envio');
            }
            
            // ========== MTODOS DE AUTENTICACIN ==========
            showAuthModal() {
                document.getElementById('authModal').classList.add('active');
                document.getElementById('pinInput').focus();
                document.body.style.overflow = 'hidden';
            }
            
            closeAuthModal() {
                document.getElementById('authModal').classList.remove('active');
                document.getElementById('pinInput').value = '';
                document.getElementById('authMessage').style.display = 'none';
                document.body.style.overflow = 'auto';
            }
            
            verificarPin() {
                const pin = document.getElementById('pinInput').value;
                const authMessage = document.getElementById('authMessage');
                
                if (pin === this.pinCorrecto) {
                    this.isAdmin = true;
                    authMessage.className = 'status-message status-success';
                    authMessage.innerHTML = '<i class="fas fa-check-circle"></i><span>PIN correcto. Accediendo al panel...</span>';
                    authMessage.style.display = 'flex';
                    
                    setTimeout(() => {
                        this.closeAuthModal();
                        this.openAdminPanel();
                    }, 1000);
                } else {
                    authMessage.className = 'status-message status-error';
                    authMessage.innerHTML = '<i class="fas fa-times-circle"></i><span>PIN incorrecto. Intenta de nuevo.</span>';
                    authMessage.style.display = 'flex';
                    
                    document.getElementById('pinInput').value = '';
                    document.getElementById('pinInput').focus();
                }
            }
            
            openAdminPanel() {
                document.getElementById('adminPanel').classList.add('open');
                document.body.style.overflow = 'hidden';
                this.renderProductosAdmin();
                this.renderCategoriasSelect();
                this.renderCategoriasAdmin();
                this.renderStats();
                this.loadSectionConfig();
                this.renderSectionCategories();
                this.renderCuponesAdmin();
            }
            
            closeAdminPanel() {
                document.getElementById('adminPanel').classList.remove('open');
                document.body.style.overflow = 'auto';
                this.resetForm();
                this.resetCategoriaForm();
                this.resetSectionCategoryForm();
            }
            
            switchTab(tabId) {
                document.querySelectorAll('.admin-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                document.querySelector(`.admin-tab[data-tab="${tabId}"]`).classList.add('active');
                
                document.querySelectorAll('.admin-section').forEach(section => {
                    section.classList.remove('active');
                });
                
                document.getElementById(`${tabId}Section`).classList.add('active');
                
                if (tabId === 'stats') {
                    this.renderStats();
                }
            }
            
            // ========== MTODOS DE PRODUCTOS ==========
            agregarEspecificacion() {
                const specInput = document.getElementById('specInput');
                const spec = specInput.value.trim();
                
                if (spec) {
                    this.especificaciones.push(spec);
                    this.renderEspecificaciones();
                    specInput.value = '';
                    specInput.focus();
                }
            }
            
            renderEspecificaciones() {
                const container = document.getElementById('specsContainer');
                container.innerHTML = this.especificaciones.map((spec, index) => `
                    <div class="tag">
                        ${spec}
                        <span class="tag-remove" onclick="admin.eliminarEspecificacion(${index})">
                            <i class="fas fa-times"></i>
                        </span>
                    </div>
                `).join('');
            }
            
            eliminarEspecificacion(index) {
                this.especificaciones.splice(index, 1);
                this.renderEspecificaciones();
            }
            
            agregarVariantField() {
                const variantId = Date.now();
                const variantField = document.createElement('div');
                variantField.className = 'variant-field';
                variantField.innerHTML = `
                    <div class="variant-field-header">
                        <div class="variant-field-title">
                            <i class="fas fa-cog"></i>
                            Campo de Variante
                        </div>
                        <button type="button" class="remove-variant-btn" onclick="admin.eliminarVariantField(${variantId})">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="form-row">
                        <div class="form-group-admin">
                            <label class="form-label-admin">
                                <i class="fas fa-tag"></i> Nombre del campo:
                            </label>
                            <input type="text" class="form-input-admin variant-name" placeholder="Ej: Talla, Color, Material" required>
                        </div>
                        <div class="form-group-admin">
                            <label class="form-label-admin">
                                <i class="fas fa-asterisk"></i> Requerido:
                            </label>
                            <select class="form-select variant-required" required>
                                <option value="true">S</option>
                                <option value="false">No</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group-admin">
                        <label class="form-label-admin">
                            <i class="fas fa-list"></i> Opciones (separadas por comas):
                        </label>
                        <input type="text" class="form-input-admin variant-options" placeholder="Ej: Negro, Azul, Rojo, S, M, L" required>
                    </div>
                `;
                
                document.getElementById('variantSystemContainer').appendChild(variantField);
                this.variantes.push({ id: variantId });
            }
            
            eliminarVariantField(variantId) {
                const variantField = document.querySelector(`.variant-field [onclick="admin.eliminarVariantField(${variantId})"]`)?.closest('.variant-field');
                if (variantField) {
                    variantField.remove();
                    this.variantes = this.variantes.filter(v => v.id !== variantId);
                }
            }
            
            resetForm() {
                document.getElementById('productForm').reset();
                this.especificaciones = [];
                this.variantes = [];
                this.productosEditando = null;
                
                this.renderEspecificaciones();
                document.getElementById('variantSystemContainer').innerHTML = '';
                document.getElementById('stockSystemContainer').innerHTML = '';
                
                document.getElementById('saveProductBtn').innerHTML = '<i class="fas fa-save"></i> Guardar Producto';
                document.getElementById('formMessage').style.display = 'none';
            }
            
            cargarProductoEnFormulario(producto) {
                document.getElementById('productName').value = producto.nombre;
                document.getElementById('productCategory').value = producto.categoria;
                document.getElementById('productSubcategory').value = producto.subcategoria;
                document.getElementById('productPrice').value = producto.precioRegular;
                document.getElementById('productDiscountPrice').value = producto.precioDescuento || '';
                document.getElementById('productImage').value = producto.imagen;
                document.getElementById('productDescription').value = producto.descripcion;
                
                const imagesText = producto.imagenesPorVariante ? 
                    Object.entries(producto.imagenesPorVariante)
                        .map(([key, value]) => `${key}|${value}`)
                        .join('\n') : '';
                document.getElementById('productImages').value = imagesText;
                
                this.especificaciones = producto.especificaciones || [];
                this.renderEspecificaciones();
                
                document.getElementById('productEstado').value = producto.estado || 'normal';
                
                document.getElementById('variantSystemContainer').innerHTML = '';
                this.variantes = [];
                
                if (producto.variantes && producto.variantes.length > 0) {
                    producto.variantes.forEach(variant => {
                        this.agregarVariantField();
                        const lastVariant = document.querySelector('.variant-field:last-child');
                        if (lastVariant) {
                            lastVariant.querySelector('.variant-name').value = variant.nombre;
                            lastVariant.querySelector('.variant-required').value = variant.required;
                            lastVariant.querySelector('.variant-options').value = variant.opciones.join(', ');
                        }
                    });
                }
                
                this.generarSistemaStock(producto);
                
                document.getElementById('saveProductBtn').innerHTML = '<i class="fas fa-save"></i> Actualizar Producto';
                this.switchTab('add');
            }
            
            generarSistemaStock(producto) {
                const container = document.getElementById('stockSystemContainer');
                
                if (!producto.variantes || producto.variantes.length === 0) {
                    container.innerHTML = `
                        <label class="form-label-admin">
                            <i class="fas fa-boxes"></i> Stock General:
                        </label>
                        <input type="number" id="stockGeneral" class="form-input-admin" placeholder="Cantidad en stock" value="${producto.stock && typeof producto.stock === 'number' ? producto.stock : 0}">
                    `;
                    return;
                }
                
                const combinaciones = this.generarCombinaciones(producto.variantes);
                
                let html = `
                    <div class="stock-header">
                        <label class="form-label-admin">
                            <i class="fas fa-boxes"></i> Stock por Combinaciones:
                        </label>
                    </div>
                    <div class="stock-table-container">
                        <table class="stock-table">
                            <thead>
                                <tr>
                `;
                
                producto.variantes.forEach(variant => {
                    html += `<th>${variant.nombre}</th>`;
                });
                html += `<th>Stock</th></tr></thead><tbody>`;
                
                combinaciones.forEach(combinacion => {
                    const key = combinacion.join('|');
                    const stock = producto.stock ? (producto.stock[key] || 0) : 0;
                    
                    html += `<tr>`;
                    combinacion.forEach(valor => {
                        html += `<td>${valor}</td>`;
                    });
                    html += `<td><input type="number" class="stock-input" data-key="${key}" value="${stock}"></td></tr>`;
                });
                
                html += `</tbody></table></div>`;
                container.innerHTML = html;
            }
            
            generarCombinaciones(variantes, index = 0, current = [], combinaciones = []) {
                if (index === variantes.length) {
                    combinaciones.push([...current]);
                    return combinaciones;
                }
                
                const variant = variantes[index];
                variant.opciones.forEach(opcion => {
                    current.push(opcion);
                    this.generarCombinaciones(variantes, index + 1, current, combinaciones);
                    current.pop();
                });
                
                return combinaciones;
            }
            
            obtenerDatosVariantes() {
                const variantFields = document.querySelectorAll('.variant-field');
                const variantes = [];
                
                variantFields.forEach(field => {
                    const nombre = field.querySelector('.variant-name').value.trim();
                    const required = field.querySelector('.variant-required').value === 'true';
                    const opcionesText = field.querySelector('.variant-options').value.trim();
                    
                    if (nombre && opcionesText) {
                        const opciones = opcionesText.split(',').map(o => o.trim()).filter(o => o);
                        variantes.push({
                            nombre: nombre,
                            tipo: 'select',
                            opciones: opciones,
                            required: required
                        });
                    }
                });
                
                return variantes;
            }
            
            obtenerStock() {
                const stockGeneral = document.getElementById('stockGeneral');
                if (stockGeneral) {
                    return parseInt(stockGeneral.value) || 0;
                }
                
                const stockInputs = document.querySelectorAll('.stock-input');
                const stock = {};
                
                stockInputs.forEach(input => {
                    const key = input.dataset.key;
                    const value = parseInt(input.value) || 0;
                    if (key && !isNaN(value)) {
                        stock[key] = value;
                    }
                });
                
                return stock;
            }
            
            guardarProducto() {
                const nombre = document.getElementById('productName').value.trim();
                const categoria = document.getElementById('productCategory').value;
                const subcategoria = document.getElementById('productSubcategory').value.trim();
                const precio = document.getElementById('productPrice').value.trim();
                const imagen = document.getElementById('productImage').value.trim();
                const descripcion = document.getElementById('productDescription').value.trim();
                
                if (!nombre || !categoria || !subcategoria || !precio || !imagen || !descripcion) {
                    this.mostrarMensaje('Por favor completa todos los campos requeridos', 'error');
                    return;
                }
                
                const variantes = this.obtenerDatosVariantes();
                const stock = this.obtenerStock();
                
                const imagesText = document.getElementById('productImages').value.trim();
                const imagenesPorVariante = {};
                
                if (imagesText) {
                    const lines = imagesText.split('\n');
                    lines.forEach(line => {
                        const trimmedLine = line.trim();
                        if (trimmedLine) {
                            const parts = trimmedLine.split('|');
                            if (parts.length >= 2) {
                                const variantValue = parts[0].trim();
                                const imageUrl = parts[1].trim();
                                if (variantValue && imageUrl) {
                                    imagenesPorVariante[variantValue] = imageUrl;
                                }
                            }
                        }
                    });
                }
                
                const nuevoProducto = {
                    id: this.productosEditando ? this.productosEditando.id : this.generarId(),
                    nombre: nombre,
                    precioRegular: precio,
                    precioDescuento: document.getElementById('productDiscountPrice').value.trim() || undefined,
                    imagen: imagen,
                    categoria: categoria,
                    subcategoria: subcategoria,
                    descripcion: descripcion,
                    estado: document.getElementById('productEstado').value,
                    especificaciones: [...this.especificaciones],
                    variantes: variantes,
                    stock: stock,
                    imagenesPorVariante: Object.keys(imagenesPorVariante).length > 0 ? imagenesPorVariante : undefined
                };
                
                if (this.productosEditando) {
                    const index = productos.findIndex(p => p.id === this.productosEditando.id);
                    if (index !== -1) {
                        productos[index] = nuevoProducto;
                        this.mostrarMensaje('Producto actualizado correctamente', 'success');
                    }
                } else {
                    productos.push(nuevoProducto);
                    this.mostrarMensaje('Producto agregado correctamente', 'success');
                }
                
                this.guardarProductosEnStorage();
                if (window.carrito) {
                    window.carrito.renderProducts();
                    window.carrito.renderCategoryFilters();
                }
                
                this.renderProductosAdmin();
                this.renderStats();
                
                setTimeout(() => {
                    this.resetForm();
                    this.switchTab('products');
                }, 1500);
            }
            
            generarId() {
                return Math.max(...productos.map(p => p.id), 0) + 1;
            }
            
            guardarProductosEnStorage() {
                localStorage.setItem('modastyle_productos', JSON.stringify(productos));
            }
            
            renderProductosAdmin() {
                const container = document.getElementById('productsListAdmin');
                
                if (productos.length === 0) {
                    container.innerHTML = `
                        <div class="status-message status-info">
                            <i class="fas fa-info-circle"></i>
                            <span>No hay productos. Agrega algunos desde la pestaa "Agregar".</span>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = productos.map(producto => {
                    const precio = producto.precioDescuento ? producto.precioDescuento : producto.precioRegular;
                    const categoria = categorias.find(c => c.id === producto.categoria);
                    
                    return `
                        <div class="product-item-admin" data-product-id="${producto.id}" draggable="true">
                            <img src="${producto.imagen}" alt="${producto.nombre}" class="product-image-admin">
                            <div class="product-info-admin">
                                <div class="product-name-admin">${producto.nombre}</div>
                                <div class="product-category-admin">
                                    <i class="fas fa-tag"></i>
                                    ${producto.subcategoria} | ${categoria ? categoria.nombre : producto.categoria}
                                </div>
                                <div class="product-price-admin">${precio}</div>
                            </div>
                            <div class="product-actions-admin">
                                <button class="product-action-btn edit-btn-admin" onclick="admin.editarProducto(${producto.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="product-action-btn delete-btn-admin" onclick="admin.eliminarProducto(${producto.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
                
                this.setupDragAndDrop();
            }
            
            setupDragAndDrop() {
                const container = document.getElementById('productsListAdmin');
                if (!container) return;
                
                let draggingItem = null;
                
                container.querySelectorAll('.product-item-admin').forEach(item => {
                    item.addEventListener('dragstart', (e) => {
                        draggingItem = e.currentTarget;
                        e.currentTarget.classList.add('dragging');
                    });
                    
                    item.addEventListener('dragend', () => {
                        draggingItem.classList.remove('dragging');
                        draggingItem = null;
                    });
                });
                
                container.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    const afterElement = this.getDragAfterElement(container, e.clientY);
                    
                    if (afterElement == null) {
                        container.appendChild(draggingItem);
                    } else {
                        container.insertBefore(draggingItem, afterElement);
                    }
                });
                
                container.addEventListener('drop', () => {
                    this.reordenarProductos();
                });
            }
            
            getDragAfterElement(container, y) {
                const draggableElements = [...container.querySelectorAll('.product-item-admin:not(.dragging)')];
                
                return draggableElements.reduce((closest, child) => {
                    const box = child.getBoundingClientRect();
                    const offset = y - box.top - box.height / 2;
                    
                    if (offset < 0 && offset > closest.offset) {
                        return { offset: offset, element: child };
                    } else {
                        return closest;
                    }
                }, { offset: Number.NEGATIVE_INFINITY }).element;
            }
            
            reordenarProductos() {
                const container = document.getElementById('productsListAdmin');
                const newOrder = [...container.querySelectorAll('.product-item-admin')].map(item => 
                    parseInt(item.dataset.productId)
                );
                
                const productosOrdenados = [];
                newOrder.forEach(id => {
                    const producto = productos.find(p => p.id === id);
                    if (producto) productosOrdenados.push(producto);
                });
                
                productos.forEach(producto => {
                    if (!newOrder.includes(producto.id)) {
                        productosOrdenados.push(producto);
                    }
                });
                
                productos = productosOrdenados;
                this.guardarProductosEnStorage();
                
                if (window.carrito) window.carrito.renderProducts();
                
                this.mostrarMensaje('Productos reordenados', 'success');
            }
            
            editarProducto(id) {
                const producto = productos.find(p => p.id === id);
                if (producto) {
                    this.productosEditando = producto;
                    this.cargarProductoEnFormulario(producto);
                }
            }
            
            eliminarProducto(id) {
                if (confirm('Ests seguro de que quieres eliminar este producto?')) {
                    const index = productos.findIndex(p => p.id === id);
                    if (index !== -1) {
                        productos.splice(index, 1);
                        this.guardarProductosEnStorage();
                        
                        if (window.carrito) window.carrito.renderProducts();
                        
                        this.renderProductosAdmin();
                        this.renderStats();
                        this.mostrarMensaje('Producto eliminado', 'success');
                    }
                }
            }
            
            // ========== MTODOS DE CATEGORAS ==========
            renderCategoriasSelect() {
                const select = document.getElementById('productCategory');
                select.innerHTML = '<option value="">Selecciona categora</option>';
                
                categorias.filter(c => c.id !== 'todo').forEach(categoria => {
                    const option = document.createElement('option');
                    option.value = categoria.id;
                    option.textContent = categoria.nombre;
                    select.appendChild(option);
                });
            }
            
            renderCategoriasAdmin() {
                const container = document.getElementById('categoriesListAdmin');
                
                if (categorias.length === 0) {
                    container.innerHTML = `
                        <div class="status-message status-info">
                            <i class="fas fa-info-circle"></i>
                            <span>No hay categoras. Agrega algunas desde el formulario.</span>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = categorias.filter(c => c.id !== 'todo').sort((a, b) => a.orden - b.orden).map(categoria => {
                    const productosEnCategoria = productos.filter(p => p.categoria === categoria.id).length;
                    
                    return `
                        <div class="category-item-admin" data-category-id="${categoria.id}" draggable="true">
                            <div class="category-info-admin">
                                <div class="category-icon-admin" style="background: ${categoria.color};">
                                    <i class="fas ${categoria.icono}"></i>
                                </div>
                                <div class="category-details-admin">
                                    <div class="category-name-admin">${categoria.nombre}</div>
                                    <div class="category-stats-admin">
                                        <span class="category-product-count">${productosEnCategoria} productos</span>
                                        <span class="category-color" style="background: ${categoria.color};"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="category-actions-admin">
                                <button class="category-action-btn edit-category-btn" onclick="admin.editarCategoria('${categoria.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="category-action-btn delete-category-btn" onclick="admin.eliminarCategoria('${categoria.id}')" ${productosEnCategoria > 0 ? 'disabled' : ''}>
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
                
                this.setupCategoriesDragAndDrop();
            }
            
            setupCategoriesDragAndDrop() {
                const container = document.getElementById('categoriesListAdmin');
                if (!container) return;
                
                let draggingItem = null;
                
                container.querySelectorAll('.category-item-admin').forEach(item => {
                    item.addEventListener('dragstart', (e) => {
                        draggingItem = e.currentTarget;
                        e.currentTarget.classList.add('dragging');
                    });
                    
                    item.addEventListener('dragend', () => {
                        draggingItem.classList.remove('dragging');
                        draggingItem = null;
                    });
                });
                
                container.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    const afterElement = this.getDragAfterElement(container, e.clientY);
                    
                    if (afterElement == null) {
                        container.appendChild(draggingItem);
                    } else {
                        container.insertBefore(draggingItem, afterElement);
                    }
                });
                
                container.addEventListener('drop', () => {
                    this.reordenarCategorias();
                });
            }
            
            reordenarCategorias() {
                const container = document.getElementById('categoriesListAdmin');
                const newOrder = [...container.querySelectorAll('.category-item-admin')].map(item => 
                    item.dataset.categoryId
                );
                
                const categoriasFiltradas = categorias.filter(c => c.id !== 'todo');
                
                newOrder.forEach((catId, index) => {
                    const categoria = categorias.find(c => c.id === catId);
                    if (categoria) categoria.orden = index + 1;
                });
                
                categorias.sort((a, b) => {
                    if (a.id === 'todo') return -1;
                    if (b.id === 'todo') return 1;
                    return a.orden - b.orden;
                });
                
                this.guardarCategoriasEnStorage();
                
                this.renderCategoriasSelect();
                this.renderCategoriasAdmin();
                
                if (window.carrito) {
                    window.carrito.renderCategoryFilters();
                    window.carrito.renderCategories();
                }
                
                this.mostrarMensaje('Categoras reordenadas', 'success');
            }
            
            agregarCategoria() {
                const nombre = document.getElementById('newCategoryName').value.trim();
                const color = document.getElementById('newCategoryColor').value;
                const icono = document.getElementById('newCategoryIcon').value.trim() || 'fa-tag';
                
                if (!nombre) {
                    this.mostrarMensaje('Ingresa un nombre para la categora', 'error');
                    return;
                }
                
                if (categorias.some(c => c.nombre.toLowerCase() === nombre.toLowerCase())) {
                    this.mostrarMensaje('Ya existe una categora con ese nombre', 'error');
                    return;
                }
                
                const id = this.crearSlug(nombre);
                if (categorias.some(c => c.id === id)) {
                    this.mostrarMensaje('Ya existe una categora con un nombre similar', 'error');
                    return;
                }
                
                const nuevaCategoria = {
                    id: id,
                    nombre: nombre,
                    color: color,
                    icono: icono,
                    orden: categorias.filter(c => c.id !== 'todo').length + 1
                };
                
                categorias.push(nuevaCategoria);
                this.guardarCategoriasEnStorage();
                
                this.renderCategoriasSelect();
                this.renderCategoriasAdmin();
                
                if (window.carrito) {
                    window.carrito.renderCategoryFilters();
                    window.carrito.renderCategories();
                }
                
                this.resetCategoriaForm();
                this.mostrarMensaje('Categora agregada', 'success');
            }
            
            editarCategoria(categoriaId) {
                const categoria = categorias.find(c => c.id === categoriaId);
                if (!categoria) return;
                
                this.categoriaEditando = categoria;
                
                document.getElementById('newCategoryName').value = categoria.nombre;
                document.getElementById('newCategoryColor').value = categoria.color;
                document.getElementById('newCategoryIcon').value = categoria.icono;
                
                document.getElementById('addCategoryBtn').innerHTML = '<i class="fas fa-save"></i> Actualizar Categora';
                document.getElementById('newCategoryName').focus();
                
                this.switchTab('categories');
            }
            
            eliminarCategoria(categoriaId) {
                const categoria = categorias.find(c => c.id === categoriaId);
                if (!categoria) return;
                
                const productosEnCategoria = productos.filter(p => p.categoria === categoriaId);
                
                if (productosEnCategoria.length > 0) {
                    this.mostrarMensaje(`No se puede eliminar porque tiene ${productosEnCategoria.length} productos`, 'error');
                    return;
                }
                
                if (confirm(`Eliminar categora "${categoria.nombre}"?`)) {
                    categorias = categorias.filter(c => c.id !== categoriaId);
                    
                    categorias.filter(c => c.id !== 'todo').forEach((c, index) => {
                        c.orden = index + 1;
                    });
                    
                    this.guardarCategoriasEnStorage();
                    this.renderCategoriasSelect();
                    this.renderCategoriasAdmin();
                    
                    if (window.carrito) {
                        window.carrito.renderCategoryFilters();
                        window.carrito.renderCategories();
                    }
                    
                    this.mostrarMensaje('Categora eliminada', 'success');
                }
            }
            
            resetCategoriaForm() {
                document.getElementById('newCategoryName').value = '';
                document.getElementById('newCategoryColor').value = '#D4AF37';
                document.getElementById('newCategoryIcon').value = 'fa-tag';
                this.categoriaEditando = null;
                
                document.getElementById('addCategoryBtn').innerHTML = '<i class="fas fa-plus"></i> Agregar Nueva Categora';
                document.getElementById('categoriesMessage').style.display = 'none';
            }
            
            guardarCategoriasEnStorage() {
                localStorage.setItem('modastyle_categorias', JSON.stringify(categorias));
            }
            
            crearSlug(texto) {
                return texto
                    .toLowerCase()
                    .normalize('NFD')
                    .replace(/[\u0300-\u036f]/g, '')
                    .replace(/[^a-z0-9]+/g, '-')
                    .replace(/^-+|-+$/g, '');
            }
            
            // ========== EDITOR DE SECCIN ==========
            loadSectionConfig() {
                document.getElementById('sectionTitle').value = sectionConfig.title;
                document.getElementById('sectionSubtitle').value = sectionConfig.subtitle;
            }
            
            renderSectionCategories() {
                const container = document.getElementById('sectionCategoriesList');
                
                if (sectionCategories.length === 0) {
                    container.innerHTML = `
                        <div class="status-message status-info">
                            <i class="fas fa-info-circle"></i>
                            <span>No hay categoras en esta seccin. Agrega algunas desde el botn "Agregar Categora".</span>
                        </div>
                    `;
                    return;
                }
                
                const sortedCategories = [...sectionCategories].sort((a, b) => a.order - b.order);
                
                container.innerHTML = sortedCategories.map((cat, index) => `
                    <div class="editor-category-item" data-category-id="${cat.id}" draggable="true">
                        <div class="editor-category-header">
                            <div class="editor-category-title">
                                <i class="fas fa-tag"></i> ${cat.name}
                                <span class="color-preview" style="background: ${cat.buttonColor};"></span>
                            </div>
                            <div class="editor-category-actions">
                                <button class="category-action-btn edit-category-btn" onclick="admin.editarSectionCategory(${cat.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="category-action-btn delete-category-btn" onclick="admin.eliminarSectionCategory(${cat.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="editor-category-content">
                            <div class="editor-category-preview">
                                <img src="${cat.image}" alt="${cat.name}">
                            </div>
                            <div class="editor-category-fields">
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-font"></i> Nombre:
                                    </label>
                                    <input type="text" class="form-input-admin" value="${cat.name}" readonly>
                                </div>
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-align-left"></i> Descripcin:
                                    </label>
                                    <input type="text" class="form-input-admin" value="${cat.description}" readonly>
                                </div>
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-link"></i> Accin:
                                    </label>
                                    <input type="text" class="form-input-admin" value="${cat.action}" readonly>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                this.setupSectionCategoriesDragAndDrop();
            }
            
            setupSectionCategoriesDragAndDrop() {
                const container = document.getElementById('sectionCategoriesList');
                if (!container) return;
                
                let draggingItem = null;
                
                container.querySelectorAll('.editor-category-item').forEach(item => {
                    item.addEventListener('dragstart', (e) => {
                        draggingItem = e.currentTarget;
                        e.currentTarget.classList.add('dragging');
                    });
                    
                    item.addEventListener('dragend', () => {
                        draggingItem.classList.remove('dragging');
                        draggingItem = null;
                    });
                });
                
                container.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    const afterElement = this.getDragAfterElement(container, e.clientY);
                    
                    if (afterElement == null) {
                        container.appendChild(draggingItem);
                    } else {
                        container.insertBefore(draggingItem, afterElement);
                    }
                });
                
                container.addEventListener('drop', () => {
                    this.reordenarSectionCategories();
                });
            }
            
            reordenarSectionCategories() {
                const container = document.getElementById('sectionCategoriesList');
                const newOrder = [...container.querySelectorAll('.editor-category-item')].map(item => 
                    parseInt(item.dataset.categoryId)
                );
                
                const categoriasOrdenadas = [];
                newOrder.forEach(id => {
                    const categoria = sectionCategories.find(c => c.id === id);
                    if (categoria) categoriasOrdenadas.push(categoria);
                });
                
                sectionCategories.forEach(categoria => {
                    if (!newOrder.includes(categoria.id)) {
                        categoriasOrdenadas.push(categoria);
                    }
                });
                
                categoriasOrdenadas.forEach((cat, index) => {
                    cat.order = index + 1;
                });
                
                sectionCategories = categoriasOrdenadas;
                this.guardarSectionCategoriesEnStorage();
                
                if (window.carrito) window.carrito.updateSectionCategories();
                
                this.mostrarEditorMensaje('Categoras reordenadas', 'success');
            }
            
            addSectionCategory() {
                if (this.sectionCategoryEditando) {
                    this.actualizarSectionCategory();
                    return;
                }
                
                const id = sectionCategories.length > 0 ? Math.max(...sectionCategories.map(c => c.id)) + 1 : 1;
                const nuevaCategoria = {
                    id: id,
                    name: `Nueva Categora ${id}`,
                    description: "Descripcin de la categora",
                    image: "https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                    buttonColor: "#D4AF37",
                    action: "carrito.filterProducts('todo')",
                    order: sectionCategories.length + 1
                };
                
                sectionCategories.push(nuevaCategoria);
                this.guardarSectionCategoriesEnStorage();
                this.renderSectionCategories();
                
                if (window.carrito) window.carrito.updateSectionCategories();
                
                this.mostrarEditorMensaje('Categora agregada', 'success');
                this.editarSectionCategory(id);
            }
            
            editarSectionCategory(categoryId) {
                const categoria = sectionCategories.find(c => c.id === categoryId);
                if (!categoria) return;
                
                this.sectionCategoryEditando = categoria;
                
                const container = document.getElementById('sectionCategoriesList');
                const categoryItem = container.querySelector(`[data-category-id="${categoryId}"]`);
                
                if (categoryItem) {
                    categoryItem.innerHTML = `
                        <div class="editor-category-header">
                            <div class="editor-category-title">
                                <i class="fas fa-edit"></i> Editando: ${categoria.name}
                            </div>
                            <div class="editor-category-actions">
                                <button class="category-action-btn edit-category-btn" style="background: linear-gradient(135deg, #4CAF50, #45a049);" onclick="admin.guardarSectionCategoryEdit(${categoryId})">
                                    <i class="fas fa-save"></i>
                                </button>
                                <button class="category-action-btn delete-category-btn" onclick="admin.cancelarSectionCategoryEdit(${categoryId})">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <div class="editor-category-content">
                            <div class="editor-category-preview">
                                <img src="${categoria.image}" alt="${categoria.name}" id="sectionCategoryImagePreview">
                            </div>
                            <div class="editor-category-fields">
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-font"></i> Nombre:
                                    </label>
                                    <input type="text" id="sectionCategoryName" class="form-input-admin" value="${categoria.name}" placeholder="Nombre de la categora">
                                </div>
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-align-left"></i> Descripcin:
                                    </label>
                                    <input type="text" id="sectionCategoryDescription" class="form-input-admin" value="${categoria.description}" placeholder="Descripcin breve">
                                </div>
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-image"></i> URL de Imagen:
                                    </label>
                                    <input type="text" id="sectionCategoryImage" class="form-input-admin" value="${categoria.image}" placeholder="URL de la imagen" oninput="admin.actualizarPreviewImagen('${categoryId}')">
                                </div>
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-palette"></i> Color del Botn:
                                    </label>
                                    <input type="color" id="sectionCategoryColor" class="form-input-admin" style="height: 38px; padding: 4px;" value="${categoria.buttonColor}">
                                </div>
                                <div class="form-group-admin">
                                    <label class="form-label-admin">
                                        <i class="fas fa-link"></i> Accin (JavaScript):
                                    </label>
                                    <input type="text" id="sectionCategoryAction" class="form-input-admin" value="${categoria.action}" placeholder="Ej: carrito.filterProducts('hombre')">
                                    <div style="font-size: 0.7rem; color: var(--text-light); margin-top: 4px;">
                                        <i class="fas fa-info-circle"></i> Cdigo JavaScript que se ejecuta al hacer clic
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    categoryItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            }
            
            actualizarPreviewImagen(categoryId) {
                const imageUrl = document.getElementById('sectionCategoryImage')?.value;
                const preview = document.getElementById('sectionCategoryImagePreview');
                if (preview && imageUrl) preview.src = imageUrl;
            }
            
            guardarSectionCategoryEdit(categoryId) {
                const categoria = sectionCategories.find(c => c.id === categoryId);
                if (!categoria) return;
                
                const name = document.getElementById('sectionCategoryName')?.value.trim();
                const description = document.getElementById('sectionCategoryDescription')?.value.trim();
                const image = document.getElementById('sectionCategoryImage')?.value.trim();
                const buttonColor = document.getElementById('sectionCategoryColor')?.value;
                const action = document.getElementById('sectionCategoryAction')?.value.trim();
                
                if (!name || !description || !image || !action) {
                    this.mostrarEditorMensaje('Por favor completa todos los campos', 'error');
                    return;
                }
                
                categoria.name = name;
                categoria.description = description;
                categoria.image = image;
                categoria.buttonColor = buttonColor;
                categoria.action = action;
                
                this.guardarSectionCategoriesEnStorage();
                this.renderSectionCategories();
                
                if (window.carrito) window.carrito.updateSectionCategories();
                
                this.sectionCategoryEditando = null;
                this.mostrarEditorMensaje('Categora actualizada', 'success');
            }
            
            cancelarSectionCategoryEdit(categoryId) {
                this.sectionCategoryEditando = null;
                this.renderSectionCategories();
            }
            
            eliminarSectionCategory(categoryId) {
                const categoria = sectionCategories.find(c => c.id === categoryId);
                if (!categoria) return;
                
                if (confirm(`Eliminar categora "${categoria.name}"?`)) {
                    sectionCategories = sectionCategories.filter(c => c.id !== categoryId);
                    
                    sectionCategories.forEach((cat, index) => {
                        cat.order = index + 1;
                    });
                    
                    this.guardarSectionCategoriesEnStorage();
                    this.renderSectionCategories();
                    
                    if (window.carrito) window.carrito.updateSectionCategories();
                    
                    this.mostrarEditorMensaje('Categora eliminada', 'success');
                }
            }
            
            actualizarSectionCategory() {
                this.mostrarEditorMensaje('Por favor, guarda los cambios primero', 'info');
            }
            
            resetSectionCategoryForm() {
                this.sectionCategoryEditando = null;
                document.getElementById('editorMessage').style.display = 'none';
            }
            
            togglePreviewSection() {
                const preview = document.getElementById('sectionPreview');
                const isVisible = preview.style.display === 'block';
                
                if (isVisible) {
                    preview.style.display = 'none';
                    document.getElementById('previewSectionBtn').innerHTML = '<i class="fas fa-eye"></i> Vista Previa';
                } else {
                    this.updatePreviewSection();
                    preview.style.display = 'block';
                    document.getElementById('previewSectionBtn').innerHTML = '<i class="fas fa-eye-slash"></i> Ocultar Vista Previa';
                    preview.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            }
            
            updatePreviewSection() {
                document.getElementById('previewSectionTitle').textContent = document.getElementById('sectionTitle').value;
                document.getElementById('previewSectionSubtitle').textContent = document.getElementById('sectionSubtitle').value;
                
                const previewGrid = document.getElementById('previewCategoriesGrid');
                const sortedCategories = [...sectionCategories].sort((a, b) => a.order - b.order);
                
                previewGrid.innerHTML = sortedCategories.map(cat => `
                    <div class="category-card">
                        <img src="${cat.image}" alt="${cat.name}" class="category-image">
                        <div class="category-overlay">
                            <h3 class="category-name">${cat.name}</h3>
                            <p class="category-description">${cat.description}</p>
                            <span class="category-badge" style="background: ${cat.buttonColor}">Ver productos</span>
                        </div>
                    </div>
                `).join('');
            }
            
            saveSectionConfig() {
                const title = document.getElementById('sectionTitle').value.trim();
                const subtitle = document.getElementById('sectionSubtitle').value.trim();
                
                if (!title) {
                    this.mostrarEditorMensaje('El ttulo de la seccin es requerido', 'error');
                    return;
                }
                
                sectionConfig.title = title;
                sectionConfig.subtitle = subtitle;
                
                this.guardarSectionConfigEnStorage();
                
                if (window.carrito) window.carrito.updateSectionCategories();
                
                this.mostrarEditorMensaje('Configuracin de seccin guardada', 'success');
            }
            
            guardarSectionCategoriesEnStorage() {
                localStorage.setItem('modastyle_section_categories', JSON.stringify(sectionCategories));
            }
            
            guardarSectionConfigEnStorage() {
                localStorage.setItem('modastyle_section_config', JSON.stringify(sectionConfig));
            }
            
            mostrarEditorMensaje(texto, tipo) {
                const mensaje = document.getElementById('editorMessage');
                mensaje.className = `status-message status-${tipo}`;
                mensaje.innerHTML = `<i class="fas fa-${tipo === 'success' ? 'check' : 'exclamation'}-circle"></i><span>${texto}</span>`;
                mensaje.style.display = 'flex';
                
                setTimeout(() => {
                    mensaje.style.display = 'none';
                }, 3000);
            }
            
            // ========== ESTADSTICAS Y EXPORTACIN ==========
            renderStats() {
                const statsGrid = document.getElementById('statsGrid');
                if (!statsGrid) return;
                
                const total = productos.length;
                const stats = {};
                
                categorias.forEach(categoria => {
                    stats[categoria.id] = productos.filter(p => p.categoria === categoria.id).length;
                });
                
                statsGrid.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--admin);">
                            <i class="fas fa-boxes"></i>
                        </div>
                        <div class="stat-value">${total}</div>
                        <div class="stat-label">Productos Totales</div>
                    </div>
                    
                    ${categorias.filter(c => c.id !== 'todo').map(categoria => `
                        <div class="stat-card">
                            <div class="stat-icon" style="background: ${categoria.color};">
                                <i class="fas ${categoria.icono}"></i>
                            </div>
                            <div class="stat-value">${stats[categoria.id] || 0}</div>
                            <div class="stat-label">${categoria.nombre}</div>
                        </div>
                    `).join('')}
                `;
                
                const cuponesActivos = cuponesDisponibles.filter(c => !c.usado && !c.expirado).length;
                const cuponesExpiranPronto = cuponesDisponibles.filter(c => {
                    if (!c.fechaExpiracion || c.usado || c.expirado) return false;
                    const ahora = new Date().getTime();
                    const expiracion = new Date(c.fechaExpiracion).getTime();
                    const diferencia = expiracion - ahora;
                    return diferencia > 0 && diferencia < 86400000 * 3; // 3 das
                }).length;
                const cuponesExpirados = cuponesDisponibles.filter(c => c.expirado).length;
                const cuponesUsadosCount = cuponesDisponibles.filter(c => c.usado).length;
                
                document.getElementById('totalCouponsStat').textContent = cuponesActivos;
                document.getElementById('expiringSoonCouponsStat').textContent = cuponesExpiranPronto;
                document.getElementById('expiredCouponsStat').textContent = cuponesExpirados;
                document.getElementById('usedCouponsStat').textContent = cuponesUsadosCount;
            }
            
            exportHtml() {
                const cleanHtml = document.getElementById('exportClean').checked;
                const includeData = document.getElementById('exportIncludeData').checked;
                
                let htmlContent = this.generateHtmlContent(cleanHtml, includeData);
                
                const blob = new Blob([htmlContent], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = 'tienda_modastyle_con_cronometro.html';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                URL.revokeObjectURL(url);
                
                this.mostrarMensaje('HTML exportado correctamente con cupones y cronmetros', 'success');
            }
            
            generateHtmlContent(cleanHtml, includeData) {
                const docClone = document.cloneNode(true);
                
                if (cleanHtml) {
                    const adminPanel = docClone.getElementById('adminPanel');
                    const authModal = docClone.getElementById('authModal');
                    const adminBtn = docClone.getElementById('adminBtn');
                    
                    if (adminPanel) adminPanel.remove();
                    if (authModal) authModal.remove();
                    if (adminBtn) adminBtn.remove();
                }
                
                if (includeData) {
                    const scripts = docClone.querySelectorAll('script');
                    const lastScript = scripts[scripts.length - 1];
                    
                    if (lastScript) {
                        const productosJson = JSON.stringify(productos);
                        const categoriasJson = JSON.stringify(categorias);
                        const sectionCategoriesJson = JSON.stringify(sectionCategories);
                        const sectionConfigJson = JSON.stringify(sectionConfig);
                        const cuponesJson = JSON.stringify(cuponesDisponibles);
                        const cuponesUsadosJson = JSON.stringify(cuponesUsados);
                        const cuponesExpiradosJson = JSON.stringify(cuponesExpirados);
                        
                        let scriptContent = lastScript.textContent;
                        scriptContent = scriptContent.replace(/let productos = \[[\s\S]*?\];/, `let productos = ${productosJson};`);
                        scriptContent = scriptContent.replace(/let categorias = \[[\s\S]*?\];/, `let categorias = ${categoriasJson};`);
                        scriptContent = scriptContent.replace(/let sectionCategories = \[[\s\S]*?\];/, `let sectionCategories = ${sectionCategoriesJson};`);
                        scriptContent = scriptContent.replace(/let sectionConfig = \{[\s\S]*?\};/, `let sectionConfig = ${sectionConfigJson};`);
                        scriptContent = scriptContent.replace(/let cuponesDisponibles = \[[\s\S]*?\];/, `let cuponesDisponibles = ${cuponesJson};`);
                        scriptContent = scriptContent.replace(/let cuponesUsados = \[[\s\S]*?\];/, `let cuponesUsados = ${cuponesUsadosJson};`);
                        scriptContent = scriptContent.replace(/let cuponesExpirados = \[[\s\S]*?\];/, `let cuponesExpirados = ${cuponesExpiradosJson};`);
                        
                        lastScript.textContent = scriptContent;
                    }
                }
                
                return docClone.documentElement.outerHTML;
            }
            
            mostrarMensaje(texto, tipo) {
                const mensaje = document.getElementById('formMessage');
                mensaje.className = `status-message status-${tipo}`;
                mensaje.innerHTML = `<i class="fas fa-${tipo === 'success' ? 'check' : 'exclamation'}-circle"></i><span>${texto}</span>`;
                mensaje.style.display = 'flex';
                
                setTimeout(() => {
                    mensaje.style.display = 'none';
                }, 3000);
            }
        }

        // ==================== INICIALIZACIN ====================
        const carrito = new Carrito();
        const admin = new Administracion();
        
        window.carrito = carrito;
        window.admin = admin;
        window.filterProducts = (categoriaId) => carrito.filterProducts(categoriaId);
        window.buscador = window.buscador || null;
        
        console.log('Sistema de tienda ModaStyle con CRONMETRO EN CUPONES funcional correctamente');
        console.log('Versin 3.0.0 - Cupones con das, horas y minutos');
    </script>

</body></html>
