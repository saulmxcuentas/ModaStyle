<!DOCTYPE html>
<html lang="es" style="overflow: auto;"><head></head><body style="overflow: hidden;">Aquí está el archivo HTML completo con las correcciones para que los cupones y el banner se exporten correctamente junto con todos los datos actuales:

```html



    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ModaStyle - Tienda de Ropa, Accesorios y Hogar</title>
    
    <!-- Estilos CSS -->
    <style>
        :root {
            /* Paleta de colores */
            --primary: #1a1a1a;
            --secondary: #333333;
            --accent: #D4AF37; /* Oro elegante */
            --light: #f8f8f8;
            --medium: #e0e0e0;
            --dark: #0a0a0a;
            --text: #333333;
            --text-light: #666666;
            --success: #2e8b57;
            --warning: #ffa500;
            --error: #cc3333;
            --admin: #8B5CF6;
            --coupon: #FF6B6B;
            --flash-sale: #FF4757;
            
            /* Colores categorías */
            --color-todo: #D4AF37;
            --color-hombre: #2563EB;
            --color-mujer: #DB2777;
            --color-kids: #059669;
            --color-accesorios: #7C3AED;
            
            /* Variables de diseño */
            --border-radius: 8px;
            --border-radius-sm: 4px;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            --shadow-hover: 0 4px 12px rgba(0, 0, 0, 0.08);
            --transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.1);
            --container-width: 1200px;
            --header-height: 60px;
        }

        /* Reset y estilos base */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
            font-size: 14px;
        }

        body {
            font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--light);
            color: var(--text);
            line-height: 1.4;
            overflow-x: hidden;
        }

        .container {
            max-width: var(--container-width);
            margin: 0 auto;
            padding: 0 15px;
        }

        /* ==================== BANNER DE OFERTAS RELÁMPAGO ==================== */
        .flash-sale-banner {
            position: fixed;
            top: var(--header-height);
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #FF4757, #FF6B6B, #FF3838);
            color: white;
            z-index: 999;
            padding: 12px 0;
            box-shadow: 0 2px 10px rgba(255, 71, 87, 0.3);
            animation: slideDown 0.5s ease;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }

        @keyframes slideDown {
            from { transform: translateY(-100%); }
            to { transform: translateY(0); }
        }

        .flash-sale-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
        }

        .flash-sale-left {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .flash-sale-icon {
            width: 32px;
            height: 32px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .flash-sale-info {
            flex: 1;
        }

        .flash-sale-title {
            font-weight: 800;
            font-size: 0.9rem;
            margin-bottom: 4px;
            letter-spacing: 0.5px;
        }

        .flash-sale-description {
            font-size: 0.8rem;
            opacity: 0.9;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .flash-sale-timer {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .timer-label {
            font-size: 0.7rem;
            opacity: 0.9;
            font-weight: 600;
        }

        .timer-display {
            display: flex;
            gap: 8px;
            font-family: 'Courier New', monospace;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .timer-unit {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 40px;
        }

        .timer-value {
            background: rgba(0, 0, 0, 0.3);
            padding: 4px 8px;
            border-radius: var(--border-radius-sm);
            font-size: 1rem;
            min-width: 32px;
            text-align: center;
        }

        .timer-label-unit {
            font-size: 0.6rem;
            opacity: 0.8;
            margin-top: 2px;
        }

        .flash-sale-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .flash-sale-products {
            display: flex;
            gap: 8px;
            margin-right: 10px;
        }

        .flash-product-preview {
            width: 40px;
            height: 40px;
            border-radius: var(--border-radius-sm);
            overflow: hidden;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .flash-product-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .flash-sale-btn {
            padding: 8px 16px;
            background: white;
            color: #FF4757;
            border: none;
            border-radius: var(--border-radius-sm);
            font-weight: 700;
            font-size: 0.8rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        .flash-sale-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .close-flash-banner {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            flex-shrink: 0;
        }

        .close-flash-banner:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }

        /* Header con ajuste para el banner */
        .main-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            height: var(--header-height);
            z-index: 1000;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.05);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 100%;
            gap: 15px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            color: var(--primary);
            flex-shrink: 0;
        }

        .logo-icon {
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.8rem;
            box-shadow: 0 1px 4px rgba(212, 175, 55, 0.3);
        }

        .logo-text {
            font-size: 1.1rem;
            font-weight: 700;
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        /* Buscador en Header */
        .search-container {
            flex: 1;
            max-width: 400px;
            position: relative;
            margin: 0 15px;
        }

        .search-input {
            width: 100%;
            padding: 10px 15px 10px 40px;
            border: 1px solid var(--medium);
            border-radius: var(--border-radius);
            background: var(--light);
            font-size: 0.85rem;
            transition: var(--transition);
            outline: none;
            color: var(--text);
        }

        .search-input:focus {
            border-color: var(--accent);
            background: white;
            box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.1);
        }

        .search-input::placeholder {
            color: var(--text-light);
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-hover);
            margin-top: 5px;
            z-index: 1001;
            max-height: 400px;
            overflow-y: auto;
            display: none;
            border: 1px solid var(--medium);
        }

        .search-results.active {
            display: block;
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .search-result-item {
            padding: 12px 15px;
            border-bottom: 1px solid var(--light);
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: var(--transition);
        }

        .search-result-item:hover {
            background: var(--light);
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-image {
            width: 45px;
            height: 45px;
            object-fit: cover;
            border-radius: var(--border-radius-sm);
            flex-shrink: 0;
        }

        .search-result-info {
            flex: 1;
            min-width: 0;
        }

        .search-result-name {
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 3px;
            color: var(--primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .search-result-category {
            font-size: 0.7rem;
            color: var(--text-light);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .search-result-price {
            font-weight: 700;
            color: var(--accent);
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .search-no-results {
            padding: 20px;
            text-align: center;
            color: var(--text-light);
        }

        .search-no-results i {
            font-size: 1.5rem;
            margin-bottom: 8px;
            color: var(--medium);
        }

        .search-no-results p {
            margin: 0;
            font-size: 0.85rem;
        }

        .clear-search {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            padding: 5px;
            display: none;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }

        .clear-search:hover {
            background: var(--medium);
            color: var(--primary);
        }

        .clear-search.active {
            display: flex;
        }

        /* Botón de Administración */
        .admin-btn {
            background: linear-gradient(135deg, var(--admin), #7C3AED);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            padding: 8px 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 1px 4px rgba(139, 92, 246, 0.3);
            margin-left: auto;
            margin-right: 10px;
        }

        .admin-btn:hover {
            background: linear-gradient(135deg, #7C3AED, var(--admin));
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(139, 92, 246, 0.4);
        }

        /* Navegación */
        .nav-links {
            display: flex;
            gap: 20px;
            list-style: none;
        }

        .nav-link {
            text-decoration: none;
            color: var(--text);
            font-weight: 500;
            padding: 4px 0;
            position: relative;
            transition: var(--transition);
            font-size: 0.85rem;
            letter-spacing: 0.3px;
        }

        .nav-link:hover {
            color: var(--accent);
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 1px;
            background: linear-gradient(90deg, var(--accent), var(--primary));
            transition: var(--transition);
        }

        .nav-link:hover::after {
            width: 100%;
        }

        /* Ajuste para el hero section cuando hay banner */
        .hero-section {
            padding: 80px 0 30px;
            background: linear-gradient(135deg, #f5f5f5 0%, #ffffff 100%);
            position: relative;
            overflow: hidden;
        }

        .flash-sale-banner.active ~ .hero-section {
            padding-top: 120px;
        }

        .hero-content {
            text-align: center;
            max-width: 700px;
            margin: 0 auto;
            position: relative;
            z-index: 2;
        }

        .hero-title {
            font-size: 2rem;
            font-weight: 800;
            line-height: 1.1;
            margin-bottom: 15px;
            color: var(--primary);
            letter-spacing: -0.5px;
        }

        .hero-highlight {
            color: var(--accent);
            font-weight: 700;
        }

        /* Badges */
        .hero-badges {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 25px;
        }

        .badge {
            padding: 6px 12px;
            background: white;
            border-radius: var(--border-radius-sm);
            font-size: 0.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(212, 175, 55, 0.2);
            transition: var(--transition);
        }

        .badge:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-hover);
            border-color: var(--accent);
        }

        .badge i {
            color: var(--accent);
            font-size: 0.85rem;
        }

        /* Sección de Categorías */
        .categories-section {
            padding: 40px 0;
            background: var(--light);
        }

        .section-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.6rem;
            font-weight: 800;
            margin-bottom: 10px;
            color: var(--primary);
            position: relative;
            display: inline-block;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 2px;
            background: linear-gradient(90deg, var(--accent), var(--primary));
            border-radius: 1px;
        }

        .section-subtitle {
            color: var(--text-light);
            font-size: 0.9rem;
            max-width: 500px;
            margin: 0 auto;
        }

        /* Grid de categorías de la página principal */
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .category-card {
            position: relative;
            border-radius: var(--border-radius);
            overflow: hidden;
            height: 250px;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .category-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
        }

        .category-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
        }

        .category-card:hover .category-image {
            transform: scale(1.05);
        }

        .category-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            color: white;
            padding: 20px 15px 15px;
        }

        .category-name {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .category-description {
            font-size: 0.85rem;
            opacity: 0.9;
            margin-bottom: 10px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            min-height: 28px;
        }

        .category-badge {
            display: inline-block;
            padding: 4px 10px;
            background: var(--accent);
            color: var(--dark);
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            font-size: 0.75rem;
        }

        /* Productos */
        .products-section {
            padding: 50px 0;
            background: linear-gradient(135deg, #ffffff 0%, #fafafa 100%);
        }

        /* Filtros de categoría */
        .category-filters {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .category-filter {
            padding: 6px 12px;
            background: white;
            border: 1px solid var(--medium);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            color: var(--text);
            font-size: 0.8rem;
        }

        .category-filter:hover {
            border-color: var(--accent);
            transform: translateY(-1px);
        }

        .category-filter.active {
            color: white;
            border-color: transparent;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.2);
        }

        /* Colores de filtros */
        .category-filter[data-color="todo"].active {
            background: var(--color-todo);
        }
        .category-filter[data-color="hombre"].active {
            background: var(--color-hombre);
        }
        .category-filter[data-color="mujer"].active {
            background: var(--color-mujer);
        }
        .category-filter[data-color="kids"].active {
            background: var(--color-kids);
        }
        .category-filter[data-color="accesorios"].active {
            background: var(--color-accesorios);
        }

        /* Grid de productos - MODIFICADO: 2 columnas */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* ← CAMBIADO A 2 */
            gap: 15px;
        }

        .product-card {
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid rgba(0, 0, 0, 0.05);
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
        }

        .product-image-container {
            position: relative;
            overflow: hidden;
            height: 180px;
        }

        .product-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
            cursor: pointer;
        }

        .product-card:hover .product-image {
            transform: scale(1.05);
        }

        /* Etiquetas de producto */
        .product-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 3px 8px;
            font-size: 0.65rem;
            font-weight: 700;
            border-radius: var(--border-radius-sm);
            text-transform: uppercase;
            letter-spacing: 0.3px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.2);
            z-index: 2;
        }

        .product-badge.oferta {
            background: #FFD700;
            color: #333;
        }
        .product-badge.nuevo {
            background: #32CD32;
            color: white;
        }
        .product-badge.agotado {
            background: #ff4757;
            color: white;
        }

        /* Información del producto */
        .product-info {
            padding: 8px;
        }

        .product-category {
            color: var(--accent);
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .product-title {
            font-size: 0.85rem;
            font-weight: 700;
            margin-bottom: 4px;
            color: #000000;
            line-height: 1.2;
            min-height: 28px;
        }

        .product-price-container {
            margin-bottom: 6px;
        }

        .sale-price-container {
            display: flex;
            align-items: center;
            gap: 4px;
            margin-bottom: 6px;
        }

        .original-price {
            font-size: 0.85rem;
            color: var(--text-light);
            text-decoration: line-through;
            font-weight: 500;
        }

        .sale-price {
            font-size: 1rem;
            font-weight: 800;
            color: var(--accent);
        }

        .discount-badge {
            padding: 1px 4px;
            background: #FFD700;
            color: #333;
            border-radius: var(--border-radius-sm);
            font-size: 0.6rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .product-description {
            color: var(--text-light);
            margin-bottom: 6px;
            line-height: 1.3;
            font-size: 0.75rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            min-height: 28px;
        }

        .product-features {
            display: flex;
            flex-direction: column;
            gap: 3px;
            margin-bottom: 6px;
        }

        .feature {
            display: flex;
            align-items: center;
            gap: 4px;
            color: var(--text);
            font-size: 0.7rem;
        }

        .feature i {
            color: var(--accent);
            width: 12px;
            font-size: 0.65rem;
        }

        /* Selector de variantes */
        .variant-selector {
            margin-bottom: 6px;
        }

        .variant-label {
            display: block;
            margin-bottom: 3px;
            font-weight: 600;
            color: var(--primary);
            font-size: 0.75rem;
        }

        .variant-options {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
        }

        .variant-btn {
            padding: 3px 6px;
            border: 1px solid var(--medium);
            background: white;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            font-size: 0.7rem;
            min-width: 32px;
        }

        .variant-btn:hover:not(.disabled) {
            border-color: var(--accent);
            transform: translateY(-1px);
        }

        .variant-btn.selected {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .variant-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Botones de acción */
        .product-actions {
            display: flex;
            gap: 4px;
            margin-top: 8px;
        }

        .add-to-cart-btn {
            flex: 1;
            padding: 6px 8px;
            background: linear-gradient(135deg, var(--accent), #c19b2e);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            font-size: 0.75rem;
        }

        .add-to-cart-btn:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(212, 175, 55, 0.4);
            background: linear-gradient(135deg, #c19b2e, var(--accent));
        }

        .add-to-cart-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Modal de imagen */
        .image-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.92);
            backdrop-filter: blur(10px);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .image-modal-overlay.active {
            display: flex;
        }

        .image-modal {
            max-width: 90%;
            max-height: 90vh;
            position: relative;
        }

        .image-modal img {
            width: 100%;
            height: auto;
            max-height: 85vh;
            object-fit: contain;
            border-radius: var(--border-radius);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .close-image-modal {
            position: absolute;
            top: -30px;
            right: -5px;
            width: 35px;
            height: 35px;
            background: rgba(255, 255, 255, 0.15);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            backdrop-filter: blur(5px);
        }

        .close-image-modal:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: rotate(90deg);
        }

        /* ==================== ESTILOS DE CUPONES ==================== */
        /* Modal de Cupones */
        .coupon-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(3px);
            z-index: 2001;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 12px;
        }

        .coupon-modal.active {
            display: flex;
        }

        .coupon-content {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-hover);
        }

        .coupon-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .coupon-header h3 {
            margin: 0;
            color: var(--primary);
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .close-coupon-modal {
            background: none;
            border: none;
            font-size: 0.9rem;
            cursor: pointer;
            color: var(--text-light);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .close-coupon-modal:hover {
            background: var(--light);
            color: var(--primary);
        }

        /* Input de cupón */
        .coupon-input-group {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }

        .coupon-input {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid var(--medium);
            border-radius: var(--border-radius-sm);
            font-family: inherit;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .coupon-input:focus {
            outline: none;
            border-color: var(--coupon);
            box-shadow: 0 0 0 2px rgba(255, 107, 107, 0.1);
        }

        .apply-coupon-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, var(--coupon), #ff5252);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        .apply-coupon-btn:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(255, 107, 107, 0.4);
            background: linear-gradient(135deg, #ff5252, var(--coupon));
        }

        .apply-coupon-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Lista de cupones disponibles */
        .available-coupons {
            margin-top: 20px;
        }

        .available-coupons h4 {
            font-size: 1rem;
            margin-bottom: 12px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .coupons-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .coupon-item {
            background: white;
            border: 2px solid var(--light);
            border-radius: var(--border-radius-sm);
            padding: 12px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .coupon-item:hover {
            border-color: var(--coupon);
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .coupon-item.applied {
            border-color: var(--success);
            background: rgba(46, 139, 87, 0.05);
        }

        .coupon-code {
            font-weight: 700;
            font-size: 0.9rem;
            color: var(--primary);
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .coupon-code i {
            color: var(--coupon);
        }

        .coupon-description {
            font-size: 0.8rem;
            color: var(--text);
            margin-bottom: 6px;
        }

        .coupon-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.75rem;
            color: var(--text-light);
        }

        .coupon-type {
            padding: 2px 6px;
            background: var(--coupon);
            color: white;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            font-size: 0.7rem;
        }

        .coupon-expiry {
            font-size: 0.7rem;
            opacity: 0.8;
        }

        /* Cupón aplicado en carrito */
        .applied-coupon {
            background: linear-gradient(135deg, rgba(46, 139, 87, 0.1), rgba(46, 139, 87, 0.05));
            border: 1px solid var(--success);
            border-radius: var(--border-radius-sm);
            padding: 10px;
            margin: 12px 0;
            display: none;
        }

        .applied-coupon.show {
            display: block;
        }

        .applied-coupon-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .applied-coupon-code {
            font-weight: 700;
            color: var(--success);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .remove-coupon {
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: var(--transition);
        }

        .remove-coupon:hover {
            color: var(--error);
        }

        .applied-coupon-details {
            font-size: 0.8rem;
            color: var(--text);
        }

        /* Botón de cupón en carrito */
        .apply-coupon-btn-small {
            width: 100%;
            padding: 8px;
            background: linear-gradient(135deg, var(--coupon), #ff5252);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin-top: 10px;
        }

        .apply-coupon-btn-small:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
            background: linear-gradient(135deg, #ff5252, var(--coupon));
        }

        /* Carrito - NUEVO DISEÑO */
        .cart-icon {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 65px;
            height: 65px;
            background: linear-gradient(135deg, #D4AF37, #B8962E, #9C7D26);
            color: white;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
            transition: var(--transition);
            border: 3px solid white;
            font-weight: 600;
        }

        .cart-icon:hover {
            transform: scale(1.08) translateY(-3px);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
            background: linear-gradient(135deg, #B8962E, #D4AF37, #9C7D26);
        }

        .cart-icon:active {
            transform: scale(0.98);
        }

        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(135deg, #ff6b6b, #ff5252);
            color: white;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(255, 107, 107, 0.4);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Panel del carrito */
        .cart-panel {
            position: fixed;
            top: 0;
            right: -350px;
            width: 320px;
            height: 100vh;
            background: linear-gradient(180deg, #ffffff 0%, #fafafa 100%);
            box-shadow: -3px 0 15px rgba(0, 0, 0, 0.1);
            z-index: 1001;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
        }

        .cart-panel.open {
            right: 0;
        }

        .cart-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .cart-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .cart-header {
            padding: 15px;
            background: linear-gradient(135deg, var(--primary), #2a2a2a);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-title {
            font-size: 1.1rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .close-cart {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .close-cart:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
            border-color: var(--accent);
        }

        .cart-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            background: linear-gradient(180deg, #fafafa 0%, #f5f5f5 100%);
        }

        /* Items del carrito */
        .cart-items {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .cart-item {
            background: white;
            border-radius: var(--border-radius-sm);
            padding: 12px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            gap: 10px;
            transition: var(--transition);
        }

        .cart-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
            border-color: var(--accent);
        }

        .cart-item-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
        }

        .cart-item-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .cart-item-title {
            font-weight: 700;
            font-size: 0.85rem;
            margin-bottom: 3px;
            color: #000000;
            line-height: 1.2;
        }

        .cart-item-variant {
            color: var(--text-light);
            font-size: 0.7rem;
            margin-bottom: 2px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .cart-item-price {
            font-weight: 700;
            color: var(--accent);
            font-size: 0.9rem;
            margin-top: 3px;
        }

        .cart-item-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 6px;
        }

        .quantity-control {
            display: flex;
            align-items: center;
            gap: 6px;
            background: var(--light);
            padding: 3px 6px;
            border-radius: var(--border-radius-sm);
            border: 1px solid var(--medium);
        }

        .quantity-btn {
            width: 20px;
            height: 20px;
            border: none;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.8rem;
            transition: var(--transition);
            color: var(--primary);
        }

        .quantity-btn:hover:not(:disabled) {
            background: var(--accent);
            color: white;
            transform: scale(1.05);
        }

        .remove-item {
            padding: 4px 8px;
            background: linear-gradient(135deg, #ff6b6b, #ff5252);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .remove-item:hover {
            background: linear-gradient(135deg, #ff5252, #ff3b3b);
            transform: translateY(-1px);
        }

        /* Carrito vacío */
        .empty-cart {
            text-align: center;
            padding: 30px 15px;
            color: var(--text-light);
            display: none;
        }

        .empty-cart i {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--medium);
            opacity: 0.5;
        }

        .empty-cart h3 {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-light);
        }

        .continue-shopping {
            display: inline-block;
            padding: 6px 12px;
            background: var(--light);
            color: var(--text);
            text-decoration: none;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            transition: var(--transition);
            border: 1px solid var(--medium);
            font-size: 0.8rem;
        }

        .continue-shopping:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
            transform: translateY(-1px);
        }

        /* Resumen del carrito */
        .cart-summary {
            background: white;
            border-radius: var(--border-radius-sm);
            padding: 12px;
            margin-top: 15px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 0, 0, 0.05);
            display: none;
        }

        .cart-summary.show {
            display: block;
        }

        .summary-title {
            font-size: 0.9rem;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.8rem;
            color: var(--text);
        }

        .summary-total {
            display: flex;
            justify-content: space-between;
            font-weight: 700;
            font-size: 1rem;
            padding-top: 12px;
            border-top: 2px solid var(--medium);
            margin-top: 12px;
            color: var(--primary);
        }

        .total-amount {
            color: var(--accent);
            font-size: 1.1rem;
        }

        /* Promoción de envío gratis */
        .free-shipping-promo {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.1), rgba(212, 175, 55, 0.05));
            border: 1px dashed var(--accent);
            border-radius: var(--border-radius-sm);
            padding: 8px;
            margin: 12px 0;
            text-align: center;
            display: none;
        }

        .free-shipping-promo.show {
            display: block;
        }

        .promo-text {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 2px;
            font-size: 0.8rem;
        }

        .promo-subtext {
            font-size: 0.75rem;
            color: var(--text-light);
        }

        .progress-bar {
            height: 3px;
            background: var(--medium);
            border-radius: 1px;
            margin: 8px 0 6px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #c19b2e);
            border-radius: 1px;
            transition: width 0.4s ease;
        }

        /* Acciones del carrito */
        .cart-actions {
            padding: 12px 15px;
            background: white;
            border-top: 1px solid var(--medium);
            display: flex;
            flex-direction: column;
            gap: 8px;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);
        }

        .checkout-btn {
            padding: 10px;
            background: linear-gradient(135deg, var(--accent), var(--primary));
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .checkout-btn:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(212, 175, 55, 0.4);
        }

        .clear-cart-btn {
            padding: 8px;
            background: var(--light);
            color: var(--text);
            border: 1px solid var(--medium);
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .clear-cart-btn:hover:not(:disabled) {
            background: #f0f0f0;
            border-color: var(--text-light);
            transform: translateY(-1px);
        }

        /* Modal de checkout */
        .checkout-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(3px);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 12px;
        }

        .checkout-modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            padding: 15px;
            max-width: 400px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-hover);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .modal-header h3 {
            margin: 0;
            color: var(--primary);
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 0.9rem;
            cursor: pointer;
            color: var(--text-light);
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .close-modal:hover {
            background: var(--light);
            color: var(--primary);
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.85rem;
        }

        .form-input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid var(--medium);
            border-radius: var(--border-radius-sm);
            font-family: inherit;
            font-size: 0.85rem;
            transition: var(--transition);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.1);
        }

        .delivery-options {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .delivery-option {
            padding: 10px;
            border: 1px solid var(--medium);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }

        .delivery-option:hover {
            border-color: var(--accent);
            background: rgba(212, 175, 55, 0.05);
        }

        .delivery-option.selected {
            border-color: var(--accent);
            background: rgba(212, 175, 55, 0.1);
        }

        .delivery-info {
            flex: 1;
        }

        .delivery-name {
            font-weight: 600;
            margin-bottom: 2px;
            color: var(--primary);
            font-size: 0.85rem;
        }

        .delivery-address {
            color: var(--text-light);
            font-size: 0.75rem;
        }

        .map-link {
            font-size: 0.75rem;
            color: var(--accent);
            text-decoration: none;
            margin-top: 3px;
            display: inline-flex;
            align-items: center;
            gap: 3px;
            transition: var(--transition);
            opacity: 0.8;
        }

        .map-link:hover {
            opacity: 1;
            color: var(--accent);
            text-decoration: underline;
        }

        .payment-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
        }

        .payment-option {
            padding: 10px;
            border: 1px solid var(--medium);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            font-weight: 600;
            font-size: 0.8rem;
        }

        .payment-option:hover {
            border-color: var(--accent);
            background: rgba(212, 175, 55, 0.05);
        }

        .payment-option.selected {
            border-color: var(--accent);
            background: rgba(212, 175, 55, 0.1);
        }

        .transfer-info {
            margin-top: 12px;
            padding: 10px;
            background: var(--light);
            border-radius: var(--border-radius-sm);
            display: none;
        }

        .transfer-info.show {
            display: block;
        }

        .transfer-details {
            margin-top: 6px;
        }

        .transfer-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            font-size: 0.75rem;
        }

        .transfer-label {
            color: var(--text-light);
        }

        .transfer-value {
            font-weight: 600;
            color: var(--primary);
        }

        .modal-actions {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }

        .btn-secondary {
            flex: 1;
            padding: 8px;
            background: var(--medium);
            color: var(--text);
            border: none;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.85rem;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .btn-primary {
            flex: 1;
            padding: 8px;
            background: linear-gradient(135deg, var(--accent), var(--primary));
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(212, 175, 55, 0.3);
        }

        /* Modal de autenticación */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(3px);
            z-index: 3000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 12px;
        }

        .auth-modal.active {
            display: flex;
        }

        .auth-content {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            max-width: 400px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-hover);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .auth-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--admin), #7C3AED);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            color: white;
            font-size: 1.2rem;
        }

        .auth-title {
            font-size: 1.3rem;
            font-weight: 800;
            margin-bottom: 8px;
            color: var(--primary);
        }

        .auth-subtitle {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        /* Panel de Administración - MEJOR JUSTIFICACIÓN */
        .admin-panel {
            position: fixed;
            top: 0;
            right: -450px;
            width: 420px;
            height: 100vh;
            background: linear-gradient(180deg, #ffffff 0%, #fafafa 100%);
            box-shadow: -3px 0 15px rgba(0, 0, 0, 0.1);
            z-index: 3001;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
        }

        .admin-panel.open {
            right: 0;
        }

        .admin-header {
            padding: 15px;
            background: linear-gradient(135deg, var(--admin), #7C3AED);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-title {
            font-size: 1.1rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .close-admin {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .close-admin:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
            border-color: white;
        }

        .admin-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: linear-gradient(180deg, #fafafa 0%, #f5f5f5 100%);
        }

        .admin-tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--medium);
            padding-bottom: 10px;
            flex-wrap: wrap;
        }

        .admin-tab {
            flex: 1;
            padding: 8px 10px;
            background: white;
            border: 1px solid var(--medium);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            text-align: center;
            font-size: 0.75rem;
            min-width: 70px;
        }

        .admin-tab:hover {
            border-color: var(--admin);
            transform: translateY(-1px);
        }

        .admin-tab.active {
            background: var(--admin);
            color: white;
            border-color: var(--admin);
        }

        .admin-section {
            display: none;
        }

        .admin-section.active {
            display: block;
        }

        .section-title-admin {
            font-size: 0.9rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .admin-form {
            background: white;
            border-radius: var(--border-radius-sm);
            padding: 12px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 0, 0, 0.05);
            margin-bottom: 15px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 10px;
        }

        .form-group-admin {
            margin-bottom: 10px;
        }

        .form-label-admin {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.8rem;
        }

        .form-input-admin {
            width: 100%;
            padding: 7px 9px;
            border: 1px solid var(--medium);
            border-radius: var(--border-radius-sm);
            font-family: inherit;
            font-size: 0.8rem;
            transition: var(--transition);
        }

        .form-input-admin:focus {
            outline: none;
            border-color: var(--admin);
            box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.1);
        }

        .form-textarea {
            width: 100%;
            padding: 7px 9px;
            border: 1px solid var(--medium);
            border-radius: var(--border-radius-sm);
            font-family: inherit;
            font-size: 0.8rem;
            transition: var(--transition);
            resize: vertical;
            min-height: 70px;
        }

        .form-select {
            width: 100%;
            padding: 7px 9px;
            border: 1px solid var(--medium);
            border-radius: var(--border-radius-sm);
            font-family: inherit;
            font-size: 0.8rem;
            transition: var(--transition);
            background: white;
        }

        .multi-input-container {
            display: flex;
            gap: 6px;
            margin-bottom: 6px;
        }

        .multi-input {
            flex: 1;
            padding: 7px 9px;
            border: 1px solid var(--medium);
            border-radius: var(--border-radius-sm);
            font-family: inherit;
            font-size: 0.8rem;
        }

        .add-btn {
            padding: 7px 10px;
            background: var(--admin);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .add-btn:hover {
            background: #7C3AED;
            transform: translateY(-1px);
        }

        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
            max-height: 100px;
            overflow-y: auto;
            padding: 5px;
            background: rgba(139, 92, 246, 0.05);
            border-radius: var(--border-radius-sm);
        }

        .tag {
            background: rgba(139, 92, 246, 0.1);
            color: var(--admin);
            padding: 3px 7px;
            border-radius: var(--border-radius-sm);
            font-size: 0.7rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .tag-remove {
            cursor: pointer;
            font-size: 0.65rem;
            opacity: 0.7;
        }

        .tag-remove:hover {
            opacity: 1;
        }

        .form-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .btn-save {
            flex: 1;
            padding: 8px;
            background: linear-gradient(135deg, var(--success), #2e8b57);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .btn-save:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(46, 139, 87, 0.3);
        }

        .btn-cancel {
            flex: 1;
            padding: 8px;
            background: var(--medium);
            color: var(--text);
            border: none;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .btn-cancel:hover {
            background: #d0d0d0;
            transform: translateY(-1px);
        }

        /* Sistema de Variantes en Admin */
        .variant-system-container {
            margin-bottom: 12px;
        }

        .variant-field {
            background: rgba(139, 92, 246, 0.05);
            border-radius: var(--border-radius-sm);
            padding: 8px;
            margin-bottom: 8px;
            border: 1px solid rgba(139, 92, 246, 0.1);
        }

        .variant-field-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .variant-field-title {
            font-weight: 600;
            color: var(--admin);
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .remove-variant-btn {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.65rem;
            transition: var(--transition);
        }

        .remove-variant-btn:hover {
            transform: scale(1.1);
        }

        .variant-options-container {
            margin-top: 8px;
        }

        .variant-option-item {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 4px;
        }

        /* Sistema de Stock en Admin */
        .stock-system-container {
            margin-top: 12px;
        }

        .stock-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .stock-table-container {
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid var(--medium);
            border-radius: var(--border-radius-sm);
            font-size: 0.7rem;
        }

        .stock-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.7rem;
        }

        .stock-table th {
            background: var(--light);
            padding: 5px;
            text-align: left;
            font-weight: 600;
            color: var(--primary);
            border-bottom: 1px solid var(--medium);
            position: sticky;
            top: 0;
        }

        .stock-table td {
            padding: 5px;
            border-bottom: 1px solid var(--light);
        }

        .stock-input {
            width: 50px;
            padding: 3px;
            border: 1px solid var(--medium);
            border-radius: var(--border-radius-sm);
            text-align: center;
            font-size: 0.7rem;
        }

        /* Lista de productos en admin */
        .products-list-admin {
            max-height: 350px;
            overflow-y: auto;
            border: 1px solid var(--medium);
            border-radius: var(--border-radius-sm);
            background: white;
        }

        .product-item-admin {
            padding: 8px;
            border-bottom: 1px solid var(--light);
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: move;
            transition: var(--transition);
        }

        .product-item-admin:hover {
            background: rgba(139, 92, 246, 0.05);
        }

        .product-item-admin.dragging {
            opacity: 0.5;
            background: rgba(139, 92, 246, 0.1);
        }

        .product-image-admin {
            width: 45px;
            height: 45px;
            object-fit: cover;
            border-radius: var(--border-radius-sm);
        }

        .product-info-admin {
            flex: 1;
            min-width: 0;
        }

        .product-name-admin {
            font-weight: 700;
            font-size: 0.8rem;
            margin-bottom: 2px;
            color: var(--primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .product-category-admin {
            font-size: 0.7rem;
            color: var(--text-light);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .product-price-admin {
            font-weight: 700;
            color: var(--accent);
            font-size: 0.75rem;
        }

        .product-actions-admin {
            display: flex;
            gap: 4px;
            flex-shrink: 0;
        }

        .product-action-btn {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.65rem;
        }

        .edit-btn-admin {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }

        .delete-btn-admin {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
        }

        .product-action-btn:hover {
            transform: scale(1.1);
        }

        /* Categorías en admin */
        .categories-list-admin {
            max-height: 350px;
            overflow-y: auto;
        }

        .category-item-admin {
            padding: 10px;
            border-bottom: 1px solid var(--light);
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: move;
            transition: var(--transition);
            background: white;
            border-radius: var(--border-radius-sm);
            margin-bottom: 6px;
            box-shadow: var(--shadow);
        }

        .category-item-admin:hover {
            background: rgba(139, 92, 246, 0.05);
            transform: translateY(-1px);
        }

        .category-item-admin.dragging {
            opacity: 0.5;
            background: rgba(139, 92, 246, 0.1);
        }

        .category-info-admin {
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 0;
        }

        .category-icon-admin {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .category-details-admin {
            flex: 1;
            min-width: 0;
        }

        .category-name-admin {
            font-weight: 700;
            font-size: 0.85rem;
            margin-bottom: 3px;
            color: var(--primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .category-stats-admin {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.75rem;
        }

        .category-product-count {
            color: var(--text-light);
        }

        .category-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 1px solid var(--medium);
            flex-shrink: 0;
        }

        .category-actions-admin {
            display: flex;
            gap: 4px;
            flex-shrink: 0;
        }

        .category-action-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.75rem;
        }

        .edit-category-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }

        .delete-category-btn {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
        }

        .category-action-btn:hover:not(:disabled) {
            transform: scale(1.1);
        }

        .delete-category-btn:disabled {
            background: var(--medium);
            cursor: not-allowed;
            opacity: 0.5;
        }

        /* Format guide */
        .format-guide {
            margin-top: 8px;
            padding: 8px;
            background: rgba(139, 92, 246, 0.05);
            border-radius: var(--border-radius-sm);
            border: 1px solid rgba(139, 92, 246, 0.1);
        }

        .format-example {
            font-size: 0.7rem;
            padding: 3px 6px;
            background: rgba(139, 92, 246, 0.1);
            border-radius: var(--border-radius-sm);
            margin-bottom: 3px;
            color: var(--admin);
            font-family: 'Consolas', monospace;
            display: none;
        }

        .format-example.active {
            display: block;
        }

        /* Estadísticas */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .stat-card {
            background: white;
            border-radius: var(--border-radius-sm);
            padding: 10px;
            text-align: center;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .stat-icon {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 6px;
            font-size: 0.9rem;
            color: white;
        }

        .stat-value {
            font-size: 1.1rem;
            font-weight: 800;
            margin-bottom: 2px;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--text-light);
        }

        /* Exportación */
        .export-options {
            background: white;
            border-radius: var(--border-radius-sm);
            padding: 12px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 0, 0, 0.05);
            margin-bottom: 12px;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 8px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            color: var(--text);
        }

        /* Mensajes */
        .status-message {
            padding: 8px;
            border-radius: var(--border-radius-sm);
            margin-bottom: 10px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 6px;
            display: none;
        }

        .status-success {
            background: rgba(46, 139, 87, 0.1);
            border: 1px solid rgba(46, 139, 87, 0.2);
            color: var(--success);
        }

        .status-error {
            background: rgba(204, 51, 51, 0.1);
            border: 1px solid rgba(204, 51, 51, 0.2);
            color: var(--error);
        }

        .status-info {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.2);
            color: var(--admin);
        }

        /* Editor de sección de categorías */
        .editor-container {
            background: white;
            border-radius: var(--border-radius-sm);
            padding: 12px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 0, 0, 0.05);
            margin-bottom: 12px;
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .editor-actions {
            display: flex;
            gap: 6px;
        }

        .btn-preview {
            padding: 7px 10px;
            background: var(--admin);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .btn-preview:hover {
            background: #7C3AED;
            transform: translateY(-1px);
        }

        .editor-categories-list {
            margin-top: 15px;
        }

        .editor-category-item {
            padding: 10px;
            border: 1px solid var(--medium);
            border-radius: var(--border-radius-sm);
            margin-bottom: 8px;
            background: white;
            transition: var(--transition);
        }

        .editor-category-item:hover {
            border-color: var(--admin);
            box-shadow: var(--shadow-hover);
        }

        .editor-category-item.dragging {
            opacity: 0.5;
            background: rgba(139, 92, 246, 0.05);
        }

        .editor-category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .editor-category-title {
            font-weight: 700;
            font-size: 0.85rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .editor-category-actions {
            display: flex;
            gap: 4px;
        }

        .editor-category-content {
            display: grid;
            grid-template-columns: 80px 1fr;
            gap: 10px;
        }

        .editor-category-preview {
            width: 80px;
            height: 80px;
            border-radius: var(--border-radius-sm);
            overflow: hidden;
            border: 1px solid var(--medium);
        }

        .editor-category-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .editor-category-fields {
            flex: 1;
        }

        .color-preview {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 1px solid var(--medium);
            display: inline-block;
            vertical-align: middle;
            margin-left: 4px;
        }

        /* Preview de la sección */
        .section-preview {
            background: var(--light);
            border-radius: var(--border-radius-sm);
            padding: 15px;
            margin-top: 12px;
            border: 2px dashed var(--medium);
        }

        .preview-title {
            text-align: center;
            margin-bottom: 12px;
        }

        /* Footer */
        .main-footer {
            background: linear-gradient(135deg, var(--primary), #0a0a0a);
            color: white;
            padding: 30px 0 15px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .footer-section h3 {
            font-size: 1rem;
            margin-bottom: 12px;
            color: white;
            position: relative;
            padding-bottom: 6px;
        }

        .footer-section h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 35px;
            height: 2px;
            background: var(--accent);
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 6px;
        }

        .footer-links a {
            color: #cccccc;
            text-decoration: none;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.8rem;
        }

        .footer-links a:hover {
            color: var(--accent);
            transform: translateX(2px);
        }

        .copyright {
            text-align: center;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #999999;
            font-size: 0.75rem;
        }

        /* Responsive - MODIFICADO para 2 columnas */
        @media (max-width: 992px) {
            .products-grid {
                grid-template-columns: repeat(2, 1fr); /* ← Mantiene 2 columnas */
            }
            
            .search-container {
                max-width: 300px;
            }
            
            .flash-sale-content {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .flash-sale-left, .flash-sale-right {
                width: 100%;
                justify-content: center;
            }
            
            .flash-sale-products {
                justify-content: center;
            }
        }

        @media (max-width: 768px) {
            .products-grid {
                grid-template-columns: repeat(2, 1fr); /* ← Mantiene 2 columnas */
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .admin-panel {
                width: 100%;
                right: -100%;
            }
            
            .stock-table-container {
                max-height: 150px;
            }
            
            .editor-category-content {
                grid-template-columns: 1fr;
            }
            
            .editor-category-preview {
                width: 100%;
                height: 150px;
            }
            
            .search-container {
                max-width: 200px;
            }
            
            .nav-links {
                display: none;
            }
            
            .flash-sale-banner {
                padding: 8px 0;
            }
            
            .flash-sale-timer {
                align-items: center;
            }
            
            .timer-display {
                justify-content: center;
            }
        }

        @media (max-width: 576px) {
            .products-grid {
                grid-template-columns: repeat(2, 1fr); /* ← Mantiene 2 columnas en móvil */
                gap: 10px; /* Un poco menos de espacio */
            }
            
            .product-image-container {
                height: 150px; /* Imágenes un poco más pequeñas */
            }
            
            .product-info {
                padding: 6px;
            }
            
            .admin-panel {
                width: 100%;
                right: -100%;
            }
            
            .admin-tab {
                padding: 6px 8px;
                font-size: 0.7rem;
                min-width: 60px;
            }
            
            .form-input-admin, 
            .form-select, 
            .form-textarea {
                font-size: 0.75rem;
                padding: 6px 8px;
            }
            
            .cart-icon {
                width: 55px;
                height: 55px;
                bottom: 15px;
                right: 15px;
            }
            
            .cart-count {
                width: 20px;
                height: 20px;
                font-size: 0.65rem;
            }
            
            .search-container {
                max-width: 150px;
                margin: 0 8px;
            }
            
            .search-input {
                padding: 8px 12px 8px 35px;
                font-size: 0.8rem;
            }
            
            .search-icon {
                left: 10px;
                font-size: 0.8rem;
            }
            
            .clear-search {
                right: 10px;
            }
            
            .flash-sale-banner {
                padding: 6px 0;
            }
            
            .flash-sale-title {
                font-size: 0.8rem;
            }
            
            .flash-sale-description {
                font-size: 0.7rem;
            }
            
            .timer-display {
                font-size: 0.9rem;
            }
            
            .timer-unit {
                min-width: 35px;
            }
            
            .flash-sale-btn {
                padding: 6px 12px;
                font-size: 0.75rem;
            }
        }

        @media (max-width: 400px) {
            .search-container {
                max-width: 120px;
            }
            
            .search-input::placeholder {
                font-size: 0.75rem;
            }
            
            .flash-sale-products {
                display: none;
            }
            
            .timer-display {
                gap: 4px;
            }
            
            .timer-unit {
                min-width: 30px;
            }
            
            .timer-value {
                font-size: 0.9rem;
                min-width: 28px;
            }
        }
    </style>
    
    <!-- Fuentes e íconos -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&amp;display=swap" rel="stylesheet">



    <!-- Banner de Ofertas Relámpago -->
    <div class="flash-sale-banner" id="flashSaleBanner" style="display: block;">
        <div class="container">
            <div class="flash-sale-content">
                <div class="flash-sale-left">
                    <div class="flash-sale-icon">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <div class="flash-sale-info">
                        <div class="flash-sale-title" id="flashSaleTitle">¡OFERTA RELÁMPAGO!</div>
                        <div class="flash-sale-description" id="flashSaleDescription">Hasta 50% de descuento en productos seleccionados</div>
                    </div>
                    <div class="flash-sale-timer">
                        <div class="timer-label">TERMINA EN:</div>
                        <div class="timer-display" id="flashSaleTimer">
                            <div class="timer-unit">
                                <span class="timer-value" id="timerHours">23</span>
                                <span class="timer-label-unit">HORAS</span>
                            </div>
                            <div class="timer-unit">
                                <span class="timer-value" id="timerMinutes">54</span>
                                <span class="timer-label-unit">MIN</span>
                            </div>
                            <div class="timer-unit">
                                <span class="timer-value" id="timerSeconds">15</span>
                                <span class="timer-label-unit">SEG</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flash-sale-right">
                    <div class="flash-sale-products" style="display: flex;">
                        <div class="flash-product-preview" onclick="carrito.filterFlashSaleProducts(); carrito.scrollToProduct(1)">
                            <img src="https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=1200&amp;q=80" alt="SUDADERA BÁSICA">
                        </div>
                    </div>
                    <button class="flash-sale-btn" id="flashSaleBtn" onclick="carrito.filterFlashSaleProducts()"><i class="fas fa-shopping-bag"></i> VER ARTICULOS</button>
                    <button class="close-flash-banner" id="closeFlashBanner">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Imagen -->
    <div class="image-modal-overlay" id="imageModal">
        <div class="image-modal">
            <button class="close-image-modal" id="closeImageModal">
                <i class="fas fa-times"></i>
            </button>
            <img id="modalImage" src="" alt="Imagen ampliada">
        </div>
    </div>

    <!-- Modal de Cupones -->
    <div class="coupon-modal" id="couponModal">
        <div class="coupon-content">
            <div class="coupon-header">
                <h3>
                    <i class="fas fa-ticket-alt"></i>
                    Cupones de Descuento
                </h3>
                <button class="close-coupon-modal" id="closeCouponModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="coupon-input-group">
                <input type="text" class="coupon-input" id="couponCodeInput" placeholder="Ingresa tu código de cupón">
                <button class="apply-coupon-btn" id="applyCouponBtn">
                    <i class="fas fa-check"></i>
                    Aplicar
                </button>
            </div>
            
            <div class="status-message status-success" id="couponSuccessMessage" style="display: none;"><i class="fas fa-check-circle"></i><span>20% de descuento en toda la tienda</span></div>
            
            <div class="status-message status-error" id="couponErrorMessage" style="display: none;"><i class="fas fa-times-circle"></i><span>Cupón agotado</span></div>
            
            <div class="available-coupons">
                <h4>
                    <i class="fas fa-gift"></i>
                    Cupones Disponibles
                </h4>
                <div class="coupons-list" id="availableCouponsList">
                            <div class="coupon-item " onclick="carrito.selectCoupon('SAUL123456')">
                                <div class="coupon-code">
                                    <i class="fas fa-percentage"></i>
                                    SAUL123456
                                </div>
                                <div class="coupon-description">
                                    DESCUENTO
                                </div>
                                <div class="coupon-details">
                                    <span class="coupon-type">20% DESCUENTO</span>
                                    <span class="coupon-expiry">Válido hasta: 10 mar 2026</span>
                                </div>
                            </div>
                        </div>
            </div>
        </div>
    </div>

    <!-- Modal de Autenticación -->
    <div class="auth-modal" id="authModal">
        <div class="auth-content">
            <div class="auth-header">
                <div class="auth-icon">
                    <i class="fas fa-lock"></i>
                </div>
                <h2 class="auth-title">Panel de Administración</h2>
                <p class="auth-subtitle">Ingresa el PIN de acceso</p>
            </div>
            
            <form id="authForm">
                <div class="form-group-admin">
                    <label class="form-label-admin">
                        <i class="fas fa-key"></i> PIN de Acceso:
                    </label>
                    <input type="password" id="pinInput" class="form-input-admin" maxlength="6" placeholder="Ingresa el PIN de 6 dígitos" required="">
                </div>
                
                <div class="status-message status-success" id="authMessage" style="display: none;"><i class="fas fa-check-circle"></i><span>PIN correcto. Accediendo al panel...</span></div>
                
                <div class="form-actions">
                    <button type="button" class="btn-cancel" id="cancelAuth">
                        <i class="fas fa-times"></i>
                        Cancelar
                    </button>
                    <button type="submit" class="btn-save" id="submitAuth">
                        <i class="fas fa-sign-in-alt"></i>
                        Acceder
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Panel de Administración -->
    <div class="admin-panel open" id="adminPanel">
        <div class="admin-header">
            <h2 class="admin-title">
                <i class="fas fa-cogs"></i>
                Panel de Administración
            </h2>
            <button class="close-admin" id="closeAdmin">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="admin-content">
            <div class="admin-tabs">
                <button class="admin-tab" data-tab="products">
                    <i class="fas fa-box"></i> Productos
                </button>
                <button class="admin-tab" data-tab="add">
                    <i class="fas fa-plus"></i> Agregar
                </button>
                <button class="admin-tab" data-tab="categories">
                    <i class="fas fa-tags"></i> Categorías
                </button>
                <button class="admin-tab" data-tab="coupons">
                    <i class="fas fa-ticket-alt"></i> Cupones
                </button>
                <button class="admin-tab" data-tab="flash-sale">
                    <i class="fas fa-bolt"></i> Ofertas Relámpago
                </button>
                <button class="admin-tab" data-tab="section-editor">
                    <i class="fas fa-edit"></i> Editor de Sección
                </button>
                <button class="admin-tab" data-tab="stats">
                    <i class="fas fa-chart-bar"></i> Estadísticas
                </button>
                <button class="admin-tab active" data-tab="export">
                    <i class="fas fa-download"></i> Exportar
                </button>
            </div>
            
            <!-- Sección de Productos -->
            <div class="admin-section" id="productsSection">
                <h3 class="section-title-admin">
                    <i class="fas fa-list"></i>
                    Lista de Productos
                </h3>
                <div class="status-message status-info" id="reorderMessage">
                    <i class="fas fa-info-circle"></i>
                    <span>Arrastra y suelta para reordenar los productos</span>
                </div>
                <div class="products-list-admin" id="productsListAdmin">
                            <div class="product-item-admin" data-product-id="1" draggable="true">
                                <img src="https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=1200&amp;q=80" alt="SUDADERA BÁSICA" class="product-image-admin">
                                <div class="product-info-admin">
                                    <div class="product-name-admin">SUDADERA BÁSICA</div>
                                    <div class="product-category-admin">
                                        <i class="fas fa-tag"></i>
                                        SUDADERA | Hombre
                                    </div>
                                    <div class="product-price-admin">$200</div>
                                </div>
                                <div class="product-actions-admin">
                                    <button class="product-action-btn edit-btn-admin" onclick="admin.editarProducto(1)">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="product-action-btn delete-btn-admin" onclick="admin.eliminarProducto(1)">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
            </div>

            <!-- Sección de Agregar Producto -->
            <div class="admin-section" id="addSection">
                <h3 class="section-title-admin">
                    <i class="fas fa-plus-circle"></i>
                    Agregar Nuevo Producto
                </h3>
                <div class="status-message status-success" id="formMessage" style="display: none;"><i class="fas fa-check-circle"></i><span>Producto guardado correctamente</span></div>
                <form class="admin-form" id="productForm">
                    <div class="form-row">
                        <div class="form-group-admin">
                            <label class="form-label-admin">
                                <i class="fas fa-tag"></i> Nombre:
                            </label>
                            <input type="text" id="productName" class="form-input-admin" placeholder="Nombre del producto" required="">
                        </div>
                        
                        <div class="form-group-admin">
                            <label class="form-label-admin">
                                <i class="fas fa-box"></i> Categoría:
                            </label>
                            <select id="productCategory" class="form-select" required=""><option value="">Selecciona categoría</option><option value="hombre">Hombre</option><option value="accesorios">Accesorios</option><option value="mujer">Mujer</option><option value="kids">Kids</option></select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group-admin">
                            <label class="form-label-admin">
                                <i class="fas fa-list"></i> Subcategoría:
                            </label>
                            <input type="text" id="productSubcategory" class="form-input-admin" placeholder="Ej: Sudaderas, Mochilas, Peluches, Camas" required="">
                        </div>
                        
                        <div class="form-group-admin">
                            <label class="form-label-admin">
                                <i class="fas fa-dollar-sign"></i> Precio Regular:
                            </label>
                            <input type="text" id="productPrice" class="form-input-admin" placeholder="Ej: $250" required="">
                        </div>
                    </div>
                    
                    <div class="form-group-admin">
                        <label class="form-label-admin">
                            <i class="fas fa-percentage"></i> Precio de Descuento (opcional):
                        </label>
                        <input type="text" id="productDiscountPrice" class="form-input-admin" placeholder="Ej: $200 (dejar vacío si no hay descuento)">
                    </div>
                    
                    <div class="form-group-admin">
                        <label class="form-label-admin">
                            <i class="fas fa-image"></i> URL de Imagen Principal:
                        </label>
                        <input type="url" id="productImage" class="form-input-admin" placeholder="https://ejemplo.com/imagen.jpg" required="">
                    </div>
                    
                    <div class="form-group-admin">
                        <label class="form-label-admin">
                            <i class="fas fa-images"></i> URLs de Imágenes por Color/Variante (una por línea):
                        </label>
                        <textarea id="productImages" class="form-textarea" placeholder="Formato: Variante|URL
Ej: Negro|https://ejemplo.com/negro.jpg
Azul|https://ejemplo.com/azul.jpg
Dejar vacío si no hay imágenes por variante"></textarea>
                    </div>
                    
                    <div class="form-group-admin">
                        <label class="form-label-admin">
                            <i class="fas fa-align-left"></i> Descripción:
                        </label>
                        <textarea id="productDescription" class="form-textarea" placeholder="Describe el producto..." required=""></textarea>
                    </div>
                    
                    <!-- Sistema de Variantes Personalizadas -->
                    <div class="form-group-admin">
                        <label class="form-label-admin">
                            <i class="fas fa-shapes"></i> Sistema de Variantes Personalizado:
                        </label>
                        <div id="variantSystemContainer"></div>
                        <button type="button" class="add-btn" id="addVariantBtn">
                            <i class="fas fa-plus"></i>
                            Agregar Campo de Variante
                        </button>
                    </div>
                    
                    <div class="form-group-admin">
                        <label class="form-label-admin">
                            <i class="fas fa-check-circle"></i> Especificaciones:
                        </label>
                        <div class="multi-input-container">
                            <input type="text" id="specInput" class="multi-input" placeholder="Agrega una especificación">
                            <button type="button" class="add-btn" id="addSpecBtn">
                                <i class="fas fa-plus"></i>
                                Agregar
                            </button>
                        </div>
                        <div class="tags-container" id="specsContainer"></div>
                    </div>
                    
                    <div class="form-group-admin">
                        <label class="form-label-admin">
                            <i class="fas fa-star"></i> Estado:
                        </label>
                        <select id="productEstado" class="form-select" required="">
                            <option value="nuevo">Nuevo</option>
                            <option value="oferta">Oferta</option>
                            <option value="normal">Normal</option>
                            <option value="agotado">Agotado</option>
                        </select>
                    </div>
                    
                    <!-- Sistema de Stock -->
                    <div class="form-group-admin">
                        <div class="stock-system-container" id="stockSystemContainer"></div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn-cancel" id="resetFormBtn">
                            <i class="fas fa-redo"></i>
                            Limpiar
                        </button>
                        <button type="submit" class="btn-save" id="saveProductBtn"><i class="fas fa-save"></i> Guardar Producto</button>
                    </div>
                </form>
            </div>

            <!-- Sección de Categorías -->
            <div class="admin-section" id="categoriesSection">
                <h3 class="section-title-admin">
                    <i class="fas fa-tags"></i>
                    Gestión de Categorías
                </h3>
                <div class="status-message status-info" id="categoriesReorderMessage">
                    <i class="fas fa-info-circle"></i>
                    <span>Arrastra y suelta para reordenar las categorías</span>
                </div>
                <div class="status-message" id="categoriesMessage" style="display: none;"></div>
                
                <div class="admin-form">
                    <div class="form-group-admin">
                        <label class="form-label-admin">
                            <i class="fas fa-plus-circle"></i> Agregar Nueva Categoría:
                        </label>
                        <div class="form-row">
                            <div class="form-group-admin">
                                <label class="form-label-admin">
                                    <i class="fas fa-tag"></i> Nombre de Categoría:
                                </label>
                                <input type="text" id="newCategoryName" class="form-input-admin" placeholder="Ej: Hombre, Mujer, Kids, Accesorios" required="">
                            </div>
                            
                            <div class="form-group-admin">
                                <label class="form-label-admin">
                                    <i class="fas fa-palette"></i> Color:
                                </label>
                                <input type="color" id="newCategoryColor" class="form-input-admin" style="height: 38px; padding: 4px;" value="#D4AF37">
                            </div>
                        </div>
                        
                        <div class="form-group-admin">
                            <label class="form-label-admin">
                                <i class="fas fa-icons"></i> Ícono FontAwesome (opcional):
                            </label>
                            <input type="text" id="newCategoryIcon" class="form-input-admin" placeholder="fa-tshirt, fa-user, fa-child">
                        </div>
                        
                        <button type="button" class="btn-save" id="addCategoryBtn"><i class="fas fa-plus"></i> Agregar Nueva Categoría</button>
                    </div>
                </div>
                
                <h4 class="section-title-admin" style="margin-top: 20px;">
                    <i class="fas fa-list"></i>
                    Categorías Existentes
                </h4>
                <div class="categories-list-admin" id="categoriesListAdmin">
                            <div class="category-item-admin" data-category-id="hombre" draggable="true">
                                <div class="category-info-admin">
                                    <div class="category-icon-admin" style="background: #2563EB;">
                                        <i class="fas fa-user-tie"></i>
                                    </div>
                                    <div class="category-details-admin">
                                        <div class="category-name-admin">Hombre</div>
                                        <div class="category-stats-admin">
                                            <span class="category-product-count">1 productos</span>
                                            <span class="category-color" style="background: #2563EB"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="category-actions-admin">
                                    <button class="category-action-btn edit-category-btn" onclick="admin.editarCategoria('hombre')">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="category-action-btn delete-category-btn" onclick="admin.eliminarCategoria('hombre')" disabled="">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        
                            <div class="category-item-admin" data-category-id="accesorios" draggable="true">
                                <div class="category-info-admin">
                                    <div class="category-icon-admin" style="background: #7C3AED;">
                                        <i class="fas fa-briefcase"></i>
                                    </div>
                                    <div class="category-details-admin">
                                        <div class="category-name-admin">Accesorios</div>
                                        <div class="category-stats-admin">
                                            <span class="category-product-count">0 productos</span>
                                            <span class="category-color" style="background: #7C3AED"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="category-actions-admin">
                                    <button class="category-action-btn edit-category-btn" onclick="admin.editarCategoria('accesorios')">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="category-action-btn delete-category-btn" onclick="admin.eliminarCategoria('accesorios')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        
                            <div class="category-item-admin" data-category-id="mujer" draggable="true">
                                <div class="category-info-admin">
                                    <div class="category-icon-admin" style="background: #DB2777;">
                                        <i class="fas fa-female"></i>
                                    </div>
                                    <div class="category-details-admin">
                                        <div class="category-name-admin">Mujer</div>
                                        <div class="category-stats-admin">
                                            <span class="category-product-count">0 productos</span>
                                            <span class="category-color" style="background: #DB2777"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="category-actions-admin">
                                    <button class="category-action-btn edit-category-btn" onclick="admin.editarCategoria('mujer')">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="category-action-btn delete-category-btn" onclick="admin.eliminarCategoria('mujer')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        
                            <div class="category-item-admin" data-category-id="kids" draggable="true">
                                <div class="category-info-admin">
                                    <div class="category-icon-admin" style="background: #059669;">
                                        <i class="fas fa-child"></i>
                                    </div>
                                    <div class="category-details-admin">
                                        <div class="category-name-admin">Kids</div>
                                        <div class="category-stats-admin">
                                            <span class="category-product-count">0 productos</span>
                                            <span class="category-color" style="background: #059669"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="category-actions-admin">
                                    <button class="category-action-btn edit-category-btn" onclick="admin.editarCategoria('kids')">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="category-action-btn delete-category-btn" onclick="admin.eliminarCategoria('kids')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
            </div>

            <!-- Sección de Cupones -->
            <div class="admin-section" id="couponsSection">
                <h3 class="section-title-admin">
                    <i class="fas fa-ticket-alt"></i>
                    Gestión de Cupones
                </h3>
                <div class="status-message status-success" id="couponsMessage" style="display: none;"><i class="fas fa-check-circle"></i><span>Cupón creado correctamente</span></div>
                
                <div class="admin-form">
                    <h4 class="section-title-admin">
                        <i class="fas fa-plus-circle"></i>
                        Crear Nuevo Cupón
                    </h4>
                    
                    <div class="form-row">
                        <div class="form-group-admin">
                            <label class="form-label-admin">
                                <i class="fas fa-tag"></i> Código del Cupón:
                            </label>
                            <input type="text" id="couponCode" class="form-input-admin" placeholder="Ej: VERANO20" required="">
                        </div>
                        
                        <div class="form-group-admin">
                            <label class="form-label-admin">
                                <i class="fas fa-ticket-alt"></i> Tipo de Cupón:
                            </label>
                            <select id="couponType" class="form-select" required="">
                                <option value="">Seleccionar tipo</option>
                                <option value="percentage">Porcentaje de descuento</option>
                                <option value="free_shipping">Envío gratis</option>
                                <option value="bogo_2x1">2x1 en productos</option>
                                <option value="bogo_3x2">3x2 en productos</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group-admin" id="percentageField" style="display: none;">
                            <label class="form-label-admin">
                                <i class="fas fa-percentage"></i> Porcentaje de Descuento:
                            </label>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="number" id="couponPercentage" class="form-input-admin" placeholder="Ej: 20" min="1" max="100" style="flex: 1;">
                                <span>%</span>
                            </div>
                        </div>
                        
                        <div class="form-group-admin" id="bogoField" style="display: none;">
                            <label class="form-label-admin">
                                <i class="fas fa-box"></i> Productos Aplicables (IDs separados por comas):
                            </label>
                            <input type="text" id="couponProducts" class="form-input-admin" placeholder="Ej: 1,3,5 (dejar vacío para todos)">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group-admin">
                            <label class="form-label-admin">
                                <i class="fas fa-calendar"></i> Fecha de Inicio:
                            </label>
                            <input type="date" id="couponStartDate" class="form-input-admin" required="">
                        </div>
                        
                        <div class="form-group-admin">
                            <label class="form-label-admin">
                                <i class="fas fa-calendar-times"></i> Fecha de Expiración:
                            </label>
                            <input type="date" id="couponEndDate" class="form-input-admin" required="">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group-admin">
                            <label class="form-label-admin">
                                <i class="fas fa-users"></i> Límite de Usos por Cliente:
                            </label>
                            <input type="number" id="couponUsesPerCustomer" class="form-input-admin" placeholder="0 = ilimitado" min="0" value="0">
                        </div>
                        
                        <div class="form-group-admin">
                            <label class="form-label-admin">
                                <i class="fas fa-shopping-cart"></i> Uso Mínimo de Carrito:
                            </label>
                            <input type="number" id="couponMinAmount" class="form-input-admin" placeholder="0 = sin mínimo" min="0" value="0">
                        </div>
                    </div>
                    
                    <div class="form-group-admin">
                        <label class="form-label-admin">
                            <i class="fas fa-hashtag"></i> Usos Totales Máximos:
                        </label>
                            <input type="number" id="couponMaxUses" class="form-input-admin" placeholder="0 = ilimitado" min="0" value="0">
                        </div>
                        
                        <div class="form-group-admin">
                            <label class="form-label-admin">
                                <i class="fas fa-align-left"></i> Descripción del Cupón:
                            </label>
                            <textarea id="couponDescription" class="form-textarea" placeholder="Describe el cupón para los clientes..." rows="2"></textarea>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn-cancel" id="resetCouponBtn">
                                <i class="fas fa-redo"></i>
                                Limpiar
                            </button>
                            <button type="button" class="btn-save" id="saveCouponBtn"><i class="fas fa-save"></i> Guardar Cupón</button>
                        </div>
                    </div>
                    
                    <h4 class="section-title-admin" style="margin-top: 20px;">
                        <i class="fas fa-list"></i>
                        Cupones Existentes
                    </h4>
                    <div class="status-message status-info">
                        <i class="fas fa-info-circle"></i>
                        <span>Los cupones se aplican automáticamente en el carrito</span>
                    </div>
                    <div class="coupons-list-admin" id="couponsListAdmin">
                            <div class="editor-category-item" data-coupon-id="2">
                                <div class="editor-category-header">
                                    <div class="editor-category-title">
                                        <i class="fas fa-shipping-fast" style="color: var(--coupon)"></i>
                                        ENVIOGRATIS
                                        <span class="color-preview" style="background: var(--coupon);"></span>
                                    </div>
                                    <div class="editor-category-actions">
                                        <button class="category-action-btn edit-category-btn" onclick="admin.editarCupon(2)">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="category-action-btn delete-category-btn" onclick="admin.eliminarCupon(2)">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="editor-category-content">
                                    <div class="editor-category-fields">
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-ticket-alt"></i> Tipo:
                                            </label>
                                            <input type="text" class="form-input-admin" value="ENVÍO GRATIS" readonly="">
                                        </div>
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-align-left"></i> Descripción:
                                            </label>
                                            <input type="text" class="form-input-admin" value="Envío gratis en cualquier compra" readonly="">
                                        </div>
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-calendar"></i> Validez:
                                            </label>
                                            <input type="text" class="form-input-admin" value="31/12/2023 - 30/12/2024" readonly="">
                                        </div>
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-hashtag"></i> Usos:
                                            </label>
                                            <input type="text" class="form-input-admin" value="0 / 50 (50 restantes)" readonly="">
                                        </div>
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-toggle-on"></i> Estado:
                                            </label>
                                            <input type="text" class="form-input-admin" value="Activo" readonly="">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        
                            <div class="editor-category-item" data-coupon-id="3">
                                <div class="editor-category-header">
                                    <div class="editor-category-title">
                                        <i class="fas fa-gift" style="color: var(--coupon)"></i>
                                        2X1MODA
                                        <span class="color-preview" style="background: var(--coupon);"></span>
                                    </div>
                                    <div class="editor-category-actions">
                                        <button class="category-action-btn edit-category-btn" onclick="admin.editarCupon(3)">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="category-action-btn delete-category-btn" onclick="admin.eliminarCupon(3)">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="editor-category-content">
                                    <div class="editor-category-fields">
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-ticket-alt"></i> Tipo:
                                            </label>
                                            <input type="text" class="form-input-admin" value="2X1" readonly="">
                                        </div>
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-align-left"></i> Descripción:
                                            </label>
                                            <input type="text" class="form-input-admin" value="Llévate 2 productos y paga solo 1 (el de menor precio)" readonly="">
                                        </div>
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-calendar"></i> Validez:
                                            </label>
                                            <input type="text" class="form-input-admin" value="31/12/2023 - 30/12/2024" readonly="">
                                        </div>
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-hashtag"></i> Usos:
                                            </label>
                                            <input type="text" class="form-input-admin" value="0 / 30 (30 restantes)" readonly="">
                                        </div>
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-toggle-on"></i> Estado:
                                            </label>
                                            <input type="text" class="form-input-admin" value="Activo" readonly="">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        
                            <div class="editor-category-item" data-coupon-id="4">
                                <div class="editor-category-header">
                                    <div class="editor-category-title">
                                        <i class="fas fa-gift" style="color: var(--coupon)"></i>
                                        3X2STYLE
                                        <span class="color-preview" style="background: var(--coupon);"></span>
                                    </div>
                                    <div class="editor-category-actions">
                                        <button class="category-action-btn edit-category-btn" onclick="admin.editarCupon(4)">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="category-action-btn delete-category-btn" onclick="admin.eliminarCupon(4)">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="editor-category-content">
                                    <div class="editor-category-fields">
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-ticket-alt"></i> Tipo:
                                            </label>
                                            <input type="text" class="form-input-admin" value="3X2" readonly="">
                                        </div>
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-align-left"></i> Descripción:
                                            </label>
                                            <input type="text" class="form-input-admin" value="Llévate 3 productos y paga solo 2 (los de menor precio)" readonly="">
                                        </div>
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-calendar"></i> Validez:
                                            </label>
                                            <input type="text" class="form-input-admin" value="31/12/2023 - 30/12/2024" readonly="">
                                        </div>
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-hashtag"></i> Usos:
                                            </label>
                                            <input type="text" class="form-input-admin" value="0 / 20 (20 restantes)" readonly="">
                                        </div>
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-toggle-on"></i> Estado:
                                            </label>
                                            <input type="text" class="form-input-admin" value="Activo" readonly="">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        
                            <div class="editor-category-item" data-coupon-id="5">
                                <div class="editor-category-header">
                                    <div class="editor-category-title">
                                        <i class="fas fa-percentage" style="color: var(--coupon)"></i>
                                        SAUL123456
                                        <span class="color-preview" style="background: var(--coupon);"></span>
                                    </div>
                                    <div class="editor-category-actions">
                                        <button class="category-action-btn edit-category-btn" onclick="admin.editarCupon(5)">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="category-action-btn delete-category-btn" onclick="admin.eliminarCupon(5)">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="editor-category-content">
                                    <div class="editor-category-fields">
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-ticket-alt"></i> Tipo:
                                            </label>
                                            <input type="text" class="form-input-admin" value="20% DESCUENTO" readonly="">
                                        </div>
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-align-left"></i> Descripción:
                                            </label>
                                            <input type="text" class="form-input-admin" value="DESCUENTO" readonly="">
                                        </div>
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-calendar"></i> Validez:
                                            </label>
                                            <input type="text" class="form-input-admin" value="9/2/2026 - 10/3/2026" readonly="">
                                        </div>
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-hashtag"></i> Usos:
                                            </label>
                                            <input type="text" class="form-input-admin" value="0 / 1 (1 restantes)" readonly="">
                                        </div>
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-toggle-on"></i> Estado:
                                            </label>
                                            <input type="text" class="form-input-admin" value="Activo" readonly="">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                </div>

                <!-- Sección de Ofertas Relámpago -->
                <div class="admin-section" id="flash-saleSection">
                    <h3 class="section-title-admin">
                        <i class="fas fa-bolt"></i>
                        Configuración de Ofertas Relámpago
                    </h3>
                    
                    <div class="status-message status-info">
                        <i class="fas fa-info-circle"></i>
                        <span>Configura el banner de ofertas relámpago que aparece en la parte superior de la tienda</span>
                    </div>
                    
                    <div class="admin-form">
                        <h4 class="section-title-admin">
                            <i class="fas fa-cog"></i>
                            Configuración del Banner
                        </h4>
                        
                        <div class="form-group-admin">
                            <label class="form-label-admin">
                                <i class="fas fa-toggle-on"></i> Estado del Banner:
                            </label>
                            <div style="display: flex; gap: 15px; align-items: center;">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="flashSaleEnabled" checked="">
                                    <span>Mostrar banner de ofertas relámpago</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group-admin">
                                <label class="form-label-admin">
                                    <i class="fas fa-heading"></i> Título del Banner:
                                </label>
                                <input type="text" id="flashSaleTitleInput" class="form-input-admin" placeholder="Ej: ¡OFERTA RELÁMPAGO!" value="¡OFERTA RELÁMPAGO!">
                            </div>
                            
                            <div class="form-group-admin">
                                <label class="form-label-admin">
                                    <i class="fas fa-align-left"></i> Descripción:
                                </label>
                                <input type="text" id="flashSaleDescriptionInput" class="form-input-admin" placeholder="Ej: Hasta 50% de descuento en productos seleccionados" value="Hasta 50% de descuento en productos seleccionados">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group-admin">
                                <label class="form-label-admin">
                                    <i class="fas fa-calendar"></i> Fecha de Inicio:
                                </label>
                                <input type="datetime-local" id="flashSaleStartDate" class="form-input-admin">
                            </div>
                            
                            <div class="form-group-admin">
                                <label class="form-label-admin">
                                    <i class="fas fa-calendar-times"></i> Fecha de Fin:
                                </label>
                                <input type="datetime-local" id="flashSaleEndDate" class="form-input-admin">
                            </div>
                        </div>
                        
                        <div class="form-group-admin">
                            <label class="form-label-admin">
                                <i class="fas fa-box"></i> Productos en Oferta (IDs separados por comas):
                            </label>
                            <input type="text" id="flashSaleProducts" class="form-input-admin" placeholder="Ej: 1,2,3 (dejar vacío para todos los productos en oferta)">
                        </div>
                        
                        <div class="form-group-admin">
                            <label class="form-label-admin">
                                <i class="fas fa-tag"></i> Texto del Botón:
                            </label>
                            <input type="text" id="flashSaleButtonText" class="form-input-admin" placeholder="Ej: VER OFERTAS" value="VER OFERTAS">
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn-save" id="saveFlashSaleBtn">
                                <i class="fas fa-save"></i>
                                Guardar Configuración
                            </button>
                        </div>
                    </div>
                    
                    <div class="status-message status-success" id="flashSaleMessage" style="display: none;">
                        <i class="fas fa-check-circle"></i>
                        <span>Configuración guardada correctamente</span>
                    </div>
                    
                    <div class="admin-form" style="margin-top: 20px;">
                        <h4 class="section-title-admin">
                            <i class="fas fa-eye"></i>
                            Vista Previa del Banner
                        </h4>
                        
                        <div class="section-preview" style="margin-top: 10px;">
                            <div class="flash-sale-banner" style="position: relative; top: 0; animation: none; margin-bottom: 15px;">
                                <div class="flash-sale-content">
                                    <div class="flash-sale-left">
                                        <div class="flash-sale-icon">
                                            <i class="fas fa-bolt"></i>
                                        </div>
                                        <div class="flash-sale-info">
                                            <div class="flash-sale-title" id="previewFlashSaleTitle">¡OFERTA RELÁMPAGO!</div>
                                            <div class="flash-sale-description" id="previewFlashSaleDescription">Hasta 50% de descuento en productos seleccionados</div>
                                        </div>
                                        <div class="flash-sale-timer">
                                            <div class="timer-label">TERMINA EN:</div>
                                            <div class="timer-display">
                                                <div class="timer-unit">
                                                    <span class="timer-value">24</span>
                                                    <span class="timer-label-unit">HORAS</span>
                                                </div>
                                                <div class="timer-unit">
                                                    <span class="timer-value">00</span>
                                                    <span class="timer-label-unit">MIN</span>
                                                </div>
                                                <div class="timer-unit">
                                                    <span class="timer-value">00</span>
                                                    <span class="timer-label-unit">SEG</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="flash-sale-right">
                                        <button class="flash-sale-btn" style="cursor: default;"><i class="fas fa-shopping-bag"></i> VER ARTICULOS</button>
                                    </div>
                                </div>
                            </div>
                            
                            <p style="font-size: 0.8rem; color: var(--text-light); text-align: center;">
                                Esta es una vista previa del banner. Los cambios se reflejarán después de guardar.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Sección de Editor de Categorías -->
                <div class="admin-section" id="section-editorSection">
                    <h3 class="section-title-admin">
                        <i class="fas fa-edit"></i>
                        Editor de Sección "Nuestras Categorías"
                    </h3>
                    
                    <div class="status-message status-info" id="editorInfoMessage">
                        <i class="fas fa-info-circle"></i>
                        <span>Desde aquí puedes modificar el título, subtítulo y las categorías que aparecen en la página principal.</span>
                    </div>
                    
                    <div class="status-message status-success" id="editorMessage" style="display: none;"><i class="fas fa-check-circle"></i><span>Categoría eliminada</span></div>
                    
                    <div class="editor-container">
                        <div class="editor-header">
                            <h4 class="section-title-admin" style="margin: 0;">
                                <i class="fas fa-cog"></i>
                                Configuración de la Sección
                            </h4>
                            <div class="editor-actions">
                                <button type="button" class="btn-preview" id="previewSectionBtn"><i class="fas fa-eye"></i> Mostrar Vista Previa</button>
                                <button type="button" class="btn-save" id="saveSectionBtn">
                                    <i class="fas fa-save"></i>
                                    Guardar Cambios
                                </button>
                            </div>
                        </div>
                        
                        <div class="admin-form">
                            <div class="form-group-admin">
                                <label class="form-label-admin">
                                    <i class="fas fa-heading"></i> Título de la Sección:
                                </label>
                                <input type="text" id="sectionTitle" class="form-input-admin" placeholder="Ej: Nuestras Categorías" value="Nuestras Categorías">
                            </div>
                            
                            <div class="form-group-admin">
                                <label class="form-label-admin">
                                    <i class="fas fa-align-left"></i> Subtítulo/Descripción:
                                </label>
                                <textarea id="sectionSubtitle" class="form-textarea" placeholder="Ej: Explora nuestra variedad de productos organizados por categorías">Explora nuestra variedad de productos organizados por categorías</textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="editor-container">
                        <div class="editor-header">
                            <h4 class="section-title-admin" style="margin: 0;">
                                <i class="fas fa-tags"></i>
                                Gestión de Categorías de la Sección
                            </h4>
                            <button type="button" class="btn-save" id="addSectionCategoryBtn">
                                <i class="fas fa-plus"></i>
                                Agregar Categoría
                            </button>
                        </div>
                        
                        <div class="status-message status-info">
                            <i class="fas fa-info-circle"></i>
                            <span>Arrastra y suelta para reordenar las categorías. Cada categoría incluye: Nombre, Descripción, Imagen, Color del botón y Enlace.</span>
                        </div>
                        
                        <div class="editor-categories-list" id="sectionCategoriesList">
                            <div class="editor-category-item" data-category-id="1" draggable="true">
                                <div class="editor-category-header">
                                    <div class="editor-category-title">
                                        <i class="fas fa-tag"></i> Hombre
                                        <span class="color-preview" style="background: #2563EB;"></span>
                                    </div>
                                    <div class="editor-category-actions">
                                        <button class="category-action-btn edit-category-btn" onclick="admin.editarSectionCategory(1)">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="category-action-btn delete-category-btn" onclick="admin.eliminarSectionCategory(1)">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="editor-category-content">
                                    <div class="editor-category-preview">
                                        <img src="https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=500&amp;q=80" alt="Hombre">
                                    </div>
                                    <div class="editor-category-fields">
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-font"></i> Nombre:
                                            </label>
                                            <input type="text" class="form-input-admin" value="Hombre" readonly="">
                                        </div>
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-align-left"></i> Descripción:
                                            </label>
                                            <input type="text" class="form-input-admin" value="Ropa y accesorios para hombres modernos" readonly="">
                                        </div>
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-link"></i> Acción:
                                            </label>
                                            <input type="text" class="form-input-admin" value="carrito.filterProducts('hombre')" readonly="">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        
                            <div class="editor-category-item" data-category-id="2" draggable="true">
                                <div class="editor-category-header">
                                    <div class="editor-category-title">
                                        <i class="fas fa-tag"></i> Mujer
                                        <span class="color-preview" style="background: #DB2777;"></span>
                                    </div>
                                    <div class="editor-category-actions">
                                        <button class="category-action-btn edit-category-btn" onclick="admin.editarSectionCategory(2)">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="category-action-btn delete-category-btn" onclick="admin.eliminarSectionCategory(2)">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="editor-category-content">
                                    <div class="editor-category-preview">
                                        <img src="https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=500&amp;q=80" alt="Mujer">
                                    </div>
                                    <div class="editor-category-fields">
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-font"></i> Nombre:
                                            </label>
                                            <input type="text" class="form-input-admin" value="Mujer" readonly="">
                                        </div>
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-align-left"></i> Descripción:
                                            </label>
                                            <input type="text" class="form-input-admin" value="Moda femenina para todos los estilos" readonly="">
                                        </div>
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-link"></i> Acción:
                                            </label>
                                            <input type="text" class="form-input-admin" value="carrito.filterProducts('mujer')" readonly="">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        
                            <div class="editor-category-item" data-category-id="3" draggable="true">
                                <div class="editor-category-header">
                                    <div class="editor-category-title">
                                        <i class="fas fa-tag"></i> Kids
                                        <span class="color-preview" style="background: #059669;"></span>
                                    </div>
                                    <div class="editor-category-actions">
                                        <button class="category-action-btn edit-category-btn" onclick="admin.editarSectionCategory(3)">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="category-action-btn delete-category-btn" onclick="admin.eliminarSectionCategory(3)">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="editor-category-content">
                                    <div class="editor-category-preview">
                                        <img src="https://images.unsplash.com/photo-1584917865442-de89df76afd3?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=500&amp;q=80" alt="Kids">
                                    </div>
                                    <div class="editor-category-fields">
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-font"></i> Nombre:
                                            </label>
                                            <input type="text" class="form-input-admin" value="Kids" readonly="">
                                        </div>
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-align-left"></i> Descripción:
                                            </label>
                                            <input type="text" class="form-input-admin" value="Ropa divertida para los más pequeños" readonly="">
                                        </div>
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-link"></i> Acción:
                                            </label>
                                            <input type="text" class="form-input-admin" value="carrito.filterProducts('kids')" readonly="">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        
                            <div class="editor-category-item" data-category-id="4" draggable="true">
                                <div class="editor-category-header">
                                    <div class="editor-category-title">
                                        <i class="fas fa-tag"></i> Accesorios
                                        <span class="color-preview" style="background: #7C3AED;"></span>
                                    </div>
                                    <div class="editor-category-actions">
                                        <button class="category-action-btn edit-category-btn" onclick="admin.editarSectionCategory(4)">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="category-action-btn delete-category-btn" onclick="admin.eliminarSectionCategory(4)">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="editor-category-content">
                                    <div class="editor-category-preview">
                                        <img src="https://images.unsplash.com/photo-1595777457583-95e059d581b8?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=500&amp;q=80" alt="Accesorios">
                                    </div>
                                    <div class="editor-category-fields">
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-font"></i> Nombre:
                                            </label>
                                            <input type="text" class="form-input-admin" value="Accesorios" readonly="">
                                        </div>
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-align-left"></i> Descripción:
                                            </label>
                                            <input type="text" class="form-input-admin" value="Complementos para completar tu look" readonly="">
                                        </div>
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-link"></i> Acción:
                                            </label>
                                            <input type="text" class="form-input-admin" value="carrito.filterProducts('accesorios')" readonly="">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="section-preview" id="sectionPreview" style="display: none;">
                        <h4 class="section-title-admin">
                            <i class="fas fa-eye"></i>
                            Vista Previa de la Sección
                        </h4>
                        <div class="preview-title">
                            <h2 id="previewSectionTitle" style="font-size: 1.6rem; font-weight: 800; margin-bottom: 10px; color: var(--primary);">Nuestras Categorías</h2>
                            <p id="previewSectionSubtitle" style="color: var(--text-light); font-size: 0.9rem;">Explora nuestra variedad de productos organizados por categorías</p>
                        </div>
                        <div class="categories-grid" id="previewCategoriesGrid">
                            <!-- Vista previa de categorías se cargará dinámicamente -->
                        </div>
                    </div>
                </div>

                <!-- Sección de Estadísticas -->
                <div class="admin-section" id="statsSection">
                    <h3 class="section-title-admin">
                        <i class="fas fa-chart-pie"></i>
                        Estadísticas de la Tienda
                    </h3>
                    <div class="stats-grid" id="statsGrid">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--admin);">
                                <i class="fas fa-boxes"></i>
                            </div>
                            <div class="stat-value">1</div>
                            <div class="stat-label">Productos Totales</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: #2563EB;">
                                <i class="fas fa-user-tie"></i>
                            </div>
                            <div class="stat-value">1</div>
                            <div class="stat-label">Hombre</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: #7C3AED;">
                                <i class="fas fa-briefcase"></i>
                            </div>
                            <div class="stat-value">0</div>
                            <div class="stat-label">Accesorios</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: #DB2777;">
                                <i class="fas fa-female"></i>
                            </div>
                            <div class="stat-value">0</div>
                            <div class="stat-label">Mujer</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: #059669;">
                                <i class="fas fa-child"></i>
                            </div>
                            <div class="stat-value">0</div>
                            <div class="stat-label">Kids</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--coupon);">
                                <i class="fas fa-percentage"></i>
                            </div>
                            <div class="stat-value">1</div>
                            <div class="stat-label">En Oferta</div>
                        </div>
                    </div>
                </div>

                <!-- Sección de Exportación -->
                <div class="admin-section active" id="exportSection">
                    <h3 class="section-title-admin">
                        <i class="fas fa-download"></i>
                        Exportar HTML Actualizado
                    </h3>
                    <div class="status-message status-info">
                        <i class="fas fa-info-circle"></i>
                        <span>Exporta la tienda completa con todos los productos modificados y nuevos.</span>
                    </div>
                    
                    <div class="export-options">
                        <div class="form-group-admin">
                            <label class="form-label-admin">
                                <i class="fas fa-file-code"></i> Opciones de exportación:
                            </label>
                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="exportClean" checked="">
                                    <span>Limpiar HTML (remover panel de administración)</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="exportIncludeData" checked="">
                                    <span>Incluir datos de productos</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn-save" id="exportHtmlBtn">
                                <i class="fas fa-download"></i>
                                Descargar HTML Completo
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Header -->
        <header class="main-header">
            <div class="container header-content">
                <a href="#" class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-crown"></i>
                    </div>
                    <div class="logo-text">ModaStyle</div>
                </a>
                
                <!-- Buscador en Header -->
                <div class="search-container">
                    <input type="text" class="search-input" id="searchInput" placeholder="Buscar productos...">
                    <i class="fas fa-search search-icon"></i>
                    <button class="clear-search" id="clearSearch">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="search-results" id="searchResults">
                        <!-- Resultados de búsqueda se cargarán dinámicamente -->
                    </div>
                </div>
                
                <button class="admin-btn" id="adminBtn">
                    <i class="fas fa-cogs"></i>
                    Administración
                </button>
                
                <nav>
                    <ul class="nav-links" id="navLinks">
                        <li><a href="#inicio" class="nav-link">Inicio</a></li>
                        <li><a href="#categorias" class="nav-link">Categorías</a></li>
                        <li><a href="#productos" class="nav-link">Productos</a></li>
                        <li><a href="#contacto" class="nav-link">Contacto</a></li>
                    </ul>
                </nav>
            </div>
        </header>

        <!-- Hero Section -->
        <section class="hero-section" id="inicio" style="padding-top: 120px;">
            <div class="container">
                <div class="hero-content">
                    <h1 class="hero-title">
                        Estilo que <span class="hero-highlight">Trasciende</span>
                    </h1>
                    
                    <div class="hero-badges">
                        <div class="badge">
                            <i class="fas fa-shipping-fast"></i>
                            Envío gratis +$300
                        </div>
                        <div class="badge">
                            <i class="fas fa-shield-alt"></i>
                            Garantía 30 días
                        </div>
                        <div class="badge">
                            <i class="fas fa-gem"></i>
                            Productos premium
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sección de Categorías - SOLAMENTE UNA -->
        <section class="categories-section" id="categorias">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title" id="mainSectionTitle">Nuestras Categorías</h2>
                    <p class="section-subtitle" id="mainSectionSubtitle">Explora nuestra variedad de productos organizados por categorías</p>
                </div>
                
                <div class="categories-grid" id="categoriesGrid">
                                <div class="category-card" onclick="carrito.filterProducts('hombre')">
                                    <img src="https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=500&amp;q=80" alt="Hombre" class="category-image">
                                    <div class="category-overlay">
                                        <h3 class="category-name">Hombre</h3>
                                        <p class="category-description">Ropa y accesorios para hombres modernos</p>
                                        <span class="category-badge" style="background: #2563EB">Ver productos</span>
                                    </div>
                                </div>
                            
                                <div class="category-card" onclick="carrito.filterProducts('mujer')">
                                    <img src="https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=500&amp;q=80" alt="Mujer" class="category-image">
                                    <div class="category-overlay">
                                        <h3 class="category-name">Mujer</h3>
                                        <p class="category-description">Moda femenina para todos los estilos</p>
                                        <span class="category-badge" style="background: #DB2777">Ver productos</span>
                                    </div>
                                </div>
                            
                                <div class="category-card" onclick="carrito.filterProducts('kids')">
                                    <img src="https://images.unsplash.com/photo-1584917865442-de89df76afd3?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=500&amp;q=80" alt="Kids" class="category-image">
                                    <div class="category-overlay">
                                        <h3 class="category-name">Kids</h3>
                                        <p class="category-description">Ropa divertida para los más pequeños</p>
                                        <span class="category-badge" style="background: #059669">Ver productos</span>
                                    </div>
                                </div>
                            
                                <div class="category-card" onclick="carrito.filterProducts('accesorios')">
                                    <img src="https://images.unsplash.com/photo-1595777457583-95e059d581b8?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=500&amp;q=80" alt="Accesorios" class="category-image">
                                    <div class="category-overlay">
                                        <h3 class="category-name">Accesorios</h3>
                                        <p class="category-description">Complementos para completar tu look</p>
                                        <span class="category-badge" style="background: #7C3AED">Ver productos</span>
                                    </div>
                                </div>
                            </div>
            </div>
        </section>

        <!-- Productos -->
        <section class="products-section" id="productos">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">Todos los Productos</h2>
                    <p class="section-subtitle">Explora nuestra colección completa de productos</p>
                </div>
                
                <!-- Filtros de categoría -->
                <div class="category-filters" id="categoryFilters">
                            <button class="category-filter active" onclick="carrito.filterProducts('todo')" data-color="#D4AF37" style="background: rgb(212, 175, 55); color: white; border-color: rgb(212, 175, 55);">
                                TODO
                            </button>
                        
                            <button class="category-filter " onclick="carrito.filterProducts('hombre')" data-color="#2563EB">
                                Hombre
                            </button>
                        
                            <button class="category-filter " onclick="carrito.filterProducts('accesorios')" data-color="#7C3AED">
                                Accesorios
                            </button>
                        
                            <button class="category-filter " onclick="carrito.filterProducts('mujer')" data-color="#DB2777">
                                Mujer
                            </button>
                        
                            <button class="category-filter " onclick="carrito.filterProducts('kids')" data-color="#059669">
                                Kids
                            </button>
                        </div>
                
                <div class="products-grid" id="productsGrid">
                            <div class="product-card" data-product-id="1" style="animation-delay: 0s">
                                <div class="product-image-container">
                                    <img src="https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=1200&amp;q=80" alt="SUDADERA BÁSICA" class="product-image" onclick="carrito.openImageModal('https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=1200&amp;q=80', 'SUDADERA BÁSICA')" data-original-image="https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=1200&amp;q=80" data-has-variant-images="true">
                                    <div class="product-badge oferta">OFERTA</div>
                                </div>
                                
                                <div class="product-info">
                                    <div class="product-category" style="color: #2563EB">
                                        <i class="fas fa-tag"></i>
                                        SUDADERA
                                    </div>
                                    
                                    <h3 class="product-title">SUDADERA BÁSICA</h3>
                                    
                                    <div class="product-price-container">
                                        
                                            <div class="sale-price-container">
                                                <div class="original-price">$250</div>
                                                <div class="sale-price" style="color: #2563EB">$200</div>
                                                <div class="discount-badge">OFERTA</div>
                                            </div>
                                        
                                    </div>
                                    
                                    <p class="product-description">
                                        La Sudadera esencial perfecta para cualquier ocasión. Fabricada con algodón egipcio de la más alta calidad.
                                    </p>
                                    
                                    
                                        <div class="product-features">
                                            
                                                <div class="feature">
                                                    <i class="fas fa-check" style="color: #2563EB"></i>
                                                    <span>100% algodón egipcio</span>
                                                </div>
                                            
                                                <div class="feature">
                                                    <i class="fas fa-check" style="color: #2563EB"></i>
                                                    <span>Corte regular</span>
                                                </div>
                                            
                                                <div class="feature">
                                                    <i class="fas fa-check" style="color: #2563EB"></i>
                                                    <span>Cuello redondo reforzado</span>
                                                </div>
                                            
                                        </div>
                                    
                                    
                                    
                        <div class="variant-selector" data-variant-name="Talla">
                            <div class="variant-label">Talla:</div>
                            <div class="variant-options">
                                
                                    <button class="variant-btn" data-value="32" style="border-color: #2563EB" onclick="carrito.selectVariant(this, 'Talla', true)">
                                        32
                                    </button>
                                
                                    <button class="variant-btn" data-value="30" style="border-color: #2563EB" onclick="carrito.selectVariant(this, 'Talla', true)">
                                        30
                                    </button>
                                
                                    <button class="variant-btn" data-value="34" style="border-color: #2563EB" onclick="carrito.selectVariant(this, 'Talla', true)">
                                        34
                                    </button>
                                
                            </div>
                        </div>
                    
                        <div class="variant-selector" data-variant-name="Color">
                            <div class="variant-label">Color:</div>
                            <div class="variant-options">
                                
                                    <button class="variant-btn" data-value="Negro" style="border-color: #2563EB" onclick="carrito.selectVariant(this, 'Color', true)">
                                        Negro
                                    </button>
                                
                                    <button class="variant-btn" data-value="Azul" style="border-color: #2563EB" onclick="carrito.selectVariant(this, 'Color', true)">
                                        Azul
                                    </button>
                                
                                    <button class="variant-btn" data-value="Rosa" style="border-color: #2563EB" onclick="carrito.selectVariant(this, 'Color', true)">
                                        Rosa
                                    </button>
                                
                            </div>
                        </div>
                    
                                    
                                    <div class="product-actions">
                                        <button class="add-to-cart-btn" data-product-id="1" style="background: linear-gradient(135deg, #2563EB, #1d4fbc);" onclick="carrito.handleAddToCart(1)">
                                            <i class="fas fa-shopping-cart"></i>
                                            AGREGAR AL CARRITO
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
            </div>
        </section>

        <!-- Modal de checkout -->
        <div class="checkout-modal" id="checkoutModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>
                        <i class="fas fa-truck"></i>
                        Información de Entrega y Pago
                    </h3>
                    <button class="close-modal" id="closeModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="checkoutForm">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-user"></i> Nombre completo:
                        </label>
                        <input type="text" id="customerName" class="form-input" required="" placeholder="Ingresa tu nombre completo">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-phone"></i> Teléfono:
                        </label>
                        <input type="tel" id="customerPhone" class="form-input" required="" placeholder="Ingresa tu número de teléfono">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-clock"></i> Horario de entrega:
                        </label>
                        <select id="deliveryTime" class="form-select" required="">
                            <option value="">Selecciona un horario</option>
                            <option value="12:00">12:00 PM</option>
                            <option value="19:00">7:00 PM</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-map-marker-alt"></i> Punto de entrega:
                        </label>
                        <div class="delivery-options">
                            <label class="delivery-option" id="deliveryOption1">
                                <input type="radio" name="delivery" value="xhala" style="display: none;">
                                <div class="delivery-info">
                                    <div class="delivery-name">San Sebastián Xhala</div>
                                    <div class="delivery-address">San Sebastián, enfrente de la universidad</div>
                                    <a href="https://maps.app.goo.gl/nKi4gyiDY1KikZPQ6" target="_blank" class="map-link">
                                        <i class="fas fa-map-marker-alt"></i> Ver en Google Maps
                                    </a>
                                </div>
                            </label>
                            
                            <label class="delivery-option selected" id="deliveryOption2">
                                <input type="radio" name="delivery" value="socorro" style="display: none;">
                                <div class="delivery-info">
                                    <div class="delivery-name">El Socorro</div>
                                    <div class="delivery-address">Colonia El Socorro, en los Arcos en frente del oxxo</div>
                                    <a href="https://maps.app.goo.gl/BYYZWmaa9TbtjWvD8" target="_blank" class="map-link">
                                        <i class="fas fa-map-marker-alt"></i> Ver en Google Maps
                                    </a>
                                </div>
                            </label>
                            
                            <label class="delivery-option" id="deliveryOption3">
                                <input type="radio" name="delivery" value="mateo" style="display: none;">
                                <div class="delivery-info">
                                    <div class="delivery-name">San Mateo</div>
                                    <div class="delivery-address">San Mateo, en frente de la iglesia</div>
                                    <a href="https://maps.app.goo.gl/q1KoquLtgrTEnuCo6" target="_blank" class="map-link">
                                        <i class="fas fa-map-marker-alt"></i> Ver en Google Maps
                                    </a>
                                </div>
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-credit-card"></i> Método de pago:
                        </label>
                        <div class="payment-options">
                            <label class="payment-option selected" id="paymentOption1">
                                <input type="radio" name="payment" value="efectivo" style="display: none;">
                                <i class="fas fa-money-bill-wave"></i> Efectivo
                            </label>
                            
                            <label class="payment-option" id="paymentOption2">
                                <input type="radio" name="payment" value="transferencia" style="display: none;">
                                <i class="fas fa-university"></i> Transferencia
                            </label>
                        </div>
                        
                        <div class="transfer-info" id="transferInfo">
                            <div style="font-weight: 600; color: var(--primary); margin-bottom: 6px; font-size: 0.85rem;">
                                <i class="fas fa-info-circle"></i> Datos para transferencia:
                            </div>
                            <div class="transfer-details">
                                <div class="transfer-row">
                                    <span class="transfer-label">Nombre:</span>
                                    <span class="transfer-value">Saul Flores</span>
                                </div>
                                <div class="transfer-row">
                                    <span class="transfer-label">Banco:</span>
                                    <span class="transfer-value">STP</span>
                                </div>
                                <div class="transfer-row">
                                    <span class="transfer-label">CLABE:</span>
                                    <span class="transfer-value">721180100001101243</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" id="cancelCheckout">
                            Cancelar
                        </button>
                        <button type="submit" class="btn-primary" id="confirmCheckout">
                            <i class="fab fa-whatsapp"></i>
                            Enviar pedido por WhatsApp
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Carrito - NUEVO DISEÑO -->
        <div class="cart-icon" id="cartIcon">
            <i class="fas fa-shopping-bag"></i>
            <div class="cart-count" id="cartCount">1</div>
        </div>

        <div class="cart-overlay" id="cartOverlay"></div>
        
        <div class="cart-panel" id="cartPanel">
            <div class="cart-header">
                <h2 class="cart-title">
                    <i class="fas fa-shopping-bag"></i>
                    Tu Carrito
                </h2>
                <button class="close-cart" id="closeCart">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="cart-content">
                <!-- Cupón aplicado -->
                <div class="applied-coupon" id="appliedCoupon">
                    <div class="applied-coupon-header">
                        <div class="applied-coupon-code">
                            <i class="fas fa-ticket-alt"></i>
                            <span id="appliedCouponCode">VERANO20</span>
                        </div>
                        <button class="remove-coupon" id="removeCouponBtn">
                            <i class="fas fa-times"></i>
                            Eliminar
                        </button>
                    </div>
                    <div class="applied-coupon-details" id="appliedCouponDetails">20% de descuento</div>
                </div>
                
                <div class="free-shipping-promo show" id="freeShippingPromo" style="display: block;">
                    <i class="fas fa-shipping-fast"></i>
                    <div class="promo-text">¡Falta poco para envío gratis!</div>
                    <div class="promo-subtext">Agrega <span id="remainingAmount">$100.00</span> más a tu carrito</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="shippingProgress" style="width: 66.6667%;"></div>
                    </div>
                </div>
                
                <div class="cart-items" id="cartItems">
                            <div class="cart-item">
                                <img src="https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=1200&amp;q=80" alt="SUDADERA BÁSICA" class="cart-item-image" onclick="carrito.openImageModal('https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&amp;auto=format&amp;fit=crop&amp;w=1200&amp;q=80', 'SUDADERA BÁSICA')">
                                <div class="cart-item-details">
                                    <div class="cart-item-info">
                                        <div class="cart-item-title">SUDADERA BÁSICA</div>
                                        <div class="cart-item-variant">
                                            <i class="fas fa-tag"></i>
                                            Talla: 32 | Color: Negro
                                        </div>
                                        <div class="cart-item-price">$200</div>
                                    </div>
                                    
                                    <div class="cart-item-actions">
                                        <div class="quantity-control">
                                            <button class="quantity-btn" onclick="carrito.updateQuantity(0, -1)" disabled="">
                                                <i class="fas fa-minus"></i>
                                            </button>
                                            <span class="quantity-value">1</span>
                                            <button class="quantity-btn" onclick="carrito.updateQuantity(0, 1)">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                        <button class="remove-item" onclick="carrito.removeItem(0)">
                                            <i class="fas fa-trash"></i>
                                            Eliminar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                
                <div class="empty-cart" id="emptyCart" style="display: none;">
                    <i class="fas fa-shopping-bag"></i>
                    <h3>Tu carrito está vacío</h3>
                    <p>Agrega algunos productos para comenzar</p>
                    <a href="#productos" class="continue-shopping" onclick="carrito.closeCart()">
                        <i class="fas fa-store"></i>
                        Continuar comprando
                    </a>
                </div>
                
                <div class="cart-summary show" id="cartSummary" style="display: block;">
                    <div class="summary-title">
                        <i class="fas fa-receipt"></i>
                        Resumen del Pedido
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">
                            <i class="fas fa-box"></i>
                            Subtotal
                        </span>
                        <span class="summary-value" id="subtotal">$200.00</span>
                    </div>
                    
                    <!-- Descuento por cupón -->
                    <div class="summary-row" id="couponDiscountRow" style="display: none;">
                        <span class="summary-label">
                            <i class="fas fa-ticket-alt"></i>
                            Descuento por cupón
                        </span>
                        <span class="summary-value" id="couponDiscount">-$0.00</span>
                    </div>
                    
                    <div class="summary-row">
                        <span class="summary-label">
                            <i class="fas fa-truck"></i>
                            Envío
                        </span>
                        <span class="summary-value" id="shipping">$50.00</span>
                    </div>
                    <div class="summary-total">
                        <span class="total-label">
                            <i class="fas fa-calculator"></i>
                            Total
                        </span>
                        <span class="total-amount" id="total">$250.00</span>
                    </div>
                    
                    <!-- Botón para aplicar cupón -->
                    <button class="apply-coupon-btn-small" id="openCouponModalBtn">
                        <i class="fas fa-ticket-alt"></i>
                        ¿Tienes un cupón?
                    </button>
                </div>
            </div>
            
            <div class="cart-actions" id="cartActions">
                <button class="checkout-btn" id="checkoutBtn">
                    <i class="fab fa-whatsapp"></i>
                    Finalizar Compra
                </button>
                <button class="clear-cart-btn" id="clearCartBtn">
                    <i class="fas fa-trash"></i>
                    Vaciar Carrito
                </button>
            </div>
        </div>

        <!-- Footer -->
        <footer class="main-footer" id="contacto">
            <div class="container">
                <div class="footer-content">
                    <div class="footer-section">
                        <h3>ModaStyle</h3>
                        <p style="font-size: 0.8rem; line-height: 1.4;">Tienda de ropa, accesorios y artículos para el hogar con las últimas tendencias en moda, estilo y decoración. Calidad en cada producto.</p>
                    </div>
                    
                    <div class="footer-section">
                        <h3>Enlaces rápidos</h3>
                        <ul class="footer-links">
                            <li><a href="#inicio"><i class="fas fa-chevron-right"></i> Inicio</a></li>
                            <li><a href="#categorias"><i class="fas fa-chevron-right"></i> Categorías</a></li>
                            <li><a href="#productos"><i class="fas fa-chevron-right"></i> Productos</a></li>
                            <li><a href="#contacto"><i class="fas fa-chevron-right"></i> Contacto</a></li>
                        </ul>
                    </div>
                    
                    <div class="footer-section">
                        <h3>Contacto</h3>
                        <ul class="footer-links">
                            <li><a href="#"><i class="fas fa-phone"></i> (55) 1234-5678</a></li>
                            <li><a href="#"><i class="fas fa-envelope"></i> info@modastyle.com</a></li>
                            <li><a href="#"><i class="fas fa-map-marker-alt"></i> Ciudad de México</a></li>
                        </ul>
                    </div>
                </div>
                
                <div class="copyright">
                    © 2024 ModaStyle - Tienda de Ropa, Accesorios y Hogar. Todos los derechos reservados.
                </div>
            </div>
        </footer>

        <script>
            // ==================== DATOS INICIALES ====================
            // Versión actual
            const CURRENT_VERSION = '2.5.0';

            // Configuración del banner de ofertas relámpago
            let flashSaleConfig = {
  "enabled": true,
  "title": "¡OFERTA RELÁMPAGO!",
  "description": "Hasta 50% de descuento en productos seleccionados",
  "startDate": "2026-02-10T23:30",
  "endDate": "2026-02-11T23:30",
  "products": [],
  "buttonText": "VER ARTICULOS"
};

            // Datos de productos iniciales con nuevo sistema de variantes
            let productos = [
  {
    "id": 1,
    "nombre": "SUDADERA BÁSICA",
    "precioRegular": "$250",
    "precioDescuento": "$200",
    "imagen": "https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
    "categoria": "hombre",
    "subcategoria": "SUDADERA",
    "descripcion": "La Sudadera esencial perfecta para cualquier ocasión. Fabricada con algodón egipcio de la más alta calidad.",
    "estado": "oferta",
    "especificaciones": [
      "100% algodón egipcio",
      "Corte regular",
      "Cuello redondo reforzado"
    ],
    "variantes": [
      {
        "nombre": "Talla",
        "tipo": "select",
        "opciones": [
          "32",
          "30",
          "34"
        ],
        "required": true
      },
      {
        "nombre": "Color",
        "tipo": "select",
        "opciones": [
          "Negro",
          "Azul",
          "Rosa"
        ],
        "required": true
      }
    ],
    "stock": {
      "32|Negro": 5,
      "32|Azul": 3,
      "32|Rosa": 2,
      "30|Negro": 4,
      "30|Azul": 3,
      "30|Rosa": 1,
      "34|Negro": 6,
      "34|Azul": 4,
      "34|Rosa": 3
    },
    "imagenesPorVariante": {
      "Negro": "https://ejemplo.com/imagen-negra.jpg",
      "Azul": "https://ejemplo.com/imagen-azul.jpg",
      "Rosa": "https://ejemplo.com/imagen-rosa.jpg"
    }
  }
];

            // Categorías iniciales
            let categorias = [
  {
    "id": "todo",
    "nombre": "TODO",
    "color": "#D4AF37",
    "icono": "fa-tags",
    "orden": 0
  },
  {
    "id": "hombre",
    "nombre": "Hombre",
    "color": "#2563EB",
    "icono": "fa-user-tie",
    "orden": 1
  },
  {
    "id": "accesorios",
    "nombre": "Accesorios",
    "color": "#7C3AED",
    "icono": "fa-briefcase",
    "orden": 2
  },
  {
    "id": "mujer",
    "nombre": "Mujer",
    "color": "#DB2777",
    "icono": "fa-female",
    "orden": 3
  },
  {
    "id": "kids",
    "nombre": "Kids",
    "color": "#059669",
    "icono": "fa-child",
    "orden": 4
  }
];

            // Categorías de la sección "Nuestras Categorías"
            let sectionCategories = [
  {
    "id": 1,
    "name": "Hombre",
    "description": "Ropa y accesorios para hombres modernos",
    "image": "https://images.unsplash.com/photo-1556821840-3a63f95609a7?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
    "buttonColor": "#2563EB",
    "action": "carrito.filterProducts('hombre')",
    "order": 1
  },
  {
    "id": 2,
    "name": "Mujer",
    "description": "Moda femenina para todos los estilos",
    "image": "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
    "buttonColor": "#DB2777",
    "action": "carrito.filterProducts('mujer')",
    "order": 2
  },
  {
    "id": 3,
    "name": "Kids",
    "description": "Ropa divertida para los más pequeños",
    "image": "https://images.unsplash.com/photo-1584917865442-de89df76afd3?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
    "buttonColor": "#059669",
    "action": "carrito.filterProducts('kids')",
    "order": 3
  },
  {
    "id": 4,
    "name": "Accesorios",
    "description": "Complementos para completar tu look",
    "image": "https://images.unsplash.com/photo-1595777457583-95e059d581b8?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
    "buttonColor": "#7C3AED",
    "action": "carrito.filterProducts('accesorios')",
    "order": 4
  }
];

            // Configuración de la sección
            let sectionConfig = {
  "title": "Nuestras Categorías",
  "subtitle": "Explora nuestra variedad de productos organizados por categorías"
};

            // ==================== SISTEMA DE CUPONES ====================
            let cupones = [
  {
    "id": 2,
    "codigo": "ENVIOGRATIS",
    "tipo": "free_shipping",
    "valor": 0,
    "descripcion": "Envío gratis en cualquier compra",
    "fechaInicio": "2024-01-01",
    "fechaFin": "2024-12-31",
    "usosPorCliente": 1,
    "usosMaximos": 50,
    "usosActuales": 0,
    "montoMinimo": 0,
    "productosAplicables": [],
    "activo": true
  },
  {
    "id": 3,
    "codigo": "2X1MODA",
    "tipo": "bogo_2x1",
    "valor": 0,
    "descripcion": "Llévate 2 productos y paga solo 1 (el de menor precio)",
    "fechaInicio": "2024-01-01",
    "fechaFin": "2024-12-31",
    "usosPorCliente": 1,
    "usosMaximos": 30,
    "usosActuales": 0,
    "montoMinimo": 500,
    "productosAplicables": [
      1
    ],
    "activo": true
  },
  {
    "id": 4,
    "codigo": "3X2STYLE",
    "tipo": "bogo_3x2",
    "valor": 0,
    "descripcion": "Llévate 3 productos y paga solo 2 (los de menor precio)",
    "fechaInicio": "2024-01-01",
    "fechaFin": "2024-12-31",
    "usosPorCliente": 1,
    "usosMaximos": 20,
    "usosActuales": 0,
    "montoMinimo": 800,
    "productosAplicables": [
      1
    ],
    "activo": true
  },
  {
    "id": 5,
    "codigo": "SAUL123456",
    "tipo": "percentage",
    "valor": 20,
    "descripcion": "DESCUENTO",
    "fechaInicio": "2026-02-10",
    "fechaFin": "2026-03-11",
    "usosPorCliente": 1,
    "usosMaximos": 1,
    "usosActuales": 0,
    "montoMinimo": 1,
    "productosAplicables": [],
    "activo": true
  }
];

            // ==================== SISTEMA DE OFERTAS RELÁMPAGO ====================
            class FlashSaleManager {
                constructor() {
                    this.timerInterval = null;
                    this.bannerVisible = false;
                    this.init();
                }
                
                init() {
                    this.loadConfig();
                    this.setupEventListeners();
                    this.checkAndShowBanner();
                }
                
                loadConfig() {
                    const savedConfig = localStorage.getItem('modastyle_flash_sale');
                    if (savedConfig) {
                        flashSaleConfig = JSON.parse(savedConfig);
                    }
                }
                
                saveConfig() {
                    localStorage.setItem('modastyle_flash_sale', JSON.stringify(flashSaleConfig));
                }
                
                setupEventListeners() {
                    // Botón de cierre del banner
                    document.getElementById('closeFlashBanner')?.addEventListener('click', () => {
                        this.hideBanner();
                    });
                    
                    // Botón de ver ofertas
                    document.getElementById('flashSaleBtn')?.addEventListener('click', () => {
                        this.filterFlashSaleProducts();
                    });
                }
                
                checkAndShowBanner() {
                    if (!flashSaleConfig.enabled) {
                        this.hideBanner();
                        return;
                    }
                    
                    const now = new Date();
                    const startDate = flashSaleConfig.startDate ? new Date(flashSaleConfig.startDate) : null;
                    const endDate = flashSaleConfig.endDate ? new Date(flashSaleConfig.endDate) : null;
                    
                    // Verificar si estamos dentro del rango de fechas
                    let shouldShow = true;
                    
                    if (startDate && now < startDate) {
                        shouldShow = false;
                    }
                    
                    if (endDate && now > endDate) {
                        shouldShow = false;
                        // Si la oferta expiró, desactivarla
                        flashSaleConfig.enabled = false;
                        this.saveConfig();
                    }
                    
                    if (shouldShow) {
                        this.showBanner();
                        this.updateBannerContent();
                        this.startTimer();
                        this.updateFlashSaleProducts();
                    } else {
                        this.hideBanner();
                    }
                }
                
                showBanner() {
                    const banner = document.getElementById('flashSaleBanner');
                    if (banner) {
                        banner.style.display = 'block';
                        this.bannerVisible = true;
                        
                        // Ajustar padding del hero section
                        document.querySelector('.hero-section').style.paddingTop = '120px';
                    }
                }
                
                hideBanner() {
                    const banner = document.getElementById('flashSaleBanner');
                    if (banner) {
                        banner.style.display = 'none';
                        this.bannerVisible = false;
                        
                        // Restaurar padding del hero section
                        document.querySelector('.hero-section').style.paddingTop = '80px';
                        
                        // Detener el timer
                        this.stopTimer();
                    }
                }
                
                updateBannerContent() {
                    document.getElementById('flashSaleTitle').textContent = flashSaleConfig.title;
                    document.getElementById('flashSaleDescription').textContent = flashSaleConfig.description;
                    document.getElementById('flashSaleBtn').innerHTML = `<i class="fas fa-shopping-bag"></i> ${flashSaleConfig.buttonText}`;
                    
                    // Actualizar vista previa en admin
                    document.getElementById('previewFlashSaleTitle').textContent = flashSaleConfig.title;
                    document.getElementById('previewFlashSaleDescription').textContent = flashSaleConfig.description;
                }
                
                updateFlashSaleProducts() {
                    const container = document.querySelector('.flash-sale-products');
                    if (!container) return;
                    
                    let productsToShow = productos;
                    
                    // Si hay productos específicos configurados
                    if (flashSaleConfig.products && flashSaleConfig.products.length > 0) {
                        productsToShow = productos.filter(p => flashSaleConfig.products.includes(p.id));
                    } else {
                        // Mostrar productos con estado "oferta"
                        productsToShow = productos.filter(p => p.estado === 'oferta');
                    }
                    
                    // Limitar a 3 productos para mostrar en el banner
                    productsToShow = productsToShow.slice(0, 3);
                    
                    if (productsToShow.length === 0) {
                        container.style.display = 'none';
                        return;
                    }
                    
                    container.innerHTML = productsToShow.map(product => `
                        <div class="flash-product-preview" onclick="carrito.filterFlashSaleProducts(); carrito.scrollToProduct(${product.id})">
                            <img src="${product.imagen}" alt="${product.nombre}">
                        </div>
                    `).join('');
                    
                    container.style.display = 'flex';
                }
                
                startTimer() {
                    this.stopTimer(); // Detener cualquier timer existente
                    
                    const updateTimer = () => {
                        const now = new Date();
                        const endDate = flashSaleConfig.endDate ? new Date(flashSaleConfig.endDate) : null;
                        
                        if (!endDate || now > endDate) {
                            this.stopTimer();
                            flashSaleConfig.enabled = false;
                            this.saveConfig();
                            this.hideBanner();
                            return;
                        }
                        
                        const diff = endDate - now;
                        
                        const hours = Math.floor(diff / (1000 * 60 * 60));
                        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                        
                        document.getElementById('timerHours').textContent = hours.toString().padStart(2, '0');
                        document.getElementById('timerMinutes').textContent = minutes.toString().padStart(2, '0');
                        document.getElementById('timerSeconds').textContent = seconds.toString().padStart(2, '0');
                    };
                    
                    updateTimer();
                    this.timerInterval = setInterval(updateTimer, 1000);
                }
                
                stopTimer() {
                    if (this.timerInterval) {
                        clearInterval(this.timerInterval);
                        this.timerInterval = null;
                    }
                }
                
                filterFlashSaleProducts() {
                    if (window.carrito) {
                        window.carrito.filterFlashSaleProducts();
                    }
                }
                
                getFlashSaleProducts() {
                    if (flashSaleConfig.products && flashSaleConfig.products.length > 0) {
                        return productos.filter(p => flashSaleConfig.products.includes(p.id));
                    } else {
                        return productos.filter(p => p.estado === 'oferta');
                    }
                }
                
                isBannerVisible() {
                    return this.bannerVisible;
                }
            }

            // ==================== GESTOR DE VERSIONES ====================
            class VersionManager {
                constructor() {
                    this.checkVersion();
                }
                
                checkVersion() {
                    const savedVersion = localStorage.getItem('modastyle_version');
                    
                    if (!savedVersion || savedVersion !== CURRENT_VERSION) {
                        // Actualizar datos
                        localStorage.setItem('modastyle_productos', JSON.stringify(productos));
                        localStorage.setItem('modastyle_categorias', JSON.stringify(categorias));
                        localStorage.setItem('modastyle_section_categories', JSON.stringify(sectionCategories));
                        localStorage.setItem('modastyle_section_config', JSON.stringify(sectionConfig));
                        localStorage.setItem('modastyle_cupones', JSON.stringify(cupones));
                        localStorage.setItem('modastyle_flash_sale', JSON.stringify(flashSaleConfig));
                        localStorage.setItem('modastyle_version', CURRENT_VERSION);
                        console.log('Datos actualizados a versión', CURRENT_VERSION);
                    } else {
                        // Cargar datos guardados
                        const productosGuardados = localStorage.getItem('modastyle_productos');
                        const categoriasGuardadas = localStorage.getItem('modastyle_categorias');
                        const sectionCategoriesGuardadas = localStorage.getItem('modastyle_section_categories');
                        const sectionConfigGuardada = localStorage.getItem('modastyle_section_config');
                        const cuponesGuardados = localStorage.getItem('modastyle_cupones');
                        const flashSaleConfigGuardada = localStorage.getItem('modastyle_flash_sale');
                        
                        if (productosGuardados) {
                            try {
                                productos = JSON.parse(productosGuardados);
                            } catch (e) {
                                console.error('Error al cargar productos:', e);
                            }
                        }
                        
                        if (categoriasGuardadas) {
                            try {
                                categorias = JSON.parse(categoriasGuardadas);
                            } catch (e) {
                                console.error('Error al cargar categorías:', e);
                            }
                        }
                        
                        if (sectionCategoriesGuardadas) {
                            try {
                                sectionCategories = JSON.parse(sectionCategoriesGuardadas);
                            } catch (e) {
                                console.error('Error al cargar categorías de sección:', e);
                            }
                        }
                        
                        if (sectionConfigGuardada) {
                            try {
                                sectionConfig = JSON.parse(sectionConfigGuardada);
                            } catch (e) {
                                console.error('Error al cargar configuración de sección:', e);
                            }
                        }
                        
                        if (cuponesGuardados) {
                            try {
                                cupones = JSON.parse(cuponesGuardados);
                            } catch (e) {
                                console.error('Error al cargar cupones:', e);
                            }
                        }
                        
                        if (flashSaleConfigGuardada) {
                            try {
                                flashSaleConfig = JSON.parse(flashSaleConfigGuardada);
                            } catch (e) {
                                console.error('Error al cargar configuración de ofertas relámpago:', e);
                            }
                        }
                    }
                }
            }

            // ==================== SISTEMA DE BÚSQUEDA ====================
            class Buscador {
                constructor() {
                    this.searchTimeout = null;
                    this.currentSearch = '';
                    this.isSearching = false;
                    
                    this.init();
                }
                
                init() {
                    this.setupEventListeners();
                }
                
                setupEventListeners() {
                    // Buscador del header
                    const searchInput = document.getElementById('searchInput');
                    const clearSearch = document.getElementById('clearSearch');
                    const searchResults = document.getElementById('searchResults');
                    
                    if (searchInput) {
                        searchInput.addEventListener('input', (e) => {
                            this.handleSearchInput(e.target.value, 'header');
                        });
                        
                        searchInput.addEventListener('focus', () => {
                            if (searchInput.value.trim()) {
                                this.showSearchResults(searchInput.value, 'header');
                            }
                        });
                    }
                    
                    if (clearSearch) {
                        clearSearch.addEventListener('click', () => {
                            this.clearSearch('header');
                        });
                    }
                    
                    // Cerrar resultados al hacer clic fuera
                    document.addEventListener('click', (e) => {
                        if (!e.target.closest('.search-container')) {
                            searchResults.classList.remove('active');
                        }
                    });
                    
                    // Tecla Escape para cerrar resultados
                    document.addEventListener('keydown', (e) => {
                        if (e.key === 'Escape') {
                            searchResults.classList.remove('active');
                            searchInput.blur();
                        }
                    });
                }
                
                handleSearchInput(query, type) {
                    clearTimeout(this.searchTimeout);
                    
                    query = query.trim();
                    
                    // Mostrar/ocultar botón de limpiar
                    if (type === 'header') {
                        const clearBtn = document.getElementById('clearSearch');
                        if (clearBtn) {
                            clearBtn.classList.toggle('active', query.length > 0);
                        }
                    }
                    
                    if (query.length < 2) {
                        if (type === 'header') {
                            document.getElementById('searchResults').classList.remove('active');
                        } else if (type === 'products') {
                            // Si la búsqueda en productos está vacía, restaurar filtro actual
                            if (window.carrito) {
                                window.carrito.renderProducts();
                            }
                        }
                        return;
                    }
                    
                    this.searchTimeout = setTimeout(() => {
                        if (type === 'header') {
                            this.showSearchResults(query, type);
                        } else if (type === 'products') {
                            this.filterProductsBySearch(query);
                        }
                    }, 300);
                }
                
                showSearchResults(query, type) {
                    const searchResults = document.getElementById('searchResults');
                    const results = this.searchProducts(query, 10); // Límite de 10 resultados
                    
                    if (results.length === 0) {
                        searchResults.innerHTML = `
                            <div class="search-no-results">
                                <i class="fas fa-search"></i>
                                <p>No se encontraron productos</p>
                                <p style="font-size: 0.7rem; margin-top: 5px;">Intenta con otros términos</p>
                            </div>
                        `;
                    } else {
                        searchResults.innerHTML = results.map(product => {
                            const precio = product.precioDescuento || product.precioRegular;
                            const categoria = categorias.find(c => c.id === product.categoria);
                            
                            return `
                                <div class="search-result-item" onclick="buscador.selectSearchResult(${product.id})">
                                    <img src="${product.imagen}" alt="${product.nombre}" class="search-result-image">
                                    <div class="search-result-info">
                                        <div class="search-result-name">${product.nombre}</div>
                                        <div class="search-result-category">
                                            <i class="fas fa-tag"></i>
                                            ${categoria ? categoria.nombre : product.categoria}
                                        </div>
                                    </div>
                                    <div class="search-result-price">${precio}</div>
                                </div>
                            `;
                        }).join('');
                    }
                    
                    searchResults.classList.add('active');
                    
                    // Hacer scroll a la sección de productos si estábamos en otra sección
                    if (window.carrito && window.carrito.currentFilter !== 'todo') {
                        window.carrito.filterProducts('todo');
                    }
                    document.getElementById('productos').scrollIntoView({ behavior: 'smooth' });
                }
                
                searchProducts(query, limit = null) {
                    query = query.toLowerCase().trim();
                    
                    if (!query) return [];
                    
                    const results = productos.filter(product => {
                        // Buscar en nombre
                        if (product.nombre.toLowerCase().includes(query)) {
                            return true;
                        }
                        
                        // Buscar en descripción
                        if (product.descripcion.toLowerCase().includes(query)) {
                            return true;
                        }
                        
                        // Buscar en subcategoría
                        if (product.subcategoria.toLowerCase().includes(query)) {
                            return true;
                        }
                        
                        // Buscar en especificaciones
                        if (product.especificaciones && product.especificaciones.some(spec => 
                            spec.toLowerCase().includes(query))) {
                            return true;
                        }
                        
                        // Buscar en nombre de categoría
                        const categoria = categorias.find(c => c.id === product.categoria);
                        if (categoria && categoria.nombre.toLowerCase().includes(query)) {
                            return true;
                        }
                        
                        return false;
                    });
                    
                    // Ordenar por relevancia (nombre primero)
                    results.sort((a, b) => {
                        const aInName = a.nombre.toLowerCase().includes(query);
                        const bInName = b.nombre.toLowerCase().includes(query);
                        
                        if (aInName && !bInName) return -1;
                        if (!aInName && bInName) return 1;
                        
                        // Si ambos están en el nombre, ordenar alfabéticamente
                        return a.nombre.localeCompare(b.nombre);
                    });
                    
                    return limit ? results.slice(0, limit) : results;
                }
                
                filterProductsBySearch(query) {
                    this.currentSearch = query;
                    this.isSearching = true;
                    
                    if (!window.carrito) return;
                    
                    const results = this.searchProducts(query);
                    const filteredProducts = query ? results : productos;
                    
                    // Actualizar el grid de productos
                    this.renderFilteredProducts(filteredProducts);
                    
                    // Actualizar mensaje de resultados
                    this.updateSearchResultsMessage(query, results.length);
                }
                
                renderFilteredProducts(filteredProducts) {
                    const productsGrid = document.getElementById('productsGrid');
                    
                    if (filteredProducts.length === 0) {
                        productsGrid.innerHTML = `
                            <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--text-light);">
                                <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.3;"></i>
                                <h3>No se encontraron productos</h3>
                                <p>Prueba con otros términos de búsqueda</p>
                                <button onclick="buscador.clearSearch('header')" style="margin-top: 15px; padding: 8px 16px; background: var(--accent); color: white; border: none; border-radius: var(--border-radius-sm); cursor: pointer;">
                                    <i class="fas fa-times"></i> Limpiar búsqueda
                                </button>
                            </div>
                        `;
                        return;
                    }
                    
                    productsGrid.innerHTML = filteredProducts.map((product, index) => {
                        const precio = product.precioDescuento || product.precioRegular;
                        const precioNum = parseFloat(precio.replace('$', ''));
                        const categoria = categorias.find(c => c.id === product.categoria);
                        const colorCategoria = categoria ? categoria.color : 'var(--accent)';
                        
                        return `
                            <div class="product-card" data-product-id="${product.id}" style="animation-delay: ${index * 0.05}s">
                                <div class="product-image-container">
                                    <img src="${product.imagen}" alt="${product.nombre}" class="product-image" 
                                         onclick="carrito.openImageModal('${product.imagen}', '${product.nombre}')"
                                         data-original-image="${product.imagen}"
                                         ${product.imagenesPorVariante ? 'data-has-variant-images="true"' : ''}>
                                    <div class="product-badge ${product.estado}">${product.estado.toUpperCase()}</div>
                                </div>
                                
                                <div class="product-info">
                                    <div class="product-category" style="color: ${colorCategoria}">
                                        <i class="fas fa-tag"></i>
                                        ${product.subcategoria}
                                    </div>
                                    
                                    <h3 class="product-title">${product.nombre}</h3>
                                    
                                    <div class="product-price-container">
                                        ${product.precioDescuento ? `
                                            <div class="sale-price-container">
                                                <div class="original-price">${product.precioRegular}</div>
                                                <div class="sale-price" style="color: ${colorCategoria}">${product.precioDescuento}</div>
                                                <div class="discount-badge">OFERTA</div>
                                            </div>
                                        ` : `
                                            <div class="regular-price">${product.precioRegular}</div>
                                        `}
                                    </div>
                                    
                                    <p class="product-description">
                                        ${product.descripcion}
                                    </p>
                                    
                                    ${product.especificaciones && product.especificaciones.length > 0 ? `
                                        <div class="product-features">
                                            ${product.especificaciones.map(spec => `
                                                <div class="feature">
                                                    <i class="fas fa-check" style="color: ${colorCategoria}"></i>
                                                    <span>${spec}</span>
                                                </div>
                                            `).join('')}
                                        </div>
                                    ` : ''}
                                    
                                    ${window.carrito ? window.carrito.renderProductVariants(product, colorCategoria) : ''}
                                    
                                    <div class="product-actions">
                                        <button class="add-to-cart-btn" 
                                                data-product-id="${product.id}"
                                                style="background: linear-gradient(135deg, ${colorCategoria}, ${this.darkenColor(colorCategoria)});"
                                                onclick="carrito.handleAddToCart(${product.id})">
                                            <i class="fas fa-shopping-cart"></i>
                                            AGREGAR AL CARRITO
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                    
                    // Actualizar variantes y botones
                    if (window.carrito) {
                        setTimeout(() => {
                            document.querySelectorAll('.product-card').forEach(card => {
                                window.carrito.updateAddToCartButton(card);
                            });
                        }, 100);
                    }
                }
                
                updateSearchResultsMessage(query, count) {
                    const sectionSubtitle = document.querySelector('#productos .section-subtitle');
                    if (sectionSubtitle) {
                        if (query) {
                            sectionSubtitle.textContent = `Encontramos ${count} producto${count !== 1 ? 's' : ''} para "${query}"`;
                            sectionSubtitle.style.color = 'var(--accent)';
                            sectionSubtitle.style.fontWeight = '600';
                        } else {
                            sectionSubtitle.textContent = 'Explora nuestra colección completa de productos';
                            sectionSubtitle.style.color = '';
                            sectionSubtitle.style.fontWeight = '';
                        }
                    }
                }
                
                selectSearchResult(productId) {
                    // Cerrar resultados
                    document.getElementById('searchResults').classList.remove('active');
                    
                    // Limpiar búsqueda del header
                    this.clearSearch('header');
                    
                    // Filtrar solo ese producto
                    const product = productos.find(p => p.id === productId);
                    if (product && window.carrito) {
                        // Cambiar a categoría "todo" para mostrar el producto
                        window.carrito.filterProducts('todo');
                        
                        // Filtrar solo ese producto
                        this.renderFilteredProducts([product]);
                        
                        // Hacer scroll al producto
                        setTimeout(() => {
                            const productCard = document.querySelector(`.product-card[data-product-id="${productId}"]`);
                            if (productCard) {
                                productCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                
                                // Efecto de destello
                                productCard.style.animation = 'none';
                                setTimeout(() => {
                                    productCard.style.animation = '';
                                    productCard.style.boxShadow = '0 0 0 3px var(--accent)';
                                    setTimeout(() => {
                                        productCard.style.boxShadow = '';
                                    }, 1000);
                                }, 50);
                            }
                        }, 300);
                    }
                }
                
                clearSearch(type) {
                    if (type === 'header') {
                        const searchInput = document.getElementById('searchInput');
                        const clearBtn = document.getElementById('clearSearch');
                        const searchResults = document.getElementById('searchResults');
                        
                        if (searchInput) {
                            searchInput.value = '';
                            searchInput.focus();
                        }
                        
                        if (clearBtn) {
                            clearBtn.classList.remove('active');
                        }
                        
                        if (searchResults) {
                            searchResults.classList.remove('active');
                        }
                        
                        // Restaurar productos normales
                        this.currentSearch = '';
                        this.isSearching = false;
                        
                        if (window.carrito) {
                            window.carrito.renderProducts();
                            this.updateSearchResultsMessage('', productos.length);
                        }
                    }
                }
                
                darkenColor(color) {
                    // Función simple para oscurecer un color hexadecimal
                    let r = parseInt(color.slice(1, 3), 16);
                    let g = parseInt(color.slice(3, 5), 16);
                    let b = parseInt(color.slice(5, 7), 16);
                    
                    r = Math.floor(r * 0.8);
                    g = Math.floor(g * 0.8);
                    b = Math.floor(b * 0.8);
                    
                    return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
                }
                
                isActive() {
                    return this.isSearching;
                }
                
                getCurrentSearch() {
                    return this.currentSearch;
                }
            }

            // ==================== SISTEMA DE CUPONES - CLASE SEPARADA ====================
            class CuponManager {
                constructor() {
                    this.cuponAplicado = null;
                    this.usoPorCliente = JSON.parse(localStorage.getItem('cupon_usos')) || {};
                    this.init();
                }
                
                init() {
                    // Cargar cupón aplicado desde localStorage
                    const cuponGuardado = localStorage.getItem('cupon_aplicado');
                    if (cuponGuardado) {
                        this.cuponAplicado = JSON.parse(cuponGuardado);
                    }
                }
                
                // Obtener cupones disponibles para el usuario actual
                getCuponesDisponibles() {
                    const ahora = new Date();
                    return cupones.filter(cupon => {
                        // Verificar si está activo
                        if (!cupon.activo) return false;
                        
                        // Verificar fechas
                        const fechaInicio = new Date(cupon.fechaInicio);
                        const fechaFin = new Date(cupon.fechaFin);
                        fechaFin.setHours(23, 59, 59, 999); // Hasta el final del día
                        
                        if (ahora < fechaInicio || ahora > fechaFin) return false;
                        
                        // Verificar usos máximos
                        if (cupon.usosMaximos > 0 && cupon.usosActuales >= cupon.usosMaximos) {
                            return false;
                        }
                        
                        // Verificar usos por cliente
                        const usosCliente = this.usoPorCliente[cupon.id] || 0;
                        if (cupon.usosPorCliente > 0 && usosCliente >= cupon.usosPorCliente) {
                            return false;
                        }
                        
                        return true;
                    });
                }
                
                // Aplicar cupón al carrito
                aplicarCupon(codigo, carritoItems) {
                    const cupon = cupones.find(c => c.codigo.toUpperCase() === codigo.toUpperCase());
                    
                    if (!cupon) {
                        return { success: false, message: 'Cupón no válido' };
                    }
                    
                    // Validar cupón
                    const validacion = this.validarCupon(cupon, carritoItems);
                    if (!validacion.success) {
                        return validacion;
                    }
                    
                    // Aplicar cupón
                    this.cuponAplicado = cupon;
                    localStorage.setItem('cupon_aplicado', JSON.stringify(cupon));
                    
                    // Incrementar contador de usos
                    cupon.usosActuales = (cupon.usosActuales || 0) + 1;
                    this.usoPorCliente[cupon.id] = (this.usoPorCliente[cupon.id] || 0) + 1;
                    localStorage.setItem('cupon_usos', JSON.stringify(this.usoPorCliente));
                    localStorage.setItem('modastyle_cupones', JSON.stringify(cupones));
                    
                    return { success: true, cupon: cupon };
                }
                
                // Validar cupón antes de aplicar
                validarCupon(cupon, carritoItems) {
                    const ahora = new Date();
                    const fechaInicio = new Date(cupon.fechaInicio);
                    const fechaFin = new Date(cupon.fechaFin);
                    fechaFin.setHours(23, 59, 59, 999);
                    
                    // Verificar si está activo
                    if (!cupon.activo) {
                        return { success: false, message: 'Cupón no disponible' };
                    }
                    
                    // Verificar fechas
                    if (ahora < fechaInicio) {
                        return { success: false, message: 'Cupón aún no está disponible' };
                    }
                    
                    if (ahora > fechaFin) {
                        return { success: false, message: 'Cupón ha expirado' };
                    }
                    
                    // Verificar usos máximos
                    if (cupon.usosMaximos > 0 && cupon.usosActuales >= cupon.usosMaximos) {
                        return { success: false, message: 'Cupón agotado' };
                    }
                    
                    // Verificar usos por cliente
                    const usosCliente = this.usoPorCliente[cupon.id] || 0;
                    if (cupon.usosPorCliente > 0 && usosCliente >= cupon.usosPorCliente) {
                        return { success: false, message: 'Ya has usado este cupón' };
                    }
                    
                    // Verificar monto mínimo del carrito
                    if (cupon.montoMinimo > 0) {
                        const subtotal = carritoItems.reduce((sum, item) => {
                            return sum + (parseFloat(item.precio.replace('$', '')) * item.cantidad);
                        }, 0);
                        
                        if (subtotal < cupon.montoMinimo) {
                            return { success: false, message: `Mínimo de compra: $${cupon.montoMinimo}` };
                        }
                    }
                    
                    // Verificar productos aplicables para cupones BOGO
                    if ((cupon.tipo === 'bogo_2x1' || cupon.tipo === 'bogo_3x2') && cupon.productosAplicables.length > 0) {
                        const productosEnCarrito = carritoItems.filter(item => 
                            cupon.productosAplicables.includes(item.productId)
                        );
                        
                        if (productosEnCarrito.length === 0) {
                            return { success: false, message: 'Cupón no aplicable a los productos en tu carrito' };
                        }
                    }
                    
                    return { success: true };
                }
                
                // Remover cupón aplicado
                removerCupon() {
                    this.cuponAplicado = null;
                    localStorage.removeItem('cupon_aplicado');
                    return { success: true };
                }
                
                // Calcular descuento del cupón
                calcularDescuento(carritoItems, subtotal) {
                    if (!this.cuponAplicado) {
                        return { descuento: 0, tipo: null, detalles: null };
                    }
                    
                    const cupon = this.cuponAplicado;
                    
                    switch (cupon.tipo) {
                        case 'percentage':
                            const descuentoPorcentaje = (subtotal * cupon.valor) / 100;
                            return {
                                descuento: descuentoPorcentaje,
                                tipo: 'percentage',
                                detalles: `${cupon.valor}% de descuento`
                            };
                            
                        case 'free_shipping':
                            return {
                                descuento: 0,
                                tipo: 'free_shipping',
                                detalles: 'Envío gratis'
                            };
                            
                        case 'bogo_2x1':
                            return this.calcularDescuentoBOGO(carritoItems, 2, 1);
                            
                        case 'bogo_3x2':
                            return this.calcularDescuentoBOGO(carritoItems, 3, 2);
                            
                        default:
                            return { descuento: 0, tipo: null, detalles: null };
                    }
                }
                
                // Calcular descuento para cupones BOGO (Buy One Get One)
                calcularDescuentoBOGO(carritoItems, totalPagar, totalLlevar) {
                    const cupon = this.cuponAplicado;
                    
                    // Filtrar productos aplicables al cupón
                    let productosAplicables = carritoItems;
                    if (cupon.productosAplicables && cupon.productosAplicables.length > 0) {
                        productosAplicables = carritoItems.filter(item => 
                            cupon.productosAplicables.includes(item.productId)
                        );
                    }
                    
                    if (productosAplicables.length === 0) {
                        return { descuento: 0, tipo: null, detalles: null };
                    }
                    
                    // Calcular cantidad total de productos aplicables
                    let cantidadTotal = 0;
                    productosAplicables.forEach(item => {
                        cantidadTotal += item.cantidad;
                    });
                    
                    // Calcular cuántos grupos completos hay
                    const gruposCompletos = Math.floor(cantidadTotal / totalPagar);
                    
                    if (gruposCompletos === 0) {
                        return { descuento: 0, tipo: null, detalles: null };
                    }
                    
                    // Ordenar productos por precio (ascendente)
                    const productosOrdenados = [...productosAplicables].sort((a, b) => {
                        const precioA = parseFloat(a.precio.replace('$', ''));
                        const precioB = parseFloat(b.precio.replace('$', ''));
                        return precioA - precioB;
                    });
                    
                    // Calcular descuento (precio de los productos gratis)
                    let descuentoTotal = 0;
                    let productosProcesados = 0;
                    
                    for (let i = 0; i < gruposCompletos; i++) {
                        // Para cada grupo, los productos más baratos son gratis
                        const productosGratis = totalPagar - totalLlevar;
                        
                        for (let j = 0; j < productosGratis; j++) {
                            if (productosProcesados < productosOrdenados.length) {
                                const producto = productosOrdenados[productosProcesados];
                                const precioProducto = parseFloat(producto.precio.replace('$', ''));
                                
                                // Ajustar si hay múltiples unidades del mismo producto
                                if (producto.cantidad > 1) {
                                    const unidadesADescontar = Math.min(producto.cantidad, productosGratis - j);
                                    descuentoTotal += precioProducto * unidadesADescontar;
                                    j += unidadesADescontar - 1;
                                    productosProcesados++;
                                } else {
                                    descuentoTotal += precioProducto;
                                    productosProcesados++;
                                }
                            }
                        }
                    }
                    
                    return {
                        descuento: descuentoTotal,
                        tipo: cupon.tipo,
                        detalles: `${totalPagar}x${totalLlevar} aplicado`
                    };
                }
                
                // Obtener cupón aplicado actualmente
                getCuponAplicado() {
                    return this.cuponAplicado;
                }
                
                // Guardar cupones en storage
                guardarCuponesEnStorage() {
                    localStorage.setItem('modastyle_cupones', JSON.stringify(cupones));
                }
            }

            // ==================== SISTEMA DE CARRITO ====================
            class Carrito {
                constructor() {
                    this.items = JSON.parse(localStorage.getItem('cartModaStyle')) || [];
                    this.currentFilter = 'todo';
                    this.FREE_SHIPPING_MINIMUM = 300;
                    this.cuponManager = new CuponManager();
                    this.flashSaleManager = new FlashSaleManager();
                    
                    // Asegurar que el scroll esté habilitado al iniciar
                    document.body.style.overflow = 'auto';
                    
                    this.init();
                }
                
                init() {
                    this.renderCartCount();
                    this.setupEventListeners();
                    this.renderProducts();
                    this.renderCategories();
                    this.renderCategoryFilters();
                    this.updateCartButtons();
                    
                    // Inicializar el gestor de versiones
                    new VersionManager();
                    
                    // Inicializar el buscador
                    window.buscador = new Buscador();
                    
                    // Actualizar la sección de categorías
                    this.updateSectionCategories();
                    
                    // Actualizar cupón si hay uno aplicado
                    this.updateAppliedCoupon();
                }
                
                setupEventListeners() {
                    // Carrito
                    document.getElementById('cartIcon').addEventListener('click', () => this.openCart());
                    document.getElementById('closeCart').addEventListener('click', () => this.closeCart());
                    document.getElementById('cartOverlay').addEventListener('click', () => this.closeCart());
                    document.getElementById('checkoutBtn').addEventListener('click', () => this.showCheckoutModal());
                    document.getElementById('clearCartBtn').addEventListener('click', () => this.clearCart());
                    
                    // Cupones
                    document.getElementById('openCouponModalBtn').addEventListener('click', () => this.showCouponModal());
                    document.getElementById('closeCouponModal').addEventListener('click', () => this.closeCouponModal());
                    document.getElementById('applyCouponBtn').addEventListener('click', () => this.applyCoupon());
                    document.getElementById('removeCouponBtn').addEventListener('click', () => this.removeCoupon());
                    document.getElementById('couponCodeInput').addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            this.applyCoupon();
                        }
                    });
                    
                    // Modal de imagen
                    document.getElementById('closeImageModal').addEventListener('click', () => this.closeImageModal());
                    document.getElementById('imageModal').addEventListener('click', (e) => {
                        if (e.target === document.getElementById('imageModal')) {
                            this.closeImageModal();
                        }
                    });
                    
                    // Modal de checkout
                    document.getElementById('closeModal').addEventListener('click', () => this.closeCheckoutModal());
                    document.getElementById('cancelCheckout').addEventListener('click', () => this.closeCheckoutModal());
                    document.getElementById('checkoutForm').addEventListener('submit', (e) => this.submitOrder(e));
                    
                    // Opciones de entrega
                    document.querySelectorAll('.delivery-option').forEach(option => {
                        option.addEventListener('click', (e) => {
                            document.querySelectorAll('.delivery-option').forEach(o => o.classList.remove('selected'));
                            e.currentTarget.classList.add('selected');
                        });
                    });
                    
                    // Opciones de pago
                    document.querySelectorAll('.payment-option').forEach(option => {
                        option.addEventListener('click', (e) => {
                            document.querySelectorAll('.payment-option').forEach(o => o.classList.remove('selected'));
                            e.currentTarget.classList.add('selected');
                            
                            const transferInfo = document.getElementById('transferInfo');
                            if (e.currentTarget.querySelector('input').value === 'transferencia') {
                                transferInfo.classList.add('show');
                            } else {
                                transferInfo.classList.remove('show');
                            }
                        });
                    });
                    
                    // Tecla Escape
                    document.addEventListener('keydown', (e) => {
                        if (e.key === 'Escape') {
                            if (document.getElementById('cartPanel').classList.contains('open')) {
                                this.closeCart();
                            }
                            if (document.getElementById('checkoutModal').classList.contains('active')) {
                                this.closeCheckoutModal();
                            }
                            if (document.getElementById('imageModal').classList.contains('active')) {
                                this.closeImageModal();
                            }
                            if (document.getElementById('couponModal').classList.contains('active')) {
                                this.closeCouponModal();
                            }
                        }
                    });
                }
                
                renderCartCount() {
                    const totalItems = this.items.reduce((sum, item) => sum + item.cantidad, 0);
                    document.getElementById('cartCount').textContent = totalItems;
                }
                
                openCart() {
                    document.getElementById('cartPanel').classList.add('open');
                    document.getElementById('cartOverlay').classList.add('show');
                    document.body.style.overflow = 'hidden';
                    this.renderCartItems();
                    this.updateAppliedCoupon();
                }
                
                closeCart() {
                    document.getElementById('cartPanel').classList.remove('open');
                    document.getElementById('cartOverlay').classList.remove('show');
                    document.body.style.overflow = 'auto';
                }
                
                renderCartItems() {
                    const cartItems = document.getElementById('cartItems');
                    const emptyCart = document.getElementById('emptyCart');
                    const cartSummary = document.getElementById('cartSummary');
                    const cartActions = document.getElementById('cartActions');
                    const freeShippingPromo = document.getElementById('freeShippingPromo');
                    const appliedCoupon = document.getElementById('appliedCoupon');
                    
                    if (this.items.length === 0) {
                        cartItems.innerHTML = '';
                        emptyCart.style.display = 'block';
                        cartSummary.style.display = 'none';
                        cartSummary.classList.remove('show');
                        cartActions.classList.add('disabled');
                        freeShippingPromo.style.display = 'none';
                        appliedCoupon.classList.remove('show');
                        return;
                    }
                    
                    emptyCart.style.display = 'none';
                    cartSummary.style.display = 'block';
                    cartSummary.classList.add('show');
                    cartActions.classList.remove('disabled');
                    
                    // Calcular subtotal primero
                    const subtotal = this.items.reduce((sum, item) => {
                        return sum + (parseFloat(item.precio.replace('$', '')) * item.cantidad);
                    }, 0);
                    
                    // MOSTRAR promoción SOLO si el subtotal es menor al mínimo PERO mayor que 0
                    if (subtotal > 0 && subtotal < this.FREE_SHIPPING_MINIMUM) {
                        const remaining = this.FREE_SHIPPING_MINIMUM - subtotal;
                        const progress = (subtotal / this.FREE_SHIPPING_MINIMUM) * 100;
                        
                        document.getElementById('remainingAmount').textContent = `$${remaining.toFixed(2)}`;
                        document.getElementById('shippingProgress').style.width = `${progress}%`;
                        freeShippingPromo.classList.add('show');
                        freeShippingPromo.style.display = 'block';
                    } else {
                        freeShippingPromo.classList.remove('show');
                        freeShippingPromo.style.display = 'none';
                    }
                    
                    // Renderizar los items del carrito
                    cartItems.innerHTML = this.items.map((item, index) => {
                        const product = productos.find(p => p.id === item.productId);
                        if (!product) return '';
                        
                        const subtotal = parseFloat(item.precio.replace('$', '')) * item.cantidad;
                        const variantesText = item.variantes.map(v => `${v.nombre}: ${v.valor}`).join(' | ');
                        
                        return `
                            <div class="cart-item">
                                <img src="${product.imagen}" alt="${product.nombre}" class="cart-item-image" onclick="carrito.openImageModal('${product.imagen}', '${product.nombre}')">
                                <div class="cart-item-details">
                                    <div class="cart-item-info">
                                        <div class="cart-item-title">${product.nombre}</div>
                                        <div class="cart-item-variant">
                                            <i class="fas fa-tag"></i>
                                            ${variantesText}
                                        </div>
                                        <div class="cart-item-price">${item.precio}</div>
                                    </div>
                                    
                                    <div class="cart-item-actions">
                                        <div class="quantity-control">
                                            <button class="quantity-btn" onclick="carrito.updateQuantity(${index}, -1)" ${item.cantidad <= 1 ? 'disabled' : ''}>
                                                <i class="fas fa-minus"></i>
                                            </button>
                                            <span class="quantity-value">${item.cantidad}</span>
                                            <button class="quantity-btn" onclick="carrito.updateQuantity(${index}, 1)">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                        <button class="remove-item" onclick="carrito.removeItem(${index})">
                                            <i class="fas fa-trash"></i>
                                            Eliminar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                    
                    this.updateCartSummary();
                }
                
                updateQuantity(index, change) {
                    const item = this.items[index];
                    const newQuantity = item.cantidad + change;
                    
                    if (newQuantity < 1) {
                        this.removeItem(index);
                        return;
                    }
                    
                    // Verificar stock
                    const product = productos.find(p => p.id === item.productId);
                    if (product) {
                        const variantKey = item.variantes.map(v => v.valor).join('|');
                        const stock = product.stock[variantKey] || 0;
                        
                        if (newQuantity > stock) {
                            alert(`Solo hay ${stock} unidades disponibles`);
                            return;
                        }
                    }
                    
                    item.cantidad = newQuantity;
                    this.saveCart();
                    this.renderCartItems();
                    this.renderCartCount();
                    this.updateCartButtons();
                }
                
                removeItem(index) {
                    this.items.splice(index, 1);
                    this.saveCart();
                    this.renderCartItems();
                    this.renderCartCount();
                    this.updateCartButtons();
                }
                
                updateCartSummary() {
                    const subtotal = this.items.reduce((sum, item) => {
                        return sum + (parseFloat(item.precio.replace('$', '')) * item.cantidad);
                    }, 0);
                    
                    // Calcular descuento del cupón
                    const descuentoCupon = this.cuponManager.calcularDescuento(this.items, subtotal);
                    
                    let shipping = subtotal >= this.FREE_SHIPPING_MINIMUM ? 0 : 50;
                    
                    // Aplicar envío gratis si el cupón lo ofrece
                    if (descuentoCupon.tipo === 'free_shipping') {
                        shipping = 0;
                    }
                    
                    const descuento = descuentoCupon.descuento;
                    const total = subtotal - descuento + shipping;
                    
                    document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
                    
                    // Mostrar/Ocultar fila de descuento por cupón
                    const couponDiscountRow = document.getElementById('couponDiscountRow');
                    const couponDiscount = document.getElementById('couponDiscount');
                    
                    if (descuento > 0) {
                        couponDiscountRow.style.display = 'flex';
                        couponDiscount.textContent = `-$${descuento.toFixed(2)}`;
                    } else {
                        couponDiscountRow.style.display = 'none';
                    }
                    
                    document.getElementById('shipping').textContent = shipping === 0 ? 'Gratis' : `$${shipping.toFixed(2)}`;
                    document.getElementById('total').textContent = `$${total.toFixed(2)}`;
                    
                    // Mostrar promoción de envío gratis SOLO si hay productos y el subtotal es menor al mínimo
                    // Y no hay cupón de envío gratis aplicado
                    const freeShippingPromo = document.getElementById('freeShippingPromo');
                    if (this.items.length > 0 && subtotal < this.FREE_SHIPPING_MINIMUM && subtotal > 0 && descuentoCupon.tipo !== 'free_shipping') {
                        const remaining = this.FREE_SHIPPING_MINIMUM - subtotal;
                        const progress = (subtotal / this.FREE_SHIPPING_MINIMUM) * 100;
                        
                        document.getElementById('remainingAmount').textContent = `$${remaining.toFixed(2)}`;
                        document.getElementById('shippingProgress').style.width = `${progress}%`;
                        freeShippingPromo.classList.add('show');
                        freeShippingPromo.style.display = 'block';
                    } else {
                        freeShippingPromo.classList.remove('show');
                        freeShippingPromo.style.display = 'none';
                    }
                }
                
                updateShippingPromo() {
                    const subtotal = this.items.reduce((sum, item) => {
                        return sum + (parseFloat(item.precio.replace('$', '')) * item.cantidad);
                    }, 0);
                    
                    const freeShippingPromo = document.getElementById('freeShippingPromo');
                    const descuentoCupon = this.cuponManager.calcularDescuento(this.items, subtotal);
                    
                    if (this.items.length === 0) {
                        freeShippingPromo.style.display = 'none';
                        freeShippingPromo.classList.remove('show');
                        return;
                    }
                    
                    if (subtotal > 0 && subtotal < this.FREE_SHIPPING_MINIMUM && subtotal > 0 && descuentoCupon.tipo !== 'free_shipping') {
                        const remaining = this.FREE_SHIPPING_MINIMUM - subtotal;
                        const progress = (subtotal / this.FREE_SHIPPING_MINIMUM) * 100;
                        
                        document.getElementById('remainingAmount').textContent = `$${remaining.toFixed(2)}`;
                        document.getElementById('shippingProgress').style.width = `${progress}%`;
                        freeShippingPromo.classList.add('show');
                        freeShippingPromo.style.display = 'block';
                    } else {
                        freeShippingPromo.classList.remove('show');
                        freeShippingPromo.style.display = 'none';
                    }
                }
                
                addToCart(productId, variantes, precio) {
                    const variantKey = variantes.map(v => v.valor).join('|');
                    
                    const existingItem = this.items.find(item => 
                        item.productId === productId && 
                        JSON.stringify(item.variantes) === JSON.stringify(variantes)
                    );
                    
                    if (existingItem) {
                        this.updateQuantity(this.items.indexOf(existingItem), 1);
                    } else {
                        this.items.push({
                            productId: productId,
                            variantes: variantes,
                            precio: precio,
                            cantidad: 1
                        });
                        this.saveCart();
                        this.renderCartCount();
                        this.renderCartItems();
                        this.updateCartButtons();
                        
                        // Mostrar notificación
                        this.showNotification('Producto agregado al carrito');
                    }
                }
                
                clearCart() {
                    if (confirm('¿Estás seguro de que quieres vaciar el carrito?')) {
                        this.items = [];
                        this.saveCart();
                        this.renderCartCount();
                        this.renderCartItems();
                        this.updateCartButtons();
                    }
                }
                
                saveCart() {
                    localStorage.setItem('cartModaStyle', JSON.stringify(this.items));
                }
                
                updateCartButtons() {
                    const hasItems = this.items.length > 0;
                    document.getElementById('checkoutBtn').disabled = !hasItems;
                    document.getElementById('clearCartBtn').disabled = !hasItems;
                }
                
                showNotification(message) {
                    // Crear notificación temporal
                    const notification = document.createElement('div');
                    notification.style.cssText = `
                        position: fixed;
                        bottom: 80px;
                        right: 20px;
                        background: linear-gradient(135deg, var(--accent), var(--primary));
                        color: white;
                        padding: 12px 16px;
                        border-radius: var(--border-radius);
                        z-index: 9999;
                        box-shadow: var(--shadow-hover);
                        animation: slideInRight 0.3s ease;
                    `;
                    notification.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-check-circle"></i>
                            <span>${message}</span>
                        </div>
                    `;
                    
                    document.body.appendChild(notification);
                    
                    setTimeout(() => {
                        notification.style.animation = 'slideInRight 0.3s ease reverse forwards';
                        setTimeout(() => {
                            if (notification.parentElement) {
                                notification.remove();
                            }
                        }, 300);
                    }, 2000);
                }
                
                // ==================== FUNCIONALIDAD DE CUPONES ====================
                
                showCouponModal() {
                    document.getElementById('couponModal').classList.add('active');
                    document.getElementById('couponCodeInput').focus();
                    document.body.style.overflow = 'hidden';
                    this.renderAvailableCoupons();
                }
                
                closeCouponModal() {
                    document.getElementById('couponModal').classList.remove('active');
                    document.getElementById('couponCodeInput').value = '';
                    document.getElementById('couponSuccessMessage').style.display = 'none';
                    document.getElementById('couponErrorMessage').style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
                
                renderAvailableCoupons() {
                    const cuponesDisponibles = this.cuponManager.getCuponesDisponibles();
                    const cuponAplicado = this.cuponManager.getCuponAplicado();
                    const container = document.getElementById('availableCouponsList');
                    
                    if (cuponesDisponibles.length === 0) {
                        container.innerHTML = `
                            <div class="status-message status-info">
                                <i class="fas fa-info-circle"></i>
                                <span>No hay cupones disponibles en este momento</span>
                            </div>
                        `;
                        return;
                    }
                    
                    container.innerHTML = cuponesDisponibles.map(cupon => {
                        const esAplicado = cuponAplicado && cuponAplicado.id === cupon.id;
                        
                        let tipoTexto = '';
                        let icono = 'fas fa-tag';
                        
                        switch (cupon.tipo) {
                            case 'percentage':
                                tipoTexto = `${cupon.valor}% DESCUENTO`;
                                icono = 'fas fa-percentage';
                                break;
                            case 'free_shipping':
                                tipoTexto = 'ENVÍO GRATIS';
                                icono = 'fas fa-shipping-fast';
                                break;
                            case 'bogo_2x1':
                                tipoTexto = '2X1';
                                icono = 'fas fa-gift';
                                break;
                            case 'bogo_3x2':
                                tipoTexto = '3X2';
                                icono = 'fas fa-gift';
                                break;
                        }
                        
                        const fechaFin = new Date(cupon.fechaFin);
                        const fechaFormateada = fechaFin.toLocaleDateString('es-ES', {
                            day: '2-digit',
                            month: 'short',
                            year: 'numeric'
                        });
                        
                        return `
                            <div class="coupon-item ${esAplicado ? 'applied' : ''}" onclick="carrito.selectCoupon('${cupon.codigo}')">
                                <div class="coupon-code">
                                    <i class="${icono}"></i>
                                    ${cupon.codigo}
                                </div>
                                <div class="coupon-description">
                                    ${cupon.descripcion}
                                </div>
                                <div class="coupon-details">
                                    <span class="coupon-type">${tipoTexto}</span>
                                    <span class="coupon-expiry">Válido hasta: ${fechaFormateada}</span>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
                
                selectCoupon(codigo) {
                    document.getElementById('couponCodeInput').value = codigo;
                    this.applyCoupon();
                }
                
                applyCoupon() {
                    const codigo = document.getElementById('couponCodeInput').value.trim();
                    const successMessage = document.getElementById('couponSuccessMessage');
                    const errorMessage = document.getElementById('couponErrorMessage');
                    
                    if (!codigo) {
                        errorMessage.innerHTML = '<i class="fas fa-times-circle"></i><span>Ingresa un código de cupón</span>';
                        errorMessage.style.display = 'flex';
                        successMessage.style.display = 'none';
                        return;
                    }
                    
                    const resultado = this.cuponManager.aplicarCupon(codigo, this.items);
                    
                    if (resultado.success) {
                        successMessage.innerHTML = `<i class="fas fa-check-circle"></i><span>${resultado.cupon.descripcion}</span>`;
                        successMessage.style.display = 'flex';
                        errorMessage.style.display = 'none';
                        
                        // Actualizar carrito
                        this.updateAppliedCoupon();
                        this.updateCartSummary();
                        this.renderAvailableCoupons();
                        
                        // Cerrar modal después de 1.5 segundos
                        setTimeout(() => {
                            this.closeCouponModal();
                        }, 1500);
                    } else {
                        errorMessage.innerHTML = `<i class="fas fa-times-circle"></i><span>${resultado.message}</span>`;
                        errorMessage.style.display = 'flex';
                        successMessage.style.display = 'none';
                    }
                }
                
                removeCoupon() {
                    const resultado = this.cuponManager.removerCupon();
                    if (resultado.success) {
                        this.updateAppliedCoupon();
                        this.updateCartSummary();
                        this.renderAvailableCoupons();
                        this.showNotification('Cupón eliminado');
                    }
                }
                
                updateAppliedCoupon() {
                    const appliedCoupon = document.getElementById('appliedCoupon');
                    const cupon = this.cuponManager.getCuponAplicado();
                    
                    if (cupon) {
                        document.getElementById('appliedCouponCode').textContent = cupon.codigo;
                        
                        let detalles = '';
                        switch (cupon.tipo) {
                            case 'percentage':
                                detalles = `${cupon.valor}% de descuento`;
                                break;
                            case 'free_shipping':
                                detalles = 'Envío gratis aplicado';
                                break;
                            case 'bogo_2x1':
                                detalles = '2x1 aplicado en productos seleccionados';
                                break;
                            case 'bogo_3x2':
                                detalles = '3x2 aplicado en productos seleccionados';
                                break;
                        }
                        
                        document.getElementById('appliedCouponDetails').textContent = detalles;
                        appliedCoupon.classList.add('show');
                    } else {
                        appliedCoupon.classList.remove('show');
                    }
                }
                
                openImageModal(imageSrc, title) {
                    document.getElementById('modalImage').src = imageSrc;
                    document.getElementById('modalImage').alt = title;
                    document.getElementById('imageModal').classList.add('active');
                    document.body.style.overflow = 'hidden';
                }
                
                closeImageModal() {
                    document.getElementById('imageModal').classList.remove('active');
                    document.body.style.overflow = 'auto';
                }
                
                showCheckoutModal() {
                    if (this.items.length === 0) return;
                    
                    document.getElementById('checkoutModal').classList.add('active');
                    document.body.style.overflow = 'hidden';
                }
                
                closeCheckoutModal() {
                    document.getElementById('checkoutModal').classList.remove('active');
                    document.body.style.overflow = 'auto';
                }
                
                submitOrder(e) {
                    e.preventDefault();
                    
                    const name = document.getElementById('customerName').value;
                    const phone = document.getElementById('customerPhone').value;
                    const deliveryTime = document.getElementById('deliveryTime').value;
                    const deliveryOption = document.querySelector('.delivery-option.selected input')?.value;
                    const paymentMethod = document.querySelector('.payment-option.selected input')?.value;
                    
                    if (!name || !phone || !deliveryTime || !deliveryOption || !paymentMethod) {
                        alert('Por favor completa todos los campos');
                        return;
                    }
                    
                    // Preparar mensaje de WhatsApp
                    let message = `*¡Hola ModaStyle! Quiero realizar un pedido*\n\n`;
                    message += `*Información del cliente:*\n`;
                    message += `👤 Nombre: ${name}\n`;
                    message += `📞 Teléfono: ${phone}\n`;
                    message += `📍 Punto de entrega: ${this.getDeliveryName(deliveryOption)}\n`;
                    message += `🗺️ Enlace de Google Maps: ${this.getDeliveryMap(deliveryOption)}\n`;
                    message += `🕐 Horario de entrega: ${deliveryTime}\n`;
                    message += `💳 Método de pago: ${paymentMethod === 'efectivo' ? 'Efectivo' : 'Transferencia'}\n\n`;
                    
                    message += `*Detalles del pedido:*\n\n`;
                    
                    let subtotal = 0;
                    this.items.forEach((item, index) => {
                        const product = productos.find(p => p.id === item.productId);
                        const price = parseFloat(item.precio.replace('$', ''));
                        const itemTotal = price * item.cantidad;
                        subtotal += itemTotal;
                        
                        message += `*${index + 1}. ${product.nombre}*\n`;
                        message += `📋 Variantes: ${item.variantes.map(v => `${v.nombre}: ${v.valor}`).join(', ')}\n`;
                        message += `🔢 Cantidad: ${item.cantidad}\n`;
                        message += `💰 Precio unitario: ${item.precio}\n`;
                        message += `💵 Subtotal: $${itemTotal.toFixed(2)}\n\n`;
                    });
                    
                    // Calcular descuento del cupón
                    const descuentoCupon = this.cuponManager.calcularDescuento(this.items, subtotal);
                    const descuento = descuentoCupon.descuento;
                    
                    let shipping = subtotal >= this.FREE_SHIPPING_MINIMUM ? 0 : 50;
                    if (descuentoCupon.tipo === 'free_shipping') {
                        shipping = 0;
                    }
                    
                    const finalTotal = subtotal - descuento + shipping;
                    
                    message += `*Resumen de la compra:*\n`;
                    message += `📦 Subtotal: $${subtotal.toFixed(2)}\n`;
                    
                    if (descuento > 0) {
                        message += `🎫 Descuento por cupón: -$${descuento.toFixed(2)}\n`;
                    }
                    
                    message += `🚚 Envío: ${shipping === 0 ? 'Gratis' : '$' + shipping.toFixed(2)}\n`;
                    message += `*💰 Total a pagar: $${finalTotal.toFixed(2)}*\n\n`;
                    
                    // Información del cupón si aplica
                    const cuponAplicado = this.cuponManager.getCuponAplicado();
                    if (cuponAplicado) {
                        message += `*Cupón aplicado:* ${cuponAplicado.codigo}\n`;
                        message += `${cuponAplicado.descripcion}\n\n`;
                    }
                    
                    if (paymentMethod === 'transferencia') {
                        message += `*Datos para transferencia:*\n`;
                        message += `🏦 Banco: STP\n`;
                        message += `🔢 CLABE: 721180100001101243\n`;
                        message += `👤 Nombre: Saul Flores\n\n`;
                    }
                    
                    message += `¡Gracias por tu compra! 😊`;
                    
                    // Codificar mensaje para URL
                    const encodedMessage = encodeURIComponent(message);
                    const whatsappUrl = `https://wa.me/5567416073?text=${encodedMessage}`;
                    
                    // Abrir WhatsApp
                    window.open(whatsappUrl, '_blank');
                    
                    // Limpiar carrito y cerrar modales
                    this.clearCart();
                    this.closeCheckoutModal();
                    this.closeCart();
                    this.cuponManager.removerCupon();
                }
                
                getDeliveryName(option) {
                    const names = {
                        'xhala': 'San Sebastián Xhala (enfrente de la universidad)',
                        'socorro': 'El Socorro (en los Arcos en frente del oxxo)',
                        'mateo': 'San Mateo (en frente de la iglesia)'
                    };
                    return names[option] || option;
                }
                
                getDeliveryMap(option) {
                    const maps = {
                        'xhala': 'https://maps.app.goo.gl/nKi4gyiDY1KikZPQ6',
                        'socorro': 'https://maps.app.goo.gl/BYYZWmaa9TbtjWvD8',
                        'mateo': 'https://maps.app.goo.gl/q1KoquLtgrTEnuCo6'
                    };
                    return maps[option] || '#';
                }
                
                renderProducts() {
                    // Si hay una búsqueda activa, dejar que el buscador maneje la renderización
                    if (window.buscador && window.buscador.isActive()) {
                        return;
                    }
                    
                    const productsGrid = document.getElementById('productsGrid');
                    const filteredProducts = this.currentFilter === 'todo' 
                        ? productos 
                        : productos.filter(p => p.categoria === this.currentFilter);
                    
                    if (filteredProducts.length === 0) {
                        productsGrid.innerHTML = `
                            <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--text-light);">
                                <i class="fas fa-box-open" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.3;"></i>
                                <h3>No hay productos en esta categoría</h3>
                                <p>Prueba con otra categoría o vuelve más tarde</p>
                            </div>
                        `;
                        return;
                    }
                    
                    productsGrid.innerHTML = filteredProducts.map((product, index) => {
                        const precio = product.precioDescuento || product.precioRegular;
                        const precioNum = parseFloat(precio.replace('$', ''));
                        const categoria = categorias.find(c => c.id === product.categoria);
                        const colorCategoria = categoria ? categoria.color : 'var(--accent)';
                        
                        return `
                            <div class="product-card" data-product-id="${product.id}" style="animation-delay: ${index * 0.05}s">
                                <div class="product-image-container">
                                    <img src="${product.imagen}" alt="${product.nombre}" class="product-image" 
                                         onclick="carrito.openImageModal('${product.imagen}', '${product.nombre}')"
                                         data-original-image="${product.imagen}"
                                         ${product.imagenesPorVariante ? 'data-has-variant-images="true"' : ''}>
                                    <div class="product-badge ${product.estado}">${product.estado.toUpperCase()}</div>
                                </div>
                                
                                <div class="product-info">
                                    <div class="product-category" style="color: ${colorCategoria}">
                                        <i class="fas fa-tag"></i>
                                        ${product.subcategoria}
                                    </div>
                                    
                                    <h3 class="product-title">${product.nombre}</h3>
                                    
                                    <div class="product-price-container">
                                        ${product.precioDescuento ? `
                                            <div class="sale-price-container">
                                                <div class="original-price">${product.precioRegular}</div>
                                                <div class="sale-price" style="color: ${colorCategoria}">${product.precioDescuento}</div>
                                                <div class="discount-badge">OFERTA</div>
                                            </div>
                                        ` : `
                                            <div class="regular-price">${product.precioRegular}</div>
                                        `}
                                    </div>
                                    
                                    <p class="product-description">
                                        ${product.descripcion}
                                    </p>
                                    
                                    ${product.especificaciones && product.especificaciones.length > 0 ? `
                                        <div class="product-features">
                                            ${product.especificaciones.map(spec => `
                                                <div class="feature">
                                                    <i class="fas fa-check" style="color: ${colorCategoria}"></i>
                                                    <span>${spec}</span>
                                                </div>
                                            `).join('')}
                                        </div>
                                    ` : ''}
                                    
                                    ${this.renderProductVariants(product, colorCategoria)}
                                    
                                    <div class="product-actions">
                                        <button class="add-to-cart-btn" 
                                                data-product-id="${product.id}"
                                                style="background: linear-gradient(135deg, ${colorCategoria}, ${this.darkenColor(colorCategoria)});"
                                                onclick="carrito.handleAddToCart(${product.id})">
                                            <i class="fas fa-shopping-cart"></i>
                                            AGREGAR AL CARRITO
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                    
                    // Deseleccionar todas las variantes al renderizar
                    setTimeout(() => {
                        document.querySelectorAll('.variant-btn.selected').forEach(btn => {
                            btn.classList.remove('selected');
                        });
                    }, 50);
                }
                
                renderProductVariants(product, colorCategoria) {
                    if (!product.variantes || product.variantes.length === 0) {
                        return '';
                    }
                    
                    return product.variantes.map(variant => `
                        <div class="variant-selector" data-variant-name="${variant.nombre}">
                            <div class="variant-label">${variant.nombre}:</div>
                            <div class="variant-options">
                                ${variant.opciones.map(opcion => `
                                    <button class="variant-btn" data-value="${opcion}" 
                                            style="border-color: ${colorCategoria}"
                                            onclick="carrito.selectVariant(this, '${variant.nombre}', ${variant.required})">
                                        ${opcion}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                    `).join('');
                }
                
                selectVariant(button, variantName, required) {
                    const productCard = button.closest('.product-card');
                    const variantContainer = button.closest('.variant-selector');
                    const productId = parseInt(productCard.dataset.productId);
                    const product = productos.find(p => p.id === productId);
                    
                    const isAlreadySelected = button.classList.contains('selected');
                    
                    // Si ya está seleccionado y no es requerido, deseleccionar
                    if (isAlreadySelected && !required) {
                        button.classList.remove('selected');
                        
                        // Si es una variante de color, restaurar imagen original
                        if (variantName.toLowerCase() === 'color') {
                            this.restoreOriginalImage(productCard);
                        }
                    } else {
                        // Deseleccionar todos los botones en este contenedor
                        variantContainer.querySelectorAll('.variant-btn').forEach(btn => {
                            btn.classList.remove('selected');
                        });
                        
                        // Seleccionar este botón
                        button.classList.add('selected');
                        
                        // Actualizar imagen si es una variante de color
                        if (variantName.toLowerCase() === 'color' && product && product.imagenesPorVariante) {
                            this.updateProductImageByColor(productCard, button.dataset.value, product);
                        }
                    }
                    
                    this.updateAddToCartButton(productCard);
                }
                
                updateProductImageByColor(productCard, color, product) {
                    if (!product) {
                        const productId = parseInt(productCard.dataset.productId);
                        product = productos.find(p => p.id === productId);
                    }
                    
                    if (!product || !product.imagenesPorVariante) return;
                    
                    // Buscar imagen para este color
                    const colorLower = color.toLowerCase();
                    let imageForColor = null;
                    let matchedKey = null;
                    
                    // Buscar coincidencia exacta o parcial
                    for (const [variantValue, imageUrl] of Object.entries(product.imagenesPorVariante)) {
                        if (variantValue.toLowerCase().includes(colorLower)) {
                            imageForColor = imageUrl;
                            matchedKey = variantValue;
                            break;
                        }
                    }
                    
                    // Si encontramos imagen para este color, actualizar
                    if (imageForColor) {
                        const imgElement = productCard.querySelector('.product-image');
                        imgElement.src = imageForColor;
                        imgElement.alt = `${product.nombre} - ${color}`;
                        
                        // Actualizar el onclick del modal
                        imgElement.setAttribute('onclick', `carrito.openImageModal('${imageForColor}', '${product.nombre} - ${color}')`);
                        
                        // Guardar la imagen actual como temporalmente seleccionada
                        imgElement.dataset.currentImage = matchedKey;
                    }
                }
                
                restoreOriginalImage(productCard) {
                    const productId = parseInt(productCard.dataset.productId);
                    const product = productos.find(p => p.id === productId);
                    
                    if (!product) return;
                    
                    const imgElement = productCard.querySelector('.product-image');
                    const originalImage = imgElement.dataset.originalImage || product.imagen;
                    
                    imgElement.src = originalImage;
                    imgElement.alt = product.nombre;
                    imgElement.setAttribute('onclick', `carrito.openImageModal('${originalImage}', '${product.nombre}')`);
                    
                    // Limpiar la imagen actual
                    delete imgElement.dataset.currentImage;
                }
                
                getSelectedVariants(productCard) {
                    const productId = parseInt(productCard.dataset.productId);
                    const product = productos.find(p => p.id === productId);
                    if (!product) return [];
                    
                    return product.variantes
                        .filter(variant => {
                            const variantContainer = productCard.querySelector(`.variant-selector[data-variant-name="${variant.nombre}"]`);
                            if (!variantContainer) return false;
                            
                            const selectedBtn = variantContainer.querySelector('.variant-btn.selected');
                            return selectedBtn !== null;
                        })
                        .map(variant => {
                            const variantContainer = productCard.querySelector(`.variant-selector[data-variant-name="${variant.nombre}"]`);
                            const selectedBtn = variantContainer.querySelector('.variant-btn.selected');
                            
                            return {
                                nombre: variant.nombre,
                                valor: selectedBtn.dataset.value,
                                required: variant.required
                            };
                        });
                }
                
                handleAddToCart(productId) {
                    const productCard = document.querySelector(`.product-card[data-product-id="${productId}"]`);
                    if (!productCard) return;
                    
                    const product = productos.find(p => p.id === productId);
                    if (!product) return;
                    
                    // Obtener variantes seleccionadas
                    const selectedVariants = this.getSelectedVariants(productCard);
                    
                    // Verificar que todas las variantes requeridas estén seleccionadas
                    const missingRequired = product.variantes.filter(v => 
                        v.required && !selectedVariants.some(sv => sv.nombre === v.nombre)
                    );
                    
                    if (missingRequired.length > 0) {
                        alert(`Por favor selecciona: ${missingRequired.map(v => v.nombre).join(', ')}`);
                        return;
                    }
                    
                    // Verificar stock
                    const variantKey = selectedVariants.map(v => v.valor).join('|');
                    const stock = product.stock[variantKey] || 0;
                    
                    if (stock <= 0) {
                        alert('Este producto está agotado');
                        return;
                    }
                    
                    // Verificar si ya hay suficiente en el carrito
                    const cartItem = this.items.find(item => 
                        item.productId === productId && 
                        JSON.stringify(item.variantes) === JSON.stringify(selectedVariants)
                    );
                    
                    if (cartItem && cartItem.cantidad >= stock) {
                        alert(`Solo hay ${stock} unidades disponibles`);
                        return;
                    }
                    
                    const precio = product.precioDescuento || product.precioRegular;
                    this.addToCart(productId, selectedVariants, precio);
                }
                
                updateAddToCartButton(productCard) {
                    const productId = parseInt(productCard.dataset.productId);
                    const product = productos.find(p => p.id === productId);
                    if (!product) return;
                    
                    const addToCartBtn = productCard.querySelector('.add-to-cart-btn');
                    
                    // Verificar si todas las variantes requeridas están seleccionadas
                    const allRequiredSelected = product.variantes.every(variant => {
                        if (!variant.required) return true;
                        
                        const variantContainer = productCard.querySelector(`.variant-selector[data-variant-name="${variant.nombre}"]`);
                        if (!variantContainer) return false;
                        
                        return variantContainer.querySelector('.variant-btn.selected') !== null;
                    });
                    
                    if (allRequiredSelected) {
                        addToCartBtn.disabled = false;
                        
                        // Verificar stock
                        const selectedVariants = this.getSelectedVariants(productCard);
                        const variantKey = selectedVariants.map(v => v.valor).join('|');
                        const stock = product.stock[variantKey] || 0;
                        
                        if (stock <= 0) {
                            addToCartBtn.disabled = true;
                            addToCartBtn.innerHTML = '<i class="fas fa-times"></i> AGOTADO';
                        } else {
                            addToCartBtn.innerHTML = '<i class="fas fa-shopping-cart"></i> AGREGAR AL CARRITO';
                        }
                    } else {
                        addToCartBtn.disabled = true;
                        addToCartBtn.innerHTML = '<i class="fas fa-shopping-cart"></i> AGREGAR AL CARRITO';
                    }
                }
                
                darkenColor(color) {
                    // Función simple para oscurecer un color hexadecimal
                    let r = parseInt(color.slice(1, 3), 16);
                    let g = parseInt(color.slice(3, 5), 16);
                    let b = parseInt(color.slice(5, 7), 16);
                    
                    r = Math.floor(r * 0.8);
                    g = Math.floor(g * 0.8);
                    b = Math.floor(b * 0.8);
                    
                    return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
                }
                
                renderCategories() {
                    // Ahora esta función utiliza las categorías de la sección
                    this.updateSectionCategories();
                }
                
                updateSectionCategories() {
                    const categoriesGrid = document.getElementById('categoriesGrid');
                    
                    // Actualizar título y subtítulo
                    document.getElementById('mainSectionTitle').textContent = sectionConfig.title;
                    document.getElementById('mainSectionSubtitle').textContent = sectionConfig.subtitle;
                    
                    // Ordenar categorías por orden
                    const sortedCategories = [...sectionCategories].sort((a, b) => a.order - b.order);
                    
                    categoriesGrid.innerHTML = sortedCategories.map(categoria => {
                        return `
                            <div class="category-card" onclick="${categoria.action}">
                                <img src="${categoria.image}" alt="${categoria.name}" class="category-image">
                                <div class="category-overlay">
                                    <h3 class="category-name">${categoria.name}</h3>
                                    <p class="category-description">${categoria.description}</p>
                                    <span class="category-badge" style="background: ${categoria.buttonColor}">Ver productos</span>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
                
                renderCategoryFilters() {
                    const filtersContainer = document.getElementById('categoryFilters');
                    filtersContainer.innerHTML = categorias.map(categoria => {
                        const isActive = categoria.id === this.currentFilter;
                        return `
                            <button class="category-filter ${isActive ? 'active' : ''}" 
                                    onclick="carrito.filterProducts('${categoria.id}')"
                                    data-color="${categoria.color}">
                                ${categoria.nombre}
                            </button>
                        `;
                    }).join('');
                    
                    // Aplicar colores a los filtros activos
                    this.updateFilterColors();
                }
                
                filterProducts(categoriaId) {
                    // Limpiar búsqueda si existe
                    if (window.buscador) {
                        window.buscador.clearSearch('header');
                    }
                    
                    this.currentFilter = categoriaId;
                    
                    // Actualizar filtros
                    document.querySelectorAll('.category-filter').forEach(filter => {
                        filter.classList.remove('active');
                    });
                    
                    const activeFilter = document.querySelector(`.category-filter[onclick*="${categoriaId}"]`);
                    if (activeFilter) {
                        activeFilter.classList.add('active');
                    }
                    
                    // Aplicar colores
                    this.updateFilterColors();
                    
                    // Filtrar productos
                    this.renderProducts();
                    
                    // Hacer scroll a productos
                    document.getElementById('productos').scrollIntoView({ behavior: 'smooth' });
                }
                
                filterFlashSaleProducts() {
                    // Limpiar búsqueda si existe
                    if (window.buscador) {
                        window.buscador.clearSearch('header');
                    }
                    
                    const flashSaleProducts = this.flashSaleManager.getFlashSaleProducts();
                    
                    if (flashSaleProducts.length === 0) {
                        alert('No hay productos en oferta relámpago en este momento');
                        return;
                    }
                    
                    // Mostrar solo productos en oferta relámpago
                    const productsGrid = document.getElementById('productsGrid');
                    
                    productsGrid.innerHTML = flashSaleProducts.map((product, index) => {
                        const precio = product.precioDescuento || product.precioRegular;
                        const categoria = categorias.find(c => c.id === product.categoria);
                        const colorCategoria = categoria ? categoria.color : 'var(--flash-sale)';
                        
                        return `
                            <div class="product-card" data-product-id="${product.id}" style="animation-delay: ${index * 0.05}s">
                                <div class="product-image-container">
                                    <img src="${product.imagen}" alt="${product.nombre}" class="product-image" 
                                         onclick="carrito.openImageModal('${product.imagen}', '${product.nombre}')"
                                         data-original-image="${product.imagen}"
                                         ${product.imagenesPorVariante ? 'data-has-variant-images="true"' : ''}>
                                    <div class="product-badge oferta" style="background: var(--flash-sale);">OFERTA RELÁMPAGO</div>
                                </div>
                                
                                <div class="product-info">
                                    <div class="product-category" style="color: ${colorCategoria}">
                                        <i class="fas fa-bolt"></i>
                                        OFERTA RELÁMPAGO
                                    </div>
                                    
                                    <h3 class="product-title">${product.nombre}</h3>
                                    
                                    <div class="product-price-container">
                                        ${product.precioDescuento ? `
                                            <div class="sale-price-container">
                                                <div class="original-price">${product.precioRegular}</div>
                                                <div class="sale-price" style="color: var(--flash-sale)">${product.precioDescuento}</div>
                                                <div class="discount-badge" style="background: var(--flash-sale);">OFERTA RELÁMPAGO</div>
                                            </div>
                                        ` : `
                                            <div class="regular-price">${product.precioRegular}</div>
                                        `}
                                    </div>
                                    
                                    <p class="product-description">
                                        ${product.descripcion}
                                    </p>
                                    
                                    ${product.especificaciones && product.especificaciones.length > 0 ? `
                                        <div class="product-features">
                                            ${product.especificaciones.map(spec => `
                                                <div class="feature">
                                                    <i class="fas fa-check" style="color: var(--flash-sale)"></i>
                                                    <span>${spec}</span>
                                                </div>
                                            `).join('')}
                                        </div>
                                    ` : ''}
                                    
                                    ${this.renderProductVariants(product, colorCategoria)}
                                    
                                    <div class="product-actions">
                                        <button class="add-to-cart-btn" 
                                                data-product-id="${product.id}"
                                                style="background: linear-gradient(135deg, var(--flash-sale), #ff3838);"
                                                onclick="carrito.handleAddToCart(${product.id})">
                                            <i class="fas fa-shopping-cart"></i>
                                            AGREGAR AL CARRITO
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                    
                    // Actualizar título de sección
                    document.querySelector('#productos .section-title').textContent = 'Ofertas Relámpago';
                    document.querySelector('#productos .section-subtitle').textContent = '¡Aprovecha estas ofertas por tiempo limitado!';
                    
                    // Actualizar filtros
                    document.querySelectorAll('.category-filter').forEach(filter => {
                        filter.classList.remove('active');
                    });
                    
                    // Deseleccionar todas las variantes
                    setTimeout(() => {
                        document.querySelectorAll('.variant-btn.selected').forEach(btn => {
                            btn.classList.remove('selected');
                        });
                    }, 50);
                    
                    // Hacer scroll a productos
                    document.getElementById('productos').scrollIntoView({ behavior: 'smooth' });
                }
                
                scrollToProduct(productId) {
                    const productCard = document.querySelector(`.product-card[data-product-id="${productId}"]`);
                    if (productCard) {
                        productCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        
                        // Efecto de destello
                        productCard.style.animation = 'none';
                        setTimeout(() => {
                            productCard.style.animation = '';
                            productCard.style.boxShadow = '0 0 0 3px var(--flash-sale)';
                            setTimeout(() => {
                                productCard.style.boxShadow = '';
                            }, 1000);
                        }, 50);
                    }
                }
                
                updateFilterColors() {
                    document.querySelectorAll('.category-filter.active').forEach(filter => {
                        const color = filter.getAttribute('data-color');
                        filter.style.background = color;
                        filter.style.color = 'white';
                        filter.style.borderColor = color;
                    });
                    
                    document.querySelectorAll('.category-filter:not(.active)').forEach(filter => {
                        filter.style.background = '';
                        filter.style.color = '';
                        filter.style.borderColor = '';
                    });
                }
            }

            // ==================== SISTEMA DE ADMINISTRACIÓN ====================
            class Administracion {
                constructor() {
                    this.pinCorrecto = "199494";
                    this.isAdmin = false;
                    this.productosEditando = null;
                    this.especificaciones = [];
                    this.variantes = [];
                    this.categoriaEditando = null;
                    this.sectionCategoryEditando = null;
                    this.cuponEditando = null;
                    
                    // Asegurar que el panel esté cerrado al iniciar
                    document.getElementById('adminPanel').classList.remove('open');
                    
                    this.init();
                }
                
                init() {
                    this.setupEventListeners();
                    this.renderProductosAdmin();
                    this.renderCategoriasSelect();
                    this.renderCategoriasAdmin();
                    this.renderCuponesAdmin();
                    this.renderStats();
                    this.loadSectionConfig();
                    this.renderSectionCategories();
                    this.loadFlashSaleConfig();
                }
                
                setupEventListeners() {
                    // Botón de administración
                    document.getElementById('adminBtn').addEventListener('click', () => this.showAuthModal());
                    
                    // Modal de autenticación
                    document.getElementById('authForm').addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.verificarPin();
                    });
                    
                    document.getElementById('cancelAuth').addEventListener('click', () => this.closeAuthModal());
                    
                    // Panel de administración
                    document.getElementById('closeAdmin').addEventListener('click', () => this.closeAdminPanel());
                    
                    // Tabs del panel
                    document.querySelectorAll('.admin-tab').forEach(tab => {
                        tab.addEventListener('click', (e) => {
                            const tabId = e.currentTarget.dataset.tab;
                            this.switchTab(tabId);
                        });
                    });
                    
                    // Formulario de producto
                    document.getElementById('addSpecBtn').addEventListener('click', () => this.agregarEspecificacion());
                    document.getElementById('addVariantBtn').addEventListener('click', () => this.agregarVariantField());
                    
                    document.getElementById('resetFormBtn').addEventListener('click', () => this.resetForm());
                    document.getElementById('productForm').addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.guardarProducto();
                    });
                    
                    // Gestión de categorías
                    document.getElementById('addCategoryBtn').addEventListener('click', () => this.agregarCategoria());
                    
                    // Gestión de cupones
                    document.getElementById('couponType').addEventListener('change', (e) => this.toggleCouponFields(e.target.value));
                    document.getElementById('resetCouponBtn').addEventListener('click', () => this.resetCouponForm());
                    document.getElementById('saveCouponBtn').addEventListener('click', () => this.guardarCupon());
                    
                    // Gestión de ofertas relámpago
                    document.getElementById('saveFlashSaleBtn').addEventListener('click', () => this.guardarFlashSaleConfig());
                    document.getElementById('flashSaleEnabled').addEventListener('change', (e) => {
                        this.updateFlashSalePreview();
                    });
                    document.getElementById('flashSaleTitleInput').addEventListener('input', () => this.updateFlashSalePreview());
                    document.getElementById('flashSaleDescriptionInput').addEventListener('input', () => this.updateFlashSalePreview());
                    document.getElementById('flashSaleButtonText').addEventListener('input', () => this.updateFlashSalePreview());
                    
                    // Editor de sección
                    document.getElementById('previewSectionBtn').addEventListener('click', () => this.togglePreviewSection());
                    document.getElementById('saveSectionBtn').addEventListener('click', () => this.saveSectionConfig());
                    document.getElementById('addSectionCategoryBtn').addEventListener('click', () => this.addSectionCategory());
                    
                    // Exportación
                    document.getElementById('exportHtmlBtn').addEventListener('click', () => this.exportHtml());
                }
                
                showAuthModal() {
                    document.getElementById('authModal').classList.add('active');
                    document.getElementById('pinInput').focus();
                    document.body.style.overflow = 'hidden';
                }
                
                closeAuthModal() {
                    document.getElementById('authModal').classList.remove('active');
                    document.getElementById('pinInput').value = '';
                    document.getElementById('authMessage').style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
                
                verificarPin() {
                    const pin = document.getElementById('pinInput').value;
                    const authMessage = document.getElementById('authMessage');
                    
                    if (pin === this.pinCorrecto) {
                        authMessage.innerHTML = '<i class="fas fa-check-circle"></i><span>PIN correcto. Accediendo al panel...</span>';
                        authMessage.className = 'status-message status-success';
                        authMessage.style.display = 'flex';
                        
                        setTimeout(() => {
                            this.isAdmin = true;
                            this.closeAuthModal();
                            this.openAdminPanel();
                        }, 1000);
                    } else {
                        authMessage.innerHTML = '<i class="fas fa-times-circle"></i><span>PIN incorrecto. Intenta nuevamente.</span>';
                        authMessage.className = 'status-message status-error';
                        authMessage.style.display = 'flex';
                        
                        document.getElementById('pinInput').value = '';
                        document.getElementById('pinInput').focus();
                    }
                }
                
                openAdminPanel() {
                    document.getElementById('adminPanel').classList.add('open');
                    document.body.style.overflow = 'hidden';
                }
                
                closeAdminPanel() {
                    document.getElementById('adminPanel').classList.remove('open');
                    document.body.style.overflow = 'auto';
                }
                
                switchTab(tabId) {
                    // Ocultar todas las secciones
                    document.querySelectorAll('.admin-section').forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    // Remover activo de todas las pestañas
                    document.querySelectorAll('.admin-tab').forEach(tab => {
                        tab.classList.remove('active');
                    });
                    
                    // Mostrar la sección seleccionada
                    const section = document.getElementById(tabId + 'Section');
                    if (section) {
                        section.classList.add('active');
                    }
                    
                    // Activar la pestaña seleccionada
                    const tab = document.querySelector(`.admin-tab[data-tab="${tabId}"]`);
                    if (tab) {
                        tab.classList.add('active');
                    }
                }
                
                // ==================== MÉTODOS DE PRODUCTOS ====================
                
                renderProductosAdmin() {
                    const container = document.getElementById('productsListAdmin');
                    
                    container.innerHTML = productos.map(product => {
                        const categoria = categorias.find(c => c.id === product.categoria);
                        const precio = product.precioDescuento || product.precioRegular;
                        
                        return `
                            <div class="product-item-admin" data-product-id="${product.id}" draggable="true">
                                <img src="${product.imagen}" alt="${product.nombre}" class="product-image-admin">
                                <div class="product-info-admin">
                                    <div class="product-name-admin">${product.nombre}</div>
                                    <div class="product-category-admin">
                                        <i class="fas fa-tag"></i>
                                        ${product.subcategoria} | ${categoria ? categoria.nombre : product.categoria}
                                    </div>
                                    <div class="product-price-admin">${precio}</div>
                                </div>
                                <div class="product-actions-admin">
                                    <button class="product-action-btn edit-btn-admin" onclick="admin.editarProducto(${product.id})">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="product-action-btn delete-btn-admin" onclick="admin.eliminarProducto(${product.id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                    }).join('');
                    
                    this.setupDragAndDropProductos();
                }
                
                setupDragAndDropProductos() {
                    const container = document.getElementById('productsListAdmin');
                    const items = container.querySelectorAll('.product-item-admin');
                    
                    items.forEach(item => {
                        item.addEventListener('dragstart', (e) => {
                            e.dataTransfer.setData('text/plain', item.dataset.productId);
                            item.classList.add('dragging');
                        });
                        
                        item.addEventListener('dragend', () => {
                            item.classList.remove('dragging');
                        });
                    });
                    
                    container.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        const afterElement = this.getDragAfterElement(container, e.clientY);
                        const draggable = document.querySelector('.product-item-admin.dragging');
                        
                        if (afterElement == null) {
                            container.appendChild(draggable);
                        } else {
                            container.insertBefore(draggable, afterElement);
                        }
                    });
                }
                
                getDragAfterElement(container, y) {
                    const draggableElements = [...container.querySelectorAll('.product-item-admin:not(.dragging)')];
                    
                    return draggableElements.reduce((closest, child) => {
                        const box = child.getBoundingClientRect();
                        const offset = y - box.top - box.height / 2;
                        
                        if (offset < 0 && offset > closest.offset) {
                            return { offset: offset, element: child };
                        } else {
                            return closest;
                        }
                    }, { offset: Number.NEGATIVE_INFINITY }).element;
                }
                
                renderCategoriasSelect() {
                    const select = document.getElementById('productCategory');
                    select.innerHTML = '<option value="">Selecciona categoría</option>' + 
                        categorias.filter(c => c.id !== 'todo').map(c => 
                            `<option value="${c.id}">${c.nombre}</option>`
                        ).join('');
                }
                
                guardarProducto() {
                    const id = this.productosEditando ? this.productosEditando.id : this.generarNuevoId();
                    const nombre = document.getElementById('productName').value;
                    const categoria = document.getElementById('productCategory').value;
                    const subcategoria = document.getElementById('productSubcategory').value;
                    const precioRegular = document.getElementById('productPrice').value;
                    const precioDescuento = document.getElementById('productDiscountPrice').value || null;
                    const imagen = document.getElementById('productImage').value;
                    const descripcion = document.getElementById('productDescription').value;
                    const estado = document.getElementById('productEstado').value;
                    
                    // Obtener especificaciones
                    const especificaciones = [];
                    document.querySelectorAll('#specsContainer .tag').forEach(tag => {
                        especificaciones.push(tag.querySelector('span').textContent);
                    });
                    
                    // Obtener variantes
                    const variantes = [];
                    document.querySelectorAll('#variantSystemContainer .variant-field').forEach(field => {
                        const nombre = field.querySelector('.variant-field-title span').textContent;
                        const tipo = field.querySelector('.variant-field-title small').textContent.replace('(', '').replace(')', '');
                        const opciones = [];
                        
                        field.querySelectorAll('.variant-option-item input').forEach(input => {
                            if (input.value.trim()) {
                                opciones.push(input.value.trim());
                            }
                        });
                        
                        if (opciones.length > 0) {
                            variantes.push({
                                nombre: nombre,
                                tipo: tipo,
                                opciones: opciones,
                                required: true
                            });
                        }
                    });
                    
                    // Obtener stock
                    const stock = {};
                    const stockTable = document.querySelector('.stock-table');
                    if (stockTable) {
                        const rows = stockTable.querySelectorAll('tbody tr');
                        rows.forEach(row => {
                            const cells = row.querySelectorAll('td');
                            if (cells.length >= 3) {
                                const key = cells[0].textContent;
                                const stockValue = parseInt(cells[2].querySelector('input').value) || 0;
                                stock[key] = stockValue;
                            }
                        });
                    }
                    
                    // Obtener imágenes por variante
                    const imagenesPorVariante = {};
                    const imagenesText = document.getElementById('productImages').value;
                    if (imagenesText.trim()) {
                        const lines = imagenesText.split('\n');
                        lines.forEach(line => {
                            const parts = line.split('|');
                            if (parts.length === 2) {
                                const variante = parts[0].trim();
                                const url = parts[1].trim();
                                imagenesPorVariante[variante] = url;
                            }
                        });
                    }
                    
                    const producto = {
                        id: id,
                        nombre: nombre,
                        categoria: categoria,
                        subcategoria: subcategoria,
                        precioRegular: precioRegular,
                        precioDescuento: precioDescuento,
                        imagen: imagen,
                        descripcion: descripcion,
                        estado: estado,
                        especificaciones: especificaciones,
                        variantes: variantes,
                        stock: stock,
                        imagenesPorVariante: Object.keys(imagenesPorVariante).length > 0 ? imagenesPorVariante : null
                    };
                    
                    if (this.productosEditando) {
                        const index = productos.findIndex(p => p.id === id);
                        productos[index] = producto;
                    } else {
                        productos.push(producto);
                    }
                    
                    // Guardar en localStorage
                    localStorage.setItem('modastyle_productos', JSON.stringify(productos));
                    
                    // Actualizar vista
                    this.renderProductosAdmin();
                    if (window.carrito) {
                        window.carrito.renderProducts();
                        window.carrito.renderCategoryFilters();
                    }
                    this.renderStats();
                    
                    // Mostrar mensaje
                    const formMessage = document.getElementById('formMessage');
                    formMessage.innerHTML = `<i class="fas fa-check-circle"></i><span>Producto ${this.productosEditando ? 'actualizado' : 'guardado'} correctamente</span>`;
                    formMessage.style.display = 'flex';
                    
                    // Resetear formulario
                    this.resetForm();
                    
                    // Cambiar a pestaña de productos
                    this.switchTab('products');
                    
                    setTimeout(() => {
                        formMessage.style.display = 'none';
                    }, 3000);
                }
                
                generarNuevoId() {
                    return Math.max(0, ...productos.map(p => p.id)) + 1;
                }
                
                editarProducto(id) {
                    const producto = productos.find(p => p.id === id);
                    if (!producto) return;
                    
                    this.productosEditando = producto;
                    
                    // Llenar formulario
                    document.getElementById('productName').value = producto.nombre;
                    document.getElementById('productCategory').value = producto.categoria;
                    document.getElementById('productSubcategory').value = producto.subcategoria;
                    document.getElementById('productPrice').value = producto.precioRegular;
                    document.getElementById('productDiscountPrice').value = producto.precioDescuento || '';
                    document.getElementById('productImage').value = producto.imagen;
                    document.getElementById('productDescription').value = producto.descripcion;
                    document.getElementById('productEstado').value = producto.estado;
                    
                    // Llenar especificaciones
                    const specsContainer = document.getElementById('specsContainer');
                    specsContainer.innerHTML = '';
                    producto.especificaciones.forEach(spec => {
                        const tag = document.createElement('div');
                        tag.className = 'tag';
                        tag.innerHTML = `
                            <i class="fas fa-check"></i>
                            <span>${spec}</span>
                            <span class="tag-remove" onclick="this.parentElement.remove()">
                                <i class="fas fa-times"></i>
                            </span>
                        `;
                        specsContainer.appendChild(tag);
                    });
                    
                    // Llenar variantes
                    const variantContainer = document.getElementById('variantSystemContainer');
                    variantContainer.innerHTML = '';
                    producto.variantes.forEach(variant => {
                        this.agregarVariantField(variant.nombre, variant.tipo, variant.opciones);
                    });
                    
                    // Llenar stock
                    this.generarSistemaStock(producto);
                    
                    // Llenar imágenes por variante
                    let imagenesText = '';
                    if (producto.imagenesPorVariante) {
                        Object.entries(producto.imagenesPorVariante).forEach(([variante, url]) => {
                            imagenesText += `${variante}|${url}\n`;
                        });
                    }
                    document.getElementById('productImages').value = imagenesText;
                    
                    // Cambiar a pestaña de agregar
                    this.switchTab('add');
                    
                    // Mostrar mensaje
                    const formMessage = document.getElementById('formMessage');
                    formMessage.innerHTML = `<i class="fas fa-info-circle"></i><span>Editando producto: ${producto.nombre}</span>`;
                    formMessage.className = 'status-message status-info';
                    formMessage.style.display = 'flex';
                }
                
                eliminarProducto(id) {
                    if (confirm('¿Estás seguro de eliminar este producto?')) {
                        const index = productos.findIndex(p => p.id === id);
                        productos.splice(index, 1);
                        
                        // Guardar en localStorage
                        localStorage.setItem('modastyle_productos', JSON.stringify(productos));
                        
                        // Actualizar vista
                        this.renderProductosAdmin();
                        if (window.carrito) {
                            window.carrito.renderProducts();
                            window.carrito.renderCategoryFilters();
                        }
                        this.renderStats();
                        
                        // Mostrar mensaje
                        const formMessage = document.getElementById('formMessage');
                        formMessage.innerHTML = `<i class="fas fa-check-circle"></i><span>Producto eliminado correctamente</span>`;
                        formMessage.className = 'status-message status-success';
                        formMessage.style.display = 'flex';
                        
                        setTimeout(() => {
                            formMessage.style.display = 'none';
                        }, 3000);
                    }
                }
                
                agregarEspecificacion() {
                    const specInput = document.getElementById('specInput');
                    const spec = specInput.value.trim();
                    
                    if (spec) {
                        const tag = document.createElement('div');
                        tag.className = 'tag';
                        tag.innerHTML = `
                            <i class="fas fa-check"></i>
                            <span>${spec}</span>
                            <span class="tag-remove" onclick="this.parentElement.remove()">
                                <i class="fas fa-times"></i>
                            </span>
                        `;
                        
                        document.getElementById('specsContainer').appendChild(tag);
                        specInput.value = '';
                        specInput.focus();
                    }
                }
                
                agregarVariantField(nombre = '', tipo = 'select', opciones = []) {
                    const container = document.getElementById('variantSystemContainer');
                    const id = Date.now();
                    
                    let opcionesHTML = '';
                    if (opciones.length > 0) {
                        opcionesHTML = opciones.map(opcion => `
                            <div class="variant-option-item">
                                <input type="text" value="${opcion}" placeholder="Opción" class="multi-input">
                                <button type="button" class="add-btn" onclick="this.parentElement.remove()">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        `).join('');
                    } else {
                        opcionesHTML = `
                            <div class="variant-option-item">
                                <input type="text" placeholder="Opción" class="multi-input">
                                <button type="button" class="add-btn" onclick="this.parentElement.remove()">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        `;
                    }
                    
                    const field = document.createElement('div');
                    field.className = 'variant-field';
                    field.innerHTML = `
                        <div class="variant-field-header">
                            <div class="variant-field-title">
                                <i class="fas fa-shapes"></i>
                                <span>${nombre || 'Nueva Variante'}</span>
                                <small>(${tipo})</small>
                            </div>
                            <button type="button" class="remove-variant-btn" onclick="this.parentElement.parentElement.remove()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="variant-options-container">
                            <div class="multi-input-container">
                                <input type="text" class="multi-input" placeholder="Nombre de la variante (ej: Color, Talla)"
                                       value="${nombre}" onchange="this.parentElement.parentElement.parentElement.querySelector('.variant-field-title span').textContent = this.value || 'Nueva Variante'">
                                <select class="multi-input" onchange="this.parentElement.parentElement.parentElement.querySelector('.variant-field-title small').textContent = '(' + this.value + ')'">
                                    <option value="select" ${tipo === 'select' ? 'selected' : ''}>Select</option>
                                    <option value="radio" ${tipo === 'radio' ? 'selected' : ''}>Radio</option>
                                    <option value="checkbox" ${tipo === 'checkbox' ? 'selected' : ''}>Checkbox</option>
                                </select>
                            </div>
                            <div class="variant-options-list">
                                ${opcionesHTML}
                            </div>
                            <button type="button" class="add-btn" onclick="admin.agregarOpcionVariante(this)">
                                <i class="fas fa-plus"></i>
                                Agregar Opción
                            </button>
                        </div>
                    `;
                    
                    container.appendChild(field);
                }
                
                agregarOpcionVariante(button) {
                    const container = button.parentElement.querySelector('.variant-options-list');
                    const option = document.createElement('div');
                    option.className = 'variant-option-item';
                    option.innerHTML = `
                        <input type="text" placeholder="Opción" class="multi-input">
                        <button type="button" class="add-btn" onclick="this.parentElement.remove()">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    container.appendChild(option);
                    option.querySelector('input').focus();
                }
                
                generarSistemaStock(producto) {
                    const container = document.getElementById('stockSystemContainer');
                    
                    if (!producto.variantes || producto.variantes.length === 0) {
                        container.innerHTML = `
                            <div class="stock-header">
                                <div class="section-title-admin">
                                    <i class="fas fa-boxes"></i>
                                    Sistema de Stock
                                </div>
                            </div>
                            <div class="status-message status-info">
                                <i class="fas fa-info-circle"></i>
                                <span>Agrega variantes al producto para habilitar el sistema de stock por combinación</span>
                            </div>
                        `;
                        return;
                    }
                    
                    // Generar todas las combinaciones de variantes
                    const combinaciones = this.generarCombinacionesVariantes(producto.variantes);
                    
                    let tablaHTML = `
                        <div class="stock-header">
                            <div class="section-title-admin">
                                <i class="fas fa-boxes"></i>
                                Sistema de Stock por Combinación
                            </div>
                            <button type="button" class="add-btn" onclick="admin.actualizarTablaStock()">
                                <i class="fas fa-sync"></i>
                                Actualizar
                            </button>
                        </div>
                        <div class="stock-table-container">
                            <table class="stock-table">
                                <thead>
                                    <tr>
                                        ${producto.variantes.map(v => `<th>${v.nombre}</th>`).join('')}
                                        <th>Stock</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    combinaciones.forEach(combinacion => {
                        const key = combinacion.join('|');
                        const stockActual = producto.stock && producto.stock[key] ? producto.stock[key] : 0;
                        
                        tablaHTML += `
                            <tr>
                                ${combinacion.map(valor => `<td>${valor}</td>`).join('')}
                                <td>
                                    <input type="number" class="stock-input" value="${stockActual}" min="0" 
                                           data-key="${key}" onchange="admin.actualizarStock('${key}', this.value)">
                                </td>
                            </tr>
                        `;
                    });
                    
                    tablaHTML += `
                                </tbody>
                            </table>
                        </div>
                    `;
                    
                    container.innerHTML = tablaHTML;
                }
                
                generarCombinacionesVariantes(variantes, index = 0, combinacionActual = [], resultado = []) {
                    if (index === variantes.length) {
                        resultado.push([...combinacionActual]);
                        return resultado;
                    }
                    
                    const variante = variantes[index];
                    for (const opcion of variante.opciones) {
                        combinacionActual.push(opcion);
                        this.generarCombinacionesVariantes(variantes, index + 1, combinacionActual, resultado);
                        combinacionActual.pop();
                    }
                    
                    return resultado;
                }
                
                actualizarStock(key, valor) {
                    // Este método se llama cuando se cambia el stock en la tabla
                    // La información se guardará cuando se guarde el producto
                }
                
                actualizarTablaStock() {
                    // Obtener valores actuales del formulario
                    const nombre = document.getElementById('productName').value || 'Producto';
                    const variantes = [];
                    
                    document.querySelectorAll('#variantSystemContainer .variant-field').forEach(field => {
                        const nombre = field.querySelector('.variant-field-title span').textContent;
                        const opciones = [];
                        
                        field.querySelectorAll('.variant-option-item input').forEach(input => {
                            if (input.value.trim()) {
                                opciones.push(input.value.trim());
                            }
                        });
                        
                        if (opciones.length > 0) {
                            variantes.push({
                                nombre: nombre,
                                opciones: opciones
                            });
                        }
                    });
                    
                    const producto = {
                        nombre: nombre,
                        variantes: variantes
                    };
                    
                    this.generarSistemaStock(producto);
                }
                
                resetForm() {
                    document.getElementById('productForm').reset();
                    document.getElementById('specsContainer').innerHTML = '';
                    document.getElementById('variantSystemContainer').innerHTML = '';
                    document.getElementById('stockSystemContainer').innerHTML = `
                        <div class="status-message status-info">
                            <i class="fas fa-info-circle"></i>
                            <span>Agrega variantes al producto para habilitar el sistema de stock</span>
                        </div>
                    `;
                    this.productosEditando = null;
                    document.getElementById('formMessage').style.display = 'none';
                }
                
                // ==================== MÉTODOS DE CATEGORÍAS ====================
                
                renderCategoriasAdmin() {
                    const container = document.getElementById('categoriesListAdmin');
                    
                    container.innerHTML = categorias.filter(c => c.id !== 'todo').map(categoria => {
                        const productosEnCategoria = productos.filter(p => p.categoria === categoria.id).length;
                        
                        return `
                            <div class="category-item-admin" data-category-id="${categoria.id}" draggable="true">
                                <div class="category-info-admin">
                                    <div class="category-icon-admin" style="background: ${categoria.color};">
                                        <i class="fas ${categoria.icono || 'fa-tag'}"></i>
                                    </div>
                                    <div class="category-details-admin">
                                        <div class="category-name-admin">${categoria.nombre}</div>
                                        <div class="category-stats-admin">
                                            <span class="category-product-count">${productosEnCategoria} productos</span>
                                            <span class="category-color" style="background: ${categoria.color}"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="category-actions-admin">
                                    <button class="category-action-btn edit-category-btn" onclick="admin.editarCategoria('${categoria.id}')">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="category-action-btn delete-category-btn" onclick="admin.eliminarCategoria('${categoria.id}')" ${productosEnCategoria > 0 ? 'disabled' : ''}>
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                    }).join('');
                    
                    this.setupDragAndDropCategorias();
                }
                
                setupDragAndDropCategorias() {
                    const container = document.getElementById('categoriesListAdmin');
                    const items = container.querySelectorAll('.category-item-admin');
                    
                    items.forEach(item => {
                        item.addEventListener('dragstart', (e) => {
                            e.dataTransfer.setData('text/plain', item.dataset.categoryId);
                            item.classList.add('dragging');
                        });
                        
                        item.addEventListener('dragend', () => {
                            item.classList.remove('dragging');
                        });
                    });
                    
                    container.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        const afterElement = this.getDragAfterElement(container, e.clientY);
                        const draggable = document.querySelector('.category-item-admin.dragging');
                        
                        if (afterElement == null) {
                            container.appendChild(draggable);
                        } else {
                            container.insertBefore(draggable, afterElement);
                        }
                        
                        // Actualizar orden
                        this.actualizarOrdenCategorias();
                    });
                }
                
                actualizarOrdenCategorias() {
                    const container = document.getElementById('categoriesListAdmin');
                    const items = container.querySelectorAll('.category-item-admin');
                    
                    items.forEach((item, index) => {
                        const categoriaId = item.dataset.categoryId;
                        const categoria = categorias.find(c => c.id === categoriaId);
                        if (categoria) {
                            categoria.orden = index + 1;
                        }
                    });
                    
                    // Guardar en localStorage
                    localStorage.setItem('modastyle_categorias', JSON.stringify(categorias));
                }
                
                agregarCategoria() {
                    const nombre = document.getElementById('newCategoryName').value.trim();
                    const color = document.getElementById('newCategoryColor').value;
                    const icono = document.getElementById('newCategoryIcon').value.trim();
                    
                    if (!nombre) {
                        this.showMessage('error', 'El nombre de la categoría es requerido');
                        return;
                    }
                    
                    const id = nombre.toLowerCase().replace(/\s+/g, '_');
                    
                    if (categorias.some(c => c.id === id)) {
                        this.showMessage('error', 'Ya existe una categoría con ese nombre');
                        return;
                    }
                    
                    const nuevaCategoria = {
                        id: id,
                        nombre: nombre,
                        color: color,
                        icono: icono || 'fa-tag',
                        orden: categorias.filter(c => c.id !== 'todo').length + 1
                    };
                    
                    categorias.push(nuevaCategoria);
                    
                    // Guardar en localStorage
                    localStorage.setItem('modastyle_categorias', JSON.stringify(categorias));
                    
                    // Actualizar vistas
                    this.renderCategoriasAdmin();
                    this.renderCategoriasSelect();
                    if (window.carrito) {
                        window.carrito.renderCategoryFilters();
                    }
                    this.renderStats();
                    
                    // Resetear formulario
                    document.getElementById('newCategoryName').value = '';
                    document.getElementById('newCategoryColor').value = '#D4AF37';
                    document.getElementById('newCategoryIcon').value = '';
                    
                    this.showMessage('success', 'Categoría agregada correctamente');
                }
                
                editarCategoria(id) {
                    const categoria = categorias.find(c => c.id === id);
                    if (!categoria) return;
                    
                    this.categoriaEditando = categoria;
                    
                    document.getElementById('newCategoryName').value = categoria.nombre;
                    document.getElementById('newCategoryColor').value = categoria.color;
                    document.getElementById('newCategoryIcon').value = categoria.icono;
                    
                    const addBtn = document.getElementById('addCategoryBtn');
                    addBtn.innerHTML = '<i class="fas fa-save"></i> Actualizar Categoría';
                    addBtn.onclick = () => this.actualizarCategoria();
                }
                
                actualizarCategoria() {
                    if (!this.categoriaEditando) return;
                    
                    const nombre = document.getElementById('newCategoryName').value.trim();
                    const color = document.getElementById('newCategoryColor').value;
                    const icono = document.getElementById('newCategoryIcon').value.trim();
                    
                    if (!nombre) {
                        this.showMessage('error', 'El nombre de la categoría es requerido');
                        return;
                    }
                    
                    this.categoriaEditando.nombre = nombre;
                    this.categoriaEditando.color = color;
                    this.categoriaEditando.icono = icono || 'fa-tag';
                    
                    // Guardar en localStorage
                    localStorage.setItem('modastyle_categorias', JSON.stringify(categorias));
                    
                    // Actualizar vistas
                    this.renderCategoriasAdmin();
                    this.renderCategoriasSelect();
                    if (window.carrito) {
                        window.carrito.renderCategoryFilters();
                    }
                    this.renderStats();
                    
                    // Resetear
                    this.resetFormCategoria();
                    
                    this.showMessage('success', 'Categoría actualizada correctamente');
                }
                
                eliminarCategoria(id) {
                    if (id === 'todo') {
                        this.showMessage('error', 'No se puede eliminar la categoría TODO');
                        return;
                    }
                    
                    const productosEnCategoria = productos.filter(p => p.categoria === id).length;
                    
                    if (productosEnCategoria > 0) {
                        this.showMessage('error', 'No se puede eliminar una categoría con productos');
                        return;
                    }
                    
                    if (confirm('¿Estás seguro de eliminar esta categoría?')) {
                        const index = categorias.findIndex(c => c.id === id);
                        categorias.splice(index, 1);
                        
                        // Guardar en localStorage
                        localStorage.setItem('modastyle_categorias', JSON.stringify(categorias));
                        
                        // Actualizar vistas
                        this.renderCategoriasAdmin();
                        this.renderCategoriasSelect();
                        if (window.carrito) {
                            window.carrito.renderCategoryFilters();
                        }
                        this.renderStats();
                        
                        this.showMessage('success', 'Categoría eliminada correctamente');
                    }
                }
                
                resetFormCategoria() {
                    document.getElementById('newCategoryName').value = '';
                    document.getElementById('newCategoryColor').value = '#D4AF37';
                    document.getElementById('newCategoryIcon').value = '';
                    
                    const addBtn = document.getElementById('addCategoryBtn');
                    addBtn.innerHTML = '<i class="fas fa-plus"></i> Agregar Nueva Categoría';
                    addBtn.onclick = () => this.agregarCategoria();
                    
                    this.categoriaEditando = null;
                }
                
                // ==================== MÉTODOS DE CUPONES ====================
                
                renderCuponesAdmin() {
                    const container = document.getElementById('couponsListAdmin');
                    
                    container.innerHTML = cupones.map(cupon => {
                        let tipoTexto = '';
                        let icono = 'fas fa-tag';
                        
                        switch (cupon.tipo) {
                            case 'percentage':
                                tipoTexto = `${cupon.valor}% DESCUENTO`;
                                icono = 'fas fa-percentage';
                                break;
                            case 'free_shipping':
                                tipoTexto = 'ENVÍO GRATIS';
                                icono = 'fas fa-shipping-fast';
                                break;
                            case 'bogo_2x1':
                                tipoTexto = '2X1';
                                icono = 'fas fa-gift';
                                break;
                            case 'bogo_3x2':
                                tipoTexto = '3X2';
                                icono = 'fas fa-gift';
                                break;
                        }
                        
                        const fechaInicio = new Date(cupon.fechaInicio);
                        const fechaFin = new Date(cupon.fechaFin);
                        const fechaFormateada = `${fechaInicio.toLocaleDateString('es-ES')} - ${fechaFin.toLocaleDateString('es-ES')}`;
                        
                        return `
                            <div class="editor-category-item" data-coupon-id="${cupon.id}">
                                <div class="editor-category-header">
                                    <div class="editor-category-title">
                                        <i class="${icono}" style="color: var(--coupon)"></i>
                                        ${cupon.codigo}
                                        <span class="color-preview" style="background: var(--coupon);"></span>
                                    </div>
                                    <div class="editor-category-actions">
                                        <button class="category-action-btn edit-category-btn" onclick="admin.editarCupon(${cupon.id})">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="category-action-btn delete-category-btn" onclick="admin.eliminarCupon(${cupon.id})">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="editor-category-content">
                                    <div class="editor-category-fields">
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-ticket-alt"></i> Tipo:
                                            </label>
                                            <input type="text" class="form-input-admin" value="${tipoTexto}" readonly="">
                                        </div>
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-align-left"></i> Descripción:
                                            </label>
                                            <input type="text" class="form-input-admin" value="${cupon.descripcion}" readonly="">
                                        </div>
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-calendar"></i> Validez:
                                            </label>
                                            <input type="text" class="form-input-admin" value="${fechaFormateada}" readonly="">
                                        </div>
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-hashtag"></i> Usos:
                                            </label>
                                            <input type="text" class="form-input-admin" value="${cupon.usosActuales} / ${cupon.usosMaximos || '∞'} (${cupon.usosMaximos ? cupon.usosMaximos - cupon.usosActuales : '∞'} restantes)" readonly="">
                                        </div>
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-toggle-on"></i> Estado:
                                            </label>
                                            <input type="text" class="form-input-admin" value="${cupon.activo ? 'Activo' : 'Inactivo'}" readonly="">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
                
                toggleCouponFields(tipo) {
                    const percentageField = document.getElementById('percentageField');
                    const bogoField = document.getElementById('bogoField');
                    
                    if (tipo === 'percentage') {
                        percentageField.style.display = 'block';
                        bogoField.style.display = 'none';
                    } else if (tipo === 'bogo_2x1' || tipo === 'bogo_3x2') {
                        percentageField.style.display = 'none';
                        bogoField.style.display = 'block';
                    } else {
                        percentageField.style.display = 'none';
                        bogoField.style.display = 'none';
                    }
                }
                
                guardarCupon() {
                    const codigo = document.getElementById('couponCode').value.trim();
                    const tipo = document.getElementById('couponType').value;
                    const descripcion = document.getElementById('couponDescription').value.trim();
                    const fechaInicio = document.getElementById('couponStartDate').value;
                    const fechaFin = document.getElementById('couponEndDate').value;
                    const usosPorCliente = parseInt(document.getElementById('couponUsesPerCustomer').value) || 0;
                    const montoMinimo = parseInt(document.getElementById('couponMinAmount').value) || 0;
                    const usosMaximos = parseInt(document.getElementById('couponMaxUses').value) || 0;
                    
                    if (!codigo || !tipo || !fechaInicio || !fechaFin) {
                        this.showMessage('error', 'Completa todos los campos requeridos');
                        return;
                    }
                    
                    let valor = 0;
                    let productosAplicables = [];
                    
                    if (tipo === 'percentage') {
                        valor = parseInt(document.getElementById('couponPercentage').value) || 0;
                        if (valor < 1 || valor > 100) {
                            this.showMessage('error', 'El porcentaje debe estar entre 1 y 100');
                            return;
                        }
                    } else if (tipo === 'bogo_2x1' || tipo === 'bogo_3x2') {
                        const productosText = document.getElementById('couponProducts').value.trim();
                        if (productosText) {
                            productosAplicables = productosText.split(',').map(id => parseInt(id.trim())).filter(id => !isNaN(id));
                        }
                    }
                    
                    const cupon = {
                        id: this.cuponEditando ? this.cuponEditando.id : cupones.length > 0 ? Math.max(...cupones.map(c => c.id)) + 1 : 1,
                        codigo: codigo.toUpperCase(),
                        tipo: tipo,
                        valor: valor,
                        descripcion: descripcion || `${codigo} - Cupón de descuento`,
                        fechaInicio: fechaInicio,
                        fechaFin: fechaFin,
                        usosPorCliente: usosPorCliente,
                        usosMaximos: usosMaximos,
                        usosActuales: this.cuponEditando ? this.cuponEditando.usosActuales : 0,
                        montoMinimo: montoMinimo,
                        productosAplicables: productosAplicables,
                        activo: true
                    };
                    
                    if (this.cuponEditando) {
                        const index = cupones.findIndex(c => c.id === cupon.id);
                        cupones[index] = cupon;
                    } else {
                        cupones.push(cupon);
                    }
                    
                    // Guardar en localStorage
                    localStorage.setItem('modastyle_cupones', JSON.stringify(cupones));
                    
                    // Actualizar vista
                    this.renderCuponesAdmin();
                    
                    // Resetear formulario
                    this.resetCouponForm();
                    
                    this.showMessage('success', `Cupón ${this.cuponEditando ? 'actualizado' : 'creado'} correctamente`, 'couponsMessage');
                }
                
                editarCupon(id) {
                    const cupon = cupones.find(c => c.id === id);
                    if (!cupon) return;
                    
                    this.cuponEditando = cupon;
                    
                    document.getElementById('couponCode').value = cupon.codigo;
                    document.getElementById('couponType').value = cupon.tipo;
                    document.getElementById('couponDescription').value = cupon.descripcion;
                    document.getElementById('couponStartDate').value = cupon.fechaInicio;
                    document.getElementById('couponEndDate').value = cupon.fechaFin;
                    document.getElementById('couponUsesPerCustomer').value = cupon.usosPorCliente;
                    document.getElementById('couponMinAmount').value = cupon.montoMinimo;
                    document.getElementById('couponMaxUses').value = cupon.usosMaximos;
                    
                    if (cupon.tipo === 'percentage') {
                        document.getElementById('couponPercentage').value = cupon.valor;
                    } else if (cupon.tipo === 'bogo_2x1' || cupon.tipo === 'bogo_3x2') {
                        document.getElementById('couponProducts').value = cupon.productosAplicables.join(', ');
                    }
                    
                    this.toggleCouponFields(cupon.tipo);
                    
                    const saveBtn = document.getElementById('saveCouponBtn');
                    saveBtn.innerHTML = '<i class="fas fa-save"></i> Actualizar Cupón';
                }
                
                eliminarCupon(id) {
                    if (confirm('¿Estás seguro de eliminar este cupón?')) {
                        const index = cupones.findIndex(c => c.id === id);
                        cupones.splice(index, 1);
                        
                        localStorage.setItem('modastyle_cupones', JSON.stringify(cupones));
                        this.renderCuponesAdmin();
                        this.showMessage('success', 'Cupón eliminado correctamente', 'couponsMessage');
                    }
                }
                
                resetCouponForm() {
                    document.getElementById('couponCode').value = '';
                    document.getElementById('couponType').value = '';
                    document.getElementById('couponPercentage').value = '';
                    document.getElementById('couponProducts').value = '';
                    document.getElementById('couponStartDate').value = '';
                    document.getElementById('couponEndDate').value = '';
                    document.getElementById('couponUsesPerCustomer').value = '0';
                    document.getElementById('couponMinAmount').value = '0';
                    document.getElementById('couponMaxUses').value = '0';
                    document.getElementById('couponDescription').value = '';
                    
                    document.getElementById('percentageField').style.display = 'none';
                    document.getElementById('bogoField').style.display = 'none';
                    
                    const saveBtn = document.getElementById('saveCouponBtn');
                    saveBtn.innerHTML = '<i class="fas fa-save"></i> Guardar Cupón';
                    
                    this.cuponEditando = null;
                }
                
                // ==================== MÉTODOS DE OFERTAS RELÁMPAGO ====================
                
                loadFlashSaleConfig() {
                    document.getElementById('flashSaleEnabled').checked = flashSaleConfig.enabled;
                    document.getElementById('flashSaleTitleInput').value = flashSaleConfig.title;
                    document.getElementById('flashSaleDescriptionInput').value = flashSaleConfig.description;
                    document.getElementById('flashSaleButtonText').value = flashSaleConfig.buttonText;
                    
                    if (flashSaleConfig.products && flashSaleConfig.products.length > 0) {
                        document.getElementById('flashSaleProducts').value = flashSaleConfig.products.join(',');
                    }
                    
                    this.updateFlashSalePreview();
                }
                
                guardarFlashSaleConfig() {
                    flashSaleConfig.enabled = document.getElementById('flashSaleEnabled').checked;
                    flashSaleConfig.title = document.getElementById('flashSaleTitleInput').value;
                    flashSaleConfig.description = document.getElementById('flashSaleDescriptionInput').value;
                    flashSaleConfig.buttonText = document.getElementById('flashSaleButtonText').value;
                    
                    const productsText = document.getElementById('flashSaleProducts').value.trim();
                    flashSaleConfig.products = productsText ? 
                        productsText.split(',').map(id => parseInt(id.trim())).filter(id => !isNaN(id)) : 
                        [];
                    
                    flashSaleConfig.startDate = document.getElementById('flashSaleStartDate').value || null;
                    flashSaleConfig.endDate = document.getElementById('flashSaleEndDate').value || null;
                    
                    // Guardar en localStorage
                    localStorage.setItem('modastyle_flash_sale', JSON.stringify(flashSaleConfig));
                    
                    // Actualizar banner si existe
                    if (window.carrito && window.carrito.flashSaleManager) {
                        window.carrito.flashSaleManager.loadConfig();
                        window.carrito.flashSaleManager.checkAndShowBanner();
                    }
                    
                    this.showMessage('success', 'Configuración guardada correctamente', 'flashSaleMessage');
                }
                
                updateFlashSalePreview() {
                    const enabled = document.getElementById('flashSaleEnabled').checked;
                    const title = document.getElementById('flashSaleTitleInput').value;
                    const description = document.getElementById('flashSaleDescriptionInput').value;
                    const buttonText = document.getElementById('flashSaleButtonText').value;
                    
                    document.getElementById('previewFlashSaleTitle').textContent = title;
                    document.getElementById('previewFlashSaleDescription').textContent = description;
                    
                    const previewBtn = document.querySelector('.section-preview .flash-sale-btn');
                    if (previewBtn) {
                        previewBtn.innerHTML = `<i class="fas fa-shopping-bag"></i> ${buttonText}`;
                    }
                }
                
                // ==================== MÉTODOS DE EDITOR DE SECCIÓN ====================
                
                loadSectionConfig() {
                    document.getElementById('sectionTitle').value = sectionConfig.title;
                    document.getElementById('sectionSubtitle').value = sectionConfig.subtitle;
                }
                
                saveSectionConfig() {
                    sectionConfig.title = document.getElementById('sectionTitle').value;
                    sectionConfig.subtitle = document.getElementById('sectionSubtitle').value;
                    
                    // Guardar en localStorage
                    localStorage.setItem('modastyle_section_config', JSON.stringify(sectionConfig));
                    
                    // Actualizar vista principal
                    if (window.carrito) {
                        window.carrito.updateSectionCategories();
                    }
                    
                    this.showMessage('success', 'Configuración guardada correctamente', 'editorMessage');
                }
                
                renderSectionCategories() {
                    const container = document.getElementById('sectionCategoriesList');
                    
                    container.innerHTML = sectionCategories.map(categoria => {
                        return `
                            <div class="editor-category-item" data-category-id="${categoria.id}" draggable="true">
                                <div class="editor-category-header">
                                    <div class="editor-category-title">
                                        <i class="fas fa-tag"></i> ${categoria.name}
                                        <span class="color-preview" style="background: ${categoria.buttonColor};"></span>
                                    </div>
                                    <div class="editor-category-actions">
                                        <button class="category-action-btn edit-category-btn" onclick="admin.editarSectionCategory(${categoria.id})">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="category-action-btn delete-category-btn" onclick="admin.eliminarSectionCategory(${categoria.id})">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="editor-category-content">
                                    <div class="editor-category-preview">
                                        <img src="${categoria.image}" alt="${categoria.name}">
                                    </div>
                                    <div class="editor-category-fields">
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-font"></i> Nombre:
                                            </label>
                                            <input type="text" class="form-input-admin" value="${categoria.name}" readonly="">
                                        </div>
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-align-left"></i> Descripción:
                                            </label>
                                            <input type="text" class="form-input-admin" value="${categoria.description}" readonly="">
                                        </div>
                                        <div class="form-group-admin">
                                            <label class="form-label-admin">
                                                <i class="fas fa-link"></i> Acción:
                                            </label>
                                            <input type="text" class="form-input-admin" value="${categoria.action}" readonly="">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                    
                    this.setupDragAndDropSectionCategories();
                }
                
                setupDragAndDropSectionCategories() {
                    const container = document.getElementById('sectionCategoriesList');
                    const items = container.querySelectorAll('.editor-category-item');
                    
                    items.forEach(item => {
                        item.addEventListener('dragstart', (e) => {
                            e.dataTransfer.setData('text/plain', item.dataset.categoryId);
                            item.classList.add('dragging');
                        });
                        
                        item.addEventListener('dragend', () => {
                            item.classList.remove('dragging');
                        });
                    });
                    
                    container.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        const afterElement = this.getDragAfterElement(container, e.clientY);
                        const draggable = document.querySelector('.editor-category-item.dragging');
                        
                        if (afterElement == null) {
                            container.appendChild(draggable);
                        } else {
                            container.insertBefore(draggable, afterElement);
                        }
                        
                        // Actualizar orden
                        this.actualizarOrdenSectionCategories();
                    });
                }
                
                actualizarOrdenSectionCategories() {
                    const container = document.getElementById('sectionCategoriesList');
                    const items = container.querySelectorAll('.editor-category-item');
                    
                    items.forEach((item, index) => {
                        const categoriaId = parseInt(item.dataset.categoryId);
                        const categoria = sectionCategories.find(c => c.id === categoriaId);
                        if (categoria) {
                            categoria.order = index + 1;
                        }
                    });
                    
                    // Guardar en localStorage
                    localStorage.setItem('modastyle_section_categories', JSON.stringify(sectionCategories));
                    
                    // Actualizar vista principal
                    if (window.carrito) {
                        window.carrito.updateSectionCategories();
                    }
                }
                
                addSectionCategory() {
                    // En una implementación real, aquí se abriría un modal para agregar una nueva categoría
                    alert('Función para agregar nueva categoría de sección. En una implementación real, se abriría un formulario.');
                }
                
                editarSectionCategory(id) {
                    const categoria = sectionCategories.find(c => c.id === id);
                    if (!categoria) return;
                    
                    this.sectionCategoryEditando = categoria;
                    
                    // En una implementación real, aquí se llenaría un formulario de edición
                    alert(`Editando categoría: ${categoria.name}`);
                }
                
                eliminarSectionCategory(id) {
                    if (confirm('¿Estás seguro de eliminar esta categoría de la sección?')) {
                        const index = sectionCategories.findIndex(c => c.id === id);
                        sectionCategories.splice(index, 1);
                        
                        localStorage.setItem('modastyle_section_categories', JSON.stringify(sectionCategories));
                        this.renderSectionCategories();
                        
                        if (window.carrito) {
                            window.carrito.updateSectionCategories();
                        }
                        
                        this.showMessage('success', 'Categoría eliminada', 'editorMessage');
                    }
                }
                
                togglePreviewSection() {
                    const preview = document.getElementById('sectionPreview');
                    const isVisible = preview.style.display === 'block';
                    
                    if (!isVisible) {
                        // Actualizar vista previa
                        document.getElementById('previewSectionTitle').textContent = sectionConfig.title;
                        document.getElementById('previewSectionSubtitle').textContent = sectionConfig.subtitle;
                        
                        const previewGrid = document.getElementById('previewCategoriesGrid');
                        previewGrid.innerHTML = sectionCategories.map(categoria => `
                            <div class="category-card">
                                <img src="${categoria.image}" alt="${categoria.name}" class="category-image">
                                <div class="category-overlay">
                                    <h3 class="category-name">${categoria.name}</h3>
                                    <p class="category-description">${categoria.description}</p>
                                    <span class="category-badge" style="background: ${categoria.buttonColor}">Ver productos</span>
                                </div>
                            </div>
                        `).join('');
                    }
                    
                    preview.style.display = isVisible ? 'none' : 'block';
                }
                
                // ==================== MÉTODOS DE ESTADÍSTICAS ====================
                
                renderStats() {
                    const container = document.getElementById('statsGrid');
                    
                    const totalProductos = productos.length;
                    const productosHombre = productos.filter(p => p.categoria === 'hombre').length;
                    const productosAccesorios = productos.filter(p => p.categoria === 'accesorios').length;
                    const productosMujer = productos.filter(p => p.categoria === 'mujer').length;
                    const productosKids = productos.filter(p => p.categoria === 'kids').length;
                    const productosOferta = productos.filter(p => p.estado === 'oferta').length;
                    
                    container.innerHTML = `
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--admin);">
                                <i class="fas fa-boxes"></i>
                            </div>
                            <div class="stat-value">${totalProductos}</div>
                            <div class="stat-label">Productos Totales</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: #2563EB;">
                                <i class="fas fa-user-tie"></i>
                            </div>
                            <div class="stat-value">${productosHombre}</div>
                            <div class="stat-label">Hombre</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: #7C3AED;">
                                <i class="fas fa-briefcase"></i>
                            </div>
                            <div class="stat-value">${productosAccesorios}</div>
                            <div class="stat-label">Accesorios</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: #DB2777;">
                                <i class="fas fa-female"></i>
                            </div>
                            <div class="stat-value">${productosMujer}</div>
                            <div class="stat-label">Mujer</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: #059669;">
                                <i class="fas fa-child"></i>
                            </div>
                            <div class="stat-value">${productosKids}</div>
                            <div class="stat-label">Kids</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--coupon);">
                                <i class="fas fa-percentage"></i>
                            </div>
                            <div class="stat-value">${productosOferta}</div>
                            <div class="stat-label">En Oferta</div>
                        </div>
                    `;
                }
                
                // ==================== MÉTODOS DE EXPORTACIÓN ====================
                
                exportHtml() {
                    try {
                        const exportClean = document.getElementById('exportClean').checked;
                        const exportIncludeData = document.getElementById('exportIncludeData').checked;
                        
                        // Crear un nuevo documento
                        const doc = document.implementation.createHTMLDocument("ModaStyle Exportado");
                        
                        // Clonar todo el documento actual
                        const clone = document.documentElement.cloneNode(true);
                        doc.replaceChild(clone, doc.documentElement);
                        
                        // Si se solicitan datos actualizados, reemplazar las variables JavaScript
                        if (exportIncludeData) {
                            this.actualizarDatosEnExportacion(doc);
                        }
                        
                         // Si se solicita limpieza, remover el panel de administración
                        if (exportClean) {
                            this.limpiarPanelAdministracion(doc);
                        }
                        
                        // Convertir el documento a string
                        const htmlContent = '<!DOCTYPE html>' + '\n' + doc.documentElement.outerHTML;
                        
                        // Crear y descargar el archivo
                        this.descargarArchivo(htmlContent, 'modastyle-tienda-completa.html');
                        
                        this.showMessage('success', 'HTML exportado correctamente');
                        
                    } catch (error) {
                        console.error('Error al exportar HTML:', error);
                        this.showMessage('error', 'Error al exportar HTML: ' + error.message);
                    }
                }
                
                actualizarDatosEnExportacion(doc) {
                    // Actualizar las variables JavaScript con los datos actuales
                    const scripts = doc.querySelectorAll('script');
                    
                    scripts.forEach(script => {
                        if (script.textContent.includes('// ==================== DATOS INICIALES ====================')) {
                            // Reemplazar la sección de datos iniciales con datos actualizados
                            let scriptContent = script.textContent;
                            
                            // Actualizar productos
                            const productosStr = JSON.stringify(productos, null, 2);
                            scriptContent = scriptContent.replace(
                                /let productos = \[.*?\];/s,
                                `let productos = ${productosStr};`
                            );
                            
                            // Actualizar categorías
                            const categoriasStr = JSON.stringify(categorias, null, 2);
                            scriptContent = scriptContent.replace(
                                /let categorias = \[.*?\];/s,
                                `let categorias = ${categoriasStr};`
                            );
                            
                            // Actualizar categorías de sección
                            const sectionCategoriesStr = JSON.stringify(sectionCategories, null, 2);
                            scriptContent = scriptContent.replace(
                                /let sectionCategories = \[.*?\];/s,
                                `let sectionCategories = ${sectionCategoriesStr};`
                            );
                            
                            // Actualizar configuración de sección
                            const sectionConfigStr = JSON.stringify(sectionConfig, null, 2);
                            scriptContent = scriptContent.replace(
                                /let sectionConfig = \{.*?\};/s,
                                `let sectionConfig = ${sectionConfigStr};`
                            );
                            
                            // Actualizar cupones
                            const cuponesStr = JSON.stringify(cupones, null, 2);
                            scriptContent = scriptContent.replace(
                                /let cupones = \[.*?\];/s,
                                `let cupones = ${cuponesStr};`
                            );
                            
                            // Actualizar configuración de ofertas relámpago
                            const flashSaleConfigStr = JSON.stringify(flashSaleConfig, null, 2);
                            scriptContent = scriptContent.replace(
                                /let flashSaleConfig = \{.*?\};/s,
                                `let flashSaleConfig = ${flashSaleConfigStr};`
                            );
                            
                            script.textContent = scriptContent;
                        }
                    });
                    
                    // También actualizar la sección de categorías en el HTML
                    const categoriesGrid = doc.getElementById('categoriesGrid');
                    if (categoriesGrid) {
                        // Ordenar categorías por orden
                        const sortedCategories = [...sectionCategories].sort((a, b) => a.order - b.order);
                        
                        categoriesGrid.innerHTML = sortedCategories.map(categoria => {
                            return `
                                <div class="category-card" onclick="${categoria.action}">
                                    <img src="${categoria.image}" alt="${categoria.name}" class="category-image">
                                    <div class="category-overlay">
                                        <h3 class="category-name">${categoria.name}</h3>
                                        <p class="category-description">${categoria.description}</p>
                                        <span class="category-badge" style="background: ${categoria.buttonColor}">Ver productos</span>
                                    </div>
                                </div>
                            `;
                        }).join('');
                    }
                    
                    // Actualizar título y subtítulo de la sección
                    const mainSectionTitle = doc.getElementById('mainSectionTitle');
                    const mainSectionSubtitle = doc.getElementById('mainSectionSubtitle');
                    
                    if (mainSectionTitle) {
                        mainSectionTitle.textContent = sectionConfig.title;
                    }
                    
                    if (mainSectionSubtitle) {
                        mainSectionSubtitle.textContent = sectionConfig.subtitle;
                    }
                    
                    // Actualizar productos en el banner de ofertas relámpago
                    this.actualizarFlashSaleEnExportacion(doc);
                }
                
                actualizarFlashSaleEnExportacion(doc) {
                    // Actualizar productos del banner
                    const flashSaleProductsContainer = doc.querySelector('.flash-sale-products');
                    if (!flashSaleProductsContainer) return;
                    
                    let productsToShow = [];
                    
                    // Si hay productos específicos configurados
                    if (flashSaleConfig.products && flashSaleConfig.products.length > 0) {
                        productsToShow = productos.filter(p => flashSaleConfig.products.includes(p.id));
                    } else {
                        // Mostrar productos con estado "oferta"
                        productsToShow = productos.filter(p => p.estado === 'oferta');
                    }
                    
                    // Limitar a 3 productos para mostrar en el banner
                    productsToShow = productsToShow.slice(0, 3);
                    
                    if (productsToShow.length === 0) {
                        flashSaleProductsContainer.style.display = 'none';
                        return;
                    }
                    
                    flashSaleProductsContainer.innerHTML = productsToShow.map(product => `
                        <div class="flash-product-preview" onclick="carrito.filterFlashSaleProducts(); carrito.scrollToProduct(${product.id})">
                            <img src="${product.imagen}" alt="${product.nombre}">
                        </div>
                    `).join('');
                    
                    flashSaleProductsContainer.style.display = 'flex';
                }
                
                limpiarPanelAdministracion(doc) {
                    // Remover panel de administración y botones relacionados
                    const adminPanel = doc.getElementById('adminPanel');
                    if (adminPanel) {
                        adminPanel.remove();
                    }
                    
                    const adminBtn = doc.getElementById('adminBtn');
                    if (adminBtn) {
                        adminBtn.remove();
                    }
                    
                    const authModal = doc.getElementById('authModal');
                    if (authModal) {
                        authModal.remove();
                    }
                    
                    // Remover cualquier script relacionado con administración
                    const scripts = doc.querySelectorAll('script');
                    scripts.forEach(script => {
                        const scriptContent = script.textContent;
                        if (scriptContent.includes('class Administracion') || 
                            scriptContent.includes('showAuthModal') ||
                            scriptContent.includes('verificarPin')) {
                            script.remove();
                        }
                    });
                    
                    // También limpiar la variable admin del objeto window en el script principal
                    const mainScript = doc.querySelector('script:last-of-type');
                    if (mainScript) {
                        let mainScriptContent = mainScript.textContent;
                        
                        // Remover inicialización del admin
                        mainScriptContent = mainScriptContent.replace(
                            /window\.admin = new Administracion\(\);/g,
                            ''
                        );
                        
                        // Remover referencias al admin en otros lugares
                        mainScriptContent = mainScriptContent.replace(
                            /admin\./g,
                            '// admin.'
                        );
                        
                        mainScript.textContent = mainScriptContent;
                    }
                }
                
                descargarArchivo(content, filename) {
                    const blob = new Blob([content], { type: 'text/html' });
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    a.style.display = 'none';
                    
                    document.body.appendChild(a);
                    a.click();
                    
                    setTimeout(() => {
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                    }, 100);
                }
                
                showMessage(type, message, elementId = 'formMessage') {
                    const messageElement = document.getElementById(elementId);
                    if (messageElement) {
                        messageElement.innerHTML = `<i class="fas fa-${type === 'success' ? 'check' : 'times'}-circle"></i><span>${message}</span>`;
                        messageElement.className = `status-message status-${type}`;
                        messageElement.style.display = 'flex';
                        
                        setTimeout(() => {
                            messageElement.style.display = 'none';
                        }, 3000);
                    }
                }
            }

            // ==================== INICIALIZACIÓN DE LA APLICACIÓN ====================
            
            // Inicializar carrito
            window.carrito = new Carrito();
            
            // Inicializar administración
            window.admin = new Administracion();
            
            // Inicializar el sistema de ofertas relámpago
            window.flashSaleManager = new FlashSaleManager();
            
            // Verificar y mostrar banner si corresponde
            if (flashSaleConfig.enabled) {
                window.carrito.flashSaleManager.checkAndShowBanner();
            }

            // Inicializar el sistema de versiones (ya se hizo en el constructor del carrito)
            // El VersionManager se inicializa automáticamente cuando se crea el carrito

            // Inicializar el buscador (ya se hizo en el constructor del carrito)
            // window.buscador = new Buscador();

            // ==================== CONFIGURACIÓN ADICIONAL ====================
            
            // Configurar la fecha actual para los campos de fecha
            document.addEventListener('DOMContentLoaded', function() {
                // Establecer fechas por defecto para cupones
                const today = new Date();
                const tomorrow = new Date();
                tomorrow.setDate(today.getDate() + 30);
                
                const formatDate = (date) => {
                    return date.toISOString().split('T')[0];
                };
                
                // Fecha de inicio (hoy)
                const startDateInput = document.getElementById('couponStartDate');
                if (startDateInput && !startDateInput.value) {
                    startDateInput.value = formatDate(today);
                }
                
                // Fecha de fin (30 días después)
                const endDateInput = document.getElementById('couponEndDate');
                if (endDateInput && !endDateInput.value) {
                    endDateInput.value = formatDate(tomorrow);
                }
                
                // Fechas para ofertas relámpago
                const flashStartInput = document.getElementById('flashSaleStartDate');
                const flashEndInput = document.getElementById('flashSaleEndDate');
                
                if (flashStartInput) {
                    const now = new Date();
                    const inOneHour = new Date(now.getTime() + 60 * 60 * 1000);
                    const in24Hours = new Date(now.getTime() + 24 * 60 * 60 * 1000);
                    
                    // Formato para datetime-local
                    const formatDateTime = (date) => {
                        return date.toISOString().slice(0, 16);
                    };
                    
                    if (!flashStartInput.value) {
                        flashStartInput.value = formatDateTime(inOneHour);
                    }
                    
                    if (!flashEndInput.value) {
                        flashEndInput.value = formatDateTime(in24Hours);
                    }
                }
                
                // Configurar drag & drop para productos en admin
                if (window.admin) {
                    window.admin.setupDragAndDropProductos();
                    window.admin.setupDragAndDropCategorias();
                    window.admin.setupDragAndDropSectionCategories();
                }
                
                // Configurar búsqueda en tiempo real
                if (window.buscador) {
                    // Asegurar que el buscador esté configurado
                    const searchInput = document.getElementById('searchInput');
                    if (searchInput) {
                        searchInput.addEventListener('input', function(e) {
                            window.buscador.handleSearchInput(e.target.value, 'header');
                        });
                    }
                }
            });

            // Asegurar que el scroll esté habilitado en todo momento
            document.body.style.overflow = 'auto';
            document.documentElement.style.overflow = 'auto';

            // Mensaje de consola para desarrollo
            console.log('ModaStyle v' + CURRENT_VERSION + ' - Tienda de Ropa, Accesorios y Hogar');
            console.log('Carrito:', window.carrito ? 'Inicializado' : 'Error');
            console.log('Administración:', window.admin ? 'Disponible' : 'No disponible');
            console.log('Productos cargados:', productos.length);
            console.log('Cupones disponibles:', cupones.length);
            console.log('Ofertas relámpago:', flashSaleConfig.enabled ? 'Activas' : 'Inactivas');
        </script>

</body></html>
